[{"title":"æ¨¡ç‰ˆå…ƒç¼–ç¨‹åº”ç”¨","date":"2019-06-19T02:34:15.000Z","updated":"2019-07-14T01:22:40.191Z","content":"1.æ¦‚è¿°ã€€ã€€å…³äºC++11æ¨¡æ¿å…ƒçš„åŸºæœ¬ç”¨æ³•å’Œå¸¸ç”¨æŠ€å·§ï¼Œåœ¨å¸¸è§„ç¼–ç¨‹ä¸­å¯èƒ½å¾ˆå°‘é‡åˆ°ï¼Œé‚£ä¹ˆC++11æ¨¡ç‰ˆå…ƒç¼–ç¨‹ç”¨æ¥è§£å†³ä»€ä¹ˆå®é™…é—®é¢˜å‘¢ï¼Œåœ¨å®é™…å·¥ç¨‹ä¸­åˆè¯¥å¦‚ä½•åº”ç”¨å‘¢ï¼Ÿæœ¬æ–‡å°†ä¾§é‡ä»‹ç»C++11æ¨¡æ¿çš„ä¸€äº›å…·ä½“åº”ç”¨ï¼Œå‘è¯»è€…å±•ç¤ºæ¨¡ç‰ˆå…ƒç¼–ç¨‹çš„å…·ä½“åº”ç”¨ã€‚\nã€€ã€€æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•é€šè¿‡C++11æ¨¡ç‰ˆå…ƒæ¥å®ç°function_traitsã€Vairantç±»å‹å’Œæ³›å‹bindç»‘å®šå™¨ã€‚function_traitsä¾§é‡äºå¦‚ä½•èƒå–å¯è°ƒç”¨å¯¹è±¡çš„ä¸€äº›å…ƒä¿¡æ¯ï¼ŒVariantåˆ™æ˜¯ä¸€ç§èƒ½æ¥å—å¤šç§ç±»å‹æ•°æ®çš„â€œä¸‡èƒ½â€ç±»å‹ï¼Œbindåˆ™æ˜¯ä¸€ä¸ªæ³›åŒ–çš„ç»‘å®šå™¨ï¼Œä¸‹é¢æ¥çœ‹çœ‹è¿™äº›å…·ä½“çš„ä¾‹å­ã€‚\n\n\nç±»å‹èƒå–ã€€ã€€C++æ¨¡æ¿ä¸­çš„ç±»å‹å‚æ•°Tæ˜¯æŠ½è±¡çš„ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åœ¨æ¨¡æ¿å†…éƒ¨ç›´æ¥è·å¾—å®ƒçš„å…·ä½“ç‰¹å¾ã€‚ç±»å‹èƒå–ï¼ˆæŠ½å–ï¼‰æŠ€æœ¯å°±æ˜¯è¦æŠ½å–ç±»å‹çš„ä¸€äº›å…·ä½“ç‰¹å¾(trait)ï¼Œæ¯”å¦‚å®ƒæ˜¯å“ªç§å…·ä½“ç±»å‹ï¼Œå®ƒæ˜¯å¼•ç”¨ç±»å‹ï¼Œå†…å»ºç±»å‹ï¼Œè¿˜æ˜¯ç±»ç±»å‹ç­‰ã€‚å¯è§ï¼Œç±»å‹èƒå–æŠ€æœ¯å…¶å®å°±æ˜¯traitæ¨¡æ¿æŠ€æœ¯çš„å…·ä½“ä½“ç°ã€‚è·å–ç±»å‹çš„å…·ä½“ç‰¹å¾åœ¨Javaã€C#ç­‰è¯­è¨€ä¸­ä¹Ÿç§°ä¸ºåå°„(reflection)ï¼ŒC++ä¸­é€šè¿‡æ¨¡æ¿æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°ä¸€å®šçš„åå°„è¡Œä¸ºã€‚ã€€ã€€ç±»å‹ä¿¡æ¯æ˜¯ç¼–è¯‘æœŸçš„å®ä½“ï¼Œç°åœ¨è¦é’ˆå¯¹ç±»å‹æ¥è¿›è¡Œç¼–ç¨‹ï¼Œè¿™å…¶å®å°±æ˜¯æ¨¡æ¿å…ƒç¼–ç¨‹çš„ä¸€ä¸ªæ–¹é¢ã€‚æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„if/elseï¼Œwhileï¼Œforç­‰åŸºæœ¬çš„é€»è¾‘ç»“æ„éƒ½æ˜¯è¿è¡ŒæœŸçš„è¡Œä¸ºï¼Œåœ¨é¢å‘ç±»å‹çš„ç¼–ç¨‹ä¸­å¹¶ä¸èƒ½ä½¿ç”¨ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸€äº›ç‰¹æ®Šçš„æ¨¡æ¿æŠ€æœ¯ã€‚å®ç°ç±»å‹èƒå–è¦ç”¨åˆ°çš„åŸºæœ¬æ€æƒ³ä¸€ä¸ªæ˜¯ç‰¹åŒ–ï¼Œä¸€ä¸ªå°±æ˜¯ç”¨typedefæ¥æºå¸¦ç±»å‹ä¿¡æ¯ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ç”¨æ¨¡æ¿åšè®¾è®¡æ—¶ï¼Œä¸€èˆ¬å»ºè®®åœ¨æ¨¡æ¿å®šä¹‰å†…éƒ¨ï¼Œä¸ºæ¨¡æ¿çš„æ¯ä¸ªç±»å‹å‚æ•°æä¾›typedefå®šä¹‰ï¼Œè¿™æ ·åœ¨æ³›å‹ä»£ç ä¸­å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¿é—®æˆ–æŠ½å–è¿™äº›ç±»å‹ã€‚ã€€ã€€åœ¨Cå’ŒC++ä¸­ï¼Œæ™®é€šçš„å‡½æ•°å¯ä»¥ç§°ä¸ºå€¼å‡½æ•°ï¼Œå®ƒä»¬æ¥å—çš„å‚æ•°æ˜¯æŸäº›å€¼ï¼Œè¿”å›çš„ç»“æœä¹Ÿæ˜¯å€¼ã€‚è€Œæ‰€è°“çš„ç±»å‹å‡½æ•°æ¥å—çš„å®å‚æ˜¯ç±»å‹ï¼Œè¿”å›çš„æ˜¯è¢«æŠ½å–å‡ºæ¥çš„ç±»å‹æˆ–å¸¸é‡å€¼ç­‰ï¼ˆå³ç”¨typedefå®šä¹‰çš„ç±»å‹åˆ«åï¼Œä¸€èˆ¬ä¸åŒçš„å…·ä½“ç±»å‹éƒ½å®šä¹‰ç»Ÿä¸€çš„åˆ«åï¼‰ã€‚å¦‚ç±»æ¨¡æ¿å°±æ˜¯ç±»å‹å‡½æ•°ï¼Œsizeofæ˜¯å†…å»ºçš„ç±»å‹å‡½æ•°ï¼Œè¿”å›ç»™å®šç±»å‹å®å‚çš„å¤§å°ã€‚åœ¨ç±»å‹ç¼–ç¨‹ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°sizeofã€‚//ä¸‹é¢æ¼”ç¤ºä¸€äº›æœ‰ç”¨çš„ç±»å‹èƒå–å®ç°ï¼Œè¿™äº›éƒ½æ˜¯ç±»å‹å‡½æ•°ã€‚\n2.function_traitsã€€ã€€function_traitsç”¨æ¥è·å–å‡½æ•°è¯­ä¹‰çš„å¯è°ƒç”¨å¯¹è±¡çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å‡½æ•°ç±»å‹ã€è¿”å›ç±»å‹ã€å‡½æ•°æŒ‡é’ˆç±»å‹å’Œå‚æ•°ç±»å‹ç­‰ã€‚ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•å®ç°function_traitsã€‚\n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;iostream&gt;#include &lt;functional&gt;template&lt;typename T&gt;struct function_traits;//æ™®é€šå‡½æ•°èƒå–template&lt;typename Ret, typename... Args&gt;struct function_traits&lt;Ret(Args...)&gt;&#123;public:    enum &#123; arity = sizeof...(Args) &#125;;    typedef Ret function_type(Args...);    typedef Ret return_type;    using stl_function_type = std::function&lt;function_type&gt;;    typedef Ret(*pointer)(Args...);    template&lt;size_t I&gt;    struct args    &#123;        static_assert(I &lt; arity, \"index is out of range, index must less than sizeof Args\");        using type = typename std::tuple_element&lt;I, std::tuple&lt;Args...&gt;&gt;::type;    &#125;;&#125;;//ç±»å‡½æ•°èƒå–template&lt;typename Ret, typename Class, typename... Args&gt;struct function_traits&lt;Ret(Class::*) (Args...)&gt;&#123;public:    enum &#123; arity = sizeof...(Args) &#125;;    typedef Ret function_type(Args...);    typedef Ret return_type;    using stl_function_type = std::function&lt;function_type&gt;;    typedef Ret(Class::* pointer)(Args...);    typedef Class class_type;    template&lt;size_t I&gt;    struct args    &#123;        static_assert(I &lt; arity, \"index is out of range, index must less than sizeof Args\");        using type = typename std::tuple_element&lt;I, std::tuple&lt;Args...&gt;&gt;::type;    &#125;;&#125;;//å‡½æ•°æŒ‡é’ˆtemplate&lt;typename Ret, typename... Args&gt;struct function_traits&lt;Ret(*)(Args...)&gt; : function_traits&lt;Ret(Args...)&gt; &#123;&#125;;//std::functiontemplate &lt;typename Ret, typename... Args&gt;struct function_traits&lt;std::function&lt;Ret(Args...)&gt;&gt; : function_traits&lt;Ret(Args...)&gt; &#123;&#125;;//member functiontemplate &lt;typename ReturnType, typename ClassType, typename... Args&gt;struct function_traits&lt;ReturnType(ClassType::*)(Args...) const&gt; : function_traits&lt;ReturnType(ClassType::*)(Args...)&gt; &#123;&#125;;//å‡½æ•°å¯¹è±¡template&lt;typename Callable&gt;struct function_traits : function_traits&lt;decltype(&amp;Callable::operator())&gt; &#123;&#125;;\n\nç”±äºå¯è°ƒç”¨å¯¹è±¡å¯èƒ½æ˜¯æ™®é€šçš„å‡½æ•°ã€å‡½æ•°æŒ‡é’ˆã€lambdaã€std::functionå’Œæˆå‘˜å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹è¿™äº›ç±»å‹åˆ†åˆ«åšåç‰¹åŒ–ï¼Œç„¶åèƒå–å‡ºå¯è°ƒç”¨å¯¹è±¡çš„å…ƒä¿¡æ¯ã€‚å…¶ä¸­ï¼Œæˆå‘˜å‡½æ•°çš„åç‰¹åŒ–ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæ¶‰åŠåˆ°cvç¬¦çš„å¤„ç†ï¼Œè¿™é‡Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå®æ¥æ¶ˆé™¤é‡å¤çš„æ¨¡æ¿ç±»å®šä¹‰ã€‚å‚æ•°ç±»å‹çš„è·å–æˆ‘ä»¬æ˜¯å€ŸåŠ©äºtupleï¼Œå°†å‚æ•°è½¬æ¢ä¸ºtupleç±»å‹ï¼Œç„¶åæ ¹æ®ç´¢å¼•æ¥è·å–å¯¹åº”ç±»å‹ã€‚å®ƒçš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼š\n1234567891011121314151617181920212223242526272829303132333435363738394041424344//ç±»å‡½æ•°struct S&#123;    inline void fun(const char*) &#123;&#125;;&#125;;//æ™®é€šå‡½æ•°double fun() &#123; return 0.1; &#125;;template&lt;typename T&gt;void PrintType()&#123;    std::cout &lt;&lt; typeid(T).name() &lt;&lt; std::endl;&#125;int main()&#123;\t\tvoid (S::* cfptr)(const char*) = &amp;S::fun; // class fnptr    double (*fptr)() = fun; //fnptr    std::function&lt;int(int)&gt; f = [](int a) &#123;return a; &#125;;  //function    auto lambda = [](int a) &#123;return a; &#125;; // lambda    //æ‰“å°å‡½æ•°ç±»å‹    PrintType&lt;function_traits&lt;decltype(fptr)&gt;::function_type&gt;(); //å°†è¾“å‡ºdouble __cdecl&lt;void&gt;      //æ‰“å°ç±»å‡½æ•°æŒ‡é’ˆç±»å‹    PrintType&lt;function_traits&lt;decltype(&amp;cfptr)&gt;::pointer&gt;(); //å°†è¾“å‡ºvoid &lt;__thiscall S::*&gt;&lt;char const *&gt;    //æ‰“å°å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹    PrintType&lt;function_traits&lt;std::function&lt;int(bool)&gt;&gt;::args&lt;0&gt;::type&gt;();//å°†è¾“å‡ºbool    //æ‰“å°å‡½æ•°çš„è¿”å›ç±»å‹    PrintType&lt;function_traits&lt;decltype(f)&gt;::return_type&gt;(); //å°†è¾“å‡ºint    //æ‰“å°å‡½æ•°æŒ‡é’ˆç±»å‹    PrintType&lt;function_traits&lt;decltype(f)&gt;::pointer&gt;(); //å°†è¾“å‡ºint &lt;__cdecl*&gt;&lt;int&gt;    //æ‰“å°functionå‡½æ•°ç±»å‹    PrintType&lt;function_traits&lt;decltype(f)&gt;::stl_function_type&gt;(); //å°†è¾“å‡ºclass std::function&lt;int __cdecl&lt;int&gt;&gt;    //lambda =&gt; éšå¼è½¬åŒ–ä¸ºäº†åŒ¿åç±»å¯¹è±¡    PrintType&lt;function_traits&lt;decltype(lambda)&gt;::class_type&gt;(); //å°†è¾“å‡ºclass &lt;lambda_13vr3tgewf32rt23rfgt435g41239da&gt;&#125;\n\ngun gccä¸‹ï¼š\n1234567FdvEbiPFiiESt8functionIFiiEEZ4mainEUliE0_M1SFvPKcE\n\nVisual studioä¸‹ï¼š\n1234567double __cdecl(void)void (__thiscall S::*)(char const *)boolintint (__cdecl*)(int)class std::function&lt;int __cdecl(int)&gt;class &lt;lambda_173ed6f42b6e4df55bf9ec2e4778d93a&gt;\n\nå…¶å®ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆå¯ä»¥å‚è€ƒè¿™é‡Œ\nå¯ä»¥çœ‹åˆ°è¿™ä¸ªfunction_traitsé€šè¿‡ç±»å‹èƒå–ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è·å–å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ã€std::functionå’Œlambdaè¡¨è¾¾å¼ï¼‰çš„ä¸€äº›å…ƒä¿¡æ¯ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œè¿™ä¸ªfunction_traitsç»å¸¸ä¼šç”¨åˆ°æ˜¯æ›´é«˜å±‚æ¨¡ç‰ˆå…ƒç¨‹åºçš„åŸºç¡€ã€‚æ¯”å¦‚Variantç±»å‹çš„å®ç°å°±è¦ç”¨åˆ°è¿™ä¸ªfunction_traitsï¼Œä¸‹é¢æ¥çœ‹çœ‹Variantçš„å®ç°ã€‚\n3.Variantã€€ã€€å€ŸåŠ©ä¸Šé¢çš„function_traitså’Œå‰æ–‡å®ç°çš„ä¸€äº›å…ƒå‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½æ–¹ä¾¿çš„å®ç°ä¸€ä¸ªâ€œä¸‡èƒ½ç±»å‹â€â€”Variantï¼ŒVariantå®é™…ä¸Šä¸€ä¸ªæ³›åŒ–çš„ç±»å‹ï¼Œè¿™ä¸ªVariantå’Œboost.variantçš„ç”¨æ³•ç±»ä¼¼ï¼Œéœ€è¦é¢„å®šä¹‰ä¸€äº›ç±»å‹ä½œä¸ºå¯æ¥å—çš„ç±»å‹ã€‚boost.variantçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š\n1234typedef variant&lt;int,char, double&gt; vt;vt v = 1;v = 'a';v = 12.32;\n\nã€€ã€€è¿™ä¸ªvariantå¯ä»¥æ¥å—å·²ç»å®šä¹‰çš„é‚£äº›ç±»å‹ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼äºc#å’Œjavaä¸­çš„objectç±»å‹ï¼Œå®é™…ä¸Švariantæ˜¯æ“¦é™¤äº†ç±»å‹ï¼Œè¦è·å–å®ƒçš„å®é™…ç±»å‹çš„æ—¶å€™å°±ç¨æ˜¾éº»çƒ¦ï¼Œéœ€è¦é€šè¿‡boost.visitoræ¥è®¿é—®ï¼š\n12345678910111213141516171819202122232425struct VariantVisitor : public boost::static_visitor&lt;void&gt;&#123;    void operator() (int a)    &#123;        cout &lt;&lt; \"int\" &lt;&lt; endl;    &#125;    void operator() (short val)    &#123;        cout &lt;&lt; \"short\" &lt;&lt; endl;    &#125;    void operator() (double val)    &#123;        cout &lt;&lt; \"double\" &lt;&lt; endl;    &#125;    void operator() (std::string val)    &#123;        cout &lt;&lt; \"string\" &lt;&lt; endl;    &#125;&#125;;boost::variant&lt;int,short,double,std::string&gt; v = 1;boost::apply_visitor(visitor, v); //å°†è¾“å‡ºint\n\nâ€‹    ã€€é€šè¿‡C++11æ¨¡ç‰ˆå…ƒå®ç°çš„Variantå°†æ”¹è¿›å€¼çš„è·å–ï¼Œå°†è·å–å®é™…å€¼çš„æ–¹å¼æ”¹ä¸ºå†…ç½®çš„ï¼Œå³é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥è®¿é—®ï¼š\n123typedef Variant&lt;int, double, string, int&gt; cv;cv v = 10;v.Visit([&amp;](double i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;, [](short i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;, [=](int i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;,[](const string&amp; i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;);//ç»“æœå°†è¾“å‡º10\n\nã€€è¿™ç§æ–¹å¼æ›´æ–¹ä¾¿ç›´è§‚ã€‚Variantçš„å®ç°éœ€è¦å€ŸåŠ©å‰æ–‡ä¸­å®ç°çš„ä¸€äº›å…ƒå‡½æ•°MaxIntegerã€MaxAlignã€Containså’ŒAtç­‰ç­‰ã€‚å¯ä»¥åœ¨ä¸‹é¢çš„tabä¸­å±•å¼€è§‚çœ‹ï¼Œä¸‹é¢æ¥çœ‹çœ‹Variantå®ç°çš„å…³é”®ä»£ç ã€‚IntegerMaxä»£ç ï¼š\n1234567891011121314/** è·å–æ•´æ•°åˆ—è¡¨ä¸­æœ€å¤§çš„æ•´æ•° */template &lt;std::size_t arg, std::size_t... rest&gt;struct IntegerMax;template &lt;std::size_t arg&gt;struct IntegerMax&lt;arg&gt; : std::integral_constant&lt;std::size_t, arg&gt;&#123;&#125;;template &lt;std::size_t arg1, std::size_t arg2, std::size_t... rest&gt;struct IntegerMax&lt;arg1, arg2, rest...&gt; : std::integral_constant&lt;std::size_t, arg1 &gt;= arg2 ? IntegerMax&lt;arg1, rest...&gt;::value    : IntegerMax&lt;arg2, rest...&gt;::value&gt;&#123;&#125;;\n\nMaxAlignä»£ç ï¼š\n12345/** è·å–æœ€å¤§çš„align */template&lt;typename... Args&gt;struct MaxAlign : std::integral_constant&lt;int, IntegerMax&lt;std::alignment_of&lt;Args&gt;::value...&gt;::value&gt;&#123;&#125;;\n\nContainsä»£ç ï¼š\n1234567891011121314/** æ˜¯å¦åŒ…å«æŸä¸ªç±»å‹ */template &lt;typename T, typename... List&gt;struct Contains;template &lt;typename T, typename Head, typename... Rest&gt;struct Contains&lt;T, Head, Rest...&gt;    : std::conditional&lt;std::is_same&lt;T, Head&gt;::value, std::true_type, Contains&lt;T, Rest... &gt;&gt; ::type&#123;&#125;;template &lt;typename T&gt;struct Contains&lt;T&gt; : std::false_type&#123;&#125;;\n\nIndexOfä»£ç ï¼š\n1234567891011121314151617181920template &lt;typename T, typename... List&gt;struct IndexOf;template &lt;typename T, typename Head, typename... Rest&gt;struct IndexOf&lt;T, Head, Rest...&gt;&#123;    enum &#123; value = IndexOf&lt;T, Rest...&gt;::value + 1 &#125;;&#125;;template &lt;typename T, typename... Rest&gt;struct IndexOf&lt;T, T, Rest...&gt;&#123;    enum &#123; value = 0 &#125;;&#125;;template &lt;typename T&gt;struct IndexOf&lt;T&gt;&#123;    enum&#123;value = -1&#125;;&#125;;\n\nAtä»£ç ï¼š\n1234567891011121314template&lt;int index, typename... Types&gt;struct At;template&lt;int index, typename First, typename... Types&gt;struct At&lt;index, First, Types...&gt;&#123;    using type = typename At&lt;index - 1, Types...&gt;::type;&#125;;template&lt;typename T, typename... Types&gt;struct At&lt;0, T, Types...&gt;&#123;    using type = T;&#125;;\n\nVariantå…³é”®ä»£ç ï¼š\n12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697template&lt;typename... Types&gt;class Variant&#123;    enum&#123;        data_size = IntegerMax&lt;sizeof(Types)...&gt;::value, //å‚æ•°ä¸ªæ•°        align_size = MaxAlign&lt;Types...&gt;::value\t//å‚æ•°æœ€å¤§å­—èŠ‚æ•°    &#125;;    using data_t = typename std::aligned_storage&lt;data_size, align_size&gt;::type;public:    template&lt;int index&gt;    using IndexType = typename At&lt;index, Types...&gt;::type;    Variant(void) :m_typeIndex(typeid(void))&#123;&#125;    ~Variant()&#123; Destroy(m_typeIndex, &amp;m_data); &#125;    Variant(Variant&lt;Types...&gt;&amp;&amp; old) : m_typeIndex(old.m_typeIndex)&#123;        Move(old.m_typeIndex, &amp;old.m_data, &amp;m_data);    &#125;    Variant(const Variant&lt;Types...&gt;&amp; old) : m_typeIndex(old.m_typeIndex)&#123;        Copy(old.m_typeIndex, &amp;old.m_data, &amp;m_data);    &#125;    template &lt;class T,    class = typename std::enable_if&lt;Contains&lt;typename std::remove_reference&lt;T&gt;::type, Types...&gt;::value&gt;::type&gt; Variant(T&amp;&amp; value) : m_typeIndex(typeid(void))&#123;            Destroy(m_typeIndex, &amp;m_data);            typedef typename std::remove_reference&lt;T&gt;::type U;            new(&amp;m_data) U(std::forward&lt;T&gt;(value));            m_typeIndex = type_index(typeid(U));    &#125;    template&lt;typename T&gt;    bool Is() const&#123;        return (m_typeIndex == type_index(typeid(T)));    &#125;    template&lt;typename T&gt;    typename std::decay&lt;T&gt;::type&amp; Get()&#123;        using U = typename std::decay&lt;T&gt;::type;        if (!Is&lt;U&gt;())        &#123;            cout &lt;&lt; typeid(U).name() &lt;&lt; \" is not defined. \" &lt;&lt; \"current type is \" &lt;&lt;                m_typeIndex.name() &lt;&lt; endl;            throw std::bad_cast();        &#125;        return *(U*)(&amp;m_data);    &#125;    template&lt;typename F&gt;    void Visit(F&amp;&amp; f)&#123;        using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type;        if (Is&lt;T&gt;())            f(Get&lt;T&gt;());    &#125;    template&lt;typename F, typename... Rest&gt;    void Visit(F&amp;&amp; f, Rest&amp;&amp;... rest)&#123;        using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type;        if (Is&lt;T&gt;())            Visit(std::forward&lt;F&gt;(f));        else            Visit(std::forward&lt;Rest&gt;(rest)...);    &#125;private:    void Destroy(const type_index&amp; index, void * buf)&#123;        std::initializer_list&lt;int&gt;&#123;(Destroy0&lt;Types&gt;(index, buf), 0)...&#125;;    &#125;    template&lt;typename T&gt;    void Destroy0(const type_index&amp; id, void* data)&#123;        if (id == type_index(typeid(T)))            reinterpret_cast&lt;T*&gt;(data)-&gt;~T();    &#125;    void Move(const type_index&amp; old_t, void* old_v, void* new_v) &#123;        std::initializer_list&lt;int&gt;&#123;(Move0&lt;Types&gt;(old_t, old_v, new_v), 0)...&#125;;    &#125;    template&lt;typename T&gt;    void Move0(const type_index&amp; old_t, void* old_v, void* new_v)&#123;        if (old_t == type_index(typeid(T)))            new (new_v)T(std::move(*reinterpret_cast&lt;T*&gt;(old_v)));    &#125;    void Copy(const type_index&amp; old_t, void* old_v, void* new_v)&#123;        std::initializer_list&lt;int&gt;&#123;(Copy0&lt;Types&gt;(old_t, old_v, new_v), 0)...&#125;;    &#125;    template&lt;typename T&gt;    void Copy0(const type_index&amp; old_t, void* old_v, void* new_v)&#123;        if (old_t == type_index(typeid(T)))            new (new_v)T(*reinterpret_cast&lt;const T*&gt;(old_v));    &#125;private:    data_t m_data;    std::type_index m_typeIndex;//ç±»å‹ID&#125;;\n\nã€€å®ç°Varianté¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å†²åŒºç”¨æ¥å­˜æ”¾ä¸åŒçš„ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªç¼“ç±»å‹å†²åŒºå®é™…ä¸Šå°±æ˜¯ç”¨æ¥æ“¦é™¤ç±»å‹ï¼Œä¸åŒçš„ç±»å‹éƒ½é€šè¿‡placement newåœ¨è¿™ä¸ªç¼“å†²åŒºä¸Šåˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºç±»å‹é•¿åº¦ä¸åŒï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘å†…å­˜å¯¹é½ï¼ŒC++11åˆšå¥½æä¾›äº†å†…å­˜å¯¹é½çš„ç¼“å†²åŒºaligned_storageï¼š\n12template&lt; std::size_t Len, std::size_t Align = /*default-alignment*/ &gt;struct aligned_storage;\n\nå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºçš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºå†…å­˜å¯¹é½çš„å¤§å°ï¼Œç”±äºVaraintå¯ä»¥æ¥å—å¤šç§ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è·å–æœ€å¤§çš„ç±»å‹é•¿åº¦ï¼Œä¿è¯ç¼“å†²åŒºè¶³å¤Ÿå¤§ï¼Œç„¶åè¿˜è¦è·å–æœ€å¤§çš„å†…å­˜å¯¹é½å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å‰é¢å®ç°çš„MaxIntegerå’ŒMaxAlignå°±å¯ä»¥äº†ï¼ŒVaraintä¸­å†…å­˜å¯¹é½çš„ç¼“å†²åŒºå®šä¹‰å¦‚ä¸‹ï¼š\n1234567enum&#123;        data_size = IntegerMax&lt;sizeof(Types)...&gt;::value,        align_size = MaxAlign&lt;Types...&gt;::value&#125;;using data_t = typename std::aligned_storage&lt;data_size, align_size&gt;::type; //å†…å­˜å¯¹é½çš„ç¼“å†²åŒºç±»å‹\n\nå…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜è¦å®ç°å¯¹ç¼“å†²åŒºçš„æ„é€ ã€æ‹·è´ã€ææ„å’Œç§»åŠ¨ï¼Œå› ä¸ºVarianté‡æ–°èµ‹å€¼çš„æ—¶å€™éœ€è¦å°†ç¼“å†²åŒºä¸­åŸæ¥çš„ç±»å‹ææ„æ‰ï¼Œæ‹·è´æ„é€ å’Œç§»åŠ¨æ„é€ æ—¶åˆ™éœ€è¦æ‹·è´å’Œç§»åŠ¨ã€‚è¿™é‡Œä»¥ææ„ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å½“å‰çš„type_indexæ¥éå†Variantçš„æ‰€æœ‰ç±»å‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç±»å‹ç„¶åè°ƒç”¨è¯¥ç±»å‹çš„ææ„å‡½æ•°ã€‚\n123456789101112ã€€ã€€ void Destroy(const type_index&amp; index, void * buf)&#123;    std::initializer_list&lt;int&gt;&#123;(Destroy0&lt;Types&gt;(index, buf), 0)...&#125;; //è¿™é‡Œé€šè¿‡ä¸€ä¸ªåˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ä¸€ä¸ªå˜é•¿æ•°ç»„ï¼Œintæ•°ç»„çš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨æ•°ç»„æ„é€ çš„è¿‡ç¨‹å±•å¼€å‚æ•°åŒ…&#125;template&lt;typename T&gt;void Destroy0(const type_index&amp; id, void* data)&#123;    if (id == type_index(typeid(T)))        reinterpret_cast&lt;T*&gt;(data)-&gt;~T();&#125;\n\nè¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨å’Œé€—å·è¡¨è¾¾å¼æ¥å±•å¼€å¯å˜æ¨¡æ¿å‚æ•°ï¼Œåœ¨å±•å¼€çš„è¿‡ç¨‹ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç±»å‹ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™ææ„ã€‚åœ¨Variantæ„é€ æ—¶è¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼ŒVariantä¸èƒ½æ¥å—æ²¡æœ‰é¢„å…ˆå®šä¹‰çš„ç±»å‹ï¼Œæ‰€ä»¥åœ¨æ„é€ Variantæ—¶ï¼Œéœ€è¦é™å®šç±»å‹å¿…é¡»åœ¨é¢„å®šä¹‰çš„ç±»å‹èŒƒå›´å½“ä¸­ï¼Œè¿™é‡Œé€šè¿‡type_traitsçš„enable_ifæ¥é™å®šæ¨¡æ¿å‚æ•°çš„ç±»å‹ã€‚\n1234567template &lt;class T,    class = typename std::enable_if&lt;Contains&lt;typename std::remove_reference&lt;T&gt;::type, Types...&gt;::value&gt;::type&gt; Variant(T&amp;&amp; value) : m_typeIndex(typeid(void))&#123;            Destroy(m_typeIndex, &amp;m_data);            typedef typename std::remove_reference&lt;T&gt;::type U;            new(&amp;m_data) U(std::forward&lt;T&gt;(value));            m_typeIndex = type_index(typeid(U));    &#125;\n\nè¿™é‡Œenbale_ifçš„æ¡ä»¶å°±æ˜¯å‰é¢å®ç°çš„å…ƒå‡½æ•°Containsçš„å€¼ï¼Œå½“æ²¡æœ‰åœ¨é¢„å®šä¹‰çš„ç±»å‹ä¸­æ‰¾åˆ°å¯¹åº”çš„ç±»å‹æ—¶ï¼Œå³Containsè¿”å›falseæ—¶ï¼Œç¼–è¯‘æœŸä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚\næœ€åè¿˜éœ€è¦å®ç°å†…ç½®çš„VistitåŠŸèƒ½ï¼ŒVisitçš„å®ç°éœ€è¦å…ˆé€šè¿‡å®šä¹‰ä¸€ç³»åˆ—çš„è®¿é—®å‡½æ•°ï¼Œç„¶åå†éå†è¿™äº›å‡½æ•°ï¼Œéå†è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹çš„type_indexæ˜¯å¦ä¸å½“å‰çš„type_indexç›¸åŒï¼Œå¦‚æœç›¸åŒåˆ™è·å–å½“å‰ç±»å‹çš„å€¼ã€‚\n123456789101112131415template&lt;typename F&gt;    void Visit(F&amp;&amp; f)&#123;        using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type;        if (Is&lt;T&gt;())            f(Get&lt;T&gt;());    &#125;    template&lt;typename F, typename... Rest&gt;    void Visit(F&amp;&amp; f, Rest&amp;&amp;... rest)&#123;        using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type;        if (Is&lt;T&gt;())            Visit(std::forward&lt;F&gt;(f));        else            Visit(std::forward&lt;Rest&gt;(rest)...);    &#125;\n\nã€€VisitåŠŸèƒ½çš„å®ç°åˆ©ç”¨äº†å¯å˜æ¨¡æ¿å‚æ•°å’Œfunction_traitsï¼Œé€šè¿‡å¯å˜æ¨¡æ¿å‚æ•°æ¥éå†ä¸€ç³»åˆ—çš„è®¿é—®å‡½æ•°ï¼Œéå†è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡function_traitsæ¥è·å–ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œå’ŒVariantå½“å‰çš„type_indexç›¸åŒæ—¶åˆ™å–å€¼ã€‚ä¸ºä»€ä¹ˆè¦è·å–è®¿é—®å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹å‘¢ï¼Ÿå› ä¸ºVariantçš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œåªæœ‰ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥è·å–çš„è®¿é—®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹å°±æ˜¯Variantä¸­å­˜å‚¨çš„å¯¹è±¡çš„å®é™…ç±»å‹ã€‚\næœªå®Œå¾…ç»­ã€‚ã€‚ã€‚\n","plink":"https://shuntan.github.io/posts/æ¨¡ç‰ˆå…ƒç¼–ç¨‹åº”ç”¨/"},{"title":"C++ä¸­ä¼˜é›…çš„å¼‚æ­¥æ“ä½œ","date":"2019-06-14T06:21:26.000Z","updated":"2019-07-14T01:23:00.129Z","content":"ã€€ã€€c++11ä¸­å¢åŠ äº†çº¿ç¨‹ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„åˆ›å»ºçº¿ç¨‹ï¼Œå®ƒçš„åŸºæœ¬ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼š\n123void f(int n);std::thread t(f, n + 1);t.join();\n\nã€€ã€€ä½†æ˜¯çº¿ç¨‹æ¯•ç«Ÿæ˜¯å±äºæ¯”è¾ƒä½å±‚æ¬¡çš„ä¸œè¥¿ï¼Œæœ‰æ—¶å€™ä½¿ç”¨æœ‰äº›ä¸ä¾¿ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›è·å–çº¿ç¨‹å‡½æ•°çš„è¿”å›ç»“æœçš„æ—¶å€™ï¼Œæˆ‘å°±ä¸èƒ½ç›´æ¥é€šè¿‡thread.join()å¾—åˆ°ç»“æœï¼Œè¿™æ—¶å°±å¿…é¡»å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œåœ¨çº¿ç¨‹å‡½æ•°ä¸­å»ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œç„¶åjoin,æœ€åå¾—åˆ°ç»“æœï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒç¹ççš„ã€‚c++11è¿˜æä¾›äº†å¼‚æ­¥æ¥å£std::asyncï¼Œé€šè¿‡è¿™ä¸ªå¼‚æ­¥æ¥å£å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å–çº¿ç¨‹å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚std::asyncä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨çº¿ç¨‹å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªstd::futureï¼Œè¿™ä¸ªfutureä¸­å­˜å‚¨äº†çº¿ç¨‹å‡½æ•°è¿”å›çš„ç»“æœï¼Œå½“æˆ‘ä»¬éœ€è¦çº¿ç¨‹å‡½æ•°çš„ç»“æœæ—¶ï¼Œç›´æ¥ä»futureä¸­è·å–ï¼Œéå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå…¶å®std::asyncç»™æˆ‘ä»¬æä¾›çš„ä¾¿åˆ©å¯ä¸ä»…ä»…æ˜¯è¿™ä¸€ç‚¹ï¼Œå®ƒé¦–å…ˆè§£è€¦äº†çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœï¼›å…¶æ¬¡å®ƒè¿˜æä¾›äº†çº¿ç¨‹çš„åˆ›å»ºç­–ç•¥ï¼ˆæ¯”å¦‚å¯ä»¥é€šè¿‡å»¶è¿ŸåŠ è½½çš„æ–¹å¼å»åˆ›å»ºçº¿ç¨‹ï¼‰ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥å¤šç§æ–¹å¼å»åˆ›å»ºçº¿ç¨‹ã€‚åœ¨ä»‹ç»asyncå…·ä½“ç”¨æ³•ä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨std::asyncä»£æ›¿çº¿ç¨‹çš„åˆ›å»ºä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯´ä¸€è¯´std::futureã€std::promiseå’Œstd::packaged_taskã€‚\n\n\nstd::futurã€€ã€€std::futureæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨ä¹Ÿå¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œç®€å•è¯´std::futureæä¾›äº†ä¸€ç§è®¿é—®å¼‚æ­¥æ“ä½œç»“æœçš„æœºåˆ¶ã€‚ä»å­—é¢æ„æ€æ¥ç†è§£ï¼Œå®ƒè¡¨ç¤ºæœªæ¥ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåå­—éå¸¸è´´åˆ‡ï¼Œå› ä¸ºä¸€ä¸ªå¼‚æ­¥æ“ä½œæˆ‘ä»¬æ˜¯ä¸å¯èƒ½é©¬ä¸Šå°±è·å–æ“ä½œç»“æœçš„ï¼Œåªèƒ½åœ¨æœªæ¥æŸä¸ªæ—¶å€™è·å–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»¥åŒæ­¥ç­‰å¾…çš„æ–¹å¼æ¥è·å–ç»“æœï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢futureçš„çŠ¶æ€ï¼ˆfuture_statusï¼‰æ¥è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚future_statusæœ‰ä¸‰ç§çŠ¶æ€ï¼š\n\ndeferredï¼šå¼‚æ­¥æ“ä½œè¿˜æ²¡å¼€å§‹\nreadyï¼šå¼‚æ­¥æ“ä½œå·²ç»å®Œæˆ\ntimeoutï¼šå¼‚æ­¥æ“ä½œè¶…æ—¶\n\n123456789101112//æŸ¥è¯¢futureçš„çŠ¶æ€std::future_status status;    do &#123;        status = future.wait_for(std::chrono::seconds(1));        if (status == std::future_status::deferred) &#123;            std::cout &lt;&lt; \"deferred\\n\"; //ä»£è¡¨å»¶è¿Ÿæ‰§è¡Œ        &#125; else if (status == std::future_status::timeout) &#123;            std::cout &lt;&lt; \"timeout\\n\";  //ä»£è¡¨æ‰§è¡Œä¸­        &#125; else if (status == std::future_status::ready) &#123;            std::cout &lt;&lt; \"ready!\\n\";   //ä»£è¡¨å·²ç»æ‰§è¡Œå®Œæˆ        &#125;    &#125; while (status != std::future_status::ready);\n\nã€€ã€€è·å–futureç»“æœæœ‰ä¸‰ç§æ–¹å¼ï¼šgetã€waitã€wait_forï¼Œå…¶ä¸­getç­‰å¾…å¼‚æ­¥æ“ä½œç»“æŸå¹¶è¿”å›ç»“æœï¼Œwaitåªæ˜¯ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œwait_foræ˜¯è¶…æ—¶ç­‰å¾…è¿”å›ç»“æœã€‚\nstd::promiseã€€ã€€std::promiseä¸ºè·å–çº¿ç¨‹å‡½æ•°ä¸­çš„æŸä¸ªå€¼æä¾›ä¾¿åˆ©ï¼Œåœ¨çº¿ç¨‹å‡½æ•°ä¸­ç»™å¤–é¢ä¼ è¿›æ¥çš„promiseèµ‹å€¼ï¼Œå½“çº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå°±å¯ä»¥é€šè¿‡promisè·å–è¯¥å€¼äº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å–å€¼æ˜¯é—´æ¥çš„é€šè¿‡promiseå†…éƒ¨æä¾›çš„futureæ¥è·å–çš„ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼š\n1234std::promise&lt;int&gt; pr;std::thread t([](std::promise&lt;int&gt;&amp; p)&#123; p.set_value_at_thread_exit(9); &#125;,std::ref(pr));std::future&lt;int&gt; f = pr.get_future();auto r = f.get();\n\nstd::packaged_taskã€€ã€€std::packaged_taskå®ƒåŒ…è£…äº†ä¸€ä¸ªå¯è°ƒç”¨çš„ç›®æ ‡ï¼ˆå¦‚function, lambda expression, bind expression, or another function objectï¼‰,ä»¥ä¾¿å¼‚æ­¥è°ƒç”¨ï¼Œå®ƒå’Œpromiseåœ¨æŸç§ç¨‹åº¦ä¸Šæœ‰ç‚¹åƒï¼Œpromiseä¿å­˜äº†ä¸€ä¸ªå…±äº«çŠ¶æ€çš„å€¼ï¼Œè€Œpackaged_taskä¿å­˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼š\n1234std::packaged_task&lt;int()&gt; task([]()&#123; return 7; &#125;);std::thread t1(std::ref(task)); std::future&lt;int&gt; f1 = task.get_future(); auto r1 = f1.get();\n\nstd::promiseã€std::packaged_taskå’Œstd::futureçš„å…³ç³»ã€€ã€€è‡³æ­¤, æˆ‘ä»¬ä»‹ç»äº†std::asyncç›¸å…³çš„å‡ ä¸ªå¯¹è±¡std::futureã€std::promiseå’Œstd::packaged_taskï¼Œå…¶ä¸­std::promiseå’Œstd::packaged_taskçš„ç»“æœæœ€ç»ˆéƒ½æ˜¯é€šè¿‡å…¶å†…éƒ¨çš„futureè¿”å›å‡ºæ¥çš„ï¼Œä¸çŸ¥é“è¯»è€…æœ‰æ²¡æœ‰æç³Šæ¶‚ï¼Œä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šä¸œè¥¿å‡ºæ¥ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»åˆ°åº•æ˜¯æ€æ ·çš„ï¼Ÿä¸”å¬æˆ‘æ…¢æ…¢é“æ¥ï¼Œstd::futureæä¾›äº†ä¸€ä¸ªè®¿é—®å¼‚æ­¥æ“ä½œç»“æœçš„æœºåˆ¶ï¼Œå®ƒå’Œçº¿ç¨‹æ˜¯ä¸€ä¸ªçº§åˆ«çš„å±äºä½å±‚æ¬¡çš„å¯¹è±¡ï¼Œåœ¨å®ƒä¹‹ä¸Šé«˜ä¸€å±‚çš„æ˜¯std::packaged_taskå’Œstd::promiseï¼Œä»–ä»¬å†…éƒ¨éƒ½æœ‰futureä»¥ä¾¿è®¿é—®å¼‚æ­¥æ“ä½œç»“æœï¼Œstd::packaged_taskåŒ…è£…çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè€Œstd::promiseåŒ…è£…çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œéƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿å¼‚æ­¥æ“ä½œçš„ï¼Œå› ä¸ºæœ‰æ—¶æˆ‘éœ€è¦è·å–çº¿ç¨‹ä¸­çš„æŸä¸ªå€¼ï¼Œè¿™æ—¶å°±ç”¨std::promiseï¼Œè€Œæœ‰æ—¶æˆ‘éœ€è¦è·ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„è¿”å›å€¼ï¼Œè¿™æ—¶å°±ç”¨std::packaged_taskã€‚é‚£std::promiseå’Œstd::packaged_taskä¹‹é—´åˆæ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿè¯´ä»–ä»¬æ²¡å…³ç³»ä¹Ÿå…³ç³»ï¼Œè¯´ä»–ä»¬æœ‰å…³ç³»ä¹Ÿæœ‰å…³ç³»ï¼Œéƒ½å–å†³äºä½ äº†ï¼Œå› ä¸ºæˆ‘å¯ä»¥å°†ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœä¿å­˜åˆ°std::promiseä¸­ã€‚å¦‚æœè¯»è€…è¿˜æ²¡ææ¸…æ¥šä»–ä»¬çš„å…³ç³»çš„è¯ï¼Œæˆ‘å°±ç”¨æ›´é€šä¿—çš„è¯æ¥è§£é‡Šä¸€ä¸‹ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå°ä¼™å­ç»™ä¸€ä¸ªå§‘å¨˜è¡¨ç™½çœŸå¿ƒçš„æ—¶å€™ä¹Ÿè®¸ä¼šè¯´ï¼šâ€æˆ‘è®¸è¯ºä¼šç»™ä½ ä¸€ä¸ªç¾å¥½çš„æœªæ¥â€œæˆ–è€…â€æˆ‘ä¼šåŠªåŠ›å¥‹æ–—ä¸ºä½ åˆ›é€ ä¸€ä¸ªç¾å¥½çš„æœªæ¥â€œã€‚å§‘å¨˜å¾€å¾€ä¼šè¯´ï¼šâ€æˆ‘ç­‰ç€â€œã€‚ç°åœ¨æˆ‘æ¥å°†è¿™ä¸‰å¥è¯ç”¨c++11æ¥ç¿»è¯‘ä¸€ä¸‹ï¼š\nå°ä¼™å­è¯´ï¼šæˆ‘è®¸è¯ºä¼šç»™ä½ ä¸€ä¸ªç¾å¥½çš„æœªæ¥ç­‰äºc++11ä¸­â€std::promise a std::futureâ€;å°ä¼™å­è¯´ï¼šæˆ‘ä¼šåŠªåŠ›å¥‹æ–—ä¸ºä½ åˆ›é€ ä¸€ä¸ªç¾å¥½çš„æœªæ¥ç­‰äºc++11ä¸­â€std::packaged_task a futureâ€;å§‘å¨˜è¯´ï¼šæˆ‘ç­‰ç€ç­‰äºc++11ä¸­â€future.get()/wait()â€;\nã€€ã€€å°ä¼™å­ä¸¤å¥è¯çš„ä¸ªä¸­å·®å¼‚ï¼Œè‡ªå·±ç¢ç£¨ä¸€ä¸‹ï¼Œè¿™ç‚¹å·®å¼‚ä¹Ÿæ˜¯std::promiseå’Œstd::packaged_taskçš„å·®å¼‚ã€‚ç°å®ä¸­çš„å±±ç›Ÿæµ·èª“é ä¸é å¾—ä½æˆ‘ä¸çŸ¥é“ï¼Œä½†æ˜¯c++11ä¸­çš„è®¸è¯ºå’Œæœªæ¥æ˜¯ä¸€å®šå¯é çš„ï¼Œå‘èµ·æ¥äº†è®¸è¯ºå°±ä¸€å®šæœ‰æœªæ¥ã€‚ç»†æƒ³èµ·æ¥c++11æ ‡å‡†çš„åˆ¶å®šè€…é€‰å®šçš„å…³é”®å­—çœŸæ˜¯è´´åˆ‡è€Œæœ‰æ„æ€ï¼å¥½äº†ï¼Œæ’ç§‘æ‰“è¯¨åˆ°æ­¤äº†ï¼Œç°åœ¨è¨€å½’æ­£ä¼ ï¼Œå›è¿‡å¤´æ¥è¯´è¯´std::asyncã€‚\nä¸ºä»€ä¹ˆè¦ç”¨std::asyncä»£æ›¿çº¿ç¨‹çš„åˆ›å»ºã€€ã€€std::asyncåˆæ˜¯å¹²å•¥çš„ï¼Œå·²ç»æœ‰äº†td::futureã€std::promiseå’Œstd::packaged_taskï¼Œå¤Ÿå¤šçš„äº†ï¼ŒçœŸçš„è¿˜è¦ä¸€ä¸ªstd::asyncæ¥å‡‘çƒ­é—¹å—ï¼Œstd::asyncè¡¨ç¤ºå¾ˆå§”å±ˆï¼šæˆ‘ä¸æ˜¯æ¥å‡‘çƒ­é—¹çš„ï¼Œæˆ‘æ˜¯æ¥å¸®å¿™çš„ã€‚æ˜¯çš„ï¼Œstd::asyncæ˜¯ä¸ºäº†è®©ç”¨æˆ·çš„å°‘è´¹ç‚¹è„‘å­çš„ï¼Œå®ƒè®©è¿™ä¸‰ä¸ªå¯¹è±¡é»˜å¥‘çš„å·¥ä½œã€‚å¤§æ¦‚çš„å·¥ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šstd::asyncå…ˆå°†å¼‚æ­¥æ“ä½œç”¨std::packaged_taskåŒ…è£…èµ·æ¥ï¼Œç„¶åå°†å¼‚æ­¥æ“ä½œçš„ç»“æœæ”¾åˆ°std::promiseä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ›é€ æœªæ¥çš„è¿‡ç¨‹ã€‚å¤–é¢å†é€šè¿‡future.get/waitæ¥è·å–è¿™ä¸ªæœªæ¥çš„ç»“æœï¼Œæ€ä¹ˆæ ·ï¼Œstd::asyncçœŸçš„æ˜¯æ¥å¸®å¿™çš„å§ï¼Œä½ ä¸ç”¨å†æƒ³åˆ°åº•è¯¥æ€ä¹ˆç”¨std::futureã€std::promiseå’Œstd::packaged_taskäº†ï¼Œstd::asyncå·²ç»å¸®ä½ æå®šä¸€åˆ‡äº†ï¼\nã€€ã€€ç°åœ¨æ¥çœ‹çœ‹std::asyncçš„åŸå‹async(std::launch::async | std::launch::deferred, f, argsâ€¦)ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çº¿ç¨‹çš„åˆ›å»ºç­–ç•¥ï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼Œé»˜è®¤çš„ç­–ç•¥æ˜¯ç«‹å³åˆ›å»ºçº¿ç¨‹ï¼š\n\nstd::launch::asyncï¼šåœ¨è°ƒç”¨asyncå°±å¼€å§‹åˆ›å»ºçº¿ç¨‹ã€‚\nstd::launch::deferredï¼šå»¶è¿ŸåŠ è½½æ–¹å¼åˆ›å»ºçº¿ç¨‹ã€‚è°ƒç”¨asyncæ—¶ä¸åˆ›å»ºçº¿ç¨‹ï¼Œç›´åˆ°è°ƒç”¨äº†futureçš„getæˆ–è€…waitæ—¶æ‰åˆ›å»ºçº¿ç¨‹ã€‚å¯èƒ½åœ¨è¿™é‡Œä¼šé˜»å¡ä½ä¸»çº¿ç¨‹ã€‚\n\nç¬¬äºŒä¸ªå‚æ•°æ˜¯çº¿ç¨‹å‡½æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯çº¿ç¨‹å‡½æ•°çš„å‚æ•°ã€‚\nstd::asyncåŸºæœ¬ç”¨æ³•ï¼š\n12345678910111213141516171819202122232425262728293031323334353637std::future&lt;int&gt; f1 = std::async(std::launch::async, []()&#123;         return 8;      &#125;); cout&lt;&lt;f1.get()&lt;&lt;endl; //output: 8std::future&lt;int&gt; f2 = std::async(std::launch::async, []()&#123;         cout&lt;&lt;8&lt;&lt;endl;    &#125;); f2.wait(); //output: 8std::future&lt;int&gt; future = std::async(std::launch::async, []()&#123;         std::this_thread::sleep_for(std::chrono::seconds(3));        return 8;      &#125;);      std::cout &lt;&lt; \"waiting...\\n\";    std::future_status status;    do &#123;        status = future.wait_for(std::chrono::seconds(1));        if (status == std::future_status::deferred) &#123;            std::cout &lt;&lt; \"deferred\\n\";        &#125; else if (status == std::future_status::timeout) &#123;            std::cout &lt;&lt; \"timeout\\n\";        &#125; else if (status == std::future_status::ready) &#123;            std::cout &lt;&lt; \"ready!\\n\";        &#125;    &#125; while (status != std::future_status::ready);      std::cout &lt;&lt; \"result is \" &lt;&lt; future.get() &lt;&lt; '\\n';å¯èƒ½çš„ç»“æœï¼šwaiting...timeouttimeoutready!result is 8\n\næ€»ç»“ï¼šã€€ã€€std::asyncæ˜¯æ›´é«˜å±‚æ¬¡ä¸Šçš„å¼‚æ­¥æ“ä½œï¼Œä½¿æˆ‘ä»¬ä¸ç”¨å…³æ³¨çº¿ç¨‹åˆ›å»ºå†…éƒ¨ç»†èŠ‚ï¼Œå°±èƒ½æ–¹ä¾¿çš„è·å–å¼‚æ­¥æ‰§è¡ŒçŠ¶æ€å’Œç»“æœï¼Œè¿˜å¯ä»¥æŒ‡å®šçº¿ç¨‹åˆ›å»ºç­–ç•¥ï¼Œåº”è¯¥ç”¨std::asyncæ›¿ä»£çº¿ç¨‹çš„åˆ›å»ºï¼Œè®©å®ƒæˆä¸ºæˆ‘ä»¬åšå¼‚æ­¥æ“ä½œçš„é¦–é€‰ã€‚\n","plink":"https://shuntan.github.io/posts/C++ä¸­ä¼˜é›…çš„å¼‚æ­¥æ“ä½œ/"},{"title":"mutexå¤´æ–‡ä»¶ä»‹ç»","date":"2019-06-14T03:00:47.000Z","updated":"2019-07-14T01:23:11.162Z","content":"Mutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸ Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»å‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜åœ¨  å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å«  å¤´æ–‡ä»¶ã€‚\n å¤´æ–‡ä»¶ä»‹ç»Mutex ç³»åˆ—ç±»(å››ç§)\nstd::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚\n\nstd::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚\n\nstd::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚\n\nstd::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚\n\n\n\n\nLock ç±»ï¼ˆä¸¤ç§ï¼‰\nstd::lock_guardï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚\nstd::unique_lockï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚\n\nå…¶ä»–ç±»å‹\nstd::once_flag\nstd::adopt_lock_t\nstd::defer_lock_t\nstd::try_to_lock_t\n\nå‡½æ•°\nstd::try_lockï¼Œå°è¯•åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚\nstd::lockï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚\nstd::call_onceï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œcall_once å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹è¯¥å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ã€‚\n\nstd::mutex ä»‹ç»ä¸‹é¢ä»¥ std::mutex ä¸ºä¾‹ä»‹ç» C++11 ä¸­çš„äº’æ–¥é‡ç”¨æ³•ã€‚\nstd::mutex æ˜¯C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œstd::mutex å¯¹è±¡æä¾›äº†ç‹¬å æ‰€æœ‰æƒçš„ç‰¹æ€§â€”â€”å³ä¸æ”¯æŒé€’å½’åœ°å¯¹ std::mutex å¯¹è±¡ä¸Šé”ï¼Œè€Œ std::recursive_lock åˆ™å¯ä»¥é€’å½’åœ°å¯¹äº’æ–¥é‡å¯¹è±¡ä¸Šé”ã€‚\nstd::mutex çš„æˆå‘˜å‡½æ•°\næ„é€ å‡½æ•°ï¼Œstd::mutexä¸å…è®¸æ‹·è´æ„é€ ï¼Œä¹Ÿä¸å…è®¸ move æ‹·è´ï¼Œæœ€åˆäº§ç”Ÿçš„ mutex å¯¹è±¡æ˜¯å¤„äº unlocked çŠ¶æ€çš„ã€‚\nlock()ï¼Œè°ƒç”¨çº¿ç¨‹å°†é”ä½è¯¥äº’æ–¥é‡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¼šå‘ç”Ÿä¸‹é¢ 3 ç§æƒ…å†µï¼š(1). å¦‚æœè¯¥äº’æ–¥é‡å½“å‰æ²¡æœ‰è¢«é”ä½ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†è¯¥äº’æ–¥é‡é”ä½ï¼Œç›´åˆ°è°ƒç”¨ unlockä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´æ‹¥æœ‰è¯¥é”ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰çš„è°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ä½ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚\nunlock()ï¼Œ è§£é”ï¼Œé‡Šæ”¾å¯¹äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚\ntry_lock()ï¼Œå°è¯•é”ä½äº’æ–¥é‡ï¼Œå¦‚æœäº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é˜»å¡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¹Ÿä¼šå‡ºç°ä¸‹é¢ 3 ç§æƒ…å†µï¼Œ(1). å¦‚æœå½“å‰äº’æ–¥é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹é”ä½äº’æ–¥é‡ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è°ƒç”¨ unlock é‡Šæ”¾äº’æ–¥é‡ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰è°ƒç”¨çº¿ç¨‹è¿”å› falseï¼Œè€Œå¹¶ä¸ä¼šè¢«é˜»å¡æ‰ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚\n\nä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸ std::mutex çš„å°ä¾‹å­ï¼ˆå‚è€ƒï¼‰\n1234567891011121314151617181920212223242526#include &lt;iostream&gt;       // std::cout#include &lt;thread&gt;         // std::thread#include &lt;mutex&gt;          // std::mutexvolatile int counter(0); // non-atomic counterstd::mutex mtx;           // locks access to countervoid attempt_10k_increases() &#123;    for (int i=0; i&lt;10000; ++i) &#123;        if (mtx.try_lock()) &#123;   // only increase if currently not locked:            ++counter;            mtx.unlock();        &#125;    &#125;&#125;int main (int argc, const char* argv[]) &#123;    std::thread threads[10];    for (int i=0; i&lt;10; ++i)        threads[i] = std::thread(attempt_10k_increases);    for (auto&amp; th : threads) th.join();    std::cout &lt;&lt; counter &lt;&lt; \" successful increases of the counter.\\n\";    return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n123$g++ -lpthread -std=c++11 -o main *.cpp$main9012 successful increases of the counter.\n\n\nå¯ä»¥çœ‹å‡ºæœ‰å¾ˆå¤šæ¬¡mtx.try_lock()è¿”å›äº†falseï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ++counteræ“ä½œã€‚\nå¦‚æœæŠŠmtx.try_lock()æ”¹æˆmtx.lock()ï¼Œåˆ™å¿…å®šä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚\n\nè¾“å‡ºç»“æœ2:\n123$g++ -lpthread -std=c++11 -o main *.cpp$main100000 successful increases of the counter.\n\nstd::recursive_mutex ä»‹ç»std::recursive_mutex ä¸ std::mutex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¢«ä¸Šé”çš„å¯¹è±¡ï¼Œä½†æ˜¯å’Œ std::mutex ä¸åŒçš„æ˜¯ï¼Œstd::recursive_mutex å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥è·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œstd::recursive_mutex é‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸è¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()ï¼Œå¯ç†è§£ä¸º lock() æ¬¡æ•°å’Œ unlock() æ¬¡æ•°ç›¸åŒï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œstd::recursive_mutex çš„ç‰¹æ€§å’Œ std::mutex å¤§è‡´ç›¸åŒã€‚\n12345678910111213141516171819202122232425#include &lt;iostream&gt;       // std::cout#include &lt;thread&gt;         // std::thread#include &lt;mutex&gt;          // std::mutexvolatile int counter(0); // non-atomic counterstd::recursive_mutex  rmtx;           // locks access to countervoid attempt_1k_increases() &#123;    for (int i=0; i&lt;10000; ++i) &#123;        rmtx.lock();           ++counter;     &#125;    for (int i=0; i&lt;10000; ++i) &#123;         counter-=2;         rmtx.unlock();    &#125;&#125;int main (int argc, const char* argv[]) &#123;    auto th = std::thread(attempt_1k_increases);    th.join();    std::cout &lt;&lt; counter &lt;&lt; \" successful increases of the counter.\\n\";    return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n123$g++ -lpthread -o main *.cpp$main-10000 successful increases of the counter.\n\nstd::time_mutex ä»‹ç»std::time_mutex æ¯” std::mutex å¤šäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œtry_lock_for()ï¼Œtry_lock_until()ã€‚\ntry_lock_for å‡½æ•°æ¥å—ä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸€æ®µæ—¶é—´èŒƒå›´ä¹‹å†…çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼ˆä¸ std::mutex çš„ try_lock() ä¸åŒï¼Œtry_lock å¦‚æœè¢«è°ƒç”¨æ—¶æ²¡æœ‰è·å¾—é”åˆ™ç›´æ¥è¿”å› falseï¼‰ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚\ntry_lock_until å‡½æ•°åˆ™æ¥å—ä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ï¼Œåœ¨æŒ‡å®šæ—¶é—´ç‚¹æœªåˆ°æ¥ä¹‹å‰çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚\nä¸‹é¢çš„å°ä¾‹å­è¯´æ˜äº† std::time_mutex çš„ç”¨æ³•ï¼ˆå‚è€ƒï¼‰ã€‚\n1234567891011121314151617181920212223242526272829#include &lt;iostream&gt;       // std::cout#include &lt;chrono&gt;         // std::chrono::milliseconds#include &lt;thread&gt;         // std::thread#include &lt;mutex&gt;          // std::timed_mutexstd::timed_mutex mtx;void fireworks() &#123;  // waiting to get a lock: each thread prints \"-\" every 200ms:  while (!mtx.try_lock_for(std::chrono::milliseconds(200))) &#123;    std::cout &lt;&lt; \"-\";  &#125;  // got a lock! - wait for 1s, then this thread prints \"*\"  std::this_thread::sleep_for(std::chrono::milliseconds(1000));  std::cout &lt;&lt; \"*\\n\";  mtx.unlock();&#125;int main ()&#123;  std::thread threads[10];  // spawn 10 threads:  for (int i=0; i&lt;10; ++i)    threads[i] = std::thread(fireworks);  for (auto&amp; th : threads) th.join();  return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n\nçº¿ç¨‹è¾“å‡º*è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”é‡Šæ”¾è¯¥é”ã€‚å¦åˆ™å°†æ¯200mså°è¯•è·å–mutexğŸ”’ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚\n\nstd::recursive_timed_mutex ä»‹ç»å’Œ std:recursive_mutex ä¸ std::mutex çš„å…³ç³»ä¸€æ ·ï¼Œstd::recursive_timed_mutex çš„ç‰¹æ€§ä¹Ÿå¯ä»¥ä» std::timed_mutex æ¨å¯¼å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„åŒé‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ ;-)\nstd::lock_guard ä»‹ç»ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰:\n\n1.std::lock_guard åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡ŒåŠ é”ï¼Œææ„å‡½æ•°ä¸­è¿›è¡Œè§£é”ã€‚\n2.é”åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šï¼Œå› æ­¤c++11æä¾›äº†lock_guardæ¨¡æ¿ç±»ï¼›åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„åœºæ™¯ç¼–å†™resource_guard RAIIç±»ï¼Œé¿å…å¿˜æ‰é‡Šæ”¾èµ„æºã€‚\n\n12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt;       // std::cout#include &lt;thread&gt;         // std::thread#include &lt;mutex&gt;          // std::mutex, std::lock_guard#include &lt;stdexcept&gt;      // std::logic_errorstd::mutex mtx;void print_even (int x) &#123;    if (x%2==0) std::cout &lt;&lt; x &lt;&lt; \" is even\\n\";    else throw (std::logic_error(\"not even\"));&#125;void print_thread_id (int id) &#123;    try &#123;        // using a local lock_guard to lock mtx guarantees unlocking on destruction / exception:        std::lock_guard&lt;std::mutex&gt; lck (mtx);        print_even(id);    &#125;    catch (std::logic_error&amp;) &#123;        std::cout &lt;&lt; \"[exception caught]\\n\";    &#125;&#125;int main ()&#123;    std::thread threads[10];    // spawn 10 threads:    for (int i=0; i&lt;10; ++i)        threads[i] = std::thread(print_thread_id,i+1);    for (auto&amp; th : threads) th.join();    return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n123456789101112$g++ -lpthread -o main *.cpp$main[exception caught]4 is even[exception caught]2 is even[exception caught]6 is even8 is even[exception caught][exception caught]10 is even\n\nstd::unique_lock ä»‹ç»ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰ï¼š\n\n1.ç±» unique_lock æ˜¯é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå…è®¸å»¶è¿Ÿé”å®šã€é”å®šçš„æœ‰æ—¶é™å°è¯•ã€é€’å½’é”å®šã€æ‰€æœ‰æƒè½¬ç§»å’Œä¸æ¡ä»¶å˜é‡ä¸€åŒä½¿ç”¨ã€‚\n2.unique_lockæ¯”lock_guardä½¿ç”¨æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ä½¿ç”¨unique_lockéœ€è¦ä»˜å‡ºæ›´å¤šçš„æ—¶é—´ã€æ€§èƒ½æˆæœ¬ã€‚\n\n12345678910111213141516171819202122232425#include &lt;iostream&gt;       // std::cout#include &lt;thread&gt;         // std::thread#include &lt;mutex&gt;          // std::mutex, std::unique_lockstd::mutex mtx;           // mutex for critical sectionvoid print_block (int n, char c) &#123;    // critical section (exclusive access to std::cout signaled by lifetime of lck):    std::unique_lock&lt;std::mutex&gt; lck (mtx);    for (int i=0; i&lt;n; ++i) &#123;        std::cout &lt;&lt; c;    &#125;    std::cout &lt;&lt; '\\n';&#125;int main ()&#123;    std::thread th1 (print_block,50,'*');    std::thread th2 (print_block,50,'$');    th1.join();    th2.join();    return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n1234$g++ -lpthread -o main *.cpp$main**************************************************$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n\nå¥½äº†ï¼Œæœ¬æ–‡æš‚æ—¶è®²åˆ°è¿™é‡Œï¼Œè¿˜å‰©ä¸‹ std::try_lockï¼Œstd::lockï¼Œstd::call_once ä¸‰ä¸ªå‡½æ•°æ²¡æœ‰è®²åˆ°ï¼Œç•™åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­è®²å§ ;-)\n","plink":"https://shuntan.github.io/posts/Mutexä»‹ç»/"},{"title":"C++ä¹‹Lambdaç ”ç©¶","date":"2019-06-03T12:20:52.000Z","updated":"2019-07-14T01:23:07.183Z","content":"1. å‰è¨€æœ¬æ–‡ä»£ç æµ‹è¯•ç¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Šå®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–ã€‹ï¼Œé€‚ç”¨äºâ€œGCC-9.1.0â€ã€‚\næœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®é™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperator ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æ„ä½“å®é™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æ§åˆ¶ï¼‰ã€‚\nå¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚\n\n\n2. ç¤ºä¾‹1å…ˆçœ‹ä¸€æ®µå‡ ä¹æœ€ç®€å•çš„Lambdaä»£ç ï¼š\n123456//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â autoÂ fÂ =Â []Â &#123;Â printf(\"f\\n\");Â &#125;;Â //Â æ³¨æ„â€œ&#125;â€åçš„â€œ;â€å¿…ä¸å¯å°‘ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™Â Â returnÂ 0;&#125;\n\nå¦‚æœLambdaè¡¨è¾¾å¼ï¼ˆæˆ–å‡½æ•°ï¼‰æ²¡æœ‰ä»¥â€œ;â€ç»“å°¾ï¼Œåˆ™ç¼–è¯‘æ—¶å°†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š\n1234a3.cpp:Â InÂ functionÂ 'intÂ main()':a3.cpp:4:3:Â error:Â expectedÂ ','Â orÂ ';'Â beforeÂ 'return'Â Â Â Â 4Â |Â Â Â returnÂ 0;Â Â Â Â Â Â |Â Â Â ^~~~~~\n\nLambdaä¹‹æ‰€ä»¥ç¥å¥‡ï¼Œè¿™å¾—ç›ŠäºC++ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä¸Šè¿°â€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n12typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;&#125;\n\nä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°â€œoperator () constâ€ã€‚æ³¨æ„è¿™é‡Œæˆå‘˜å‡½æ•°æ˜¯â€constâ€ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚å¦‚æœéœ€éâ€constâ€æˆå‘˜å‡½æ•°ï¼Œéœ€è¦åŠ â€mutableâ€ä¿®é¥°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n1autoÂ fÂ =Â [n]()Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;\n\nä¸Šé¢ä¾‹å­å¯¹åº”çš„åŒ¿åç±»æ²¡æœ‰ä»»ä½•ç±»æ•°æ®æˆå‘˜ï¼Œç°åœ¨æ¥ä¸ªæœ‰ç±»æ•°æ®æˆå‘˜çš„ä»£ç ï¼š\n12345678//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â intÂ nÂ =Â 3;Â Â autoÂ fÂ =Â [n]Â &#123;Â printf(\"%d\\n\",Â n);Â &#125;;Â Â f();Â //Â è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯åŒ¿åç±»çš„æˆå‘˜å‡½æ•°â€œoperatorÂ ()â€Â Â returnÂ 0;&#125;\n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰ç±»æ•°æ®æˆå‘˜çš„åŒ¿åç±»ï¼Œè€Œä¸å†æ˜¯ç©ºæ— ä¸€ç‰¹çš„ç±»ï¼š\n123typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;Â Â Â Â intÂ __n;&#125;\n\n3. ç¤ºä¾‹2ç»§ç»­æ¥ä¸ªå˜ç§ï¼š\n12345678910//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â intÂ nÂ =Â 3;Â Â autoÂ fÂ =Â [&amp;n]()Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;Â Â f();Â Â returnÂ 0;&#125;\n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œä¸€ä¸ªåŒ…å«äº†å¼•ç”¨ç±»å‹çš„åŒ¿åç±»ï¼š\n123typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;Â Â Â Â intÂ &amp;__n;&#125;\n\n4. ç¤ºä¾‹3ç»§ç»­å˜ç§ï¼Œâ€œ&amp;â€çš„ä½œç”¨è®©Lambdaå‡½æ•°å¯ä½¿ç”¨Lambdaæ‰€åœ¨ä½œç”¨åŸŸå†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬Lambdaæ‰€åœ¨ç±»çš„thisï¼‰ï¼Œå¹¶ä¸”æ˜¯ä»¥å¼•ç”¨ä¼ é€’æ–¹å¼ï¼š\n123456789//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â intÂ nÂ =Â 3;Â Â autoÂ fÂ =Â [&amp;]()Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;Â Â f();Â Â returnÂ 0;&#125;\n\nâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n123typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;Â Â Â Â intÂ &amp;__n;&#125;\n\nå˜ç¨å¤æ‚ä¸€ç‚¹ï¼š\n123456789//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â intÂ nÂ =Â 3;Â Â intÂ mÂ =Â 5;Â Â autoÂ fÂ =Â [&amp;]()Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;Â Â f();Â Â returnÂ 0;&#125;\n\nå¯ä»¥çœ‹åˆ°ï¼Œâ€œfâ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š\n123typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;Â Â Â Â intÂ &amp;__n;&#125;\n\n5. ç¤ºä¾‹4ç»§ç»­å¢åŠ å¤æ‚åº¦ï¼š\n123456789//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;intÂ main()Â &#123;Â Â intÂ nÂ =Â 3;Â Â intÂ mÂ =Â 5;Â Â autoÂ fÂ =Â [&amp;]()Â mutableÂ &#123;Â printf(\"%d,%d\\n\",Â n,Â m);Â &#125;;Â Â f();Â Â returnÂ 0;&#125;\n\nå¯ä»¥çœ‹åˆ°â€œfâ€å˜äº†ï¼š\n1234typeÂ =Â structÂ &lt;lambda()&gt;Â &#123;Â Â Â Â intÂ &amp;__n;Â Â Â Â intÂ &amp;__m;&#125;\n\nä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åªä¼šæŠŠLambdaå‡½æ•°ç”¨åˆ°çš„å˜é‡æ‰“åŒ…è¿›å¯¹åº”çš„åŒ¿åç±»ã€‚ç»§ç»­ä¸€ä¸ªç¨å¤æ‚ç‚¹çš„ï¼š\n1234567891011121314//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;structÂ XÂ &#123;Â Â voidÂ foo()Â &#123;Â printf(\"foo\\n\");Â &#125;Â Â voidÂ xoo()Â &#123;Â Â Â Â autoÂ fÂ =Â [&amp;]Â &#123;Â foo();Â &#125;;Â Â Â Â f();Â Â &#125;&#125;;intÂ main()Â &#123;Â Â X().xoo();Â Â returnÂ 0;&#125;\n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n123typeÂ =Â structÂ X::&lt;lambda()&gt;Â &#123;Â Â Â Â XÂ *Â constÂ __this;Â //Â Xç±»å‹çš„æŒ‡é’ˆï¼ˆéå¯¹è±¡ï¼‰&#125;\n\nå¦‚æœå°†â€œauto f = [&amp;] { foo(); };â€ä¸­çš„â€œ&amp;â€å»æ‰ï¼Œåˆ™ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºâ€œthisâ€æ²¡æœ‰è¢«Lambdaå‡½æ•°æ•è·ï¼š\n12345a2.cpp:Â InÂ lambdaÂ function:a2.cpp:5:23:Â error:Â 'this'Â wasÂ notÂ capturedÂ forÂ thisÂ lambdaÂ functionÂ Â Â Â 5Â |Â Â Â Â Â autoÂ fÂ =Â []Â &#123;Â foo();Â &#125;;Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^a2.cpp:5:23:Â error:Â cannotÂ callÂ memberÂ functionÂ 'voidÂ X::foo()'Â withoutÂ object\n\næ”¹æˆä¸‹åˆ—æ–¹å¼æ•è·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š\n1234567891011121314//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;structÂ XÂ &#123;Â Â voidÂ foo()Â &#123;Â printf(\"foo\\n\");Â &#125;Â Â voidÂ xoo()Â &#123;Â Â Â Â autoÂ fÂ =Â [this]Â &#123;Â foo();Â &#125;;Â Â Â Â f();Â Â &#125;&#125;;intÂ main()Â &#123;Â Â X().xoo();Â Â returnÂ 0;&#125;\n\nå¦‚æœæ˜¯C++17ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š\n1234567891011121314//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17#includeÂ &lt;stdio.h&gt;structÂ XÂ &#123;Â Â voidÂ foo()Â &#123;Â printf(\"foo\\n\");Â &#125;Â Â voidÂ xoo()Â &#123;Â Â Â Â autoÂ fÂ =Â [*this]()Â mutableÂ &#123;Â foo();Â &#125;;Â Â Â Â f();Â Â &#125;&#125;;intÂ main()Â &#123;Â Â X().xoo();Â Â returnÂ 0;&#125;\n\næ³¨æ„å¾—æœ‰â€œmutableâ€ä¿®é¥°ï¼Œä¸ç„¶æŠ¥å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š\n1234567a2.cpp:Â InÂ lambdaÂ function:a2.cpp:5:30:Â error:Â passingÂ 'constÂ X'Â asÂ 'this'Â argumentÂ discardsÂ qualifiersÂ [-fpermissive]Â Â Â Â 5Â |Â Â Â Â Â autoÂ fÂ =Â [*this]()Â &#123;Â foo();Â &#125;;Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^a2.cpp:3:8:Â note:Â Â Â inÂ callÂ toÂ 'voidÂ X::foo()'Â Â Â Â 3Â |Â Â Â voidÂ foo()Â &#123;Â printf(\"foo\\n\");Â &#125;Â Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~~\n\nä¹Ÿå¯ä»¥è¿™æ ·ï¼š\n123456789101112131415//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17#includeÂ &lt;stdio.h&gt;structÂ XÂ &#123;Â Â voidÂ foo()Â &#123;Â printf(\"foo\\n\");Â &#125;Â Â voidÂ xoo()Â &#123;Â Â Â Â autoÂ fÂ =Â [&amp;,*this]()Â mutableÂ &#123;Â foo();Â &#125;;Â Â Â Â f();Â Â &#125;&#125;;intÂ main()Â &#123;Â Â X().xoo();Â Â returnÂ 0;&#125;\n\nä½¿ç”¨â€œ*thisâ€æ—¶çš„â€œfâ€æ ·å­å¦‚ä¸‹ï¼š\n123typeÂ =Â structÂ X::&lt;lambda()&gt;Â &#123;Â Â Â Â XÂ __this;Â //Â Xç±»å‹çš„å¯¹è±¡ï¼ˆéæŒ‡é’ˆï¼‰&#125;\n\n6. ç¤ºä¾‹5ç»§ç»­ç ”ç©¶ï¼Œä½¿ç”¨C++ RTTIï¼ˆRun-Time Type Identificationï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰è®¾æ–½â€œtypeidâ€æŸ¥çœ‹Lambdaå‡½æ•°ï¼š\n123456789101112131415//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11#includeÂ &lt;stdio.h&gt;#includeÂ &lt;typeinfo&gt;structÂ XÂ &#123;Â Â voidÂ xoo()Â &#123;Â Â Â Â autoÂ fÂ =Â []Â &#123;Â printf(\"f\\n\");Â &#125;;Â Â Â Â printf(\"%s\\n\",Â typeid(f).name());Â Â Â Â //Â æ³¨ï¼štypeidè¿”å›å€¼ç±»å‹ä¸ºâ€œstd::type_infoâ€Â Â &#125;&#125;;intÂ main()Â &#123;Â Â X().xoo();Â Â returnÂ 0;&#125;\n\nè¿è¡Œè¾“å‡ºï¼š\nZN1X3xooEvEUlvE_\n7. åŒ¿åç±»è§„åˆ™ç¼–è¯‘å™¨ä¸ºLambdaç”Ÿæˆçš„åŒ¿åç±»è§„åˆ™ï¼ˆä¸åŒæ ‡å‡†æœ‰åŒºåˆ«ï¼‰ï¼š\n            æ„é€ å‡½æ•°            æ‹·è´æ„é€ å‡½æ•°                                    ClosureType()&nbsp;=&nbsp;delete;                                    C++14å‰                                ClosureType()&nbsp;=&nbsp;default;                                    C++20èµ·ï¼Œ            ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶                                ClosureType(const&nbsp;ClosureType&amp;&nbsp;)&nbsp;=&nbsp;default;                                    C++14èµ·                                ClosureType(ClosureType&amp;&amp;&nbsp;)&nbsp;=&nbsp;default;                                    C++14èµ·                                æ‹·è´å¤åˆ¶å‡½æ•°                                    ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;                                    C++20å‰                                ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;default;            ClosureType&amp;&nbsp;operator=(ClosureType&amp;&amp;)&nbsp;=&nbsp;default;                                    C++20èµ·ï¼Œ            ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶                                ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;                                    C++20èµ·ï¼Œå…¶ä»–æƒ…å†µ                                ææ„å‡½æ•°                                    ~ClosureType()&nbsp;=&nbsp;default;                                    ææ„å‡½æ•°æ˜¯éšå¼å£°æ˜çš„                    \nå¯¹äºæ ‡è®°ä¸ºâ€œdeleteâ€çš„å‡½æ•°æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œå¦‚ä¸‹åˆ—ä»£ç ä¸­çš„â€œf2 = f1;â€å°†è§¦å‘ç¼–è¯‘é”™è¯¯ï¼š\n\n1234567891011intÂ main()Â &#123;Â Â autoÂ f1Â =Â []&#123;&#125;;Â Â autoÂ f2Â =Â f1;Â Â f2Â =Â f1;Â Â returnÂ 0;&#125;\n\nä¸Šåˆ—ä»£ç åœ¨C++11ã€C++14å’ŒC++17å‡ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¦‚è§„åˆ™æ‰€ç¤ºï¼ŒC++20ï¼ˆå«C++2aï¼‰ä¸Šåˆ™å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼š\n1234567a3.cpp:Â InÂ functionÂ 'intÂ main()':a3.cpp:4:8:Â error:Â useÂ ofÂ deletedÂ functionÂ 'main()::&lt;lambda()&gt;&amp;Â main()::&lt;lambda()&gt;::operator=(constÂ main()::&lt;lambda()&gt;&amp;)'Â Â Â Â 4Â |Â Â Â f2Â =Â f1;Â Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~a3.cpp:2:14:Â note:Â aÂ lambdaÂ closureÂ typeÂ hasÂ aÂ deletedÂ copyÂ assignmentÂ operatorÂ Â Â Â 2Â |Â Â Â autoÂ f1Â =Â []&#123;&#125;;Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^\n\nå¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œå¯¹ç†è§£Lambdaæœ‰æ‰€å¸®åŠ©ã€‚\n8. å‚è€ƒèµ„æ–™\n1) https://zh.cppreference.com/w/cpp/language/lambda\n\n2) https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-2019\n\n3) https://en.cpprefeence.com/w/cpp/language/lambda\n\n4) https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11\n\n5) https://www.cprogramming.com/c++11/c++11-lambda-closures.html\n\n\n\n\n            ä½œè€…ï¼šä¸€è§æ¥æºï¼šCSDNåŸæ–‡ï¼šhttps://blog.csdn.net/Aquester/article/details/90691479 \n          \n","plink":"https://shuntan.github.io/posts/Lambda/"},{"title":"C++ æ¨¡æ¿åç‰¹åŒ–ï¼æ¥è‡ªSTLçš„æ€è€ƒ","date":"2019-05-31T06:29:52.000Z","updated":"2019-07-14T01:22:35.792Z","content":"ä¹‹å‰å­¦ä¹ STLæ—¶æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›å‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€STLä»å¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›å‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–\n\n\nå…ˆç®€è¦å›é¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸ç±»æ¨¡æ¿\n\nå‡½æ•°æ¨¡æ¿12345678910template&lt;class T&gt;T add(T a, T b) &#123; return a + b;&#125;int main()&#123;    int a = 1, b = 2;    std::cout &lt;&lt; add(a + b) &lt;&lt; std::endl;    return 0;&#125;\n\n\n\nå¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å®ä¾‹åŒ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå®å‚ç±»å‹æ¨å¯¼ä¸Šé¢ç±»å‹Tå°±è¢«è‡ªåŠ¨æ¨å¯¼ä¸ºintç±»å‹\nç±»æ¨¡æ¿12345678910111213141516templete&lt;class T&gt;class A&#123;public:    explicit A(T val) : t(val) &#123; &#125;    T add(T x) &#123; return t + y; &#125;    privete:    T t;&#125;;int main()&#123;    A&lt;int&gt; a(10);    std::cout &lt;&lt; a.add(5) &lt;&lt; std::endl;    return 0;&#125;\n\nå¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„ç±»æ¨¡æ¿ï¼Œå®ä¾‹åŒ–ç±»æ¨¡æ¿å¿…é¡»è¦æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨æ— æ³•ä¸ºç±»æ¨¡æ¿è‡ªåŠ¨æ¨å¯¼ç±»å‹\nå‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹\nï¼‘ï¼ç±»æ¨¡æ¿çš„å’Œå‡½æ•°æ¨¡æ¿éƒ½å¿…é¡»å®šä¹‰åœ¨.hå¤´æ–‡ä»¶ä¸­\n\nï¼’ï¼æ¨¡æ¿çš„å®ä¾‹åŒ–ç±»å‹ç¡®å®šæ˜¯åœ¨ç¼–è¯‘æœŸé—´\n\nï¼“ï¼åªæ˜¯æ¨¡æ¿å†™å¥½äº†ï¼Œç¼–è¯‘ä¸€èˆ¬ä¸ä¼šå¾ˆå¤šå‡ºé”™ï¼Œå‡ºé”™ä¸€èˆ¬ä¼šåœ¨å®ä¾‹åŒ–ç¼–è¯‘ä¹‹å\n\nï¼”ï¼æ¨¡æ¿å®ä¾‹åŒ–åªä¼šå®ä¾‹åŒ–ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†å°†ä¸ä¼šè¢«å®ä¾‹åŒ–\n\n\n\næˆ‘è§‰å¾—æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–æ˜¯æ¨¡æ¿ä¸­æ¯”è¾ƒç²¾é«“çš„ä¸œè¥¿æœ‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œå…¶ä¸­åˆåˆ†ä¸ºå…¨ç‰¹åŒ–ä¸åç‰¹åŒ–ä¸»è¦çš„ç”¨é€”éƒ½æ˜¯å¯¹äºç‰¹å®šçš„ç±»å‹ï¼ŒæŒ‡å®šç‰¹å®šçš„å¤„ç†æ–¹å¼å°±ç›¸å½“äºæ™®é€šç¼–ç¨‹ä¸­if-else if - elseè¿™æ ·çš„æ–¹å¼ç¼–è¯‘é˜¶æ®µç¡®å®šå¦‚æœæ˜¯æŸä¸ªç‰¹åŒ–ç±»å‹ï¼Œå°±ç”¨ç‰¹åŒ–çš„æ¨¡æ¿å¦‚æœéƒ½ä¸æ˜¯ï¼Œå°±ç”¨æœ€ä¸€èˆ¬çš„æ¨¡æ¿\nå‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–å‡½æ•°æ¨¡æ¿åªèƒ½å…¨ç‰¹åŒ–ï¼Œä¸èƒ½åç‰¹åŒ–ï¼Œå¦‚æœè¦åç‰¹åŒ–çš„è¯åªèƒ½é‡è½½\nå‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–1234567891011template&lt; &gt;                                  // å…¨ç‰¹åŒ–ã€€æ³¨æ„è¯­æ³•double add(double a, double b)  &#123; return a + b; &#125;int main()&#123;    int x = 10, y = 20;    double z = 1.1, w = 2.2;    std::cout &lt;&lt; add(x, y) &lt;&lt; std::endl;   // è°ƒç”¨æ™®é€šç‰ˆæœ¬    std::cout &lt;&lt; add(z, w) &lt;&lt; std::endl;   // è°ƒç”¨å…¨ç‰¹åŒ–ç‰ˆæœ¬    return 0;&#125;\n\nå¦‚æœæœ‰ä¸å®å‚æ›´åŠ åŒ¹é…çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨å°†ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–ç‰ˆæœ¬\nå‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰å› ä¸ºåç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¨¡æ¿ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥é‡è½½ä¸€ä¸ªå‡½æ•°æ¨¡æ¿\n12345678910template&lt;class T1&gt;ã€€ã€€// é‡è½½ç‰ˆæœ¬ï¼Œæ¥æ”¶å‚æ•°ä¸ºæŒ‡é’ˆT1 add(T1* a, T1* b) &#123; return *a + *b; &#125;   int main()&#123;    int a = 10, b = 20;    int *x = &amp;a, *y = &amp;b;    add(a, b);    // è°ƒç”¨æ™®é€šæ¨¡æ¿    add(x, y);ã€€  // è°ƒç”¨é‡è½½çš„æ¨¡æ¿    return 0;&#125;\n\nå¦‚ä¸Šï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ¥æ”¶æŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨é‡è½½æ¨¡æ¿å®ç°å‡½æ•°æ¨¡æ¿ä¸å­˜åœ¨åç‰¹åŒ–\nç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿æ—¢æœ‰å…¨ç‰¹åŒ–ï¼Œåˆæœ‰åç‰¹åŒ–è¿™é‡Œé‡æ–°å†™ä¸€ä¸ªæ›´ä¸€èˆ¬çš„æ¨¡æ¿ç±»æ¥è¯´æ˜ç±»æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–\nç±»æ¨¡æ¿å…¨ç‰¹åŒ–æ¯”è¾ƒå¥½ç†è§£ï¼Œè·Ÿå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå…¨ç‰¹åŒ–æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå½“ç¼–è¯‘å™¨åŒ¹é…æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‚æ•°ä¸€è‡´çš„å®ä¾‹\n123456789template&lt; &gt;     ã€€ã€€ã€€// æ³¨æ„è¯­æ³•class A&lt;char*&gt;       // ä¸€ä¸ªå…¨ç‰¹åŒ–çš„æ¨¡æ¿ç±»A&#123;                    // å½“ç”¨char*ç±»å‹æ¥å®ä¾‹åŒ–ç±»æ¨¡æ¿Aæ—¶ï¼Œå°†ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªå…¨ç‰¹åŒ–å®ä¾‹public:    explicit A(char* val) : t(val) &#123; &#125;    char* add(char* a, char* b) &#123; return strcat(a, b); &#125;private:    char* t;&#125;;\n\nç±»æ¨¡æ¿çš„åç‰¹åŒ–ç±»æ¨¡æ¿çš„åç‰¹åŒ–ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒæœ‰å¤šç§å½¢å¼ç±»æ¨¡æ¿åç‰¹åŒ–æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡å®šéƒ¨åˆ†ç±»å‹ï¼Œè®©åç‰¹åŒ–ç‰ˆæœ¬ç§°ä¸ºæ™®é€šç‰ˆæœ¬çš„å­é›†ï¼Œè‹¥å®ä¾‹åŒ–æ—¶å‚æ•°ç±»å‹ä¸ºæŒ‡å®šçš„ç±»å‹ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ç¬¬ä¸€ç§å½¢å¼\n12345template&lt;class T1, class T2&gt;      // æ™®é€šç‰ˆæœ¬ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°class B &#123; ..... &#125;;template&lt;class T2&gt;ã€€ã€€ã€€         // åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒæŒ‡å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå³æŒ‡å®šäº†éƒ¨åˆ†ç±»å‹class B&lt;int , T2&gt; &#123; ..... &#125;;ã€€ã€€// å½“å®ä¾‹åŒ–æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºint åˆ™ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªç‰ˆæœ¬\n\nç¬¬äºŒç§å½¢å¼ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ç‰ˆæœ¬\n12345678template&lt;class T&gt;     // æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt;ã€€ã€€ã€€//è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥æ”¶æŒ‡é’ˆç±»å‹çš„æ¨¡æ¿å®å‚ class B&lt;T*&gt; &#123; ..... &#125;; template&lt;class T&gt;class B&lt;T&amp;&gt; &#123; ..... &#125;;     // è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥å—å¼•ç”¨ç±»å‹çš„æ¨¡æ¿å®å‚\n\nç¬¬ä¸‰ç§å½¢å¼\n12345template&lt;class T&gt;    //æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt;ã€€ã€€ã€€// è¿™ç§åªæ¥å—ç”¨Tå®ä¾‹åŒ–çš„vectorçš„æ¨¡æ¿å®å‚ï¼ä¹Ÿæ˜¯ä¸€ç§åç‰¹åŒ–class B&lt;vector&lt;T&gt;&gt; &#123; ......  &#125;;\n\nå‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹\n\nï¼‘ï¼ç‰¹ä¾‹åŒ–æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬é¡¶æ›¿äº†ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸®ç¼–è¯‘å™¨åšäº†ç±»å‹æ¨å¯¼\nï¼’ï¼å…¨ç‰¹åŒ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œåç‰¹åŒ–æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œåªæ˜¯åŸæ¥æ¨¡æ¿çš„ä¸€ä¸ªå­é›†\nï¼“ï¼æ‰€ä»¥å…¨ç‰¹åŒ–çš„å‡½æ•°æ¨¡æ¿ï¼Œæœ¬è´¨ä¸Šæ˜¯å®ä¾‹ï¼Œä»è€Œä¸ä¼šä¸å‡½æ•°æ¨¡æ¿äº§ç”ŸäºŒä¹‰æ€§\nï¼”ï¼è‹¥æƒ³è®©ç”¨æˆ·èƒ½ä½¿ç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬å¿…é¡»ä¸æ¨¡æ¿å®šä¹‰åœ¨åŒä¸€ä¸ª.hå¤´æ–‡ä»¶ä¸­\n\n\nSTLä¸­çš„è¿­ä»£å™¨å®ç°ä¸é«˜æ•ˆå®ç°ä¸æ¨¡æ¿åç‰¹åŒ–æ¯æ¯ç›¸å…³ï¼\nç±»æ¨¡æ¿åç‰¹åŒ–ä¸STLåç‰¹åŒ–åœ¨STLä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåº”ç”¨\nï¼‘ï¼åº”ç”¨åœ¨è¿­ä»£å™¨è®¾è®¡ä¸­ï¼Œä¸ºäº†ä½¿è¿­ä»£å™¨æ—¢å¯ä»¥èƒå–å‡ºå€¼ç±»å‹ï¼Œåˆå¯ä»¥åŒ…å®¹åŸç”ŸæŒ‡é’ˆå¦‚æœè¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å°±èƒ½çŸ¥é“å®ƒçš„å€¼ç±»å‹ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šä½¿ç”¨iterator_traitsè¿­ä»£å™¨èƒå–æŠ€æœ¯çš„ä¸¤ä¸ªæ ¸å¿ƒæ˜¯ï¼š\n\nï¼‘ï¼‰åœ¨æ¯ä¸ªè¿­ä»£å™¨ç±»ä¸­å®šä¹‰value_typeå€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼Œè¿™æ ·ç›´æ¥é€šè¿‡è¿­ä»£å™¨çš„value_typeç±»å‹æˆå‘˜å°±å¯ä»¥çŸ¥é“å€¼ç±»å‹\nï¼’ï¼‰é—®é¢˜å°±åœ¨äºï¼Œè¿­ä»£å™¨å¿…é¡»å…¼å®¹åŸç”ŸæŒ‡é’ˆï¼Œè€ŒåŸç”ŸæŒ‡é’ˆå¾ˆéš¾è¢«é‡æ–°å®šä¹‰ï¼Œå³è¦åœ¨åŸç”ŸæŒ‡é’ˆçš„ç±»ä¸­æ·»åŠ value_typeçš„å€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼è¿™æ—¶å€™ï¼Œé çš„å°±æ˜¯ç±»æ¨¡æ¿çš„åç‰¹åŒ–äº†ï¼æ–°æ·»åŠ ä¸€å±‚iterator_traitsç±»ï¼Œä¸“é—¨èƒå–è¿­ä»£å™¨çš„å±æ€§ï¼Œç„¶åå†å¯¹iterator_traitsç±»è®¾è®¡åŸç”ŸæŒ‡é’ˆä¸åŸç”Ÿå¼•ç”¨çš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå°±è§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜\n\nï¼’ï¼ type_traitsç±»å‹èƒå–ï¼Œå¯¹å¾…ç‰¹æ®Šç±»å‹ï¼Œç‰¹æ®Šå¤„ç†ï¼Œæé«˜æ•ˆç‡å¯¹äºæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ç­‰çš„å†…ç½®ç±»å‹ï¼Œå¦‚æœä¸å¤æ‚ç±»å‹ä¸€æ ·ï¼Œæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ•ˆç‡ä¸é«˜çš„å…ˆå®ç°ä¸€ä¸ªå¯¹æ‰€æœ‰ç±»å‹éƒ½è®¾ç½®ä¸€ä¸ªæœ€ä¿å®ˆå€¼çš„type_traitsæ¨¡æ¿ç±»ï¼Œç„¶åå†å¯¹æ¯ä¸ªå†…ç½®ç±»å‹è®¾ç½®åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå†…ç½®ç±»å‹è®¾ç½®ä¸€ä¸ªæ›´ä¸ºæ¿€è¿›çš„å€¼ï¼Œè¡¨æ˜å¯ä»¥é‡‡å–æ›´ä¸ºé«˜æ•ˆçš„æ“ä½œæ¥æé«˜æ•ˆç‡æ¯”å¦‚copyå‡½æ•°ï¼Œå¦‚æœä¼ é€’çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œé‚£ä¹ˆå¯èƒ½åªèƒ½é‡‡å–æœ€ä¿å®ˆçš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ„é€ ï¼›å¦‚æœæ˜¯å†…ç½®ç±»å‹ï¼Œè¿™æ ·æ˜¾ç„¶å¤ªä½æ•ˆï¼Œä½¿ç”¨memcpy()å¯èƒ½ä¼šå¥½ä¸€äº›\nå…¶å®iterator_traitsä¹Ÿä¸æ­¢æ˜¯å¤„ç†å…¼å®¹åŸç”ŸæŒ‡é’ˆçš„é—®é¢˜ï¼Œå®ƒä¹Ÿå¯ä»¥æé«˜æ•ˆç‡ï¼è¿­ä»£å™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰å¯ä»¥éšæœºè®¿é—®çš„ï¼ˆvectorï¼‰ï¼Œæœ‰åªèƒ½å‰åä¸€ä¸ªä¸€ä¸ªç§»åŠ¨çš„ï¼ˆlistï¼‰,ä¹Ÿæœ‰åªèƒ½å•å‘ç§»åŠ¨çš„ï¼ˆslistï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æŠŠè¿­ä»£å™¨åˆ†ä¸ºäº”ç§ï¼š\n\nInputIteratorã€€ã€€ã€€ã€€ã€€ã€€ã€€è¾“å…¥è¿­ä»£å™¨\nOutputIterator ã€€ã€€ã€€ã€€ã€€ ã€€è¾“å‡ºè¿­ä»£å™¨\nForwardIteratorã€€ã€€ã€€ã€€ã€€ã€€å•å‘è¿­ä»£å™¨\nBidirectionIteratorã€€ã€€ã€€ã€€ã€€åŒå‘è¿­ä»£å™¨\nRandomAccessIteratorã€€ã€€ã€€éšæœºè®¿é—®è¿­ä»£å™¨\n\næ¯”å¦‚ä¸€ä¸ªadvance(n)å‡½æ•°ï¼Œå¯¹äºå•å‘è¿­ä»£å™¨åªèƒ½ä¸€ä¸ªä¸€ä¸ªç§»åŠ¨è¿‡å»ï¼Œä½†æ˜¯è¿™ç§å®ç°å¯¹äºéšæœºè®¿é—®è¿­ä»£å™¨æ˜¾ç„¶ä¸æ˜¯ç†æƒ³çš„å¤„ç†æ–¹å¼å¤„ç†çš„æ–¹å¼å°±æ˜¯å…ˆå®ç°è¿™äº”ä¸ªç±»ï¼Œç”¨ä½œæ ‡è®°ç”¨ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å™¨é‡Œé¢éƒ½å®šä¹‰è¿­ä»£å™¨ç±»å‹çš„ç±»å‹æˆå‘˜iterator_catagoryï¼Œå†å¯¹ä¸åŒç‰ˆæœ¬çš„è¿­ä»£å™¨å®ç°ä¸åŒçš„advance(n)å¤„ç†æ–¹å¼\næ¯”å¦‚stlä¸­æ·»åŠ å³å€¼å¼•ç”¨å…ƒæ¨¡æ¿çš„å®ç°ï¼š\n1234567891011121314template&lt;typename _Tp,\t\t   bool = __and_&lt;__not_&lt;is_reference&lt;_Tp&gt;&gt;,\t\t   \t\t\t\t\t__not_&lt;is_void&lt;_Tp&gt;&gt;&gt;::value&gt;\tstruct __add_rvalue_reference_helper\t&#123;typedef __Tp   type; &#125;;template&lt;typename _Tp&gt;\tstruct __add_rvalue_reference_helper&lt;__Tp, true&gt;\t&#123;typedef __Tp&amp;&amp;  type; &#125;;\ttemplate&lt;typename _Tp&gt;struct add_rvalue_reference: public __add_rvalue_reference_helper&lt;_Tp&gt;&#123; &#125;;\n\nå¯ä»¥å‘ç°è°ƒç”¨æ—¶ä¸€èˆ¬ä¸ºstatic_cast&lt;typenameadd_rvalue_reference&lt;T&gt;::type&gt;(__t),é¦–å…ˆä¼šåŒ¹é…æ³›åŒ–ç‰ˆæœ¬çš„å…ƒæ¨¡æ¿ç±»ï¼Œç¬¬äºŒä¸ªæ¨¡ç‰ˆå‚æ•°boolä¼šåŒ¹é…_Tpçš„ç±»å‹ï¼Œå¦‚æœåŸæ¥ä¸æ˜¯å¼•ç”¨ç±»å‹çš„è¯å°±ç›´æ¥åŒ¹é…trueçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œå¦åˆ™falseä¸ºåŸæ³›åŒ–ç‰ˆæœ¬ã€‚\nçŸ­çŸ­å‡ è¡Œä»£ç å·²ç»å±•ç¤ºå‡ºäº†æ¨¡æ¿å/å…¨ç‰¹åŒ–çš„å¼ºå¤§åŒ¹é…åŠŸèƒ½ï¼\n","plink":"https://shuntan.github.io/posts/æ¨¡æ¿ç‰¹åŒ–/"},{"title":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘","date":"2019-05-29T02:05:19.000Z","updated":"2019-07-14T01:22:44.423Z","content":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\né˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–\n\nä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒ\n\n\nä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n\n1234567891011121314151617#include &lt;iostream&gt;using std::cout;using std::endl;template&lt;typename T&gt;void func(T&amp; param) &#123;    cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123;    int num = 2019;    func(num);    return 0;&#125;\n\nè¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ\n1234int main() &#123;    func(2019);    return 0;&#125;\n\nåˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœã€‚\n1234567891011121314151617template&lt;typename T&gt;void func(T&amp; param) &#123;    cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" &lt;&lt; endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123;    cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å³å€¼\" &lt;&lt; endl;&#125;int main() &#123;    int num = 2019;    func(num);    func(2019);    return 0;&#125;\n\nè¾“å‡ºç»“æœï¼š\n12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å³å€¼\n\nç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æ¥æ”¶å·¦å€¼åˆå¯ä»¥æ¥æ”¶å³å€¼å‘¢ï¼Ÿ\nC++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&amp;&amp;ç±»å‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚\nä½†æ˜¯æ³¨æ„äº†ï¼šåªæœ‰å‘ç”Ÿç±»å‹æ¨å¯¼çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼› å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚\næ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š\n123456789101112template&lt;typename T&gt;void func(T&amp;&amp; param) &#123;    cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123;    int num = 2019;    func(num);    func(2019);    return 0;&#125;\n\nå¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰ä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼Œæ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®å‚çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼š\n\nå·¦å€¼-å·¦å€¼ T&amp; &amp;        # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨\nå·¦å€¼-å³å€¼ T&amp; &amp;&amp;      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨\nå³å€¼-å·¦å€¼ T&amp;&amp; &amp;      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨\nå³å€¼-å³å€¼ T&amp;&amp; &amp;&amp;    # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨\n\nä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼š\næ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚\nå³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚\nå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ä¸‹é¢æ¥ç€è¯´å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹2ä¸ªä¾‹å­ï¼š\nğŸŒ°æ —å­[1]è¦äº†è§£å®Œç¾è½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„æ¨å¯¼è¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æ¨å¯¼å‚æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚\n12345678910111213141516171819202122232425262728template &lt;typename T&gt;void func(T&amp;&amp; arg) &#123;    auto is_lval = std::is_lvalue_reference&lt;T&gt;::value;    auto is_rval  = std::is_rvalue_reference&lt;T&gt;::value;    if(std::is_same&lt;T, int&gt;::value) &#123;        std::cout &lt;&lt; \"'T' is type[int]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt;                     \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl;    &#125;    else if(std::is_same&lt;T, int&amp;&gt;::value) &#123;        std::cout &lt;&lt; \"'T' is type[int&amp;]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt;                     \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl;    &#125;    else if(std::is_same&lt;T, int&amp;&amp;&gt;::value) &#123;        std::cout &lt;&lt; \"'T' is type[int&amp;&amp;]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt;                     \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl;    &#125;        std::cout &lt;&lt; \"-----------------\" &lt;&lt; std::endl;&#125;int main() &#123;  int a = 1;  func(a);  func(2);  func(static_cast&lt;int&amp;&gt;(a));  func(static_cast&lt;int&amp;&amp;&gt;(a));&#125;\n\nè¾“å‡ºç»“æœä¸ºï¼š\n12345678'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:2-----------------'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:1-----------------\n\nå¯ä»¥å‘ç°ï¼Œå½“å®å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œå·¦å€¼ä¼ é€’Tä¸ºint&amp;ï¼Œå³å€¼ä¼ é€’Tä¸ºintã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ\nå¦‚æœå°†æ¨¡ç‰ˆå‚æ•°æ˜¾ç¤ºç»‘å®šï¼š\n1234567int main() &#123;  int a = 1;  func&lt;int&gt;(a); //é”™è¯¯âŒ  func&lt;int&gt;(2);  func&lt;int&amp;&gt;(static_cast&lt;int&amp;&gt;(a));  func&lt;int&amp;&amp;&gt;(static_cast&lt;int&amp;&amp;&gt;(a));&#125;\n\nä¼šå‘ç°æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š\n1234In function 'int main()'error: no matching for call to 'func(int&amp;)'\tfunc&lt;int&gt;(a);\t...\n\næ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®å‚æ¨æ–­\nNote:å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡ç‰ˆæ¿å‚æ•°ç±»å‹çš„å³å€¼å¼•ç”¨(å¦‚ï¼ŒT&amp;&amp;)ï¼Œåˆ™å¯ä»¥ä¼ é€’ç»™å®ƒä»»æ„ç±»å‹çš„å®å‚ã€‚å¦‚æœå°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™è¿™æ ·çš„å‚æ•°ï¼Œåˆ™å‡½æ•°å‚æ•°è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨(T&amp;)ã€‚ï¼Œä¼°è®¡æ˜¯ç¼–è¯‘å™¨åšäº†ç‰¹æ®Šçš„å¤„ç†ã€‚\nç”±äºintæ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥åªèƒ½æ ¹æ®å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰è§„åˆ™ï¼Œint&amp; &amp;&amp;=int&amp;ï¼Œint &amp;&amp;= int&amp;&amp;ã€‚ä¿ç•™äº†å‚æ•°çš„å·¦å€¼å³å€¼ç‰¹æ€§ã€‚è¿™ä¹Ÿç¬¦åˆå¼•ç”¨æŠ˜å è§„åˆ™ã€‚\nå½“å®å‚æ•°ä»¥å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œint&amp;è¿˜æ˜¯æ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥T=int&amp;ï¼Œè€Œint&amp;&amp;åˆšå¥½åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥Tå°±æ˜¯intã€‚\nğŸŒ°æ —å­[2]\nä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨std::forwardå‡½æ•°copyå‡ºæ¥ï¼Œå¢åŠ è¾“å‡ºä¸€æ¡å†…å®¹ï¼Œæ”¹ä¸ºtest::forwardï¼Œå…¶ä»–ä¿æŒä¸å˜ã€‚\n123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;iostream&gt;#include &lt;bits/move.h&gt;// add print contentnamespace test&#123;template&lt;typename _Tp&gt;  constexpr _Tp&amp;&amp;  forward(typename std::remove_reference&lt;_Tp&gt;::type&amp; __t) noexcept &#123;    std::cout &lt;&lt; \"Forward an l-value.\" &lt;&lt; std::endl;    return static_cast&lt;_Tp&amp;&amp;&gt;(__t);  &#125;template&lt;typename _Tp&gt;  constexpr _Tp&amp;&amp;  forward(typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp; __t) noexcept &#123;    std::cout &lt;&lt; \"Forward an r-value.\" &lt;&lt; std::endl;    static_assert(!std::is_lvalue_reference&lt;_Tp&gt;::value, \"template argument\"          \" substituting _Tp is an lvalue reference type\");    return static_cast&lt;_Tp&amp;&amp;&gt;(__t);  &#125;&#125;// my template functionstemplate&lt;typename T&gt;void func(T&amp; param) &#123;    std::cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123;    std::cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å³å€¼\" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123;    func(param);&#125;extern \"C\" &#123;int main(int argc, char* argv[]) &#123;    int num = 2019;    warp(num);    warp(2019);    return 0;&#125;&#125;\n\nè¾“å‡ºç»“æœä¸ºï¼š\n12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å·¦å€¼\n\næ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŸå› ï¼š\nwarp()å‡½æ•°æœ¬èº«çš„å½¢å‚æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå³å¯ä»¥æ¥å—å·¦å€¼åˆå¯ä»¥æ¥å—å³å€¼ï¼›ç¬¬ä¸€ä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ï¼Œwarp()å‡½æ•°ä¸­è°ƒç”¨func()ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåº”è¯¥æ˜¯å·¦å€¼ï¼›ç¬¬äºŒä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å³å€¼ï¼Œæ ¹æ®ä¸Šé¢æ‰€è¯´çš„å¼•ç”¨æŠ˜å è§„åˆ™ï¼Œwarp()å‡½æ•°æ¥æ”¶çš„å‚æ•°ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå´è°ƒç”¨äº†è°ƒç”¨func()çš„å·¦å€¼ç‰ˆæœ¬äº†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨warp()å‡½æ•°å†…éƒ¨ï¼Œå³å€¼å¼•ç”¨ç±»å‹å˜ä¸ºäº†å·¦å€¼ï¼Œå› ä¸ºå‚æ•°æœ‰äº†åç§°ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡å˜é‡åå–å¾—å˜é‡åœ°å€ã€‚\nç»“è®ºï¼šæ— è®ºä¼ å…¥wrap()çš„å‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œåˆ°äº†å‡½æ•°å†…éƒ¨éƒ½å˜æˆäº†å·¦å€¼ã€‚\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¿æŒå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå˜é‡ç±»å‹çš„ä¸å˜å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œå®Œç¾è½¬å‘â€æŠ€æœ¯ï¼Œåœ¨C++11ä¸­é€šè¿‡std::forward()å‡½æ•°æ¥å®ç°ã€‚æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„warp()å‡½æ•°å¦‚ä¸‹ï¼š\n1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123;    func(test::forward&lt;T&gt;(param));&#125;\n\nè¾“å‡ºç»“æœä¸ºï¼š\n1234Forward an l-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an l-value.ä¼ å…¥çš„æ˜¯å³å€¼\n\nç°åœ¨è·Ÿæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´äº†ï¼Œä½†æ˜¯åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿforward()å‡½æ•°å†…éƒ¨ä¸éš¾å‘ç°ï¼Œä¼ å…¥çš„å‚æ•°åšäº†ç§»é™¤å¼•ç”¨çš„æ“ä½œï¼Œä½¿å…¶éƒ½ä¸º&amp;&amp; æˆ– &amp;ï¼Œæ‰€ä»¥æœ‰2ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œé‡ç‚¹åœ¨äºæ¨¡ç‰ˆè¿”å›çš„æ—¶å€™return static_cast&lt;_Tp&amp;&amp;&gt;(__t);å¼ºåˆ¶å°†å®å‚è½¬æ¢æˆTåŸæœ‰çš„å¼•ç”¨ç±»å‹ï¼Œæ ¹æ®å¼•ç”¨æŠ˜å åŸåˆ™ï¼ŒT&amp;&amp; &amp;è¿˜æ˜¯&amp;ï¼ŒT&amp;&amp; &amp;&amp;è¿˜æ˜¯&amp;&amp;ã€‚æ‰€ä»¥å®ç°äº†â€œå®Œç¾è½¬å‘â€ã€‚\nå¦‚æœå°†wrap()å‡½æ•°æ”¹ä¸ºè¿™æ ·å‘¢ï¼Ÿ\n1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123;    func(test::forward&lt;T&gt;(std::move(param)));&#125;\n\nç¼–è¯‘ç»“æœï¼š\n12Errorï¼šstatic_assert(template argument substituting _Tp is an lvalue reference type\");\n\nå¯ä»¥å‘ç°æˆåŠŸèµ°åˆ°äº†ç¬¬äºŒä¸ªforward()å‡½æ•°ç‰ˆæœ¬ã€‚å°†static_assert&lt;&gt;æ³¨é‡Šæ‰ï¼Œç¼–è¯‘é€šè¿‡ã€‚è¾“å‡ºç»“æœä¸ºï¼š\n1234Forward an r-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an r-value.ä¼ å…¥çš„æ˜¯å³å€¼\n\nå¯¹æ¯”std::move()çš„è¿”å›å€¼å°±å¯ä»¥å‘ç°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯return static_cast&lt;typename  std::remove_reference&lt;_Tp&gt;::type&amp;&amp;&gt;(__t);ä¸éš¾çœ‹å‡ºï¼Œå¿…æ˜¯å³å€¼å¼•ç”¨ã€‚è€Œstd::forward()å‡½æ•°åˆ™å°†å…¶æŒ‰Tçš„å¼•ç”¨ç±»å‹ä¿æŒä¸å˜åŸæ ·è¿”å›ã€‚\n","plink":"https://shuntan.github.io/posts/å®Œç¾è½¬å‘/"},{"title":"ä»4è¡Œä»£ç çœ‹å³å€¼å¼•ç”¨","date":"2019-05-23T06:50:40.000Z","updated":"2019-07-14T01:22:55.309Z","content":"æ¦‚è¿°ã€€ã€€å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®ä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š\n12int i = 0;int&amp; j = i;\n\nã€€ã€€è¿™é‡Œçš„int&amp;æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&amp;å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&amp;&amp;ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»å‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&amp;&amp;æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š\nã€€ã€€\nã€€ã€€\n\n1int&amp;&amp; i = 0;\n\nã€€ã€€è¿™é‡Œæˆ‘ä»¬ç»‘å®šäº†ä¸€ä¸ªå³å€¼0ï¼Œå…³äºå³å€¼çš„æ¦‚å¿µä¼šåœ¨åé¢ä»‹ç»ã€‚å³å€¼å¼•ç”¨æ˜¯C++11ä¸­æ–°å¢åŠ çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä»–ä¸»æ˜¯è¦ç”¨æ¥è§£å†³C++98/03ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸´æ—¶å¯¹è±¡éå¿…è¦çš„æ˜‚è´µçš„æ‹·è´æ“ä½œï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­å¦‚ä½•æŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ”¹è¿›äº†ç¨‹åºæ€§èƒ½ï¼Œåé¢å°†ä¼šè¯¦ç»†ä»‹ç»å³å€¼å¼•ç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚\nã€€ã€€å’Œå³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šå³å€¼ã€çº¯å³å€¼ã€å°†äº¡å€¼ã€universal referencesã€å¼•ç”¨æŠ˜å ã€ç§»åŠ¨è¯­ä¹‰ã€moveè¯­ä¹‰å’Œå®Œç¾è½¬å‘ç­‰ç­‰ã€‚å¾ˆå¤šéƒ½æ˜¯æ–°æ¦‚å¿µï¼Œå¯¹äºåˆšå­¦ä¹ C++11å³å€¼å¼•ç”¨çš„åˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šè§‰å¾—å³å€¼å¼•ç”¨è¿‡äºå¤æ‚ï¼Œæ¦‚å¿µä¹‹é—´çš„å…³ç³»éš¾ä»¥ç†æ¸…ã€‚\nå³å€¼å¼•ç”¨å®é™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå…¶å®æ˜¯å…³äº4è¡Œä»£ç çš„æ•…äº‹ï¼Œé€šè¿‡ç®€å•çš„4è¡Œä»£ç æˆ‘ä»¬å°±èƒ½æ¸…æ™°çš„ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µäº†ã€‚æœ¬æ–‡å¸Œæœ›å¸¦é¢†è¯»è€…é€šè¿‡4è¡Œä»£ç æ¥ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µï¼Œç†æ¸…ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æœ€ç»ˆèƒ½é€å½»åœ°æŒæ¡C++11çš„æ–°ç‰¹æ€§â€“å³å€¼å¼•ç”¨ã€‚\nå››è¡Œä»£ç çš„æ•…äº‹ç¬¬1è¡Œä»£ç çš„æ•…äº‹1int i = getVar();\n\nã€€ã€€ä¸Šé¢çš„è¿™è¡Œä»£ç å¾ˆç®€å•ï¼Œä»getVar()å‡½æ•°è·å–ä¸€ä¸ªæ•´å½¢å€¼ï¼Œç„¶è€Œï¼Œè¿™è¡Œä»£ç ä¼šäº§ç”Ÿå‡ ç§ç±»å‹çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šäº§ç”Ÿä¸¤ç§ç±»å‹çš„å€¼ï¼Œä¸€ç§æ˜¯å·¦å€¼iï¼Œä¸€ç§æ˜¯å‡½æ•°getVar()è¿”å›çš„ä¸´æ—¶å€¼ï¼Œè¿™ä¸ªä¸´æ—¶å€¼åœ¨è¡¨è¾¾å¼ç»“æŸåå°±é”€æ¯äº†ï¼Œè€Œå·¦å€¼iåœ¨è¡¨è¾¾å¼ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªä¸´æ—¶å€¼å°±æ˜¯å³å€¼ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œå³å€¼æ˜¯ä¸å…·åçš„ã€‚åŒºåˆ†å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªç®€å•åŠæ³•æ˜¯ï¼šçœ‹èƒ½ä¸èƒ½å¯¹è¡¨è¾¾å¼å–åœ°å€ï¼Œå¦‚æœèƒ½ï¼Œåˆ™ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚\nã€€ã€€æ‰€æœ‰çš„å…·åå˜é‡æˆ–å¯¹è±¡éƒ½æ˜¯å·¦å€¼ï¼Œè€ŒåŒ¿åå˜é‡åˆ™æ˜¯å³å€¼ï¼Œæ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼è¯­å¥ï¼š\n1int i = 0;\n\nã€€ã€€åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œi æ˜¯å·¦å€¼ï¼Œ0 æ˜¯å­—é¢é‡ï¼Œå°±æ˜¯å³å€¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œi å¯ä»¥è¢«å¼•ç”¨ï¼Œ0 å°±ä¸å¯ä»¥äº†ã€‚å…·ä½“æ¥è¯´ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­ç­‰å·å³è¾¹çš„0æ˜¯çº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œåœ¨C++11ä¸­æ‰€æœ‰çš„å€¼å¿…å±äºå·¦å€¼ã€å°†äº¡å€¼ã€çº¯å³å€¼ä¸‰è€…ä¹‹ä¸€ã€‚æ¯”å¦‚ï¼Œéå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€åŸå§‹å­—é¢é‡å’Œlambdaè¡¨è¾¾å¼ç­‰éƒ½æ˜¯çº¯å³å€¼ã€‚è€Œå°†äº¡å€¼æ˜¯C++11æ–°å¢çš„ã€ä¸å³å€¼å¼•ç”¨ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼Œå°†è¦è¢«ç§»åŠ¨çš„å¯¹è±¡ã€T&amp;&amp;å‡½æ•°è¿”å›å€¼ã€std::moveè¿”å›å€¼å’Œè½¬æ¢ä¸ºT&amp;&amp;çš„ç±»å‹çš„è½¬æ¢å‡½æ•°çš„è¿”å›å€¼ç­‰ã€‚å…³äºå°†äº¡å€¼æˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š\n123int j = 5;auto f = []&#123;return 5;&#125;;\n\nã€€ã€€ä¸Šé¢çš„ä»£ç ä¸­5æ˜¯ä¸€ä¸ªåŸå§‹å­—é¢é‡ï¼Œ []{return 5;}æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œéƒ½æ˜¯å±äºçº¯å³å€¼ï¼Œä»–ä»¬çš„ç‰¹ç‚¹æ˜¯åœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ã€‚\nã€€ã€€é€šè¿‡åœ°è¡Œä»£ç æˆ‘ä»¬å¯¹å³å€¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ç¬¬äºŒè¡Œä»£ç ã€‚\nç¬¬2è¡Œä»£ç çš„æ•…äº‹1T&amp;&amp; k = getVar();\n\nã€€ã€€ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç å¾ˆåƒï¼Œåªæ˜¯ç›¸æ¯”ç¬¬ä¸€è¡Œä»£ç å¤šäº†â€œ&amp;&amp;â€ï¼Œä»–å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“å·¦å€¼å¼•ç”¨æ˜¯å¯¹å·¦å€¼çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œå¯¹åº”çš„ï¼Œå¯¹å³å€¼çš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œä¸”å³å€¼æ˜¯åŒ¿åå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥è·å–å³å€¼ã€‚è™½ç„¶ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯å®é™…ä¸Šè¯­ä¹‰çš„å·®åˆ«å¾ˆå¤§ï¼Œè¿™é‡Œï¼ŒgetVar()äº§ç”Ÿçš„ä¸´æ—¶å€¼ä¸ä¼šåƒç¬¬ä¸€è¡Œä»£ç é‚£æ ·ï¼Œåœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ï¼Œè€Œæ˜¯ä¼šè¢«â€œç»­å‘½â€ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šé€šè¿‡å³å€¼å¼•ç”¨å¾—ä»¥å»¶ç»­ï¼Œå’Œå˜é‡kçš„å£°æ˜å‘¨æœŸä¸€æ ·é•¿ã€‚\nå³å€¼å¼•ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹ã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨çš„å£°æ˜ï¼Œå³å€¼åˆâ€œé‡è·æ–°ç”Ÿâ€ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸å³å€¼å¼•ç”¨ç±»å‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œåªè¦è¯¥å˜é‡è¿˜æ´»ç€ï¼Œè¯¥å³å€¼ä¸´æ—¶é‡å°†ä¼šä¸€ç›´å­˜æ´»ä¸‹å»ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä»£ç æ¸…å•1-1æ‰€ç¤ºã€‚\nä»£ç æ¸…å•1-1 \n12345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;using namespace std;int g_constructCount=0;int g_copyConstructCount=0;int g_destructCount=0;struct A&#123;    A()&#123;        cout&lt;&lt;\"construct: \"&lt;&lt;++g_constructCount&lt;&lt;endl;        &#125;        A(const A&amp; a)    &#123;        cout&lt;&lt;\"copy construct: \"&lt;&lt;++g_copyConstructCount &lt;&lt;endl;    &#125;    ~A()    &#123;        cout&lt;&lt;\"destruct: \"&lt;&lt;++g_destructCount&lt;&lt;endl;    &#125;&#125;;A GetA()&#123;    return A();&#125;int main() &#123;    A a = GetA();    return 0;&#125;\n\nã€€ã€€ä¸ºäº†æ¸…æ¥šçš„è§‚å¯Ÿä¸´æ—¶å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsç”¨æ¥å…³é—­è¿”å›å€¼ä¼˜åŒ–æ•ˆæœã€‚\nã€€ã€€è¾“å‡ºç»“æœï¼š\n123456construct: 1copy construct: 1destruct: 1copy construct: 2destruct: 2destruct: 3\n\nã€€ã€€ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰è¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‹·è´æ„é€ å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯GetA()å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¯¹è±¡è¿”å›å‡ºæ¥æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡äº§ç”Ÿçš„ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨mainå‡½æ•°ä¸­æ„é€ aå¯¹è±¡äº§ç”Ÿçš„ã€‚ç¬¬äºŒæ¬¡çš„destructæ˜¯å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨æ„é€ aå¯¹è±¡ä¹‹åå°±é”€æ¯äº†ã€‚å¦‚æœå¼€å¯è¿”å›å€¼ä¼˜åŒ–çš„è¯ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼š\nconstruct: 1\ndestruct: 1\nã€€ã€€å¯ä»¥çœ‹åˆ°è¿”å›å€¼ä¼˜åŒ–å°†ä¼šæŠŠä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æ‰ï¼Œä½†è¿™ä¸æ˜¯c++æ ‡å‡†ï¼Œæ˜¯å„ç¼–è¯‘å™¨çš„ä¼˜åŒ–è§„åˆ™ã€‚æˆ‘ä»¬åœ¨å›åˆ°ä¹‹å‰æåˆ°çš„å¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨æ¥å»¶é•¿ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡å³å€¼å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›å€¼çš„è¯ï¼Œç»“æœåˆä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsã€‚\n123456789int main() &#123;    A&amp;&amp; a = GetA();    return 0;&#125;è¾“å‡ºç»“æœï¼šconstruct: 1copy construct: 1destruct: 1destruct: 2\n\nã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæ¯”ä¹‹å‰å°‘äº†ä¸€æ¬¡æ‹·è´æ„é€ å’Œä¸€æ¬¡ææ„ï¼ŒåŸå› åœ¨äºå³å€¼å¼•ç”¨ç»‘å®šäº†å³å€¼ï¼Œè®©ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå³é¿å…ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æ„é€ å’Œææ„ï¼Œäº‹å®ä¸Šï¼Œåœ¨c++98/03ä¸­ï¼Œé€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨ä¹Ÿç»å¸¸ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ã€‚ä¸Šé¢çš„ä»£ç æ”¹æˆï¼š\nã€€ã€€const A&amp; a = GetA();\nã€€ã€€è¾“å‡ºçš„ç»“æœå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œå› ä¸ºå¸¸é‡å·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªâ€œä¸‡èƒ½â€çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æ¥å—å·¦å€¼ã€å³å€¼ã€å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ™®é€šçš„å·¦å€¼å¼•ç”¨ä¸èƒ½æ¥å—å³å€¼ï¼Œæ¯”å¦‚è¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯¹çš„ï¼š\nã€€ã€€A&amp; a = GetA();\nã€€ã€€ä¸Šé¢çš„ä»£ç ä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºéå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½æ¥å—å·¦å€¼ã€‚\nå³å€¼å¼•ç”¨çš„ç¬¬äºŒä¸ªç‰¹ç‚¹ã€€ã€€å³å€¼å¼•ç”¨ç‹¬ç«‹äºå·¦å€¼å’Œå³å€¼ã€‚æ„æ€æ˜¯å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š\n1int&amp;&amp; var1 = 1;\n\nã€€ã€€var1ç±»å‹ä¸ºå³å€¼å¼•ç”¨ï¼Œä½†var1æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå…·åå˜é‡éƒ½æ˜¯å·¦å€¼ã€‚\nã€€ã€€å…³äºå³å€¼å¼•ç”¨ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜æ˜¯ï¼šT&amp;&amp;æ˜¯ä»€ä¹ˆï¼Œä¸€å®šæ˜¯å³å€¼å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n12345template&lt;typename T&gt;void f(T&amp;&amp; t)&#123;&#125;f(10); //tæ˜¯å³å€¼int x = 10;f(x); //tæ˜¯å·¦å€¼\n\nã€€ã€€ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒT&amp;&amp;è¡¨ç¤ºçš„å€¼ç±»å‹ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯å·¦å€¼åˆå¯èƒ½æ˜¯å³å€¼ï¼Œè¿™ä¸€ç‚¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™å°±æ˜¯å³å€¼å¼•ç”¨çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚\nå³å€¼å¼•ç”¨çš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹ã€€ã€€T&amp;&amp; tåœ¨å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨æ–­çš„æ—¶å€™ï¼Œå®ƒæ˜¯æœªå®šçš„å¼•ç”¨ç±»å‹ï¼ˆuniversal referencesï¼‰ï¼Œå¦‚æœè¢«ä¸€ä¸ªå·¦å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼›å¦‚æœå®ƒè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå®ƒæ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼å–å†³äºå®ƒçš„åˆå§‹åŒ–ã€‚\næˆ‘ä»¬å†å›è¿‡å¤´çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹äºå‡½æ•°templatevoid f(T&amp;&amp; t)ï¼Œå½“å‚æ•°ä¸ºå³å€¼10çš„æ—¶å€™ï¼Œæ ¹æ®universal referencesçš„ç‰¹ç‚¹ï¼Œtè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯å³å€¼ï¼›å½“å‚æ•°ä¸ºå·¦å€¼xæ—¶ï¼Œtè¢«ä¸€ä¸ªå·¦å€¼å¼•ç”¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…æ˜¯å½“å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œæˆ–autoå…³é”®å­—ï¼‰çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰æ˜¯universal referencesã€‚å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n1234567template&lt;typename T&gt;void f(T&amp;&amp; param); template&lt;typename T&gt;class Test &#123;    Test(Test&amp;&amp; rhs); &#125;;\n\nã€€ã€€ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œparamæ˜¯universal referenceï¼Œrhsæ˜¯Test&amp;&amp;å³å€¼å¼•ç”¨ï¼Œå› ä¸ºæ¨¡ç‰ˆå‡½æ•°få‘ç”Ÿäº†ç±»å‹æ¨æ–­ï¼Œè€ŒTest&amp;&amp;å¹¶æ²¡æœ‰å‘ç”Ÿç±»å‹æ¨å¯¼ï¼Œå› ä¸ºTest&amp;&amp;æ˜¯ç¡®å®šçš„ç±»å‹äº†ã€‚\nã€€ã€€æ­£æ˜¯å› ä¸ºå³å€¼å¼•ç”¨å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œä¾èµ–äºåˆå§‹åŒ–ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šæ–‡ç« ï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚\nã€€ã€€è¿™é‡Œå†æä¸€ä¸‹å¼•ç”¨æŠ˜å ï¼Œæ­£æ˜¯å› ä¸ºå¼•å…¥äº†å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„æŠ˜å ï¼ŒC++11ç¡®å®šäº†å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼š\n\næ‰€æœ‰çš„å³å€¼å¼•ç”¨å åŠ åˆ°å³å€¼å¼•ç”¨ä¸Šä»ç„¶è¿˜æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼›\næ‰€æœ‰çš„å…¶ä»–å¼•ç”¨ç±»å‹ä¹‹é—´çš„å åŠ éƒ½å°†å˜æˆå·¦å€¼å¼•ç”¨ã€‚\n\nç¬¬3è¡Œä»£ç çš„æ•…äº‹1T(T&amp;&amp; a) : m_val(val)&#123; a.m_val=nullptr; &#125;\n\nã€€ã€€è¿™è¡Œä»£ç å®é™…ä¸Šæ¥è‡ªäºä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä¸ºä»€ä¹ˆå°†å³å€¼å¼•ç”¨ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°å‘¢ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚ä»£ç æ¸…å•1-2æ‰€ç¤ºã€‚\nä»£ç æ¸…å•1-2\n1234567891011121314151617181920class A&#123;public:    A():m_ptr(new int(0))&#123;cout &lt;&lt; \"construct\" &lt;&lt; endl;&#125;    A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°    &#123;        cout &lt;&lt; \"copy construct\" &lt;&lt; endl;    &#125;    ~A()&#123; delete m_ptr;&#125;private:    int* m_ptr;&#125;;int main() &#123;    A a = GetA();    return 0;&#125;    è¾“å‡ºï¼šconstructcopy constructcopy construct\n\nã€€ã€€è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸€ä¸ªå¸¦æœ‰å †å†…å­˜çš„ç±»ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæ·±æ‹·è´æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œä¼šå‘ç”Ÿâ€œæŒ‡é’ˆæ‚¬æŒ‚â€çš„é—®é¢˜ã€‚å¦‚æœä¸æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä¸Šé¢çš„æµ‹è¯•ä»£ç å°†ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆç¼–è¯‘é€‰é¡¹-fno-elide-constructorsï¼‰ï¼Œå†…éƒ¨çš„m_ptrå°†ä¼šè¢«åˆ é™¤ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¸´æ—¶å³å€¼ææ„çš„æ—¶å€™åˆ é™¤ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡å¤–é¢æ„é€ çš„aå¯¹è±¡é‡Šæ”¾æ—¶åˆ é™¤ä¸€æ¬¡ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„m_ptræ˜¯åŒä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æŒ‡é’ˆæ‚¬æŒ‚é—®é¢˜ã€‚æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°è™½ç„¶å¯ä»¥ä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ä¼šé€ æˆé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™ç§æ·±æ‹·è´æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š\nã€€ã€€ä¸Šé¢ä»£ç ä¸­çš„GetAå‡½æ•°ä¼šè¿”å›ä¸´æ—¶å˜é‡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡aï¼Œä¸´æ—¶å˜é‡åœ¨æ‹·è´æ„é€ å®Œæˆä¹‹åå°±é”€æ¯äº†ï¼Œå¦‚æœå †å†…å­˜å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ‹·è´æ„é€ çš„ä»£ä»·ä¼šå¾ˆå¤§ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸´æ—¶å˜é‡å¹¶é€ æˆé¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œæœ‰æ²¡æœ‰åŠæ³•é¿å…ä¸´æ—¶å˜é‡é€ æˆçš„æ€§èƒ½æŸå¤±å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒC++11å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚ä»£ç æ¸…å•1-3æ‰€ç¤ºã€‚\nä»£ç æ¸…å•1-3\n123456789101112131415161718192021222324class A&#123;public:    A() :m_ptr(new int(0))&#123;&#125;    A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°    &#123;        cout &lt;&lt; \"copy construct\" &lt;&lt; endl;    &#125;    A(A&amp;&amp; a) :m_ptr(a.m_ptr)    &#123;        a.m_ptr = nullptr;        cout &lt;&lt; \"move construct\" &lt;&lt; endl;    &#125;    ~A()&#123; delete m_ptr;&#125;private:    int* m_ptr;&#125;;int main()&#123;    A a = Get(false); &#125; è¾“å‡ºï¼šconstructmove constructmove construct\n\nã€€ã€€ä»£ç æ¸…å•1-3å’Œ1-2ç›¸æ¯”åªå¤šäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å‡ºç»“æœè¡¨æ˜ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œåªè°ƒç”¨äº†move constructå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªmove constructå‡½æ•°ï¼š\n12345A(A&amp;&amp; a) :m_ptr(a.m_ptr)&#123;    a.m_ptr = nullptr;    cout &lt;&lt; \"move construct\" &lt;&lt; endl;&#125;\n\nã€€ã€€è¿™ä¸ªæ„é€ å‡½æ•°å¹¶æ²¡æœ‰åšæ·±æ‹·è´ï¼Œä»…ä»…æ˜¯å°†æŒ‡é’ˆçš„æ‰€æœ‰è€…è½¬ç§»åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†å‚æ•°å¯¹è±¡açš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œè¿™é‡Œä»…ä»…æ˜¯åšäº†æµ…æ‹·è´ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°é¿å…äº†ä¸´æ—¶å˜é‡çš„æ·±æ‹·è´é—®é¢˜ã€‚\nã€€ã€€ä¸Šé¢è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œçš„A&amp;&amp;è¡¨ç¤ºå³å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‰é¢å·²ç»æåˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å‘ç”Ÿç±»å‹æ¨æ–­ï¼Œæ˜¯ç¡®å®šçš„å³å€¼å¼•ç”¨ç±»å‹ã€‚ä¸ºä»€ä¹ˆä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ï¼Ÿå› ä¸ºè¿™ä¸ªæ„é€ å‡½æ•°åªèƒ½æ¥å—å³å€¼å‚æ•°ï¼Œè€Œå‡½æ•°è¿”å›å€¼æ˜¯å³å€¼ï¼Œæ‰€ä»¥å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„A&amp;&amp;å¯ä»¥çœ‹ä½œæ˜¯ä¸´æ—¶å€¼çš„æ ‡è¯†ï¼Œå¯¹äºä¸´æ—¶å€¼æˆ‘ä»¬ä»…ä»…éœ€è¦åšæµ…æ‹·è´å³å¯ï¼Œæ— éœ€å†åšæ·±æ‹·è´ï¼Œä»è€Œè§£å†³äº†å‰é¢æåˆ°çš„ä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº§ç”Ÿçš„æ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç§»åŠ¨è¯­ä¹‰ï¼Œå³å€¼å¼•ç”¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ã€‚\nã€€ã€€éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬æä¾›ç§»åŠ¨æ„é€ å‡½æ•°çš„åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ï¼Œä»¥é˜²æ­¢ç§»åŠ¨ä¸æˆåŠŸçš„æ—¶å€™è¿˜èƒ½æ‹·è´æ„é€ ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®‰å…¨ã€‚\nã€€ã€€æˆ‘ä»¬çŸ¥é“ç§»åŠ¨è¯­ä¹‰æ˜¯é€šè¿‡å³å€¼å¼•ç”¨æ¥åŒ¹é…ä¸´æ—¶å€¼çš„ï¼Œé‚£ä¹ˆï¼Œæ™®é€šçš„å·¦å€¼æ˜¯å¦ä¹Ÿèƒ½å€ŸåŠ©ç§»åŠ¨è¯­ä¹‰æ¥ä¼˜åŒ–æ€§èƒ½å‘¢ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿäº‹å®ä¸ŠC++11ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†std::moveæ–¹æ³•æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œä»è€Œæ–¹ä¾¿åº”ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚moveæ˜¯å°†å¯¹è±¡èµ„æºçš„æ‰€æœ‰æƒä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯è½¬ç§»ï¼Œæ²¡æœ‰å†…å­˜çš„æ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„moveè¯­ä¹‰ã€‚å¦‚å›¾1-1æ‰€ç¤ºæ˜¯æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«ã€‚\nå›¾1-1 æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«\nã€€ã€€å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n1234567&#123;    std::list&lt; std::string&gt; tokens;    //çœç•¥åˆå§‹åŒ–...    std::list&lt; std::string&gt; t = tokens; //è¿™é‡Œå­˜åœ¨æ‹·è´ &#125;std::list&lt; std::string&gt; tokens;std::list&lt; std::string&gt; t = std::move(tokens);  //è¿™é‡Œæ²¡æœ‰æ‹·è´\n\nã€€ã€€å¦‚æœä¸ç”¨std::moveï¼Œæ‹·è´çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½è¾ƒä½ã€‚ä½¿ç”¨moveå‡ ä¹æ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œåªæ˜¯è½¬æ¢äº†èµ„æºçš„æ‰€æœ‰æƒã€‚ä»–å®é™…ä¸Šå°†å·¦å€¼å˜æˆå³å€¼å¼•ç”¨ï¼Œç„¶ååº”ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå°±é¿å…äº†æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å†…éƒ¨æœ‰è¾ƒå¤§çš„å¯¹å†…å­˜æˆ–è€…åŠ¨æ€æ•°ç»„æ—¶ï¼Œå¾ˆæœ‰å¿…è¦å†™moveè¯­ä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°ï¼Œé¿å…æ— è°“çš„æ·±æ‹·è´ï¼Œä»¥æé«˜æ€§èƒ½ã€‚äº‹å®ä¸Šï¼ŒC++11ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ã€‚\nã€€ã€€è¿™é‡Œä¹Ÿè¦æ³¨æ„å¯¹moveè¯­ä¹‰çš„è¯¯è§£ï¼Œmoveå®é™…ä¸Šå®ƒå¹¶ä¸èƒ½ç§»åŠ¨ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚å¦‚æœæ˜¯ä¸€äº›åŸºæœ¬ç±»å‹æ¯”å¦‚intå’Œchar[10]å®šé•¿æ•°ç»„ç­‰ç±»å‹ï¼Œä½¿ç”¨moveçš„è¯ä»ç„¶ä¼šå‘ç”Ÿæ‹·è´ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œmoveå¯¹äºå«èµ„æºï¼ˆå †å†…å­˜æˆ–å¥æŸ„ï¼‰çš„å¯¹è±¡æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚\nç¬¬4è¡Œä»£ç æ•…äº‹1template &lt;typename T&gt;void f(T&amp;&amp; val)&#123; foo(std::forward&lt;T&gt;(val)); &#125;\n\nã€€ã€€C++11ä¹‹å‰è°ƒç”¨æ¨¡æ¿å‡½æ•°æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚ä½•æ­£ç¡®çš„ä¼ é€’å‚æ•°ã€‚æ¯”å¦‚ï¼š \n12345678910template &lt;typename T&gt;void forwardValue(T&amp; val)&#123;    processValue(val); //å³å€¼å‚æ•°ä¼šå˜æˆå·¦å€¼ &#125;template &lt;typename T&gt;void forwardValue(const T&amp; val)&#123;    processValue(val); //å‚æ•°éƒ½å˜æˆå¸¸é‡å·¦å€¼å¼•ç”¨äº† &#125;\n\néƒ½ä¸èƒ½æŒ‰ç…§å‚æ•°çš„æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚\nã€€ã€€C++11å¼•å…¥äº†å®Œç¾è½¬å‘ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œå®Œå…¨ä¾ç…§æ¨¡æ¿çš„å‚æ•°çš„ç±»å‹ï¼ˆå³ä¿æŒå‚æ•°çš„å·¦å€¼ã€å³å€¼ç‰¹å¾ï¼‰ï¼Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ¨¡æ¿ä¸­è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚C++11ä¸­çš„std::forwardæ­£æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œä»–ä¼šæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n12345678910111213141516void processValue(int&amp; a)&#123; cout &lt;&lt; \"lvalue\" &lt;&lt; endl; &#125;void processValue(int&amp;&amp; a)&#123; cout &lt;&lt; \"rvalue\" &lt;&lt; endl; &#125;template &lt;typename T&gt;void forwardValue(T&amp;&amp; val)&#123;    processValue(std::forward&lt;T&gt;(val)); //ç…§å‚æ•°æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚&#125;void Testdelcl()&#123;    int i = 0;    forwardValue(i); //ä¼ å…¥å·¦å€¼     forwardValue(0);//ä¼ å…¥å³å€¼ &#125;è¾“å‡ºï¼šlvaue rvalue\n\nã€€ã€€å³å€¼å¼•ç”¨T&amp;&amp;æ˜¯ä¸€ä¸ªuniversal referencesï¼Œå¯ä»¥æ¥å—å·¦å€¼æˆ–è€…å³å€¼ï¼Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§è®©ä»–é€‚åˆä½œä¸ºä¸€ä¸ªå‚æ•°çš„è·¯ç”±ï¼Œç„¶åå†é€šè¿‡std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹å»åŒ¹é…å¯¹åº”çš„é‡è½½å‡½æ•°ï¼Œæœ€ç»ˆå®ç°å®Œç¾è½¬å‘ã€‚\nã€€ã€€æˆ‘ä»¬å¯ä»¥ç»“åˆå®Œç¾è½¬å‘å’Œç§»åŠ¨è¯­ä¹‰æ¥å®ç°ä¸€ä¸ªæ³›å‹çš„å·¥å‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š\n12345template&lt;typenameâ€¦  Args&gt;T* Instance(Args&amp;&amp;â€¦ args)&#123;    return new T(std::forward&lt;Args &gt;(args)â€¦);&#125;\n\nã€€ã€€è¿™ä¸ªå·¥å‚å‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ç±»å‹ï¼Œå†…éƒ¨ä½¿ç”¨std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ï¼Œå¦‚æœå‚æ•°çš„å®é™…ç±»å‹æ˜¯å³å€¼ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åŒ¹é…ç§»åŠ¨æ„é€ ï¼Œå¦‚æœæ˜¯å·¦å€¼åˆ™ä¼šåŒ¹é…æ‹·è´æ„é€ ã€‚\næ€»ç»“ã€€ã€€é€šè¿‡4è¡Œä»£ç æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä»¥åŠå³å€¼å¼•ç”¨çš„ä¸€äº›ç‰¹ç‚¹ï¼Œåˆ©ç”¨è¿™äº›ç‰¹ç‚¹æˆ‘ä»¬æ‰æ–¹ä¾¿å®ç°ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚C++11æ­£æ˜¯é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥é¿å…æ— è°“æ‹·è´çš„é—®é¢˜ï¼Œé€šè¿‡moveè¯­ä¹‰æ¥å°†ä¸´æ—¶ç”Ÿæˆçš„å·¦å€¼ä¸­çš„èµ„æºæ— ä»£ä»·çš„è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼Œé€šè¿‡å®Œç¾è½¬å‘æ¥è§£å†³ä¸èƒ½æŒ‰ç…§å‚æ•°å®é™…ç±»å‹æ¥è½¬å‘çš„é—®é¢˜ï¼ˆåŒæ—¶ï¼Œå®Œç¾è½¬å‘è·å¾—çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®ç°ç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚\næœ¬æ–‡æ›¾å‘è¡¨äºã€Šç¨‹åºå‘˜ã€‹2015å¹´1æœˆåˆŠã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\nåè®°ï¼šæœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªäºæˆ‘åœ¨å…¬å¸å†…éƒ¨åŸ¹è®­çš„ä¸€æ¬¡è¯¾ç¨‹ï¼Œå› ä¸ºå¾ˆå¤šäººå¯¹C++11å³å€¼å¼•ç”¨æä¸æ¸…æˆ–è€…ç†è§£å¾—ä¸æ·±å…¥ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå°±æ•´ç†äº†ä¸€ä¸‹å‘åˆ°ç¨‹åºå‘˜æ‚å¿—äº†ï¼Œæˆ‘ç›¸ä¿¡è¯»è€…çœ‹å®Œä¹‹åå¯¹å³å€¼å¼•ç”¨ä¼šæœ‰å…¨é¢æ·±å…¥çš„äº†è§£ã€‚\nä¸€ç‚¹æ¢¦æƒ³ï¼šå°½è‡ªå·±ä¸€ä»½åŠ›ï¼Œè®©c++çš„ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼\n","plink":"https://shuntan.github.io/posts/å³å€¼å¼•ç”¨/"},{"title":"squidä»‹ç»åŠå…¶ç®€å•é…ç½®","date":"2019-05-15T07:15:30.000Z","updated":"2019-07-14T01:23:21.617Z","content":"squidçš„æ¦‚å¿µsquidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»ç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚\n\n\nä¸‹è½½åœ°å€squid-cache å®˜ç½‘ http://www.squid-cache.org\nsquidä»‹ç»åŠå…¶ç®€å•é…ç½® https://www.cnblogs.com/cherishry/p/5706736.html\nCentOS 7å®‰è£…squidä»£ç†æœåŠ¡å™¨ https://blog.csdn.net/ithomer/article/details/78136993\nsquidä»£ç†çš„ä½œç”¨\né€šè¿‡ç¼“å­˜çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›Webè®¿é—®åŠ é€Ÿ\nå¯¹ç”¨æˆ·çš„Webè®¿é—®è¿›è¡Œè¿‡æ»¤æ§åˆ¶\n\nå·¥ä½œæµç¨‹å½“ä»£ç†æœåŠ¡å™¨ä¸­æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶ï¼š\na.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\nb.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›\nc.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼Œå–å‡ºæ•°æ®ï¼›\nd.ä»£ç†æœåŠ¡å™¨å°†ä»ç¼“å­˜ä¸­å–å¾—çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nå½“ä»£ç†æœåŠ¡å™¨ä¸­æ²¡æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶äº†ï¼š\n1.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\n2.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›\n3.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼›\n4.ä»£ç†æœåŠ¡å™¨å‘Internet ä¸Šçš„è¿œç«¯æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\n5.è¿œç«¯æœåŠ¡å™¨å“åº”ï¼Œè¿”å›ç›¸åº”çš„æ•°æ®ï¼›\n6.ä»£ç†æœåŠ¡å™¨å–å¾—è¿œç«¯æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿ç•™ä¸€ä»½åˆ°è‡ªå·±çš„æ•°æ®ç¼“å­˜ä¸­ã€‚\n\nSquidä»£ç†æœåŠ¡å™¨å·¥ä½œåœ¨TCP/IPåº”ç”¨å±‚\n\nSquidå„ç§ä»£ç†çš„å®šä¹‰æ­£å‘ä»£ç†æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡è¢«ç”¨äºç¼“å­˜é™æ€çš„ç½‘é¡µåˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸€å°ä¸»æœºä¸Šï¼ˆå³ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚å½“è¢«ç¼“å­˜çš„é¡µé¢è¢«ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»æœ¬åœ°ä»£ç†æœåŠ¡å™¨é‚£é‡Œè·å–è¯·æ±‚æ•°æ®è€Œä¸å†å‘åŸwebç«™ç‚¹è¯·æ±‚æ•°æ®ã€‚è¿™æ ·å°±èŠ‚çœäº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œè¦æƒ³å®ç°è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æ¯ä¸€ä¸ªå†…éƒ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šæ˜ç¡®æŒ‡åä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚å®¢æˆ·ç«¯ä¸Šç½‘æ—¶ï¼Œæ¯æ¬¡éƒ½æŠŠè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†,ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ç¡®å®šæ˜¯å¦è¿æ¥åˆ°è¿œç¨‹webæœåŠ¡å™¨è·å–æ•°æ®ã€‚å¦‚æœåœ¨æœ¬åœ°ç¼“å†²åŒºæœ‰ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™ç›´æ¥å°†æ–‡ä»¶ä¼ ç»™ç”¨æˆ·å³å¯ã€‚å¦‚æœæ²¡æœ‰çš„è¯åˆ™å…ˆå–å›æ–‡ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½ç¼“å†²ï¼Œç„¶åå°†æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚\né€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œä»£ç†æ“ä½œå¯¹å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ˜¯é€æ˜çš„ï¼ˆå³ä¸éœ€æŒ‡æ˜ä»£ç†æœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼‰ã€‚é€æ˜ä»£ç†æœåŠ¡å™¨é˜»æ–­ç½‘ç»œé€šä¿¡ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºè®¿é—®å¤–éƒ¨çš„HTTPï¼ˆ80ç«¯å£ï¼‰æµé‡ã€‚å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœ¬åœ°æœ‰ç¼“å†²åˆ™å°†ç¼“å†²çš„æ•°æ®ç›´æ¥å‘ç»™ç”¨æˆ·ï¼Œå¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰ç¼“å†²åˆ™å‘è¿œç¨‹webæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä½™æ“ä½œå’Œæ ‡å‡†çš„ä»£ç†æœåŠ¡å™¨å®Œå…¨ç›¸åŒã€‚å¯¹äºlinuxæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé€æ˜ä»£ç†ä½¿ç”¨Iptablesæˆ–è€…Ipchainså®ç°ã€‚å› æ­¤ä¸éœ€è¦å¯¹æµè§ˆå™¨ä½œä»»ä½•è®¾ç½®ï¼Œæ‰€ä»¥ï¼Œé€æ˜ä»£ç†å¯¹äºISPï¼ˆInternetæœåŠ¡å™¨æä¾›å•†ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚\nåå‘ä»£ç†åå‘ä»£ç†ç¼“å†²å™¨åå‘ä»£ç†æ˜¯å’Œå‰ä¸¤ç§ä»£ç†å®Œå…¨ä¸åŒçš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚ä½¿ç”¨å®ƒå¯ä»¥é™ä½åŸå§‹WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚åå‘ä»£ç†æœåŠ¡å™¨æ‰¿æ‹…äº†å¯¹åŸå§‹WEBæœåŠ¡å™¨çš„é™æ€é¡µé¢çš„è¯·æ±‚ï¼Œé˜²æ­¢åŸå§‹æœåŠ¡å™¨è¿‡è½½ã€‚å®ƒä½äºWEBæœåŠ¡å™¨å’ŒInternetä¹‹é—´ï¼Œå¤„ç†æ‰€æœ‰å¯¹WEBæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œç»„ç»‡äº†WEBæœåŠ¡å™¨å’ŒInternetçš„ç›´æ¥é€šä¿¡ã€‚å¦‚æœäº’è”ç½‘ç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å†²çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å†²å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åˆ™å…ˆå‘WEBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹å¼é€šè¿‡é™ä½äº†WEBæœåŠ¡å™¨çš„è¯·æ±‚æ•°ä»è€Œé™ä½äº†WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚\næ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«æ¦‚å¿µæ­£å‘ä»£ç†ï¼šå¯¹äºåŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äººåå‘ä»£ç†ï¼šå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨\nç”¨é€”æ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚\nå®‰å…¨æ€§æ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚åå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚\nSquidä¸»è¦ç»„æˆéƒ¨åˆ†æœåŠ¡åï¼šsquidä¸»ç¨‹åºï¼š/usr/sbin/squidé…ç½®ç›®å½•ï¼š/etc/squidä¸»é…ç½®æ–‡ä»¶ï¼š/etc/squid/squid.confç›‘å¬tcpç«¯å£å·ï¼š3128é»˜è®¤è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼š/var/log/squid/access.log\nsquidå¸¸ç”¨é…ç½®é€‰é¡¹/etc/squid/squid.conf\n123456789101112131415http_port 3128  (è¿˜å¯ä»¥åªç›‘å¬ä¸€ä¸ªIP http_port 192.168.0.1:3128)cache_mem 64MB  #ç¼“å­˜å å†…å­˜å¤§å°maximum_object_size 4096KB  #æœ€å¤§ç¼“å­˜å—reply_body_max_size  1024000 allow all      #é™å®šä¸‹è½½æ–‡ä»¶å¤§å°access_log /var/log/squid/access.log    #è®¿é—®æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹visible_hostname    proxy.test.xom  #å¯è§çš„ä¸»æœºåcache_dir ufs /var/spool/squid  100 16 256 #ufs:ç¼“å­˜æ•°æ®çš„å­˜å‚¨æ ¼å¼#/var/spool/squid    ç¼“å­˜ç›®å½•#100ï¼šç¼“å­˜ç›®å½•å ç£ç›˜ç©ºé—´å¤§å°ï¼ˆMï¼‰#16ï¼šç¼“å­˜ç©ºé—´ä¸€çº§å­ç›®å½•ä¸ªæ•°#256ï¼šç¼“å­˜ç©ºé—´äºŒçº§å­ç›®å½•ä¸ªæ•°cache_mgr webmaster@test.com    #å®šä¹‰ç®¡ç†å‘˜é‚®ç®±http_access deny all    #è®¿é—®æ§åˆ¶\n\nsquidä¸­çš„è®¿é—®æ§åˆ¶  ä½¿ç”¨è®¿é—®æ§åˆ¶ç‰¹æ€§ï¼Œå¯ä»¥æ§åˆ¶åœ¨è®¿é—®æ—¶æ ¹æ®ç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œç¼“å­˜ã€è®¿é—®ç‰¹å®šç«™ç‚¹æˆ–ä¸€ç»„ç«™ç‚¹ç­‰ç­‰ã€‚squidè®¿é—®æ§åˆ¶æœ‰ä¸¤ä¸ªè¦ç´ ï¼šACLå…ƒç´ å’Œè®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä»¥å…è®¸æˆ–æ‹’ç»æŸäº›ç”¨æˆ·å¯¹æ­¤æœåŠ¡çš„è®¿é—®ã€‚\nACLå…ƒç´ ç±»å‹\nsrcï¼šæºåœ°å€ï¼ˆå³å®¢æˆ·æœºIPåœ°å€ï¼‰\ndstï¼šç›®æ ‡åœ°å€ï¼ˆå³æœåŠ¡å™¨IPåœ°å€ï¼‰\nsrcdomainï¼šæºåç§°ï¼ˆå³å®¢æˆ·æœºåç§°ï¼‰\ndstdomainï¼šç›®æ ‡åç§°ï¼ˆå³æœåŠ¡å™¨åç§°ï¼‰\ntimeï¼šä¸€å¤©ä¸­çš„æ—¶åˆ»å’Œä¸€å‘¨å†…çš„ä¸€å¤©\nurl_regexï¼šURLè§„åˆ™è¡¨è¾¾å¼åŒ¹é…\nurlpath_regexï¼šURL-pathè§„åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œç•¥å»åè®®å’Œä¸»æœºå\nproxy_authï¼šé€šè¿‡å¤–éƒ¨ç¨‹åºè¿›è¡Œç”¨æˆ·éªŒè¯\nmaxconnï¼šå•ä¸€IPçš„æœ€å¤§è¿æ¥æ•°\n\nACLæ ¼å¼ä¸ºäº†ä½¿ç”¨æ§åˆ¶åŠŸèƒ½ï¼Œå¿…é¡»å…ˆè®¾ç½®ACLè§„åˆ™å¹¶åº”ç”¨ã€‚ACLå£°æ˜çš„æ ¼å¼å¦‚ä¸‹ï¼šæ³¨ï¼š\n\nacl_element_name å¯ä»¥æ˜¯ä»»ä¸€ä¸ªåœ¨ACLä¸­å®šä¹‰çš„åç§°\nä»»ä½•ä¸¤ä¸ªACLå…ƒç´ ä¸èƒ½ç”¨ç›¸åŒçš„åå­—\næ¯ä¸ªACLç”±åˆ—è¡¨å€¼ç»„æˆã€‚å½“è¿›è¡ŒåŒ¹é…æ£€æµ‹çš„æ—¶å€™ï¼Œå¤šä¸ªå€¼ç”±é€»è¾‘æˆ–è¿ç®—è¿æ¥ï¼›æ¢è¨€ä¹‹ï¼Œå³ä»»ä¸€ACLå…ƒç´ çš„å€¼è¢«åŒ¹é…ï¼Œåˆ™è¿™ä¸ªACLå…ƒç´ å³è¢«åŒ¹é…ã€‚\nå¹¶ä¸æ˜¯æ‰€æœ‰ACLå…ƒç´ éƒ½èƒ½ä½¿ç”¨è®¿é—®åˆ—è¡¨ä¸­çš„å…¨éƒ¨ç±»å‹\nä¸åŒçš„ACLå…ƒç´ å†™åœ¨ä¸åŒè¡Œä¸­ï¼Œsquidå°†æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­\n\nè®¿é—®æ¡ç›®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„è®¿é—®æ¡ç›®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ä¸ªï¼š\n\nhttp_access:å…è®¸HTTPè®¿é—®\nno_cache:å®šä¹‰å¯¹ç¼“å­˜è¯·æ±‚çš„å“åº”ã€‚è®¿é—®åˆ—è¡¨çš„è§„åˆ™ç”±ä¸€äº›ç±»ä¼¼â€™allowâ€™æˆ–â€˜denyâ€™çš„å…³é”®å­—æ„æˆï¼Œç”¨ä»¥å…è®¸æˆ–æ‹’ç»å‘ç‰¹å®šæˆ–ä¸€ç»„ACLå…ƒç´ æä¾›æœåŠ¡ã€‚\n\n\nä¸€ä¸ªè®¿é—®åˆ—è¡¨å¯ä»¥ç”±å¤šæ¡è§„åˆ™ç»„æˆ\nå¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™ä¸è®¿é—®è¯·æ±‚åŒ¹é…ï¼Œé»˜è®¤åŠ¨ä½œå°†ä¸åˆ—è¡¨ä¸­æœ€åä¸€æ¡è§„åˆ™å¯¹åº”ã€‚\nä¸€ä¸ªè®¿é—®æ¡ç›®ä¸­æ‰€æœ‰å…ƒç´ å°†ç”¨é€»è¾‘ä¸è¿ç®—è¿æ¥http_access Action å£°æ˜1 AND å£°æ˜2 AND å£°æ˜ OR.http_access Action å£°æ˜3å¤šä¸ªhttp_accessså£°æ˜é—´ç”¨æˆ–è¿ç®—è¿æ¥ï¼Œä½†æ¯ä¸ªè®¿é—®æ¡ç›®çš„å…ƒç´ é—´ç”¨ä¸è¿ç®—è¿æ¥ã€‚\nåˆ—è¡¨ä¸­çš„è§„åˆ™æ€»æ˜¯éµå¾ªç”±ä¸Šè€Œä¸‹çš„é¡ºåº\nè¿™äº›è§„åˆ™æŒ‰ç…§ä»–ä»¬çš„æ’åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°åŒ¹é…çš„è§„åˆ™ï¼ŒåŒ¹é…å°±ç«‹å³ç»“æŸã€‚\n\nSquid.confé…ç½®æ–‡ä»¶è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156#acl all src 0.0.0.0/0.0.0.0 and http_access allow allé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚è¯¦ç»†æƒ…å†µå‚è§å’ŒSquidè½¯ä»¶#æºå¸¦çš„æ–‡æ¡£ã€‚è¿™é‡Œçš„è®¿é—®æ§åˆ¶åˆ—è¡¨å…è®¸æ‰€æœ‰å¯¹ä»£ç†æœåŠ¡çš„è®¿é—®ï¼Œå› ä¸ºè¿™é‡Œè¯¥ä»£ç†æ˜¯åŠ é€ŸwebæœåŠ¡å™¨ã€‚acl all src 0.0.0.0/0.0.0.0                 #å…è®¸æ‰€æœ‰IPè®¿é—®acl manager proto http                 #manager urlåè®®ä¸ºhttpacl localhost src 127.0.0.1/255.255.255.255  #å…åˆæœ¬æœºIPacl to_localhost dst 127.0.0.1                 #å…åˆç›®çš„åœ°å€ä¸ºæœ¬æœºIPacl Safe_ports port 80                # å…è®¸å®‰å…¨æ›´æ–°çš„ç«¯å£ä¸º80acl CONNECT method CONNECT        #è¯·æ±‚æ–¹æ³•ä»¥CONNECThttp_access allow all                #å…è®¸æ‰€æœ‰äººä½¿ç”¨è¯¥ä»£ç†.å› ä¸ºè¿™é‡Œæ˜¯ä»£ç†åŠ é€ŸwebæœåŠ¡å™¨http_reply_access allow all                #å…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ä»£ç†acl OverConnLimit maxconn 16        #é™åˆ¶æ¯ä¸ªIPæœ€å¤§å…è®¸16ä¸ªè¿æ¥ï¼Œé˜²æ­¢æ”»å‡»http_access deny OverConnLimiticp_access deny all                        #ç¦æ­¢ä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚.miss_access allow all                #å…è®¸ç›´æ¥æ›´æ–°è¯·æ±‚ident_lookup_access deny all                                #ç¦æ­¢lookupæ£€æŸ¥DNShttp_port 8080 transparent                                #æŒ‡å®šSquidç›‘å¬æµè§ˆå™¨å®¢æˆ·è¯·æ±‚çš„ç«¯å£å·ã€‚hierarchy_stoplist cgi-bin ?                #ç”¨æ¥å¼ºåˆ¶æŸäº›ç‰¹å®šçš„å¯¹è±¡ä¸è¢«ç¼“å­˜ï¼Œä¸»è¦æ˜¯å¤„äºå®‰å…¨çš„ç›®çš„ã€‚acl QUERY urlpath_regex cgi-bin \\?cache deny QUERYcache_mem 1 GB        #è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œå¢åŠ è¯¥å†…å­˜å€¼æœ‰åˆ©äºç¼“å­˜ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼š                     #ä¸€èˆ¬æ¥è¯´å¦‚æœç³»ç»Ÿæœ‰å†…å­˜ï¼Œè®¾ç½®è¯¥å€¼ä¸º(n/)3Mã€‚ç°åœ¨æ˜¯3G æ‰€ä»¥è¿™é‡Œ1Gfqdncache_size 1024        #FQDN é«˜é€Ÿç¼“å­˜å¤§å°maximum_object_size_in_memory 2 MB        #å…è®¸æœ€å¤§çš„æ–‡ä»¶è½½å…¥å†…å­˜memory_replacement_policy heap LFUDA  #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºå†…å­˜cachecache_replacement_policy heap LFUDA         #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºç¡¬ç›˜cachecache_dir ufs /home/cache 5000 32 512  #é«˜é€Ÿç¼“å­˜ç›®å½• ufs ç±»å‹ ä½¿ç”¨çš„ç¼“å†²å€¼æœ€å¤§å…åˆ1000MBç©ºé—´ï¼Œ#32ä¸ªä¸€çº§ç›®å½•ï¼Œ512ä¸ªäºŒçº§ç›®å½•max_open_disk_fds 0                                 #å…è®¸æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡,0 æ— é™åˆ¶minimum_object_size 1 KB                         #å…åˆæœ€å°æ–‡ä»¶è¯·æ±‚ä½“å¤§å°maximum_object_size 20 MB                 #å…åˆæœ€å¤§æ–‡ä»¶è¯·æ±‚ä½“å¤§å°cache_swap_low 90                            #æœ€å°å…è®¸ä½¿ç”¨swap 90%cache_swap_high 95                            #æœ€å¤šå…è®¸ä½¿ç”¨swap 95%ipcache_size 2048                                # IP åœ°å€é«˜é€Ÿç¼“å­˜å¤§å° 2Mipcache_low 90                                #æœ€å°å…è®¸ipcacheä½¿ç”¨swap 90%ipcache_high 95                                  #æœ€å¤§å…è®¸ipcacheä½¿ç”¨swap 90%access_log /var/log/squid/access.log squid        #å®šä¹‰æ—¥å¿—å­˜æ”¾è®°å½•cache_log /var/log/squid/cache.log squidcache_store_log none                        #ç¦æ­¢storeæ—¥å¿—emulate_httpd_log on        #å°†ä½¿Squidä»¿ç…§WebæœåŠ¡å™¨çš„æ ¼å¼åˆ›å»ºè®¿é—®è®°å½•ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨                                #Webè®¿é—®è®°å½•åˆ†æç¨‹åºï¼Œå°±éœ€è¦è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚refresh_pattern . 0 20% 4320 override-expire override-lastmod reload-into-ims ignore-reload   #æ›´æ–°cacheè§„åˆ™acl buggy_server url_regex ^http://.... http://          #åªå…è®¸httpçš„è¯·æ±‚broken_posts allow buggy_serveracl apache rep_header Server ^Apache                 #å…è®¸apacheçš„ç¼–ç broken_vary_encoding allow apacherequest_entities off                                        #ç¦æ­¢éhttpçš„æ ‡åˆ†å‡†è¯·æ±‚ï¼Œé˜²æ­¢æ”»å‡»header_access header allow all                        #å…è®¸æ‰€æœ‰çš„httpæŠ¥å¤´relaxed_header_parser on                                #ä¸ä¸¥æ ¼åˆ†æhttpæŠ¥å¤´.client_lifetime 120 minute                                #æœ€å¤§å®¢æˆ·è¿æ¥æ—¶é—´ 120åˆ†é’Ÿcache_mgr sky@test.com                        #æŒ‡å®šå½“ç¼“å†²å‡ºç°é—®é¢˜æ—¶å‘ç¼“å†²ç®¡ç†è€…å‘é€å‘Šè­¦ä¿¡æ¯çš„åœ°å€ä¿¡æ¯ã€‚cache_effective_user squid                        #è¿™é‡Œä»¥ç”¨æˆ·squidçš„èº«ä»½SquidæœåŠ¡å™¨cache_effective_group squidicp_port 0                       #æŒ‡å®šSquidä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚çš„ç«¯å£å·ã€‚                     #è¿™é‡Œè®¾ç½®ä¸º0æ˜¯å› ä¸ºè¿™é‡Œé…ç½®Squidä¸ºå†…éƒ¨WebæœåŠ¡å™¨çš„åŠ é€Ÿå™¨ï¼Œ                     #æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨é‚»å±…æœåŠ¡å™¨çš„ç¼“å†²ã€‚0æ˜¯ç¦ç”¨# cache_peer è®¾ç½®å…è®¸æ›´æ–°ç¼“å­˜çš„ä¸»æœºï¼Œå› æ˜¯æœ¬æœºæ‰€ä»¥127.0.0.1cache_peer 127.0.0.1 parent 80 0 no-query default multicast-responder no-netdb-exchangecache_peer_domain 127.0.0.1                                 hostname_aliases 127.0.0.1error_directory /usr/share/squid/errors/Simplify_Chinese        #å®šä¹‰é”™è¯¯è·¯å¾„always_direct allow all                # cacheä¸¢å¤±æˆ–ä¸å­˜åœ¨æ˜¯å…è®¸æ‰€æœ‰è¯·æ±‚ç›´æ¥è½¬å‘åˆ°åŸå§‹æœåŠ¡å™¨ignore_unknown_nameservers on        #å¼€åDNSæŸ¥è¯¢ï¼Œå½“åŸŸååœ°å€ä¸ç›¸åŒæ—¶å€™ï¼Œç¦æ­¢è®¿é—®coredump_dir  /var/log/squid                 #å®šä¹‰dumpçš„ç›®å½•max_filedesc 2048                #æœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°half_closed_clients off        #ä½¿Squidåœ¨å½“readä¸å†è¿”å›æ•°æ®æ—¶ç«‹å³å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ã€‚                                #æœ‰æ—¶readä¸å†è¿”å›æ•°æ®æ˜¯ç”±äºæŸäº›å®¢æˆ·å…³é—­TCPçš„å‘é€æ•°æ®                                #è€Œä»ç„¶ä¿æŒæ¥æ”¶æ•°æ®ã€‚è€ŒSquidåˆ†è¾¨ä¸å‡ºTCPåŠå…³é—­å’Œå®Œå…¨å…³é—­ã€‚buffered_logs on #è‹¥æ‰“å¼€é€‰é¡¹â€œbuffered_logsâ€å¯ä»¥ç¨ç¨æé«˜åŠ é€ŸæŸäº›å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥ï¼Œè¯¥é€‰é¡¹ä¸»è¦æ˜¯å®ç°ä¼˜åŒ–ç‰¹æ€§ã€‚#é˜²æ­¢å¤©æ¶¯ç›—é“¾ï¼Œè½¬å«ç»™ç™¾åº¦acl tianya referer_regex -i tianyahttp_access deny tianyadeny_info  tianya#é˜»æ­¢baiduèœ˜è››acl baidu req_header User-Agent Baiduspiderhttp_access deny baidu#é™åˆ¶åŒä¸€IPå®¢æˆ·ç«¯çš„æœ€å¤§è¿æ¥æ•°acl OverConnLimit maxconn 128http_access deny OverConnLimit#é˜²æ­¢è¢«äººåˆ©ç”¨ä¸ºHTTPä»£ç†ï¼Œè®¾ç½®å…è®¸è®¿é—®çš„IPåœ°å€acl myip dst 222.18.63.37http_access deny !myip#å…è®¸æœ¬åœ°ç®¡ç†acl Manager proto cache_objectacl Localhost src 127.0.0.1 222.18.63.37http_access allow Manager Localhostcachemgr_passwd 53034338 allhttp_access deny Manager#ä»…ä»…å…è®¸80ç«¯å£çš„ä»£ç†acl all src 0.0.0.0/0.0.0.0acl Safe_ports port 80 # httphttp_access deny !Safe_portshttp_access allow all#Squidä¿¡æ¯è®¾ç½®visible_hostname happy.swjtu.edu.cncache_mgr  ooopic2008@qq.com#åŸºæœ¬è®¾ç½®cache_effective_user squidcache_effective_group squidtcp_recv_bufsize 65535 bytes#2.6çš„åå‘ä»£ç†åŠ é€Ÿé…ç½®cache_peer 127.0.0.1 parent 80 0 no-query originserver#é”™è¯¯æ–‡æ¡£error_directory /usr/local/squid/share/errors/Simplify_Chinese#å•å°ä½¿ç”¨ï¼Œä¸ä½¿ç”¨è¯¥åŠŸèƒ½icp_port 0hierarchy_stoplist cgi-bin ?acl QUERY urlpath_regex cgi-bin \\? .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .execache deny QUERYacl apache rep_header Server ^Apachebroken_vary_encoding allow apacherefresh_pattern ^ftp:           1440 20%     10080refresh_pattern ^gopher:        1440 0%    1440refresh_pattern .             0    20%     4320cache_store_log nonepid_filename /usr/local/squid/var/logs/squid.pidemulate_httpd_log on\n\nSquidå¸¸ç”¨å‘½ä»¤\nåˆå§‹åŒ–åœ¨squid.confé‡Œé…ç½®çš„cacheç›®å½•squid -zå¦‚æœæœ‰é”™è¯¯æç¤ºï¼Œè¯·æ£€æŸ¥cacheç›®å½•çš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹ç›®å½•æƒé™chown -R squid:squid /cacheç›®å½•\nå¯¹squid.confæ’é”™ï¼Œå³éªŒè¯squid.confçš„è¯­æ³•å’Œé…ç½®squid -k parseå¦‚æœåœ¨squid.confä¸­æœ‰è¯­æ³•æˆ–é…ç½®é”™è¯¯ï¼Œè¿™é‡Œä¼šè¿”å›æç¤ºï¼Œè‹¥æ— è¿”å›ï¼Œå°è¯•å¯åŠ¨squid\nå‰å°å¯åŠ¨squidï¼Œå¹¶è¾“å‡ºå¯åŠ¨è¿‡ç¨‹/usr/local/squid/sbin/squid -N -d1å¦‚æœæœ‰ready to server requesç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜squidå¯åŠ¨æˆåŠŸç„¶åctrl+c ,åœæ­¢squid,å¹¶ä»¥åå°è¿è¡Œçš„æ–¹å¼å¯åŠ¨å®ƒ\nå¯åŠ¨squidåœ¨åå°è¿è¡Œsquid -så¯ä»¥ä½¿ç”¨ps -ax | grep squid æ¥æŸ¥çœ‹squidè¿›ç¨‹æ˜¯å¦å­˜åœ¨\nåœæ­¢squidsquid -k shutdown\né‡æ–°å¼•å¯¼ä¿®æ”¹è¿‡çš„squid.confsquid -k reconfigure -f /XXX/squid.confå½“squidè¿›è¡Œé…ç½®æ›´æ”¹åï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œsquidé…ç½®é‡è½½\næŠŠsquidæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹vim /etc/rc.local/usr/local/squid/sbin/squid -s\nä¿®æ”¹cacheç¼“å­˜ç›®å½•çš„æƒé™chown -R squid.squid /cacheç›®å½•cacheç¼“å­˜ç›®å½•æ ¹æ®è‡ªå·±çš„é…ç½®æ›´æ”¹ï¼Œsquidç”¨æˆ·å’Œç»„æ˜¯squidï¼Œsquid\nä¿®æ”¹squidæ—¥å¿—ç›®å½•çš„æƒé™chown -R squid.squid å®šä¹‰çš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è¿™ä¸€æ­¥å¹¶ä¸æ˜¯é€‚åˆæ¯ä¸€ä¸ªä½¿ç”¨squidçš„ç”¨æˆ·ï¼Œæ„ä¸ºè®©squidæœ‰æƒé™åœ¨è¯¥ç›®å½•é‡Œè¿›è¡Œå†™æ“ä½œ\næŸ¥çœ‹ä½ çš„æ—¥å¿—æ–‡æ¡£more /usr/local/squid/var/logs/access.log | grep TCP_MEM_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°cacheç›®å½•ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_MISSè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶æ²¡æœ‰è¢«squidç¼“å­˜ï¼Œè€Œæ˜¯ä»åŸå§‹æœåŠ¡å™¨è·å–å¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚\n\nSquidå‘½ä¸­ç‡åˆ†æ12/usr/local/squid/bin/squidclient -p 80 mgr:info/usr/local/squid/bin/squidclient -p 80 mgr:5min\n\nå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½æƒ…å†µ,å…¶ä¸­PORTæ˜¯ä½ çš„proxyçš„ç«¯å£ï¼Œ5minå¯ä»¥æ˜¯60minå–å¾—squidè¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š\n1squidclient -p 80 mgr:info\n\nå–å¾—squidå†…å­˜ä½¿ç”¨æƒ…å†µï¼š\n1squidclient -p 80 mgr:mem\n\nå–å¾—squidå·²ç»ç¼“å­˜çš„åˆ—è¡¨ï¼š\n1squidclient -p 80 mgr:bjects. use it carefully,it may crash\n\nå–å¾—squidçš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š\n1squidclient -p 80 mgr:diskd\n\nå¼ºåˆ¶æ›´æ–°æŸä¸ªurlï¼š\n1squidclient -p 80 -m PURGE http://www.xxx.com/xxx.php\n\næ›´å¤šçš„è¯·æŸ¥çœ‹ï¼šsquidclient-h æˆ–è€… squidclient -p 80 mgr:æŸ¥å‘½ä¸­ç‡ï¼š\n1squidclient -h IP(å…·ä½“ä¾¦å¬IP) -p 80(å…·ä½“ä¾¦å¬ç«¯å£) mgr:info\n\nå®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®123/path/to/squid/sbin/squid -k rotate -f /path/to/squid/conf_filevi /etc/crontab0        0       *       *       *       root    /usr/local/sbin/squid -k rotate -f /usr/local/etc/squid/squid1.conf\n\nå½“squidåº”ç”¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œcache_dirå¯¹åº”çš„swap.stateæ–‡ä»¶å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‡Œé¢çš„æ— æ•ˆæ¥å£æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½å½±å“squidçš„å“åº”æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨squidæ¸…ç†swap.stateé‡Œé¢çš„æ— æ•ˆæ•°æ®ï¼Œå‡å°‘swap.stateçš„å¤§å°ã€‚\n","plink":"https://shuntan.github.io/posts/squid/"},{"title":"ç§‘å­¦ä¸Šç½‘ï¼šç”¨ VPS æ­å»º shadowsocks æœåŠ¡å™¨","date":"2019-05-15T06:38:46.000Z","updated":"2019-07-14T01:23:15.870Z","content":"shadowsocks ç®€ä»‹shadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºå…¶æµé‡ç‰¹å¾ä¸æ˜æ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚\nshadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åå†å‘å›å®¢æˆ·ç«¯ã€‚\nå› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚\n\n\nè´­ä¹° VPS æœåŠ¡å™¨  ä¸»æµçš„ VPSï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æœåŠ¡å™¨æä¾›å•†æœ‰ä¸‰å®¶ï¼š\n\nlinode\ndigital ocean\nbandwagon\n\nä¸‹é¢çš„æ¯”ä¸Šé¢çš„ä¾¿å®œã€‚å¦‚æœåªæ˜¯è‡ªç”¨ï¼Œbandwagon è¶³å¤Ÿã€‚\nä¸€èˆ¬ä½¿ç”¨ paypal ç»‘å®šä¸€ä¸ª visa æˆ– mastercard ä¿¡ç”¨å¡æ¥ä»˜æ¬¾ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚\nåœ¨ bandwagon è´­ä¹° VPS ä»¥åä¼šè·å¾—ä¸€ä¸ªä¸»æœºåœ°å€å’Œç”¨äº ssh ç™»å½•çš„ root å¯†ç ã€‚\nè¿œç¨‹ç™»é™† VPS  Macæˆ– Linux ä¸‹ç›´æ¥åœ¨ç»ˆç«¯ä¸­ssh root@your_vps_ip your_ssh_portå³å¯ã€‚åœ¨ windows ç³»ç»Ÿä¸‹éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æ¥ SSH ç™»å½• VPSã€‚åœ¨&nbsp;xShell å®˜ç½‘&nbsp;&nbsp;ä¸‹è½½ xShellã€‚\n  å®¶åº­å’Œå­¦æ ¡ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨ï¼Œä¸‹è½½æ—¶é€‰æ‹© home&nbsp;and&nbsp;school&nbsp;use å³å¯ã€‚éœ€è¦ç”¨é‚®ç®±æ³¨å†Œä¸€ä¸‹ï¼Œä¸‹è½½é“¾æ¥ä¼šå‘é€åˆ°é‚®ç®±ä¸­ã€‚\n  xShell ä¸­æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šè¦æ±‚è¾“å…¥ç›®æ ‡ IP åœ°å€å’Œç«¯å£ï¼Œä»¥åŠ root å¯†ç ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚\nå®‰è£… shadowsocksæœ€å¥½æ˜¯centos7\n1.å®‰è£…pip\nç”±äºå®‰è£…çš„æ˜¯python ç‰ˆæœ¬çš„ shadowsocksï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…pip\n$ curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;\n\n$ python get-pip.py2.å®‰è£…shadowsocks    \n$ pip install --upgrade pip\n\n$ pip install shadowsocks3.åˆ›å»ºé…ç½®æ–‡ä»¶\nåˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•:/etcåˆ›å»ºæ–‡ä»¶å‘½ä»¤\n$ vi /etc/shadowsocks.jsonè‹¥è¿›å…¥äº†etcç›®å½•\n$ vi shadowsocks.jsoné…ç½®æ–‡ä»¶å†…å®¹ï¼š\nå•ç«¯å£ï¼š\n1234567891011121314151617&#123; \"server\":\"0.0.0.0\", --æœåŠ¡å™¨IPï¼Œç›´æ¥ç”¨0.0.0.0ä¹Ÿå¯ \"server_port\":8888, --ç«¯å£ç«¯å£ \"local_address\": \"127.0.0.1\", --æœ¬åœ°åœ°å€ï¼Œå¯çœç•¥ \"local_port\":1080,--æœ¬åœ°ç«¯å£ï¼Œå¯çœç•¥ \"password\":\"password\",--å¯†ç  \"timeout\":300, --è¶…æ—¶æ—¶é—´ï¼Œå¯çœç•¥ \"method\":\"aes-256-cfb\", --åŠ å¯†ç­–ç•¥ï¼Œæœ‰å¤šé‡ç­–ç•¥ï¼Œå…·ä½“è‡ªæŸ¥&#125;\n\nå¤šç«¯å£ï¼š\n12345678910111213141516171819202122232425&#123; \"server\":\"0.0.0.0\", \"local_address\":\"127.0.0.1\", \"local_port\":1080, \"port_password\":&#123;--æ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªå¯†ç  \"1111\":\"password1\", \"1112\":\"password2\", \"1113\":\"password3\" &#125;, \"timeout\":300, \"method\":\"aes-256-cfb\", \"fast_open\":false&#125;\n\n4.å¯åŠ¨shadowsocks\nå¯åŠ¨\nssserver -c /etc/shadowsocks.json -d startåœæ­¢\nssserver -c /etc/shadowsocks.json -d stopé‡å¯\nssserver -c /etc/shadowsocks.json -d restartå¯åŠ¨æˆåŠŸå³å¯é€šè¿‡sså®¢æˆ·ç«¯ä½¿ç”¨ã€‚\nåœ¨windowç«¯å¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€\ntelnet {ip} {port}5.é…ç½®è‡ªå¯åŠ¨\næ–°å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶/etc/systemd/system/shadowsocks.serviceï¼Œå†…å®¹å¦‚ä¸‹ï¼š[Unit]\nDescription=Shadowsocks[Service]\nTimeoutStartSec=0\n\nExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json[Install]\nWantedBy=multi-user.targeté€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼Œå¯åŠ¨æœåŠ¡\n$ systemctl enable shadowsocks\n\n$ systemctl start shadowsockså¯åŠ¨åå¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n$ systemctl status shadowsocks -lè‹¥å¯åŠ¨æˆåŠŸï¼š\nâ— shadowsocks.service - Shadowsocks\nLoaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)\nActive: active (running) since Sun 2017-08-13 18:03:41 CST; 1h 29min ago\nMain PID: 9567 (ssserver)\nCGroup: /system.slice/shadowsocks.service\nâ””â”€9567 /usr/bin/python2 /usr/bin/ssserver -c /etc/shadowsocks.jsonå¦‚æœï¼ŒæœåŠ¡å¤±è´¥ï¼Œé‡å¯æœåŠ¡å™¨è¯•ä¸€ä¸‹\nå®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯  shadowsocks æ”¯æŒ windowsã€Mac&nbsp;OS&nbsp;Xã€Linuxã€Androidã€iOS ç­‰å¤šä¸ªå¹³å°ã€‚ä¸è¿‡ iOS ç”±äºç³»ç»Ÿå¯¹åº”ç”¨åå°è¿è¡Œçš„é™åˆ¶ï¼Œæ¨èä½¿ç”¨å®¢æˆ·ç«¯å†…åµŒçš„æµè§ˆå™¨ç§‘å­¦ä¸Šç½‘ï¼Œç»™å…¶ä»–åº”ç”¨ä»£ç†æ—¶éœ€è¦æ¯è¿‡å‡ åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€ä¸‹ appã€‚\n  shadowsocks é¡¹ç›® Github ä¸»é¡µåœ¨è¿™é‡Œã€‚\n  é‡Œé¢å¯ä»¥æ‰¾åˆ°å®¢æˆ·ç«¯ä¸‹è½½åœ°å€ã€‚\n  ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯ä»¥åï¼Œåªéœ€æŒ‰æœåŠ¡å™¨çš„é…ç½®å¡«å†™ IP åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€æœ¬åœ°ç«¯å£ï¼ˆå¦‚æœæ²¡æœ‰æœ¬åœ°ç«¯å£é€‰é¡¹ï¼Œå°±æ˜¯é»˜è®¤çš„ 1080ï¼‰ã€å¯†ç ã€åŠ å¯†æ–¹å¼ç­‰å‚æ•°ï¼Œå¯åŠ¨å°±å¯ä»¥äº†ã€‚\n  å®¢æˆ·ç«¯æ”¯æŒå…¨å±€ä»£ç†å’Œ PAC ä»£ç†ä¸¤ç§æ–¹å¼ï¼Œåè€…ä¼šä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨æ£€æŸ¥ä¸€ä¸ªç½‘ç«™æ˜¯å¦åœ¨éœ€è¦ä»£ç†çš„ç½‘ç«™åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©ç›´æ¥è¿æ¥æˆ–ä»£ç†è¿æ¥ã€‚\n  PAC åˆ—è¡¨å¯ä»¥åœ¨çº¿æ›´æ–°ï¼Œä½†æ˜¯éš¾å…æœ‰æ”¶å½•ä¸å…¨çš„æƒ…å†µã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©å…³é—­ shadowsocks ä»£ç†ï¼ˆå®é™…ä¸Šæ˜¯å–æ¶ˆå¯¹ç³»ç»Ÿä»£ç†çš„é…ç½®ï¼Œshadowsocks å®¢æˆ·ç«¯ä»ç„¶ä¿æŒå·¥ä½œï¼‰ï¼Œç„¶åä½¿ç”¨æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„ä»£ç†ç®¡ç†æ’ä»¶æ¥å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†ï¼Œæ¯”å¦‚ switchyOmegaã€‚\nä½¿ç”¨ switchyOmega å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†switchyOmega æ˜¯ chrome æµè§ˆå™¨ä¸Šä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä»£ç†ç®¡ç†æ’ä»¶ã€‚å®ƒçš„å‰èº« switchySharp æ›´æœ‰åã€‚\n\nchrome åº”ç”¨å•†åº—æœ¬èº«éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œå› æ­¤éœ€è¦å…ˆåœ¨ shadowsocks å¯åŠ¨ä»£ç†æ¨¡å¼ä¸‹ä¸‹è½½å®‰è£…ï¼Œå†å…³é—­ shadowsocks ä»£ç†ã€‚\n\nå®‰è£…å®Œæ¯•åï¼Œå³å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©é€‰é¡¹ï¼Œè¿›å…¥ switchOmega é…ç½®ç•Œé¢ã€‚åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼æ–°å»ºä¸€ä¸ªæƒ…æ™¯æ¨¡å¼ï¼Œæ¯”å¦‚å« SSï¼Œä»£ç†åè®®é€‰æ‹© socks5ï¼Œä»£ç†åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ 1080ã€‚\n\nç°åœ¨åˆ‡æ¢åˆ° SS æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥é€šè¿‡ shadowsocks ç§‘å­¦ä¸Šç½‘äº†ã€‚åé¢è·å–è‡ªåŠ¨åˆ‡æ¢è§„åˆ™åˆ—è¡¨è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼  åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåœ¨ â€œåˆ‡æ¢è§„åˆ™â€ ä¸­å‹¾é€‰â€œè§„åˆ™åˆ—è¡¨è§„åˆ™â€ï¼Œå¯¹åº”çš„æƒ…æ™¯æ¨¡å¼é€‰æ‹©åˆšåˆšæ–°å»ºçš„ SSã€‚\n  ç„¶ååœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨åœ°å€ä¸­å¡«å†™\n  https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt\n  è§„åˆ™åˆ—è¡¨æ ¼å¼é€‰æ‹© AutoProxyã€‚\n  ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œ æ›´æ–°å®Œæˆåä¼šæœ‰æç¤ºã€‚\n  ç‚¹å‡»å·¦ä¾§çš„ â€œåº”ç”¨é€‰é¡¹â€ã€‚ç„¶åå•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨è®¿é—®â€œä¸å­˜åœ¨çš„ç½‘ç«™â€ æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° shadowsocks ä»£ç†äº†ã€‚\næ·»åŠ è‡ªå®šä¹‰è§„åˆ™  å¦‚æœé‡åˆ°æŸä¸ªå›½å¤–ç½‘ç«™æ— æ³•ç›´æ¥è¿æ¥æˆ–é€Ÿåº¦å¤ªæ…¢æ—¶ï¼Œå¯ä»¥å•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹© â€œæ·»åŠ æ¡ä»¶â€ï¼Œæƒ…æ™¯æ¨¡å¼é€‰æ‹© SSï¼Œå°±å¯ä»¥äº†ã€‚\n  è¿™æ—¶æ‰“å¼€ switchyOmega é€‰é¡¹ï¼Œåœ¨è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢è§„åˆ™ä¸­å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„è§„åˆ™ã€‚å¯ä»¥åœ¨è¿™é‡Œç®¡ç†è‡ªå®šä¹‰çš„è§„åˆ™ã€‚\nå¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®  å¦‚æœæ¢äº†ä¸€å°ç”µè„‘ï¼Œé‡æ–°è®¾ç½®ä¸€é switchyOmega å°±å¤ªéº»çƒ¦äº†ã€‚å¯ä»¥åœ¨è®¾ç½®å¥½çš„ switchyOmega ä¸­å¯¼å‡ºè®¾ç½®æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ä¸ª chrome æµè§ˆå™¨ä¸­å¯¼å…¥ï¼Œå°±å¯ä»¥ç›´æ¥å¤åˆ¶åŸæ¥çš„è®¾ç½®äº†ã€‚\n  åœ¨ switchyOmega é€‰é¡¹çš„å·¦ä¾§ç‚¹å‡» â€œå¯¼å…¥ / å¯¼å‡ºâ€ï¼Œç‚¹å‡»â€œç”Ÿæˆå¤‡ä»½æ–‡ä»¶â€ å³å¯ç”Ÿæˆ switchyOmega è®¾ç½®å¤‡ä»½ã€‚ç‚¹å‡» â€œä»å¤‡ä»½æ–‡ä»¶æ¢å¤â€ å¯ä»¥å¯¼å…¥å¤‡ä»½æ–‡ä»¶ã€‚\n","plink":"https://shuntan.github.io/posts/shadowsocks/"},{"title":"Tag Plugins","date":"2019-05-10T04:35:58.000Z","updated":"2019-07-14T01:23:30.547Z","content":"\n            FAQWelcome to tag-plugins\n          \n\nTag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. Hexo has a lot of tags which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:\n\n\n\nCentered Quote\nInclude Raw\nButton\nFull Image\nGroup Pictures\nLabel\nMermaid\nNote\nPDF\nTabs\nVideo\n\nCentered QuoteThis tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote wonâ€™t be symmetrical, so itâ€™s recommended to use when only have single line text. For example before article all after article to make a summary.\nUsagecenter-quote.js123&#123;% centerquote %&#125;Something&#123;% endcenterquote %&#125;&lt;!-- Tag Alias --&gt;&#123;% cq %&#125;Something&#123;% endcq %&#125;\n\nExample1&#123;% cq %&#125;Elegant in code, simple in core&#123;% endcq %&#125;\n\nElegant in code, simple in core\n\n\nInclude RawThis tag include any raw content into your posts. Path is relative to your site source directory.\nUsageinclude-raw.js1&#123;% include_raw '_data/path/to/file.html' %&#125;\n\nExampleLetâ€™s create include-raw.html file in _data directory under site root directory with following content:\n1Any &lt;strong&gt;raw content&lt;/strong&gt; may be included with this tag.\n\nThen in any post we can use this content with include_raw tag:\n1&#123;% include_raw '_data/path/to/include-raw.html' %&#125;\n\n","plink":"https://shuntan.github.io/posts/Tag Plugins/"},{"title":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD","date":"2019-05-06T15:03:34.000Z","updated":"2019-07-14T01:28:06.370Z","content":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\nè¡¥ä¸ç±»å‹ï¼šæ¸¸æˆMOD\næ•´ç†æ—¶é—´ï¼š2019-05-05\nå¤§å°ï¼š18.73MB\nè¡¥ä¸åˆ¶ä½œï¼šhiyokomod\nè¡¥ä¸è¯­è¨€ï¼šå¤šå›½\nç‰ˆæœ¬ï¼šv1.0\n\ndownload\nç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œäºŒæ¬¡å…ƒèŒå¦¹MODâ€ï¼Œå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼\n\n\n\n\næˆªå›¾ \n \n \n \n \n \n \n \n \n \næ³¨æ„äº‹é¡¹éœ€è¦ä¸‹è½½â€œLooksMenuæè„¸èœå•==&gt;ç‚¹æˆ‘ä¸‹è½½â€ã€‚\nä½¿ç”¨è¯´æ˜NMMè‡ªåŠ¨å®‰è£…æ–¹æ³•ï¼šç‚¹æˆ‘ä¸‹è½½NMM\n1ã€æ·»åŠ å‹ç¼©åŒ…åˆ°NMM(åˆ—è¡¨ä¸­å‡ºç°)ï¼›\n\n2ã€åŒå‡»åˆ—è¡¨å®‰è£…ï¼›\n\n3ã€è¿›å…¥æ¸¸æˆå³å¯ã€‚\n\n**æ‰‹åŠ¨å®‰è£…æ–¹æ³•(ä¸æ¨è)ï¼š** \n\n1ã€è§£å‹ç¼©ï¼›\n\n2ã€å°†dataæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼›\n\n3ã€ç”¨MODç®¡ç†å™¨åŠ è½½ESPï¼›\n\n4ã€è¿›å…¥æ¸¸æˆä¸­å³å¯ã€‚æ¼”ç¤ºè§†é¢‘\n\n\n\n\n\n\nåˆ†æµ\n\nç™¾åº¦ç½‘ç›˜(æå–ç ï¼šbr93)\n\næœ¬åœ°\n\nç”µä¿¡ç½‘é€š\n\n\né«˜é€Ÿä¸‹è½½ç”µä¿¡ä¸‹è½½è”é€šä¸‹è½½\n\n","plink":"https://shuntan.github.io/posts/ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD/"},{"title":"ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹","date":"2019-05-06T13:11:05.000Z","updated":"2019-07-14T01:22:20.630Z","content":"\nè¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ sourcod\n\n\næˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚\n\nä¿®æ”¹ themes/next/layout/_macro/sidebar.swig æ–‡ä»¶æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹ \n\n\n\nåœ¨ themes/next/_config.yml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®background_music: //music.163.com/outchain/player?type=0&amp;amp;id=2120628564&amp;amp;auto=1&amp;amp;height=66 \n\næ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹è‡ªå·±ç ”ç©¶\nåˆ›å»ºæ­Œå•è‡ªå·±ç ”ç©¶\nç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹çœ‹ä½ è‡ªå·±äº†\nåˆ†äº«æ­Œå•ä¸ä¼šè·å–å¤–é“¾çš„è¯·ä¸Šåº¦å¨˜: æ€ä¹ˆæŠŠè‡ªå·±çš„æ­Œå•åšæˆå¤–é“¾\nè·å–å¤–é“¾æ’­æ”¾å™¨\næŠŠåœ°å€copyå‡ºæ¥height=90æ”¹æˆ 66\n\nè¿™æ ·ä»¥ååªéœ€è¦ä¿®æ”¹ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œå•ï¼Œåšå®¢çš„èƒŒæ™¯éŸ³ä¹å°±ä¼šè‡ªåŠ¨ä¿®æ”¹äº†ã€‚\nå¦‚æœå‡ºç°éŸ³ä¹ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œé‚£æ˜¯èµ„æºçš„é—®é¢˜ï¼Œè‡ªå·±ä¸Šç½‘æ˜“äº‘éŸ³ä¹ç”Ÿæˆå¤–é“¾çš„é¡µé¢çœ‹çœ‹ä¼šä¸ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚æŠŠåèµ„æºåˆ é™¤å°±OKäº†ã€‚\n\n\nä¿®æ”¹å®Œæˆ‘çš„åšå®¢çš„æ•ˆæœ\n\n","plink":"https://shuntan.github.io/posts/ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹/"},{"title":"é—®é“","date":"2019-04-11T11:12:20.000Z","updated":"2019-07-18T14:58:35.610Z","content":"æ¸¸æˆèƒŒæ™¯ä»‹ç»é¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·å¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚\n\nä¸‰æ•™ä¸»ç§‰æ‰¿å¸ˆçˆ¶é¸¿é’§ä¸Šäººæ•™è¯²ï¼Œå¹¿æ”¶é—¨å¾’å°†é“æ•™æµä¼ äºä¸–ã€‚åªå› å…¥é“é—¨ä¸­å³å¯ä¿®ä»™ï¼Œä½¿äººè·³å‡ºä¸‰ç•Œä¹‹å¤–ï¼Œä¸åœ¨äº”è¡Œä¹‹ä¸­ï¼Œå…é™¤ç”Ÿæ­»è½®å›ä¹‹è‹¦ï¼Œä½¿å¾—å…¥é“ä¿®è¡Œä¹‹äººå¤šä¸èƒœæ•°ã€‚ä½†ä¿®ä»™ä¹‹é“å¹¶éè‹¦å¿ƒä¿®ç‚¼ä¾¿å¯è¾¾æˆï¼Œä¿®è¡Œè·¯ä¸Šï¼Œå‡è¦ç»å†ä¸‰ç™¾å¹´ä¸€å°åŠ«ï¼Œä¸€åƒäº”ç™¾å¹´ä¸€å¤§åŠ«çš„åŠ«æ•°ã€‚ä¿®è¡Œä¹‹äººå‡æ— æ³•é¿å¼€åŠ«æ•°ï¼Œåªèƒ½æ ¹æ®è‡ªèº«é“è¡Œçš„æ·±æµ…å»ç»å†åŠ«æ•°ã€‚å€¼å•†å‘¨ä¸¤æœäº¤æ›¿ä¹‹æ—¶ï¼Œæ°é€¢ä¿®ä»™ä¸€åƒäº”ç™¾å¹´ä»™åŠ«ï¼Œäºæ˜¯ä¸‰æ•™ä¸»å…±è®®å°ç¥æ¦œï¼Œä»¥è§‚ä¼—ä»™æ ¹è¡Œæµ…æ·±ã€‚ç„¶åŠ«æ•°éš¾é€ƒï¼Œå°ç¥ä¸€å½¹ï¼Œè‡´ä½¿é“é—¨å†…éƒ¨é˜æ•™å’Œæˆªæ•™ä¸å’Œï¼Œä¿®ä»™ä¼—äººä¿±é­å± æˆ®ï¼Œæ›´å¼•æ¥è¥¿æ–¹æ•™æ´¾å‚ä¸çº·äº‰ï¼Œåå› é¸¿é’§ä¸Šäººäº²è‡ªå‡ºé¢è°ƒåœï¼Œç»ˆå¾—ä»¥å¹³æ¯ã€‚é€šå¤©æ•™ä¸»è¢«é¸¿é’§ä¸Šäººç¦åˆ¶åœ¨ç´«éœ„å®«æ˜†ä»‘ä¹‹é¢ ä¿®è¡Œæ€è¿‡ã€‚æ—¶å…‰å¦‚æ¢­ï¼Œè½¬çœ¼å·²è¿‡åƒå¹´ï¼Œå¸ˆå°Šé¸¿é’§ä¸Šäººå¤–å‡ºäº‘æ¸¸ï¼Œä¸çŸ¥æ‰€è¸ªã€‚è€Œé€šå¤©ä»¿ä½›å·²ç»ä¹ æƒ¯äº†è¿™ç§è¢«ç¦å›ºçš„ç”Ÿæ´»ï¼Œé™¤äº†æ¯æ—¥çš„å¿…åšçš„ä¿®çœŸç‚¼æ°”å’Œé™è¯µã€Šé»„åº­ã€‹ï¼Œä»–æ›´å¤šçš„æ—¶é—´æ€»æ˜¯åœ¨æ–­å´–è¾¹é™é™åç€ã€‚ä¹Ÿè®¸åªæœ‰è¿™ä¸ªæ—¶åˆ»ï¼Œä»–æ‰èƒ½çœŸçœŸå®å®åœ°æ„Ÿè§‰åˆ°è‡ªå·±çš„å­˜åœ¨ï¼Œåƒå¹´çš„è‹¦è¡Œä½¿ä»–çš„ä¿®ä¸ºå€å¢ï¼ŒåŒæ—¶ä¹Ÿè®©ä»–é¥±å—äº†å­¤å•å’Œå¯‚å¯ï¼Œä»–å·²ç»å¾ˆä¹…æ²¡æœ‰è¯´è¿‡ä¸€å¥è¯äº†ï¼Œå¾ˆä¹…æ˜¯å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–åªçŸ¥é“ä»–åœ¨ç­‰ï¼Œä»–ä»¬éƒ½åœ¨ç­‰ã€‚.ç©ºæ—·çš„æ–­å´–è¾¹ï¼Œä¸€ä¸ªäººå½±ä¼«ç«‹ï¼Œè‰¯ä¹…ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚å±±é£åŠ²è¢­ï¼ŒäººçŠ¹å¦‚ä¸å±±æµ‘ç„¶ä¸€ä½“ï¼Œä»æ˜¯ä¸€åŠ¨ä¸åŠ¨ï¼Œåšæ¯…çš„é¢å®¹æ¯«æ— è¡¨æƒ…ï¼Œåªæœ‰æ˜äº®çš„åŒçœ¸åœ¨é»‘å¤œå°è¡¬ä¸‹å¯’å…‰é—ªç°ï¼Œçœºæœ›ç€è¿œæ–¹ã€‚è¿œå¤„ï¼Œéª·é«…å±±é¡¶ï¼Œä¸€å—é¡½çŸ³å¥½è±¡åŠ¨äº†ä¸€åŠ¨ï¼ŒåˆåŠ¨äº†ä¸€åŠ¨ï¼Œä»¿ä½›æœ‰äº†å‘¼å¸ã€‚æ…¢æ…¢åœ°ï¼Œé¡½çŸ³å‘¨å›´ç«Ÿç„¶å¿½éšå¿½ç°å‡ºç€ç„é»„è‰²çš„å…‰èŠ’ï¼Œæœ€ç»ˆå¹»åŒ–ä¸ºä¸€ä¸ªäººå½¢çš„å…‰å›¢ï¼Œç¼“ç¼“é£˜å‘å±±åçš„å¹½å†¥æ¶§ã€‚æ­¤æ—¶ï¼Œäººå½±çš„è‹ç™½é¢å®¹ä¸Šæµ®ç°å‡ºå¥‡æ€ªçš„ç¬‘æ„ï¼Œä»¤äººä¸å¯’è€Œæ —ï¼Œä»–æ˜¯é€šå¤©ã€‚äº”ç™¾å¹´åçš„ä¸­æ´²å¤§é™†ã€‚åœ¨ä¸œæµ·æ¸”æ‘ï¼Œä¸–ä¸–ä»£ä»£ä»¥æ•é±¼ä¸ºç”Ÿçš„æ¸”æ°‘æœ‰ä¸€å¤©çªç„¶å‘ç°ç¦»ä»–ä»¬æ‘å­ä¸è¿œçš„æµ·é¢ä¸Šï¼Œç«Ÿç„¶å‡ºç°ä¸€ä¸ªå¼‚å¸¸ç¾ä¸½çš„ä»™å²›ã€‚åœ¨å¤©å¢‰åŸï¼Œç†™ç†™æ”˜æ”˜åœ°è¡—é“ä¸Šçªç„¶å¤šäº†ä¸€äº›èº«ç€å¥‡è£…å¥‡æœï¼Œè¡Œä¸ºä¸¾æ­¢ååˆ†å¯ç–‘ä¹‹äººã€‚åœ¨æ½ä»™é•‡ï¼Œä¸€ä¸ªå¹³å‡¡å†·æ¸…çš„å°é•‡ä¸Šçªç„¶é—´çƒ­é—¹äº†èµ·æ¥ï¼Œä»å››é¢å…«æ–¹èµ¶æ¥çš„ä¿Šç”·ç¾å¥³ç»œç»ä¸ç»ã€‚æœ¬æ¥å¹³é™çš„ã€Šé—®é“ã€‹ä¸–ç•Œä¸­å‡ºç°å„ç§å¼‚è±¡å’Œå¾å…†ï¼Œè€Œæ­¤æ—¶ï¼Œå‡†å¤‡ä¸€æ¢ç©¶ç«Ÿçš„ç©å®¶ï¼Œæ­£èµ¶å¾€æ½ä»™é•‡çš„é€”ä¸­ã€‚ [1] \næˆªå›¾\nipsum\n\nä¸‹è½½å®¢æˆ·ç«¯ä¸‹è½½ç™»å½•å™¨ä¸‹è½½\n            ç›®å‰åªæä¾›1.60.0905ç‰ˆæœ¬å®¢æˆ·ç«¯ç™¾åº¦äº‘ä¸‹è½½é“¾æ¥ğŸ”—\n          \n\nç™¾åº¦äº‘ å¯†ç (kq7m)\n            ä¸ç‰ˆæœ¬å¯¹åº”çš„ç™»å½•å™¨ï¼ŒæœåŠ¡å™¨ä¸ºå…¬ç›Šæœï¼Œä¸åšä»»ä½•ç›ˆåˆ©å’Œä¸å…·å¤‡å•†ä¸šæ€§è´¨ï¼\n          \n\né“¾æ¥ï¼šhttps://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMwæå–ç ï¼š**** \nå¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦\n\n\n\n\nSomething\n\n\n\næ›´å¤šèµ„è®¯: Deployment\n","plink":"https://shuntan.github.io/posts/é—®é“/"},{"title":"Hello World","date":"2018-10-24T14:19:55.904Z","updated":"2019-07-14T01:20:24.132Z","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.\n\n\nQuick StartCreate a new post1$ hexo new \"My New Post\"\n\nMore info: Writing\nRun server1$ hexo server\n\nMore info: Server\nGenerate static files1$ hexo generate\n\nMore info: Generating\nDeploy to remote sites1$ hexo deploy\n\næ›´å¤šèµ„è®¯: Deployment\n","thumbnail":"https://uploadbeta.com/api/pictures/random/","plink":"https://shuntan.github.io/posts/hello-world/"},{"title":"å…³äºShawntan","date":"2019-05-08T02:08:40.000Z","updated":"2019-07-02T11:31:09.445Z","content":"ä¸ªäººä»‹ç»\nä¸å¿˜åˆå¿ƒï¼Œçº¦å®šæœªæ¥ã€‚\n\nä¸€ä¸ªå¹³å‡¡çš„c++å¼€å‘è€…ï¼Œåœ¨è‡ªå·±å–œæ¬¢çš„è¡Œä¸šä¸Šä¸€ç›´åŠªåŠ›ï¼Œå¸Œæœ›ä¼šé‡åˆ°æ›´å¤šå¿—åŒé“åˆçš„æœ‹å‹ã€‚\n\n            æŠ€æœ¯äº¤æµæ¬¢è¿æ‚¨æ‰«æä¸‹é¢çš„äºŒç»´ç åŠ å…¥c++æŠ€æœ¯äº¤æµç¾¤ï¼ŒæœŸå¾…é‡è§æ›´å¤šå¿—åŒé“åˆçš„æœ‹å‹ï¼QQäº¤æµç¾¤ï¼š681732945\n          \nJoin & Us\n\n2019å¹´è®¡åˆ’\nç²¾é€šSwift\né˜…è¯»10æœ¬ä¹¦\nç ”ç©¶2ä¸ªä»¥ä¸Šå¼€æºçš„åˆ†å¸ƒå¼æ¶æ„\nç ”ç©¶AFNetWorkingç½‘ç»œæ¡†æ¶\n\n","plink":"https://shuntan.github.io/about/"}]
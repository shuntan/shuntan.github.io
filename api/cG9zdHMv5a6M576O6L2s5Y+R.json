{"title":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘","date":"2019-05-29T02:05:19.000Z","date_formatted":{"ll":"May 29, 2019","L":"05/29/2019","MM-DD":"05-29"},"link":"posts/å®Œç¾è½¬å‘","comments":true,"tags":["C++"],"categories":["C++"],"updated":"2019-09-28T02:27:03.644Z","content":"<h2 id=\"C-ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\">C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘<a href=\"posts/å®Œç¾è½¬å‘#C-ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\"></a></h2><ul>\n<li>é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–</li>\n<li>ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒ</li>\n</ul>\n<h3 id=\"å·¦å€¼ä¸å³å€¼çš„åŒºåˆ†\">å·¦å€¼ä¸å³å€¼çš„åŒºåˆ†<a href=\"posts/å®Œç¾è½¬å‘#å·¦å€¼ä¸å³å€¼çš„åŒºåˆ†\"></a></h3><p>é¦–å…ˆç†è§£ä»€ä¹ˆæ˜¯å³å€¼å¼•ç”¨ï¼ˆä¸‹é¢æ˜¯ç™¾åº¦ç™¾ç§‘ç»™å‡ºçš„è§£é‡Šï¼‰ï¼š</p>\n<p>   å³å€¼å¼•ç”¨ï¼ˆåŠå…¶æ”¯æŒçš„Moveè¯­æ„å’Œå®Œç¾è½¬å‘ï¼‰æ˜¯C++0xå°†è¦åŠ å…¥çš„æœ€é‡å¤§è¯­è¨€ç‰¹æ€§ä¹‹ä¸€ï¼Œè¿™ç‚¹ä»è¯¥ç‰¹æ€§çš„ææ¡ˆåœ¨C++ - State of the Evolutionåˆ—è¡¨ä¸Šé«˜å±…æ¦œé¦–ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ã€‚ä»å®è·µè§’åº¦è®²ï¼Œå®ƒèƒ½å¤Ÿå®Œç¾è§£å†³C++ä¸­é•¿ä¹…ä»¥æ¥ä¸ºäººæ‰€è¯Ÿç—…çš„ä¸´æ—¶å¯¹è±¡æ•ˆç‡é—®é¢˜ã€‚ä»è¯­è¨€æœ¬èº«è®²ï¼Œå®ƒå¥å…¨äº†C++ä¸­çš„å¼•ç”¨ç±»å‹åœ¨å·¦å€¼å³å€¼æ–¹é¢çš„ç¼ºé™·ã€‚ä»åº“è®¾è®¡è€…çš„è§’åº¦è®²ï¼Œå®ƒç»™åº“è®¾è®¡è€…åˆå¸¦æ¥äº†ä¸€æŠŠåˆ©å™¨ã€‚ä»åº“ä½¿ç”¨è€…çš„è§’åº¦è®²ï¼Œä¸åŠ¨ä¸€å…µä¸€å’ä¾¿å¯ä»¥è·å¾—â€œå…è´¹çš„â€æ•ˆç‡æå‡â€¦ ã€€ã€€åœ¨æ ‡å‡†C++è¯­è¨€ä¸­ï¼Œä¸´æ—¶é‡ï¼ˆæœ¯è¯­ä¸ºå³å€¼ï¼Œå› å…¶å‡ºç°åœ¨èµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹ï¼‰å¯ä»¥è¢«ä¼ ç»™å‡½æ•°ï¼Œä½†åªèƒ½è¢«æ¥å—ä¸ºconst &amp;ç±»å‹ã€‚è¿™æ ·å‡½æ•°ä¾¿æ— æ³•åŒºåˆ†ä¼ ç»™const &amp;çš„æ˜¯çœŸå®çš„å³å€¼è¿˜æ˜¯å¸¸è§„å˜é‡ã€‚è€Œä¸”ï¼Œç”±äºç±»å‹ä¸ºconst &amp;ï¼Œå‡½æ•°ä¹Ÿæ— æ³•æ”¹å˜æ‰€ä¼ å¯¹è±¡çš„å€¼ã€‚C++0xå°†å¢åŠ ä¸€ç§åä¸ºå³å€¼å¼•ç”¨çš„æ–°çš„å¼•ç”¨ç±»å‹ï¼Œè®°ä½œtypename &amp;&amp;ã€‚è¿™ç§ç±»å‹å¯ä»¥è¢«æ¥å—ä¸ºéconstå€¼ï¼Œä»è€Œå…è®¸æ”¹å˜å…¶å€¼ã€‚</p>\n<a id=\"more\"></a>\n\n<p><strong>åŒºåˆ†å·¦å€¼ä¸å³å€¼ï¼š</strong></p>\n<p> C++ 11ä¸­å¼•å…¥çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µå°±æ˜¯å³å€¼å¼•ç”¨ã€‚ç†è§£å³å€¼å¼•ç”¨æ˜¯å­¦ä¹ â€œç§»åŠ¨è¯­ä¹‰â€ï¼ˆmove semanticsï¼‰çš„åŸºç¡€ã€‚è€Œè¦ç†è§£å³å€¼å¼•ç”¨ï¼Œå°±å¿…é¡»å…ˆåŒºåˆ†å·¦å€¼ä¸å³å€¼ã€‚<br>       å¯¹å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªæœ€å¸¸è§çš„è¯¯è§£æ˜¯ï¼šç­‰å·å·¦è¾¹çš„å°±æ˜¯å·¦å€¼ï¼Œç­‰å·å³è¾¹çš„å°±æ˜¯å³å€¼ã€‚</p>\n<p><strong>ä»€ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼š</strong><br>       åŒºåˆ†æ¸…æ¥šäº†å·¦å€¼ä¸å³å€¼ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å·¦å€¼å¼•ç”¨ã€‚å·¦å€¼å¼•ç”¨æ ¹æ®å…¶ä¿®é¥°ç¬¦çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºéå¸¸é‡å·¦å€¼å¼•ç”¨(<strong>eg.1 double &amp;r =i;</strong>)å’Œå¸¸é‡å·¦å€¼å¼•ç”¨(<strong>eg.1 const double &amp;r =i;</strong>)ã€‚<br>       éå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½ç»‘å®šåˆ°éå¸¸é‡å·¦å€¼ï¼Œä¸èƒ½ç»‘å®šåˆ°å¸¸é‡å·¦å€¼ã€éå¸¸é‡å³å€¼å’Œå¸¸é‡å³å€¼ã€‚å¦‚æœå…è®¸ç»‘å®šåˆ°å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ï¼Œåˆ™éå¸¸é‡å·¦å€¼å¼•ç”¨å¯ä»¥ç”¨äºä¿®æ”¹å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ï¼Œè¿™æ˜æ˜¾è¿åäº†å…¶å¸¸é‡çš„å«ä¹‰(<strong>eg.1ä¸­å°±æ˜¯å‡ºç°äº†éå¸¸é‡å·¦å€¼å¼•ç”¨ç»‘å®šåˆ°å¸¸é‡å³å€¼çš„æƒ…å†µ</strong>)ã€‚å¦‚æœå…è®¸ç»‘å®šåˆ°éå¸¸é‡å³å€¼ï¼Œåˆ™ä¼šå¯¼è‡´éå¸¸å±é™©çš„æƒ…å†µå‡ºç°ï¼Œå› ä¸ºéå¸¸é‡å³å€¼æ˜¯ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œéå¸¸é‡å·¦å€¼å¼•ç”¨å¯èƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå·²ç»è¢«é”€æ¯äº†çš„ä¸´æ—¶å¯¹è±¡ã€‚<br>       <strong>å¸¸é‡å·¦å€¼å¼•ç”¨å¯ä»¥ç»‘å®šåˆ°æ‰€æœ‰ç±»å‹çš„å€¼ï¼ŒåŒ…æ‹¬éå¸¸é‡å·¦å€¼ã€å¸¸é‡å·¦å€¼ã€éå¸¸é‡å³å€¼å’Œå¸¸é‡å³å€¼ã€‚</strong></p>\n<p>å¦‚æœåŒæ—¶åŒ…å«å·¦å€¼å’Œå³å€¼çš„å‡½æ•°é‡è½½ï¼Œå³å€¼ä¼šä¼˜å…ˆåŒ¹é…å³å€¼çš„é‡è½½ç‰ˆæœ¬ï¼Œå…¶æ¬¡åŒ¹é…å¸¸é‡å·¦å€¼é‡è½½ç‰ˆæœ¬ã€‚</p>\n<h3 id=\"ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal-Referenceï¼‰\">ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰<a href=\"posts/å®Œç¾è½¬å‘#ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal-Referenceï¼‰\"></a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; param &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> num = <span class=\"number\">2019</span>;</span><br><span class=\"line\">    func(num);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>è¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">int</span> main() &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"number\">2019</span>)</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span><span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœã€‚</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å·¦å€¼\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp;&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å³å€¼\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> num = <span class=\"number\">2019</span>;</span><br><span class=\"line\">    func(num);</span><br><span class=\"line\">    func(<span class=\"number\">2019</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>è¾“å‡ºç»“æœï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å³å€¼</span><br></pre></td></tr></table></div></figure>\n\n<p>ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æ¥æ”¶å·¦å€¼åˆå¯ä»¥æ¥æ”¶å³å€¼å‘¢ï¼Ÿ</p>\n<p>â€‹     <strong>C++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&amp;&amp;ç±»å‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚åªæœ‰åœ¨æ¨¡ç‰ˆä¸­æ‰ç”Ÿæ•ˆï¼Œæ™®é€šå‡½æ•°ä¸­å·¦å€¼å¼•ç”¨ï¼ˆéå¸¸é‡ï¼‰åªæ¥å—å·¦å€¼ï¼Œå³å€¼å¼•ç”¨åªæ¥å—å³å€¼ï¼Œconst å·¦å€¼å¼•ç”¨å¯ä»¥æ¥å—ä»»ä½•å€¼ï¼Œconst å³å€¼å¼•ç”¨èƒ½æ¥å—ä»»ä½•å³å€¼ï¼Œæ¨å¯¼åçš„æ¨¡ç‰ˆä¹ŸåŒç†ã€‚</strong></p>\n<p>ä½†æ˜¯æ³¨æ„äº†ï¼š<strong>åªæœ‰å‘ç”Ÿç±»å‹æ¨å¯¼çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼›</strong> å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚</p>\n<p>æ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename T&gt;</span><br><span class=\"line\">void <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(T&amp;&amp; param)</span> &#123;</span></span><br><span class=\"line\">    cout &lt;&lt; param &lt;&lt; endl<span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">int</span> main() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">int</span> num = <span class=\"number\">2019</span><span class=\"comment\">;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(num)</span>;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"number\">2019</span>)</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span><span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<h2 id=\"å¼•ç”¨æŠ˜å ï¼ˆUniversal-Collapseï¼‰\">å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰<a href=\"posts/å®Œç¾è½¬å‘#å¼•ç”¨æŠ˜å ï¼ˆUniversal-Collapseï¼‰\"></a></h2><p>ä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼Œæ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®å‚çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼š</p>\n<ul>\n<li>å·¦å€¼-å·¦å€¼ T&amp; &amp;        # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨</li>\n<li>å·¦å€¼-å³å€¼ T&amp; &amp;&amp;      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨ï¼ˆå¿…é¡»constä¿®é¥°ï¼‰</li>\n<li>å³å€¼-å·¦å€¼ T&amp;&amp; &amp;      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨</li>\n<li>å³å€¼-å³å€¼ T&amp;&amp; &amp;&amp;    # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨</li>\n</ul>\n<p>ä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼š</p>\n<p>æ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚</p>\n<p>å³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚</p>\n<h2 id=\"å®Œç¾è½¬å‘ï¼ˆPerfect-Forwardingï¼‰\">å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰<a href=\"posts/å®Œç¾è½¬å‘#å®Œç¾è½¬å‘ï¼ˆPerfect-Forwardingï¼‰\"></a></h2><p>ä¸‹é¢æ¥ç€è¯´å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹ä¸ªä¾‹å­ï¼š</p>\n<p>ğŸŒ°[æ —å­]<br>è¦äº†è§£å®Œç¾è½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„<strong>æ¨å¯¼è¿‡ç¨‹</strong>ï¼Œ<span class=\"label success\">åœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æ¨å¯¼å‚æ•°ï¼Œå·¦å€¼å¼•ç”¨templateå‡½æ•°æ¨å¯¼å‡ºæ¥æ€»æ˜¯å·¦å€¼å¼•ç”¨å‡½æ•°ï¼Œå³å€¼å¼•ç”¨templateå‡½æ•°èƒ½æ¨å¯¼å‡ºå·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨å‡½æ•°</span>ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp;&amp; arg)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//auto is_lval = std::is_lvalue_reference&lt;T&gt;::value;</span></span><br><span class=\"line\">    <span class=\"comment\">//auto is_rval  = std::is_rvalue_reference&lt;T&gt;::value;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">int</span>&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[int]\"</span>  &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">const</span> <span class=\"keyword\">int</span>&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[const int]\"</span> &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">int</span>&amp;&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[int&amp;]\"</span> &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">const</span> <span class=\"keyword\">int</span>&amp;&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[const int&amp;]\"</span> &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"-----------------\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"keyword\">int</span>&amp; b = <span class=\"number\">2</span>;</span><br><span class=\"line\">  func(a);  <span class=\"comment\">//ä¼ å…¥å·¦å€¼å¼•ç”¨ T =&gt; int&amp;</span></span><br><span class=\"line\">  func(b);  <span class=\"comment\">//ä¼ å…¥å¸¸é‡å·¦å€¼å¼•ç”¨ T =&gt; const int&amp;</span></span><br><span class=\"line\">  func(<span class=\"number\">3</span>);  <span class=\"comment\">//ä¼ å…¥å³å€¼å¼•ç”¨ T =&gt; int</span></span><br><span class=\"line\">  func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&gt;(a));        <span class=\"comment\">//ä¼ å…¥è½¬æ¢åçš„å³å€¼å¼•ç”¨ T =&gt; int</span></span><br><span class=\"line\">  func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&gt;(a));       <span class=\"comment\">//ä¼ å…¥è½¬æ¢åçš„å·¦å€¼å¼•ç”¨ T =&gt; int&amp;</span></span><br><span class=\"line\">  func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">const</span> <span class=\"keyword\">int</span>&amp;&amp;&gt;(a));<span class=\"comment\">//ä¼ å…¥è½¬æ¢åçš„å¸¸é‡å³å€¼ T =&gt; const int</span></span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&gt;(a);  <span class=\"comment\">//é”™è¯¯âŒ æ˜¾ç¤ºæŒ‡å®šæ¨¡ç‰ˆå½¢å‚ï¼Œæ¨å¯¼ååªèƒ½æ¥å—å³å€¼å¼•ç”¨ï¼Œè€Œaæ˜¯å·¦å€¼</span></span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&amp;&gt;(a); <span class=\"comment\">//ç¤ºæŒ‡å®šæ¨¡ç‰ˆå½¢å‚ï¼Œæ¨å¯¼ååªå¯æ¥å—å·¦å€¼å¼•ç”¨ï¼Œaæ˜¯å·¦å€¼</span></span><br><span class=\"line\">  func&lt;<span class=\"keyword\">const</span> <span class=\"keyword\">int</span>&gt;(<span class=\"number\">1</span>); <span class=\"comment\">//ç¤ºæŒ‡å®šæ¨¡ç‰ˆå½¢å‚ï¼Œæ¨å¯¼ååªå¯æ¥å—å³å€¼ï¼Œä¸”ä¸èƒ½ä¿®æ”¹ï¼Œ1æ˜¯å³å€¼</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>è¾“å‡ºç»“æœä¸ºï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -std=<span class=\"keyword\">c</span>++<span class=\"number\">11</span> -<span class=\"keyword\">o</span> main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>&amp;] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[const <span class=\"keyword\">int</span>&amp;] <span class=\"keyword\">ar</span><span class=\"variable\">g:2</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>] <span class=\"keyword\">ar</span><span class=\"variable\">g:3</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>&amp;] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[const <span class=\"keyword\">int</span>] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>&amp;] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[const <span class=\"keyword\">int</span>] <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br></pre></td></tr></table></div></figure>\n\n<p>é”™è¯¯ä¿¡æ¯ï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main.cpp:6:6: note:   template argument deduction/substitution failed:</span><br><span class=\"line\">main.cpp:35:14: note:   cannot convert â€˜aâ€™ (type â€˜intâ€™) <span class=\"keyword\">to</span><span class=\"built_in\"> type </span>â€˜int&amp;&amp;â€™</span><br><span class=\"line\">   func&lt;int&gt;(a);</span><br></pre></td></tr></table></div></figure>\n\n<span class=\"label success\">æ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®å‚æ¨æ–­</span>\n<p><strong>Note:å¦‚æœæ˜¾ç¤ºæ¨å¯¼æ¨¡ç‰ˆTçš„ç±»å‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¼–è¯‘ä¸è¿‡ï¼Œå› ä¸ºä¼šå¯¼è‡´æ¨åˆ°å‡ºæ¥çš„å‡½æ•°å®å‚å’Œå½¢å‚å¼•ç”¨ç±»å‹ä¸ä¸€è‡´</strong></p>\n<h2 id=\"std-forward\">std::forward()<a href=\"posts/å®Œç¾è½¬å‘#std-forward\"></a></h2><h3 id=\"std-forwardå®Œç¾è½¬å‘è§£æ\">std::forwardå®Œç¾è½¬å‘è§£æ<a href=\"posts/å®Œç¾è½¬å‘#std-forwardå®Œç¾è½¬å‘è§£æ\"></a></h3><blockquote>\n<p>å®Œç¾è½¬å‘å®ç°äº†å‚æ•°åœ¨ä¼ é€’è¿‡ç¨‹ä¸­ä¿æŒå…¶å€¼å±æ€§çš„åŠŸèƒ½ï¼Œå³è‹¥æ˜¯å·¦å€¼ï¼Œåˆ™ä¼ é€’ä¹‹åä»ç„¶æ˜¯å·¦å€¼ï¼Œè‹¥æ˜¯å³å€¼ï¼Œåˆ™ä¼ é€’ä¹‹åä»ç„¶æ˜¯å³å€¼ã€‚</p>\n<p>C++11 lets us perform perfect forwarding, which means that we can forward the parameters passed to a function template to another function call inside it without losing their own qualifiers (const-ref, ref, value, rvalue, etc.).</p>\n</blockquote>\n<h3 id=\"std-forward-è§£æ\">std::forward()è§£æ<a href=\"posts/å®Œç¾è½¬å‘#std-forward-è§£æ\"></a></h3><p>std::forwardåªæœ‰åœ¨å®ƒçš„å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼ä¸Šçš„æ—¶å€™ï¼Œå®ƒæ‰è½¬æ¢å®ƒçš„å‚æ•°åˆ°ä¸€ä¸ªå³å€¼ã€‚</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> member;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\">    Foo(T&amp;&amp; member): member&#123;<span class=\"built_in\">std</span>::forward&lt;T&gt;(member)&#125; &#123;&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>å¯¹äºFooå‡½æ•°ä¸­memberå˜é‡ï¼Œæ— è®ºä¹‹å‰æ˜¯ä»€ä¹ˆï¼Œéƒ½å˜ä¸ºå·¦å€¼äº†ï¼Œå› ä¸ºä»–æœ‰åå­—äº†</strong>:smile:</p>\n<p>ä¼ é€’ä¸€ä¸ªlvalueæˆ–è€…ä¼ é€’ä¸€ä¸ªconst lvaue</p>\n<ul>\n<li>ä¼ é€’ä¸€ä¸ªlvalueï¼Œæ¨¡æ¿æ¨å¯¼ä¹‹å <code>T = std::string&amp;</code></li>\n<li>ä¼ é€’ä¸€ä¸ªconst lvaue, æ¨¡æ¿æ¨å¯¼ä¹‹å<code>T = const std::string&amp;</code></li>\n<li><code>T&amp; &amp;&amp;</code>å°†æŠ˜å ä¸ºT&amp;ï¼Œå³<code>std::string&amp; &amp;&amp; æŠ˜å ä¸º std::string&amp;</code></li>\n<li>æœ€ç»ˆå‡½æ•°ä¸º: <code>Foo(string&amp; member): member{std::forward&lt;string&amp;&gt;(member)} {}</code></li>\n<li>std::forward&lt;string&amp;&gt;(member)å°†è¿”å›ä¸€ä¸ªå·¦å€¼ï¼Œæœ€ç»ˆè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</li>\n</ul>\n<p>ä¼ é€’ä¸€ä¸ªrvalue</p>\n<ul>\n<li>ä¼ é€’ä¸€ä¸ªrvalueï¼Œæ¨¡æ¿æ¨å¯¼ä¹‹å <code>T = std::string</code></li>\n<li>æœ€ç»ˆå‡½æ•°ä¸º: <code>Foo(string&amp;&amp; member): member{std::forward&lt;string&gt;(member)} {}</code></li>\n<li>std::forward<string>(member) å°†è¿”å›ä¸€ä¸ªå³å€¼ï¼Œæœ€ç»ˆè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼›</string></li>\n</ul>\n<p>std::moveå’Œstd::forwardæœ¬è´¨éƒ½æ˜¯è½¬æ¢ã€‚std::moveæ‰§è¡Œåˆ°å³å€¼çš„æ— æ¡ä»¶è½¬æ¢ã€‚std::forwardåªæœ‰åœ¨å®ƒçš„å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼ä¸Šçš„æ—¶å€™ï¼Œæ‰è½¬æ¢å®ƒçš„å‚æ•°åˆ°ä¸€ä¸ªå³å€¼ã€‚</p>\n<p>std::moveæ²¡æœ‰moveä»»ä½•ä¸œè¥¿ï¼Œstd::forwardæ²¡æœ‰è½¬å‘ä»»ä½•ä¸œè¥¿ã€‚åœ¨è¿è¡ŒæœŸï¼Œå®ƒä»¬æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚å®ƒä»¬æ²¡æœ‰äº§ç”Ÿéœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œä¸€byteéƒ½æ²¡æœ‰ã€‚</p>\n<h2 id=\"std-move\">std::move<a href=\"posts/å®Œç¾è½¬å‘#std-move\"></a></h2><h3 id=\"std-moveçš„ä½¿ç”¨\">std::moveçš„ä½¿ç”¨<a href=\"posts/å®Œç¾è½¬å‘#std-moveçš„ä½¿ç”¨\"></a></h3><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Foo</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span> member;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Copy member.</span></span><br><span class=\"line\">    Foo(<span class=\"keyword\">const</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&amp; m): member(m) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Move member.</span></span><br><span class=\"line\">    Foo(<span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&amp;&amp; m): member(<span class=\"built_in\">std</span>::move(m)) &#123;&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></div></figure>\n\n<p>ä¸Šè¿°<code>Foo(std::string&amp;&amp; member)</code>ä¸­çš„memberæ˜¯rvalue referenceï¼Œä½†æ˜¯memberå´æ˜¯ä¸€ä¸ªå·¦å€¼lvalueï¼Œå› æ­¤åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­éœ€è¦ä½¿ç”¨std::moveå°†å…¶è½¬æ¢æˆrvalueã€‚</p>\n<h3 id=\"std-move-è§£æ\">std::move()è§£æ<a href=\"posts/å®Œç¾è½¬å‘#std-move-è§£æ\"></a></h3><p>æ ‡å‡†åº“ä¸­moveçš„å®šä¹‰å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"keyword\">typename</span> remove_reference&lt;T&gt;::<span class=\"function\">type &amp;&amp; <span class=\"title\">move</span><span class=\"params\">(T&amp;&amp; t)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">typename</span> remove_reference&lt;T&gt;::type &amp;&amp;&gt;(t);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<ul>\n<li>moveå‡½æ•°çš„å‚æ•°T&amp;&amp;æ˜¯ä¸€ä¸ªæŒ‡å‘æ¨¡æ¿ç±»å‹å‚æ•°çš„å³å€¼å¼•ç”¨ã€è§„åˆ™2ã€‘ï¼Œé€šè¿‡å¼•ç”¨æŠ˜å ï¼Œæ­¤å‚æ•°å¯ä»¥å’Œä»»ä½•ç±»å‹çš„å®å‚åŒ¹é…ï¼Œå› æ­¤moveæ—¢å¯ä»¥ä¼ é€’ä¸€ä¸ªå·¦å€¼ï¼Œä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªå³å€¼ï¼›</li>\n<li>std::move(string(â€œhelloâ€))è°ƒç”¨è§£æï¼š<ul>\n<li>é¦–å…ˆï¼Œæ ¹æ®æ¨¡æ¿æ¨æ–­è§„åˆ™ï¼Œç¡®åœ°Tçš„ç±»å‹ä¸ºstring;</li>\n<li>typename remove_reference<t>::type &amp;&amp; çš„ç»“æœä¸º string &amp;&amp;;</t></li>\n<li>moveå‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºstring&amp;&amp;;</li>\n<li>static_cast&lt;string &amp;&amp;&gt;(t)ï¼Œtå·²ç»æ˜¯string&amp;&amp;ï¼Œäºæ˜¯ç±»å‹è½¬æ¢ä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›string &amp;&amp;;</li>\n</ul>\n</li>\n<li>string s1(â€œhelloâ€); std::move(s1); è°ƒç”¨è§£æï¼š<ul>\n<li>é¦–å…ˆï¼Œæ ¹æ®æ¨¡æ¿æ¨æ–­è§„åˆ™ï¼Œç¡®å®šTçš„ç±»å‹ä¸ºstring&amp;;</li>\n<li>typename remove_reference<t>::type &amp;&amp; çš„ç»“æœä¸º string&amp;</t></li>\n<li>moveå‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºstring&amp; &amp;&amp;ï¼Œå¼•ç”¨æŠ˜å ä¹‹åä¸ºstring&amp;;</li>\n<li>static_cast&lt;string &amp;&amp;&gt;(t)ï¼Œtæ˜¯string&amp;ï¼Œç»è¿‡static_castä¹‹åè½¬æ¢ä¸ºstring&amp;&amp;, è¿”å›string &amp;&amp;;</li>\n</ul>\n</li>\n</ul>\n<blockquote>\n<p>ä»moveçš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œmoveè‡ªèº«é™¤äº†åšä¸€äº›å‚æ•°çš„æ¨æ–­ä¹‹å¤–ï¼Œè¿”å›å³å€¼å¼•ç”¨æœ¬è´¨ä¸Šè¿˜æ˜¯é static_cast&lt;T&amp;&amp;&gt;å®Œæˆçš„ã€‚</p>\n</blockquote>\n<p>å› æ­¤ä¸‹é¢ä¸¤ä¸ªè°ƒç”¨æ˜¯ç­‰ä»·çš„ï¼Œstd::moveå°±æ˜¯ä¸ªè¯­æ³•ç³–ã€‚</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"keyword\">int</span>&amp;&amp; a)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; a &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> a = <span class=\"number\">6</span>;</span><br><span class=\"line\">func(<span class=\"built_in\">std</span>::move(a));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> b = <span class=\"number\">10</span>;</span><br><span class=\"line\">func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&amp;&gt;(b));</span><br></pre></td></tr></table></div></figure>\n\n<p>std::moveæ‰§è¡Œåˆ°å³å€¼çš„æ— æ¡ä»¶è½¬æ¢ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®ƒæ²¡æœ‰moveä»»ä½•ä¸œè¥¿ã€‚</p>\n<h2 id=\"std-move-å’Œstd-forward-å¯¹æ¯”\">std::move()å’Œstd::forward()å¯¹æ¯”<a href=\"posts/å®Œç¾è½¬å‘#std-move-å’Œstd-forward-å¯¹æ¯”\"></a></h2><ul>\n<li>std::moveæ‰§è¡Œåˆ°å³å€¼çš„æ— æ¡ä»¶è½¬æ¢ã€‚å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®ƒæ²¡æœ‰moveä»»ä½•ä¸œè¥¿ã€‚</li>\n<li>std::forwardåªæœ‰åœ¨å®ƒçš„å‚æ•°ç»‘å®šåˆ°ä¸€ä¸ªå³å€¼ä¸Šçš„æ—¶å€™ï¼Œå®ƒæ‰è½¬æ¢å®ƒçš„å‚æ•°åˆ°ä¸€ä¸ªå³å€¼ã€‚</li>\n<li>std::moveå’Œstd::forwardåªä¸è¿‡å°±æ˜¯æ‰§è¡Œç±»å‹è½¬æ¢çš„ä¸¤ä¸ªå‡½æ•°ï¼›std::moveæ²¡æœ‰moveä»»ä½•ä¸œè¥¿ï¼Œstd::forwardæ²¡æœ‰è½¬å‘ä»»ä½•ä¸œè¥¿ã€‚åœ¨è¿è¡ŒæœŸï¼Œå®ƒä»¬æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚å®ƒä»¬æ²¡æœ‰äº§ç”Ÿéœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œä¸€byteéƒ½æ²¡æœ‰ã€‚</li>\n<li>std::forward<t>()ä¸ä»…å¯ä»¥ä¿æŒå·¦å€¼æˆ–è€…å³å€¼ä¸å˜ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¿æŒconstã€Lreferenceã€Rreferenceã€validateç­‰å±æ€§ä¸å˜ï¼›</t></li>\n</ul>\n","prev":{"title":"C++ æ¨¡æ¿åç‰¹åŒ–ï¼æ¥è‡ªSTLçš„æ€è€ƒ","link":"posts/æ¨¡æ¿ç‰¹åŒ–"},"next":{"title":"ä»4è¡Œä»£ç çœ‹å³å€¼å¼•ç”¨","link":"posts/å³å€¼å¼•ç”¨"},"plink":"https://shuntan.github.io/posts/å®Œç¾è½¬å‘/","toc":[{"title":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘","id":"C-ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘","index":"1","children":[{"title":"å·¦å€¼ä¸å³å€¼çš„åŒºåˆ†","id":"å·¦å€¼ä¸å³å€¼çš„åŒºåˆ†","index":"1.1"},{"title":"ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰","id":"ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal-Referenceï¼‰","index":"1.2"}]},{"title":"å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰","id":"å¼•ç”¨æŠ˜å ï¼ˆUniversal-Collapseï¼‰","index":"2"},{"title":"å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰","id":"å®Œç¾è½¬å‘ï¼ˆPerfect-Forwardingï¼‰","index":"3"},{"title":"std::forward()","id":"std-forward","index":"4","children":[{"title":"std::forwardå®Œç¾è½¬å‘è§£æ","id":"std-forwardå®Œç¾è½¬å‘è§£æ","index":"4.1"},{"title":"std::forward()è§£æ","id":"std-forward-è§£æ","index":"4.2"}]},{"title":"std::move","id":"std-move","index":"5","children":[{"title":"std::moveçš„ä½¿ç”¨","id":"std-moveçš„ä½¿ç”¨","index":"5.1"},{"title":"std::move()è§£æ","id":"std-move-è§£æ","index":"5.2"}]},{"title":"std::move()å’Œstd::forward()å¯¹æ¯”","id":"std-move-å’Œstd-forward-å¯¹æ¯”","index":"6"}],"reward":true,"copyright":{"author":"Shawntan","link":"<a href=\"https://shuntan.github.io/posts/å®Œç¾è½¬å‘/\" title=\"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\">https://shuntan.github.io/posts/å®Œç¾è½¬å‘/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow noopener\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"May 29, 2019","updated":"September 28, 2019"}}
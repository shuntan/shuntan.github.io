{"meta":{"title":"Shawntan's Blog","subtitle":"Segmentfault","description":"shawntan@tencent.com","author":"Shawntan","url":"https://shuntan.github.io"},"pages":[{},{},{},{},{}],"posts":[{"title":"<mutex>å¤´æ–‡ä»¶ä»‹ç»","date":"2019-06-14T03:00:47.000Z","path":"posts/58aac72e/","text":"Mutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸ Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»å‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å«å¤´æ–‡ä»¶ã€‚å¤´æ–‡ä»¶ä»‹ç»Mutex ç³»åˆ—ç±»(å››ç§)std::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚std::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚std::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚std::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚Lock ç±»ï¼ˆä¸¤ç§ï¼‰std::lock_guardï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚std::unique_lockï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚å…¶ä»–ç±»å‹std::once_flagstd::adopt_lock_tstd::defer_lock_tstd::try_to_lock_tå‡½æ•°std::try_lockï¼Œå°è¯•åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚std::lockï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚std::call_onceï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œcall_once å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹è¯¥å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ã€‚std::mutex ä»‹ç»ä¸‹é¢ä»¥ std::mutex ä¸ºä¾‹ä»‹ç» C++11 ä¸­çš„äº’æ–¥é‡ç”¨æ³•ã€‚std::mutex æ˜¯C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œstd::mutex å¯¹è±¡æä¾›äº†ç‹¬å æ‰€æœ‰æƒçš„ç‰¹æ€§â€”â€”å³ä¸æ”¯æŒé€’å½’åœ°å¯¹ std::mutex å¯¹è±¡ä¸Šé”ï¼Œè€Œ std::recursive_lock åˆ™å¯ä»¥é€’å½’åœ°å¯¹äº’æ–¥é‡å¯¹è±¡ä¸Šé”ã€‚std::mutex çš„æˆå‘˜å‡½æ•°æ„é€ å‡½æ•°ï¼Œstd::mutexä¸å…è®¸æ‹·è´æ„é€ ï¼Œä¹Ÿä¸å…è®¸ move æ‹·è´ï¼Œæœ€åˆäº§ç”Ÿçš„ mutex å¯¹è±¡æ˜¯å¤„äº unlocked çŠ¶æ€çš„ã€‚lock()ï¼Œè°ƒç”¨çº¿ç¨‹å°†é”ä½è¯¥äº’æ–¥é‡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¼šå‘ç”Ÿä¸‹é¢ 3 ç§æƒ…å†µï¼š(1). å¦‚æœè¯¥äº’æ–¥é‡å½“å‰æ²¡æœ‰è¢«é”ä½ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†è¯¥äº’æ–¥é‡é”ä½ï¼Œç›´åˆ°è°ƒç”¨ unlockä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´æ‹¥æœ‰è¯¥é”ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰çš„è°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ä½ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚unlock()ï¼Œ è§£é”ï¼Œé‡Šæ”¾å¯¹äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚try_lock()ï¼Œå°è¯•é”ä½äº’æ–¥é‡ï¼Œå¦‚æœäº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é˜»å¡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¹Ÿä¼šå‡ºç°ä¸‹é¢ 3 ç§æƒ…å†µï¼Œ(1). å¦‚æœå½“å‰äº’æ–¥é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹é”ä½äº’æ–¥é‡ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è°ƒç”¨ unlock é‡Šæ”¾äº’æ–¥é‡ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰è°ƒç”¨çº¿ç¨‹è¿”å› falseï¼Œè€Œå¹¶ä¸ä¼šè¢«é˜»å¡æ‰ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸ std::mutex çš„å°ä¾‹å­ï¼ˆå‚è€ƒï¼‰1234567891011121314151617181920212223242526#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutexvolatile int counter(0); // non-atomic counterstd::mutex mtx; // locks access to countervoid attempt_10k_increases() &#123; for (int i=0; i&lt;10000; ++i) &#123; if (mtx.try_lock()) &#123; // only increase if currently not locked: ++counter; mtx.unlock(); &#125; &#125;&#125;int main (int argc, const char* argv[]) &#123; std::thread threads[10]; for (int i=0; i&lt;10; ++i) threads[i] = std::thread(attempt_10k_increases); for (auto&amp; th : threads) th.join(); std::cout &lt;&lt; counter &lt;&lt; \" successful increases of the counter.\\n\"; return 0;&#125;è¾“å‡ºç»“æœï¼š123$g++ -lpthread -std=c++11 -o main *.cpp$main9012 successful increases of the counter.å¯ä»¥çœ‹å‡ºæœ‰å¾ˆå¤šæ¬¡mtx.try_lock()è¿”å›äº†falseï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ++counteræ“ä½œã€‚å¦‚æœæŠŠmtx.try_lock()æ”¹æˆmtx.lock()ï¼Œåˆ™å¿…å®šä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚è¾“å‡ºç»“æœ2:123$g++ -lpthread -std=c++11 -o main *.cpp$main100000 successful increases of the counter.std::recursive_mutex ä»‹ç»std::recursive_mutex ä¸ std::mutex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¢«ä¸Šé”çš„å¯¹è±¡ï¼Œä½†æ˜¯å’Œ std::mutex ä¸åŒçš„æ˜¯ï¼Œstd::recursive_mutex å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥è·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œstd::recursive_mutex é‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸è¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()ï¼Œå¯ç†è§£ä¸º lock() æ¬¡æ•°å’Œ unlock() æ¬¡æ•°ç›¸åŒï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œstd::recursive_mutex çš„ç‰¹æ€§å’Œ std::mutex å¤§è‡´ç›¸åŒã€‚12345678910111213141516171819202122232425#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutexvolatile int counter(0); // non-atomic counterstd::recursive_mutex rmtx; // locks access to countervoid attempt_1k_increases() &#123; for (int i=0; i&lt;10000; ++i) &#123; rmtx.lock(); ++counter; &#125; for (int i=0; i&lt;10000; ++i) &#123; counter-=2; rmtx.unlock(); &#125;&#125;int main (int argc, const char* argv[]) &#123; auto th = std::thread(attempt_1k_increases); th.join(); std::cout &lt;&lt; counter &lt;&lt; \" successful increases of the counter.\\n\"; return 0;&#125;è¾“å‡ºç»“æœï¼š123$g++ -lpthread -o main *.cpp$main-10000 successful increases of the counter.std::time_mutex ä»‹ç»std::time_mutex æ¯” std::mutex å¤šäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œtry_lock_for()ï¼Œtry_lock_until()ã€‚try_lock_for å‡½æ•°æ¥å—ä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸€æ®µæ—¶é—´èŒƒå›´ä¹‹å†…çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼ˆä¸ std::mutex çš„ try_lock() ä¸åŒï¼Œtry_lock å¦‚æœè¢«è°ƒç”¨æ—¶æ²¡æœ‰è·å¾—é”åˆ™ç›´æ¥è¿”å› falseï¼‰ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚try_lock_until å‡½æ•°åˆ™æ¥å—ä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ï¼Œåœ¨æŒ‡å®šæ—¶é—´ç‚¹æœªåˆ°æ¥ä¹‹å‰çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚ä¸‹é¢çš„å°ä¾‹å­è¯´æ˜äº† std::time_mutex çš„ç”¨æ³•ï¼ˆå‚è€ƒï¼‰ã€‚1234567891011121314151617181920212223242526272829#include &lt;iostream&gt; // std::cout#include &lt;chrono&gt; // std::chrono::milliseconds#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::timed_mutexstd::timed_mutex mtx;void fireworks() &#123; // waiting to get a lock: each thread prints \"-\" every 200ms: while (!mtx.try_lock_for(std::chrono::milliseconds(200))) &#123; std::cout &lt;&lt; \"-\"; &#125; // got a lock! - wait for 1s, then this thread prints \"*\" std::this_thread::sleep_for(std::chrono::milliseconds(1000)); std::cout &lt;&lt; \"*\\n\"; mtx.unlock();&#125;int main ()&#123; std::thread threads[10]; // spawn 10 threads: for (int i=0; i&lt;10; ++i) threads[i] = std::thread(fireworks); for (auto&amp; th : threads) th.join(); return 0;&#125;è¾“å‡ºç»“æœï¼šçº¿ç¨‹è¾“å‡º*è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”é‡Šæ”¾è¯¥é”ã€‚å¦åˆ™å°†æ¯200mså°è¯•è·å–mutexğŸ”’ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚std::recursive_timed_mutex ä»‹ç»å’Œ std:recursive_mutex ä¸ std::mutex çš„å…³ç³»ä¸€æ ·ï¼Œstd::recursive_timed_mutex çš„ç‰¹æ€§ä¹Ÿå¯ä»¥ä» std::timed_mutex æ¨å¯¼å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„åŒé‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ ;-)std::lock_guard ä»‹ç»ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰:1.std::lock_guard åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡ŒåŠ é”ï¼Œææ„å‡½æ•°ä¸­è¿›è¡Œè§£é”ã€‚2.é”åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šï¼Œå› æ­¤c++11æä¾›äº†lock_guardæ¨¡æ¿ç±»ï¼›åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„åœºæ™¯ç¼–å†™resource_guard RAIIç±»ï¼Œé¿å…å¿˜æ‰é‡Šæ”¾èµ„æºã€‚12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutex, std::lock_guard#include &lt;stdexcept&gt; // std::logic_errorstd::mutex mtx;void print_even (int x) &#123; if (x%2==0) std::cout &lt;&lt; x &lt;&lt; \" is even\\n\"; else throw (std::logic_error(\"not even\"));&#125;void print_thread_id (int id) &#123; try &#123; // using a local lock_guard to lock mtx guarantees unlocking on destruction / exception: std::lock_guard&lt;std::mutex&gt; lck (mtx); print_even(id); &#125; catch (std::logic_error&amp;) &#123; std::cout &lt;&lt; \"[exception caught]\\n\"; &#125;&#125;int main ()&#123; std::thread threads[10]; // spawn 10 threads: for (int i=0; i&lt;10; ++i) threads[i] = std::thread(print_thread_id,i+1); for (auto&amp; th : threads) th.join(); return 0;&#125;è¾“å‡ºç»“æœï¼š123456789101112$g++ -lpthread -o main *.cpp$main[exception caught]4 is even[exception caught]2 is even[exception caught]6 is even8 is even[exception caught][exception caught]10 is evenstd::unique_lock ä»‹ç»ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰ï¼š1.ç±» unique_lock æ˜¯é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå…è®¸å»¶è¿Ÿé”å®šã€é”å®šçš„æœ‰æ—¶é™å°è¯•ã€é€’å½’é”å®šã€æ‰€æœ‰æƒè½¬ç§»å’Œä¸æ¡ä»¶å˜é‡ä¸€åŒä½¿ç”¨ã€‚2.unique_lockæ¯”lock_guardä½¿ç”¨æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ä½¿ç”¨unique_lockéœ€è¦ä»˜å‡ºæ›´å¤šçš„æ—¶é—´ã€æ€§èƒ½æˆæœ¬ã€‚12345678910111213141516171819202122232425#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutex, std::unique_lockstd::mutex mtx; // mutex for critical sectionvoid print_block (int n, char c) &#123; // critical section (exclusive access to std::cout signaled by lifetime of lck): std::unique_lock&lt;std::mutex&gt; lck (mtx); for (int i=0; i&lt;n; ++i) &#123; std::cout &lt;&lt; c; &#125; std::cout &lt;&lt; '\\n';&#125;int main ()&#123; std::thread th1 (print_block,50,'*'); std::thread th2 (print_block,50,'$'); th1.join(); th2.join(); return 0;&#125;è¾“å‡ºç»“æœï¼š1234$g++ -lpthread -o main *.cpp$main**************************************************$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$å¥½äº†ï¼Œæœ¬æ–‡æš‚æ—¶è®²åˆ°è¿™é‡Œï¼Œè¿˜å‰©ä¸‹ std::try_lockï¼Œstd::lockï¼Œstd::call_once ä¸‰ä¸ªå‡½æ•°æ²¡æœ‰è®²åˆ°ï¼Œç•™åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­è®²å§ ;-)","raw":"---\ntitle: <mutex>å¤´æ–‡ä»¶ä»‹ç»\ncopyright: true\ntags: C++\ncategories: C++\nabbrlink: 58aac72e\ndate: 2019-06-14 11:00:47\ntype:\nkeyword:\ntop:\ncomments:\npassword:\ndescription:\n---\n\nMutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸ Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»å‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜åœ¨ <mutex> å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å« <mutex> å¤´æ–‡ä»¶ã€‚\n\n### <mutex> å¤´æ–‡ä»¶ä»‹ç»\n\n#### Mutex ç³»åˆ—ç±»(å››ç§)\n\n- std::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚\n\n- std::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚\n\n- std::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚\n\n- std::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚\n\n<!-- more -->\n\n#### Lock ç±»ï¼ˆä¸¤ç§ï¼‰\n\n- std::lock_guardï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚\n- std::unique_lockï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚\n\n#### å…¶ä»–ç±»å‹\n\n- std::once_flag\n- std::adopt_lock_t\n- std::defer_lock_t\n- std::try_to_lock_t\n\n#### å‡½æ•°\n\n- std::try_lockï¼Œå°è¯•åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚\n- std::lockï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚\n- std::call_onceï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œcall_once å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹è¯¥å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ã€‚\n\n### std::mutex ä»‹ç»\n\nä¸‹é¢ä»¥ std::mutex ä¸ºä¾‹ä»‹ç» C++11 ä¸­çš„äº’æ–¥é‡ç”¨æ³•ã€‚\n\nstd::mutex æ˜¯C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œstd::mutex å¯¹è±¡æä¾›äº†ç‹¬å æ‰€æœ‰æƒçš„ç‰¹æ€§â€”â€”å³ä¸æ”¯æŒé€’å½’åœ°å¯¹ std::mutex å¯¹è±¡ä¸Šé”ï¼Œè€Œ std::recursive_lock åˆ™å¯ä»¥é€’å½’åœ°å¯¹äº’æ–¥é‡å¯¹è±¡ä¸Šé”ã€‚\n\n#### std::mutex çš„æˆå‘˜å‡½æ•°\n\n- æ„é€ å‡½æ•°ï¼Œstd::mutexä¸å…è®¸æ‹·è´æ„é€ ï¼Œä¹Ÿä¸å…è®¸ move æ‹·è´ï¼Œæœ€åˆäº§ç”Ÿçš„ mutex å¯¹è±¡æ˜¯å¤„äº unlocked çŠ¶æ€çš„ã€‚\n- lock()ï¼Œè°ƒç”¨çº¿ç¨‹å°†é”ä½è¯¥äº’æ–¥é‡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¼šå‘ç”Ÿä¸‹é¢ 3 ç§æƒ…å†µï¼š(1). å¦‚æœè¯¥äº’æ–¥é‡å½“å‰æ²¡æœ‰è¢«é”ä½ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†è¯¥äº’æ–¥é‡é”ä½ï¼Œç›´åˆ°è°ƒç”¨ unlockä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´æ‹¥æœ‰è¯¥é”ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰çš„è°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ä½ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚\n- unlock()ï¼Œ è§£é”ï¼Œé‡Šæ”¾å¯¹äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚\n- try_lock()ï¼Œå°è¯•é”ä½äº’æ–¥é‡ï¼Œå¦‚æœäº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é˜»å¡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¹Ÿä¼šå‡ºç°ä¸‹é¢ 3 ç§æƒ…å†µï¼Œ(1). å¦‚æœå½“å‰äº’æ–¥é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹é”ä½äº’æ–¥é‡ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è°ƒç”¨ unlock é‡Šæ”¾äº’æ–¥é‡ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰è°ƒç”¨çº¿ç¨‹è¿”å› falseï¼Œè€Œå¹¶ä¸ä¼šè¢«é˜»å¡æ‰ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚\n\nä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸ std::mutex çš„å°ä¾‹å­ï¼ˆ[å‚è€ƒ](http://www.cplusplus.com/reference/mutex/mutex/try_lock/)ï¼‰\n\n```c++\n#include <iostream>       // std::cout\n#include <thread>         // std::thread\n#include <mutex>          // std::mutex\n\nvolatile int counter(0); // non-atomic counter\nstd::mutex mtx;           // locks access to counter\n\nvoid attempt_10k_increases() {\n    for (int i=0; i<10000; ++i) {\n        if (mtx.try_lock()) {   // only increase if currently not locked:\n            ++counter;\n            mtx.unlock();\n        }\n    }\n}\n\nint main (int argc, const char* argv[]) {\n    std::thread threads[10];\n    for (int i=0; i<10; ++i)\n        threads[i] = std::thread(attempt_10k_increases);\n\n    for (auto& th : threads) th.join();\n    std::cout << counter << \" successful increases of the counter.\\n\";\n\n    return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n```c++\n$g++ -lpthread -std=c++11 -o main *.cpp\n$main\n9012 successful increases of the counter.\n```\n\n> å¯ä»¥çœ‹å‡ºæœ‰å¾ˆå¤šæ¬¡mtx.try_lock()è¿”å›äº†falseï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ++counteræ“ä½œã€‚\n>\n> å¦‚æœæŠŠmtx.try_lock()æ”¹æˆmtx.lock()ï¼Œåˆ™å¿…å®šä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚\n\nè¾“å‡ºç»“æœ2:\n\n```c++\n$g++ -lpthread -std=c++11 -o main *.cpp\n$main\n100000 successful increases of the counter.\n```\n\n### std::recursive_mutex ä»‹ç»\n\nstd::recursive_mutex ä¸ std::mutex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¢«ä¸Šé”çš„å¯¹è±¡ï¼Œä½†æ˜¯å’Œ std::mutex ä¸åŒçš„æ˜¯ï¼Œstd::recursive_mutex å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥è·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œstd::recursive_mutex é‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸è¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()ï¼Œå¯ç†è§£ä¸º lock() æ¬¡æ•°å’Œ unlock() æ¬¡æ•°ç›¸åŒï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œstd::recursive_mutex çš„ç‰¹æ€§å’Œ std::mutex å¤§è‡´ç›¸åŒã€‚\n\n```c++\n#include <iostream>       // std::cout\n#include <thread>         // std::thread\n#include <mutex>          // std::mutex\n\nvolatile int counter(0); // non-atomic counter\nstd::recursive_mutex  rmtx;           // locks access to counter\n\nvoid attempt_1k_increases() {\n    for (int i=0; i<10000; ++i) {\n        rmtx.lock();   \n        ++counter; \n    }\n    for (int i=0; i<10000; ++i) { \n        counter-=2; \n        rmtx.unlock();\n    }\n}\n\nint main (int argc, const char* argv[]) {\n    auto th = std::thread(attempt_1k_increases);\n    th.join();\n    std::cout << counter << \" successful increases of the counter.\\n\";\n\n    return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n```c++\n$g++ -lpthread -o main *.cpp\n$main\n-10000 successful increases of the counter.\n```\n\n### std::time_mutex ä»‹ç»\n\nstd::time_mutex æ¯” std::mutex å¤šäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œtry_lock_for()ï¼Œtry_lock_until()ã€‚\n\ntry_lock_for å‡½æ•°æ¥å—ä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸€æ®µæ—¶é—´èŒƒå›´ä¹‹å†…çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼ˆä¸ std::mutex çš„ try_lock() ä¸åŒï¼Œtry_lock å¦‚æœè¢«è°ƒç”¨æ—¶æ²¡æœ‰è·å¾—é”åˆ™ç›´æ¥è¿”å› falseï¼‰ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚\n\ntry_lock_until å‡½æ•°åˆ™æ¥å—ä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ï¼Œåœ¨æŒ‡å®šæ—¶é—´ç‚¹æœªåˆ°æ¥ä¹‹å‰çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚\n\nä¸‹é¢çš„å°ä¾‹å­è¯´æ˜äº† std::time_mutex çš„ç”¨æ³•ï¼ˆ[å‚è€ƒ](http://www.cplusplus.com/reference/mutex/timed_mutex/try_lock_for/)ï¼‰ã€‚\n\n```c++\n#include <iostream>       // std::cout\n#include <chrono>         // std::chrono::milliseconds\n#include <thread>         // std::thread\n#include <mutex>          // std::timed_mutex\n\nstd::timed_mutex mtx;\n\nvoid fireworks() {\n  // waiting to get a lock: each thread prints \"-\" every 200ms:\n  while (!mtx.try_lock_for(std::chrono::milliseconds(200))) {\n    std::cout << \"-\";\n  }\n  // got a lock! - wait for 1s, then this thread prints \"*\"\n  std::this_thread::sleep_for(std::chrono::milliseconds(1000));\n  std::cout << \"*\\n\";\n  mtx.unlock();\n}\n\nint main ()\n{\n  std::thread threads[10];\n  // spawn 10 threads:\n  for (int i=0; i<10; ++i)\n    threads[i] = std::thread(fireworks);\n\n  for (auto& th : threads) th.join();\n\n  return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n> çº¿ç¨‹è¾“å‡º*è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”é‡Šæ”¾è¯¥é”ã€‚å¦åˆ™å°†æ¯200mså°è¯•è·å–mutexğŸ”’ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚\n\n### std::recursive_timed_mutex ä»‹ç»\n\nå’Œ std:recursive_mutex ä¸ std::mutex çš„å…³ç³»ä¸€æ ·ï¼Œstd::recursive_timed_mutex çš„ç‰¹æ€§ä¹Ÿå¯ä»¥ä» std::timed_mutex æ¨å¯¼å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„åŒé‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ ;-)\n\n### std::lock_guard ä»‹ç»\n\nä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚ä¾‹å­ï¼ˆ[å‚è€ƒ](http://www.cplusplus.com/reference/mutex/lock_guard/)ï¼‰:\n\n* 1.std::lock_guard åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡ŒåŠ é”ï¼Œææ„å‡½æ•°ä¸­è¿›è¡Œè§£é”ã€‚\n* 2.é”åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šï¼Œå› æ­¤c++11æä¾›äº†lock_guardæ¨¡æ¿ç±»ï¼›åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„åœºæ™¯ç¼–å†™`resource_guard` RAIIç±»ï¼Œé¿å…å¿˜æ‰é‡Šæ”¾èµ„æºã€‚\n\n```c++\n#include <iostream>       // std::cout\n#include <thread>         // std::thread\n#include <mutex>          // std::mutex, std::lock_guard\n#include <stdexcept>      // std::logic_error\n\nstd::mutex mtx;\n\nvoid print_even (int x) {\n    if (x%2==0) std::cout << x << \" is even\\n\";\n    else throw (std::logic_error(\"not even\"));\n}\n\nvoid print_thread_id (int id) {\n    try {\n        // using a local lock_guard to lock mtx guarantees unlocking on destruction / exception:\n        std::lock_guard<std::mutex> lck (mtx);\n        print_even(id);\n    }\n    catch (std::logic_error&) {\n        std::cout << \"[exception caught]\\n\";\n    }\n}\n\nint main ()\n{\n    std::thread threads[10];\n    // spawn 10 threads:\n    for (int i=0; i<10; ++i)\n        threads[i] = std::thread(print_thread_id,i+1);\n\n    for (auto& th : threads) th.join();\n\n    return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n```c++\n$g++ -lpthread -o main *.cpp\n$main\n[exception caught]\n4 is even\n[exception caught]\n2 is even\n[exception caught]\n6 is even\n8 is even\n[exception caught]\n[exception caught]\n10 is even\n```\n\n### std::unique_lock ä»‹ç»\n\nä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚ä¾‹å­ï¼ˆ[å‚è€ƒ](http://www.cplusplus.com/reference/mutex/unique_lock/)ï¼‰ï¼š\n\n* 1.ç±» unique_lock æ˜¯é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå…è®¸`å»¶è¿Ÿé”å®šã€é”å®šçš„æœ‰æ—¶é™å°è¯•ã€é€’å½’é”å®šã€æ‰€æœ‰æƒè½¬ç§»å’Œä¸æ¡ä»¶å˜é‡ä¸€åŒä½¿ç”¨`ã€‚\n* 2.unique_lockæ¯”lock_guardä½¿ç”¨æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚\n  ä½¿ç”¨unique_lockéœ€è¦ä»˜å‡ºæ›´å¤šçš„æ—¶é—´ã€æ€§èƒ½æˆæœ¬ã€‚\n\n```c++\n#include <iostream>       // std::cout\n#include <thread>         // std::thread\n#include <mutex>          // std::mutex, std::unique_lock\n\nstd::mutex mtx;           // mutex for critical section\n\nvoid print_block (int n, char c) {\n    // critical section (exclusive access to std::cout signaled by lifetime of lck):\n    std::unique_lock<std::mutex> lck (mtx);\n    for (int i=0; i<n; ++i) {\n        std::cout << c;\n    }\n    std::cout << '\\n';\n}\n\nint main ()\n{\n    std::thread th1 (print_block,50,'*');\n    std::thread th2 (print_block,50,'$');\n\n    th1.join();\n    th2.join();\n\n    return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n```c++\n$g++ -lpthread -o main *.cpp\n$main\n**************************************************\n$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n```\n\n\n\nå¥½äº†ï¼Œæœ¬æ–‡æš‚æ—¶è®²åˆ°è¿™é‡Œï¼Œè¿˜å‰©ä¸‹ std::try_lockï¼Œstd::lockï¼Œstd::call_once ä¸‰ä¸ªå‡½æ•°æ²¡æœ‰è®²åˆ°ï¼Œç•™åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­è®²å§ ;-)","content":"<p>Mutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸ Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»å‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜åœ¨<mutex>å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å«<mutex>å¤´æ–‡ä»¶ã€‚</mutex></mutex></p><h3 id=\"å¤´æ–‡ä»¶ä»‹ç»\"><a href=\"#å¤´æ–‡ä»¶ä»‹ç»\" class=\"headerlink\" title=\" å¤´æ–‡ä»¶ä»‹ç»\"></a><mutex>å¤´æ–‡ä»¶ä»‹ç»</mutex></h3><h4 id=\"Mutex-ç³»åˆ—ç±»-å››ç§\"><a href=\"#Mutex-ç³»åˆ—ç±»-å››ç§\" class=\"headerlink\" title=\"Mutex ç³»åˆ—ç±»(å››ç§)\"></a>Mutex ç³»åˆ—ç±»(å››ç§)</h4><ul><li><p>std::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚</p></li><li><p>std::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚</p></li><li><p>std::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚</p></li><li><p>std::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚</p></li></ul><a id=\"more\"></a><h4 id=\"Lock-ç±»ï¼ˆä¸¤ç§ï¼‰\"><a href=\"#Lock-ç±»ï¼ˆä¸¤ç§ï¼‰\" class=\"headerlink\" title=\"Lock ç±»ï¼ˆä¸¤ç§ï¼‰\"></a>Lock ç±»ï¼ˆä¸¤ç§ï¼‰</h4><ul><li>std::lock_guardï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚</li><li>std::unique_lockï¼Œä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚</li></ul><h4 id=\"å…¶ä»–ç±»å‹\"><a href=\"#å…¶ä»–ç±»å‹\" class=\"headerlink\" title=\"å…¶ä»–ç±»å‹\"></a>å…¶ä»–ç±»å‹</h4><ul><li>std::once_flag</li><li>std::adopt_lock_t</li><li>std::defer_lock_t</li><li>std::try_to_lock_t</li></ul><h4 id=\"å‡½æ•°\"><a href=\"#å‡½æ•°\" class=\"headerlink\" title=\"å‡½æ•°\"></a>å‡½æ•°</h4><ul><li>std::try_lockï¼Œå°è¯•åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚</li><li>std::lockï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚</li><li>std::call_onceï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œcall_once å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹è¯¥å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ã€‚</li></ul><h3 id=\"std-mutex-ä»‹ç»\"><a href=\"#std-mutex-ä»‹ç»\" class=\"headerlink\" title=\"std::mutex ä»‹ç»\"></a>std::mutex ä»‹ç»</h3><p>ä¸‹é¢ä»¥ std::mutex ä¸ºä¾‹ä»‹ç» C++11 ä¸­çš„äº’æ–¥é‡ç”¨æ³•ã€‚</p><p>std::mutex æ˜¯C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œstd::mutex å¯¹è±¡æä¾›äº†ç‹¬å æ‰€æœ‰æƒçš„ç‰¹æ€§â€”â€”å³ä¸æ”¯æŒé€’å½’åœ°å¯¹ std::mutex å¯¹è±¡ä¸Šé”ï¼Œè€Œ std::recursive_lock åˆ™å¯ä»¥é€’å½’åœ°å¯¹äº’æ–¥é‡å¯¹è±¡ä¸Šé”ã€‚</p><h4 id=\"std-mutex-çš„æˆå‘˜å‡½æ•°\"><a href=\"#std-mutex-çš„æˆå‘˜å‡½æ•°\" class=\"headerlink\" title=\"std::mutex çš„æˆå‘˜å‡½æ•°\"></a>std::mutex çš„æˆå‘˜å‡½æ•°</h4><ul><li>æ„é€ å‡½æ•°ï¼Œstd::mutexä¸å…è®¸æ‹·è´æ„é€ ï¼Œä¹Ÿä¸å…è®¸ move æ‹·è´ï¼Œæœ€åˆäº§ç”Ÿçš„ mutex å¯¹è±¡æ˜¯å¤„äº unlocked çŠ¶æ€çš„ã€‚</li><li>lock()ï¼Œè°ƒç”¨çº¿ç¨‹å°†é”ä½è¯¥äº’æ–¥é‡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¼šå‘ç”Ÿä¸‹é¢ 3 ç§æƒ…å†µï¼š(1). å¦‚æœè¯¥äº’æ–¥é‡å½“å‰æ²¡æœ‰è¢«é”ä½ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†è¯¥äº’æ–¥é‡é”ä½ï¼Œç›´åˆ°è°ƒç”¨ unlockä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´æ‹¥æœ‰è¯¥é”ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰çš„è°ƒç”¨çº¿ç¨‹è¢«é˜»å¡ä½ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚</li><li>unlock()ï¼Œ è§£é”ï¼Œé‡Šæ”¾å¯¹äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚</li><li>try_lock()ï¼Œå°è¯•é”ä½äº’æ–¥é‡ï¼Œå¦‚æœäº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é˜»å¡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¹Ÿä¼šå‡ºç°ä¸‹é¢ 3 ç§æƒ…å†µï¼Œ(1). å¦‚æœå½“å‰äº’æ–¥é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹é”ä½äº’æ–¥é‡ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è°ƒç”¨ unlock é‡Šæ”¾äº’æ–¥é‡ã€‚(2). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰è°ƒç”¨çº¿ç¨‹è¿”å› falseï¼Œè€Œå¹¶ä¸ä¼šè¢«é˜»å¡æ‰ã€‚(3). å¦‚æœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚</li></ul><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸ std::mutex çš„å°ä¾‹å­ï¼ˆ<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcGx1c3BsdXMuY29tL3JlZmVyZW5jZS9tdXRleC9tdXRleC90cnlfbG9jay8=\" title=\"http://www.cplusplus.com/reference/mutex/mutex/try_lock/\">å‚è€ƒ<i class=\"fa fa-external-link\"></i></span>ï¼‰</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;       // std::cout</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;thread&gt;         // std::thread</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;mutex&gt;          // std::mutex</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> <span class=\"title\">counter</span><span class=\"params\">(<span class=\"number\">0</span>)</span></span>; <span class=\"comment\">// non-atomic counter</span></span><br><span class=\"line\"><span class=\"built_in\">std</span>::mutex mtx;           <span class=\"comment\">// locks access to counter</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">attempt_10k_increases</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10000</span>; ++i) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mtx.try_lock()) &#123;   <span class=\"comment\">// only increase if currently not locked:</span></span><br><span class=\"line\">            ++counter;</span><br><span class=\"line\">            mtx.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::thread threads[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10</span>; ++i)</span><br><span class=\"line\">        threads[i] = <span class=\"built_in\">std</span>::thread(attempt_10k_increases);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span>&amp; th : threads) th.join();</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; counter &lt;&lt; <span class=\"string\">\" successful increases of the counter.\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -lpthread -<span class=\"built_in\">std</span>=c++<span class=\"number\">11</span> -o main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\"><span class=\"number\">9012</span> successful increases of the counter.</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹å‡ºæœ‰å¾ˆå¤šæ¬¡mtx.try_lock()è¿”å›äº†falseï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ++counteræ“ä½œã€‚</p><p>å¦‚æœæŠŠmtx.try_lock()æ”¹æˆmtx.lock()ï¼Œåˆ™å¿…å®šä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚</p></blockquote><p>è¾“å‡ºç»“æœ2:</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -lpthread -<span class=\"built_in\">std</span>=c++<span class=\"number\">11</span> -o main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\"><span class=\"number\">100000</span> successful increases of the counter.</span><br></pre></td></tr></table></figure><h3 id=\"std-recursive-mutex-ä»‹ç»\"><a href=\"#std-recursive-mutex-ä»‹ç»\" class=\"headerlink\" title=\"std::recursive_mutex ä»‹ç»\"></a>std::recursive_mutex ä»‹ç»</h3><p>std::recursive_mutex ä¸ std::mutex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¢«ä¸Šé”çš„å¯¹è±¡ï¼Œä½†æ˜¯å’Œ std::mutex ä¸åŒçš„æ˜¯ï¼Œstd::recursive_mutex å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥è·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œstd::recursive_mutex é‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸è¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()ï¼Œå¯ç†è§£ä¸º lock() æ¬¡æ•°å’Œ unlock() æ¬¡æ•°ç›¸åŒï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œstd::recursive_mutex çš„ç‰¹æ€§å’Œ std::mutex å¤§è‡´ç›¸åŒã€‚</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;       // std::cout</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;thread&gt;         // std::thread</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;mutex&gt;          // std::mutex</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> <span class=\"title\">counter</span><span class=\"params\">(<span class=\"number\">0</span>)</span></span>; <span class=\"comment\">// non-atomic counter</span></span><br><span class=\"line\"><span class=\"built_in\">std</span>::recursive_mutex  rmtx;           <span class=\"comment\">// locks access to counter</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">attempt_1k_increases</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10000</span>; ++i) &#123;</span><br><span class=\"line\">        rmtx.lock();   </span><br><span class=\"line\">        ++counter; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10000</span>; ++i) &#123; </span><br><span class=\"line\">        counter-=<span class=\"number\">2</span>; </span><br><span class=\"line\">        rmtx.unlock();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> th = <span class=\"built_in\">std</span>::thread(attempt_1k_increases);</span><br><span class=\"line\">    th.join();</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; counter &lt;&lt; <span class=\"string\">\" successful increases of the counter.\\n\"</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -lpthread -o main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\"><span class=\"number\">-10000</span> successful increases of the counter.</span><br></pre></td></tr></table></figure><h3 id=\"std-time-mutex-ä»‹ç»\"><a href=\"#std-time-mutex-ä»‹ç»\" class=\"headerlink\" title=\"std::time_mutex ä»‹ç»\"></a>std::time_mutex ä»‹ç»</h3><p>std::time_mutex æ¯” std::mutex å¤šäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œtry_lock_for()ï¼Œtry_lock_until()ã€‚</p><p>try_lock_for å‡½æ•°æ¥å—ä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸€æ®µæ—¶é—´èŒƒå›´ä¹‹å†…çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼ˆä¸ std::mutex çš„ try_lock() ä¸åŒï¼Œtry_lock å¦‚æœè¢«è°ƒç”¨æ—¶æ²¡æœ‰è·å¾—é”åˆ™ç›´æ¥è¿”å› falseï¼‰ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚</p><p>try_lock_until å‡½æ•°åˆ™æ¥å—ä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ï¼Œåœ¨æŒ‡å®šæ—¶é—´ç‚¹æœªåˆ°æ¥ä¹‹å‰çº¿ç¨‹å¦‚æœæ²¡æœ‰è·å¾—é”åˆ™è¢«é˜»å¡ä½ï¼Œå¦‚æœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥è·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰è·å¾—é”ï¼‰ï¼Œåˆ™è¿”å› falseã€‚</p><p>ä¸‹é¢çš„å°ä¾‹å­è¯´æ˜äº† std::time_mutex çš„ç”¨æ³•ï¼ˆ<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcGx1c3BsdXMuY29tL3JlZmVyZW5jZS9tdXRleC90aW1lZF9tdXRleC90cnlfbG9ja19mb3Iv\" title=\"http://www.cplusplus.com/reference/mutex/timed_mutex/try_lock_for/\">å‚è€ƒ<i class=\"fa fa-external-link\"></i></span>ï¼‰ã€‚</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;       // std::cout</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;chrono&gt;         // std::chrono::milliseconds</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;thread&gt;         // std::thread</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;mutex&gt;          // std::timed_mutex</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">std</span>::timed_mutex mtx;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">fireworks</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// waiting to get a lock: each thread prints \"-\" every 200ms:</span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (!mtx.try_lock_for(<span class=\"built_in\">std</span>::chrono::milliseconds(<span class=\"number\">200</span>))) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"-\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// got a lock! - wait for 1s, then this thread prints \"*\"</span></span><br><span class=\"line\">  <span class=\"built_in\">std</span>::this_thread::sleep_for(<span class=\"built_in\">std</span>::chrono::milliseconds(<span class=\"number\">1000</span>));</span><br><span class=\"line\">  <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"*\\n\"</span>;</span><br><span class=\"line\">  mtx.unlock();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">std</span>::thread threads[<span class=\"number\">10</span>];</span><br><span class=\"line\">  <span class=\"comment\">// spawn 10 threads:</span></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10</span>; ++i)</span><br><span class=\"line\">    threads[i] = <span class=\"built_in\">std</span>::thread(fireworks);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span>&amp; th : threads) th.join();</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><blockquote><p>çº¿ç¨‹è¾“å‡º*è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”é‡Šæ”¾è¯¥é”ã€‚å¦åˆ™å°†æ¯200mså°è¯•è·å–mutexğŸ”’ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚</p></blockquote><h3 id=\"std-recursive-timed-mutex-ä»‹ç»\"><a href=\"#std-recursive-timed-mutex-ä»‹ç»\" class=\"headerlink\" title=\"std::recursive_timed_mutex ä»‹ç»\"></a>std::recursive_timed_mutex ä»‹ç»</h3><p>å’Œ std:recursive_mutex ä¸ std::mutex çš„å…³ç³»ä¸€æ ·ï¼Œstd::recursive_timed_mutex çš„ç‰¹æ€§ä¹Ÿå¯ä»¥ä» std::timed_mutex æ¨å¯¼å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„åŒé‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ ;-)</p><h3 id=\"std-lock-guard-ä»‹ç»\"><a href=\"#std-lock-guard-ä»‹ç»\" class=\"headerlink\" title=\"std::lock_guard ä»‹ç»\"></a>std::lock_guard ä»‹ç»</h3><p>ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚ä¾‹å­ï¼ˆ<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcGx1c3BsdXMuY29tL3JlZmVyZW5jZS9tdXRleC9sb2NrX2d1YXJkLw==\" title=\"http://www.cplusplus.com/reference/mutex/lock_guard/\">å‚è€ƒ<i class=\"fa fa-external-link\"></i></span>ï¼‰:</p><ul><li>1.std::lock_guard åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡ŒåŠ é”ï¼Œææ„å‡½æ•°ä¸­è¿›è¡Œè§£é”ã€‚</li><li>2.é”åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šï¼Œå› æ­¤c++11æä¾›äº†lock_guardæ¨¡æ¿ç±»ï¼›åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„åœºæ™¯ç¼–å†™<code>resource_guard</code> RAIIç±»ï¼Œé¿å…å¿˜æ‰é‡Šæ”¾èµ„æºã€‚</li></ul><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;       // std::cout</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;thread&gt;         // std::thread</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;mutex&gt;          // std::mutex, std::lock_guard</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;stdexcept&gt;      // std::logic_error</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">std</span>::mutex mtx;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print_even</span> <span class=\"params\">(<span class=\"keyword\">int</span> x)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (x%<span class=\"number\">2</span>==<span class=\"number\">0</span>) <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; x &lt;&lt; <span class=\"string\">\" is even\\n\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">throw</span> (<span class=\"built_in\">std</span>::logic_error(<span class=\"string\">\"not even\"</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print_thread_id</span> <span class=\"params\">(<span class=\"keyword\">int</span> id)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// using a local lock_guard to lock mtx guarantees unlocking on destruction / exception:</span></span><br><span class=\"line\">        <span class=\"built_in\">std</span>::lock_guard&lt;<span class=\"built_in\">std</span>::mutex&gt; lck (mtx);</span><br><span class=\"line\">        print_even(id);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (<span class=\"built_in\">std</span>::logic_error&amp;) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"[exception caught]\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::thread threads[<span class=\"number\">10</span>];</span><br><span class=\"line\">    <span class=\"comment\">// spawn 10 threads:</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"number\">10</span>; ++i)</span><br><span class=\"line\">        threads[i] = <span class=\"built_in\">std</span>::thread(print_thread_id,i+<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span>&amp; th : threads) th.join();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -lpthread -o main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\">[exception caught]</span><br><span class=\"line\"><span class=\"number\">4</span> is even</span><br><span class=\"line\">[exception caught]</span><br><span class=\"line\"><span class=\"number\">2</span> is even</span><br><span class=\"line\">[exception caught]</span><br><span class=\"line\"><span class=\"number\">6</span> is even</span><br><span class=\"line\"><span class=\"number\">8</span> is even</span><br><span class=\"line\">[exception caught]</span><br><span class=\"line\">[exception caught]</span><br><span class=\"line\"><span class=\"number\">10</span> is even</span><br></pre></td></tr></table></figure><h3 id=\"std-unique-lock-ä»‹ç»\"><a href=\"#std-unique-lock-ä»‹ç»\" class=\"headerlink\" title=\"std::unique_lock ä»‹ç»\"></a>std::unique_lock ä»‹ç»</h3><p>ä¸ Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æ§åˆ¶ã€‚ä¾‹å­ï¼ˆ<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5jcGx1c3BsdXMuY29tL3JlZmVyZW5jZS9tdXRleC91bmlxdWVfbG9jay8=\" title=\"http://www.cplusplus.com/reference/mutex/unique_lock/\">å‚è€ƒ<i class=\"fa fa-external-link\"></i></span>ï¼‰ï¼š</p><ul><li>1.ç±» unique_lock æ˜¯é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå…è®¸<code>å»¶è¿Ÿé”å®šã€é”å®šçš„æœ‰æ—¶é™å°è¯•ã€é€’å½’é”å®šã€æ‰€æœ‰æƒè½¬ç§»å’Œä¸æ¡ä»¶å˜é‡ä¸€åŒä½¿ç”¨</code>ã€‚</li><li>2.unique_lockæ¯”lock_guardä½¿ç”¨æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚<br>ä½¿ç”¨unique_lockéœ€è¦ä»˜å‡ºæ›´å¤šçš„æ—¶é—´ã€æ€§èƒ½æˆæœ¬ã€‚</li></ul><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;       // std::cout</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;thread&gt;         // std::thread</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;mutex&gt;          // std::mutex, std::unique_lock</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">std</span>::mutex mtx;           <span class=\"comment\">// mutex for critical section</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">print_block</span> <span class=\"params\">(<span class=\"keyword\">int</span> n, <span class=\"keyword\">char</span> c)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// critical section (exclusive access to std::cout signaled by lifetime of lck):</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::unique_lock&lt;<span class=\"built_in\">std</span>::mutex&gt; lck (mtx);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i=<span class=\"number\">0</span>; i&lt;n; ++i) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; c;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span> <span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"function\">thread <span class=\"title\">th1</span> <span class=\"params\">(print_block,<span class=\"number\">50</span>,<span class=\"string\">'*'</span>)</span></span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"function\">thread <span class=\"title\">th2</span> <span class=\"params\">(print_block,<span class=\"number\">50</span>,<span class=\"string\">'$'</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    th1.join();</span><br><span class=\"line\">    th2.join();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$g++ -lpthread -o main *.cpp</span><br><span class=\"line\">$main</span><br><span class=\"line\">**************************************************</span><br><span class=\"line\">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œæœ¬æ–‡æš‚æ—¶è®²åˆ°è¿™é‡Œï¼Œè¿˜å‰©ä¸‹ std::try_lockï¼Œstd::lockï¼Œstd::call_once ä¸‰ä¸ªå‡½æ•°æ²¡æœ‰è®²åˆ°ï¼Œç•™åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­è®²å§ ;-)</p>","slug":"Mutexä»‹ç»","updated":"2019-06-14T06:09:09.649Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/58aac72e/","excerpt":"Mutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸ Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»å‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å«å¤´æ–‡ä»¶ã€‚å¤´æ–‡ä»¶ä»‹ç»Mutex ç³»åˆ—ç±»(å››ç§)std::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚std::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚std::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚std::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚","categories":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/tags/C/"}]},{"title":"C++ä¹‹Lambdaç ”ç©¶","date":"2019-06-03T12:20:52.000Z","path":"posts/95b963ee/","text":"1. å‰è¨€æœ¬æ–‡ä»£ç æµ‹è¯•ç¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Šå®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–ã€‹ï¼Œé€‚ç”¨äºâ€œGCC-9.1.0â€ã€‚æœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®é™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperator ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æ„ä½“å®é™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æ§åˆ¶ï¼‰ã€‚å¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚2. ç¤ºä¾‹1å…ˆçœ‹ä¸€æ®µå‡ ä¹æœ€ç®€å•çš„Lambdaä»£ç ï¼š123456// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; auto f = [] &#123; printf(\"f\\n\"); &#125;; // æ³¨æ„â€œ&#125;â€åçš„â€œ;â€å¿…ä¸å¯å°‘ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ return 0;&#125;å¦‚æœLambdaè¡¨è¾¾å¼ï¼ˆæˆ–å‡½æ•°ï¼‰æ²¡æœ‰ä»¥â€œ;â€ç»“å°¾ï¼Œåˆ™ç¼–è¯‘æ—¶å°†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š1234a3.cpp: In function 'int main()':a3.cpp:4:3: error: expected ',' or ';' before 'return' 4 | return 0; | ^~~~~~Lambdaä¹‹æ‰€ä»¥ç¥å¥‡ï¼Œè¿™å¾—ç›ŠäºC++ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä¸Šè¿°â€œfâ€å®é™…é•¿è¿™æ ·ï¼š12type = struct &lt;lambda()&gt; &#123;&#125;ä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°â€œoperator () constâ€ã€‚æ³¨æ„è¿™é‡Œæˆå‘˜å‡½æ•°æ˜¯â€constâ€ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚å¦‚æœéœ€éâ€constâ€æˆå‘˜å‡½æ•°ï¼Œéœ€è¦åŠ â€mutableâ€ä¿®é¥°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1auto f = [n]() mutable &#123; printf(\"%d\\n\", n); &#125;;ä¸Šé¢ä¾‹å­å¯¹åº”çš„åŒ¿åç±»æ²¡æœ‰ä»»ä½•ç±»æ•°æ®æˆå‘˜ï¼Œç°åœ¨æ¥ä¸ªæœ‰ç±»æ•°æ®æˆå‘˜çš„ä»£ç ï¼š12345678// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [n] &#123; printf(\"%d\\n\", n); &#125;; f(); // è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯åŒ¿åç±»çš„æˆå‘˜å‡½æ•°â€œoperator ()â€ return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰ç±»æ•°æ®æˆå‘˜çš„åŒ¿åç±»ï¼Œè€Œä¸å†æ˜¯ç©ºæ— ä¸€ç‰¹çš„ç±»ï¼š123type = struct &lt;lambda()&gt; &#123; int __n;&#125;3. ç¤ºä¾‹2ç»§ç»­æ¥ä¸ªå˜ç§ï¼š12345678910// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [&amp;n]() mutable &#123; printf(\"%d\\n\", n); &#125;; f(); return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œä¸€ä¸ªåŒ…å«äº†å¼•ç”¨ç±»å‹çš„åŒ¿åç±»ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;4. ç¤ºä¾‹3ç»§ç»­å˜ç§ï¼Œâ€œ&amp;â€çš„ä½œç”¨è®©Lambdaå‡½æ•°å¯ä½¿ç”¨Lambdaæ‰€åœ¨ä½œç”¨åŸŸå†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬Lambdaæ‰€åœ¨ç±»çš„thisï¼‰ï¼Œå¹¶ä¸”æ˜¯ä»¥å¼•ç”¨ä¼ é€’æ–¹å¼ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [&amp;]() mutable &#123; printf(\"%d\\n\", n); &#125;; f(); return 0;&#125;â€œfâ€å®é™…é•¿è¿™æ ·ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;å˜ç¨å¤æ‚ä¸€ç‚¹ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; int m = 5; auto f = [&amp;]() mutable &#123; printf(\"%d\\n\", n); &#125;; f(); return 0;&#125;å¯ä»¥çœ‹åˆ°ï¼Œâ€œfâ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;5. ç¤ºä¾‹4ç»§ç»­å¢åŠ å¤æ‚åº¦ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; int m = 5; auto f = [&amp;]() mutable &#123; printf(\"%d,%d\\n\", n, m); &#125;; f(); return 0;&#125;å¯ä»¥çœ‹åˆ°â€œfâ€å˜äº†ï¼š1234type = struct &lt;lambda()&gt; &#123; int &amp;__n; int &amp;__m;&#125;ä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åªä¼šæŠŠLambdaå‡½æ•°ç”¨åˆ°çš„å˜é‡æ‰“åŒ…è¿›å¯¹åº”çš„åŒ¿åç±»ã€‚ç»§ç»­ä¸€ä¸ªç¨å¤æ‚ç‚¹çš„ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf(\"foo\\n\"); &#125; void xoo() &#123; auto f = [&amp;] &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š123type = struct X::&lt;lambda()&gt; &#123; X * const __this; // Xç±»å‹çš„æŒ‡é’ˆï¼ˆéå¯¹è±¡ï¼‰&#125;å¦‚æœå°†â€œauto f = [&amp;] { foo(); };â€ä¸­çš„â€œ&amp;â€å»æ‰ï¼Œåˆ™ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºâ€œthisâ€æ²¡æœ‰è¢«Lambdaå‡½æ•°æ•è·ï¼š12345a2.cpp: In lambda function:a2.cpp:5:23: error: 'this' was not captured for this lambda function 5 | auto f = [] &#123; foo(); &#125;; | ^a2.cpp:5:23: error: cannot call member function 'void X::foo()' without objectæ”¹æˆä¸‹åˆ—æ–¹å¼æ•è·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf(\"foo\\n\"); &#125; void xoo() &#123; auto f = [this] &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;å¦‚æœæ˜¯C++17ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++17#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf(\"foo\\n\"); &#125; void xoo() &#123; auto f = [*this]() mutable &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;æ³¨æ„å¾—æœ‰â€œmutableâ€ä¿®é¥°ï¼Œä¸ç„¶æŠ¥å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š1234567a2.cpp: In lambda function:a2.cpp:5:30: error: passing 'const X' as 'this' argument discards qualifiers [-fpermissive] 5 | auto f = [*this]() &#123; foo(); &#125;; | ^a2.cpp:3:8: note: in call to 'void X::foo()' 3 | void foo() &#123; printf(\"foo\\n\"); &#125; | ^~~ä¹Ÿå¯ä»¥è¿™æ ·ï¼š123456789101112131415// g++ -g -o a1 a1.cpp -std=c++17#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf(\"foo\\n\"); &#125; void xoo() &#123; auto f = [&amp;,*this]() mutable &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;ä½¿ç”¨â€œ*thisâ€æ—¶çš„â€œfâ€æ ·å­å¦‚ä¸‹ï¼š123type = struct X::&lt;lambda()&gt; &#123; X __this; // Xç±»å‹çš„å¯¹è±¡ï¼ˆéæŒ‡é’ˆï¼‰&#125;6. ç¤ºä¾‹5ç»§ç»­ç ”ç©¶ï¼Œä½¿ç”¨C++ RTTIï¼ˆRun-Time Type Identificationï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰è®¾æ–½â€œtypeidâ€æŸ¥çœ‹Lambdaå‡½æ•°ï¼š123456789101112131415// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;#include &lt;typeinfo&gt;struct X &#123; void xoo() &#123; auto f = [] &#123; printf(\"f\\n\"); &#125;; printf(\"%s\\n\", typeid(f).name()); // æ³¨ï¼štypeidè¿”å›å€¼ç±»å‹ä¸ºâ€œstd::type_infoâ€ &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;è¿è¡Œè¾“å‡ºï¼šZN1X3xooEvEUlvE_7. åŒ¿åç±»è§„åˆ™ç¼–è¯‘å™¨ä¸ºLambdaç”Ÿæˆçš„åŒ¿åç±»è§„åˆ™ï¼ˆä¸åŒæ ‡å‡†æœ‰åŒºåˆ«ï¼‰ï¼šæ„é€ å‡½æ•°æ‹·è´æ„é€ å‡½æ•°ClosureType()&nbsp;=&nbsp;delete;C++14å‰ClosureType()&nbsp;=&nbsp;default;C++20èµ·ï¼Œä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶ClosureType(const&nbsp;ClosureType&amp;&nbsp;)&nbsp;=&nbsp;default;C++14èµ·ClosureType(ClosureType&amp;&amp;&nbsp;)&nbsp;=&nbsp;default;C++14èµ·æ‹·è´å¤åˆ¶å‡½æ•°ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;C++20å‰ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;default;ClosureType&amp;&nbsp;operator=(ClosureType&amp;&amp;)&nbsp;=&nbsp;default;C++20èµ·ï¼Œä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;C++20èµ·ï¼Œå…¶ä»–æƒ…å†µææ„å‡½æ•°~ClosureType()&nbsp;=&nbsp;default;ææ„å‡½æ•°æ˜¯éšå¼å£°æ˜çš„å¯¹äºæ ‡è®°ä¸ºâ€œdeleteâ€çš„å‡½æ•°æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œå¦‚ä¸‹åˆ—ä»£ç ä¸­çš„â€œf2 = f1;â€å°†è§¦å‘ç¼–è¯‘é”™è¯¯ï¼š1234567891011int main() &#123; auto f1 = []&#123;&#125;; auto f2 = f1; f2 = f1; return 0;&#125;ä¸Šåˆ—ä»£ç åœ¨C++11ã€C++14å’ŒC++17å‡ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¦‚è§„åˆ™æ‰€ç¤ºï¼ŒC++20ï¼ˆå«C++2aï¼‰ä¸Šåˆ™å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼š1234567a3.cpp: In function 'int main()':a3.cpp:4:8: error: use of deleted function 'main()::&lt;lambda()&gt;&amp; main()::&lt;lambda()&gt;::operator=(const main()::&lt;lambda()&gt;&amp;)' 4 | f2 = f1; | ^~a3.cpp:2:14: note: a lambda closure type has a deleted copy assignment operator 2 | auto f1 = []&#123;&#125;; | ^å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œå¯¹ç†è§£Lambdaæœ‰æ‰€å¸®åŠ©ã€‚8. å‚è€ƒèµ„æ–™1) https://zh.cppreference.com/w/cpp/language/lambda2) https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-20193) https://en.cpprefeence.com/w/cpp/language/lambda4) https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c115) https://www.cprogramming.com/c++11/c++11-lambda-closures.htmlä½œè€…ï¼šä¸€è§æ¥æºï¼šCSDNåŸæ–‡ï¼šhttps://blog.csdn.net/Aquester/article/details/90691479","raw":"---\ntitle: C++ä¹‹Lambdaç ”ç©¶\ntags: C++\ncategories: C++\nabbrlink: 95b963ee\ndate: 2019-06-03 20:20:52\ncopyright:\ntype:\nkeyword:\ntop:\ncomments:\npassword:\ndescription:\n---\n\n# 1.Â å‰è¨€\næœ¬æ–‡ä»£ç æµ‹è¯•ç¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Š[å®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–](https://blog.csdn.net/Aquester/article/details/89735466)ã€‹ï¼Œé€‚ç”¨äºâ€œGCC-9.1.0â€ã€‚\n\næœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®é™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperatorÂ ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æ„ä½“å®é™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æ§åˆ¶ï¼‰ã€‚\n\nå¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚\n\n<!-- more -->\n\n# 2. ç¤ºä¾‹1\nå…ˆçœ‹ä¸€æ®µå‡ ä¹æœ€ç®€å•çš„Lambdaä»£ç ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nintÂ main()Â {\nÂ Â autoÂ fÂ =Â []Â {Â printf(\"f\\n\");Â };Â //Â æ³¨æ„â€œ}â€åçš„â€œ;â€å¿…ä¸å¯å°‘ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™\nÂ Â returnÂ 0;\n}\n```\n\nå¦‚æœLambdaè¡¨è¾¾å¼ï¼ˆæˆ–å‡½æ•°ï¼‰æ²¡æœ‰ä»¥â€œ;â€ç»“å°¾ï¼Œåˆ™ç¼–è¯‘æ—¶å°†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š\n\n```\na3.cpp:Â InÂ functionÂ 'intÂ main()':\na3.cpp:4:3:Â error:Â expectedÂ ','Â orÂ ';'Â beforeÂ 'return'\nÂ Â Â Â 4Â |Â Â Â returnÂ 0;\nÂ Â Â Â Â Â |Â Â Â ^~~~~~\n```\nÂ \n\nLambdaä¹‹æ‰€ä»¥ç¥å¥‡ï¼Œè¿™å¾—ç›ŠäºC++ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä¸Šè¿°â€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\n}\n```\nÂ \n\nä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°â€œoperatorÂ ()Â constâ€ã€‚æ³¨æ„è¿™é‡Œæˆå‘˜å‡½æ•°æ˜¯â€constâ€ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚å¦‚æœéœ€éâ€constâ€æˆå‘˜å‡½æ•°ï¼Œéœ€è¦åŠ â€mutableâ€ä¿®é¥°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\nautoÂ fÂ =Â [n]()Â mutableÂ {Â printf(\"%d\\n\",Â n);Â };\n```\nÂ \n\nä¸Šé¢ä¾‹å­å¯¹åº”çš„åŒ¿åç±»æ²¡æœ‰ä»»ä½•ç±»æ•°æ®æˆå‘˜ï¼Œç°åœ¨æ¥ä¸ªæœ‰ç±»æ•°æ®æˆå‘˜çš„ä»£ç ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nintÂ main()Â {\nÂ Â intÂ nÂ =Â 3;\nÂ Â autoÂ fÂ =Â [n]Â {Â printf(\"%d\\n\",Â n);Â };\nÂ Â f();Â //Â è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯åŒ¿åç±»çš„æˆå‘˜å‡½æ•°â€œoperatorÂ ()â€\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰ç±»æ•°æ®æˆå‘˜çš„åŒ¿åç±»ï¼Œè€Œä¸å†æ˜¯ç©ºæ— ä¸€ç‰¹çš„ç±»ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\nÂ Â Â Â intÂ __n;\n}\n```\n\n# 3.Â ç¤ºä¾‹2\nç»§ç»­æ¥ä¸ªå˜ç§ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n\n#includeÂ <stdio.h>\n\nintÂ main()Â {\nÂ Â intÂ nÂ =Â 3;\nÂ Â autoÂ fÂ =Â [&n]()Â mutableÂ {Â printf(\"%d\\n\",Â n);Â };\nÂ Â f();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œä¸€ä¸ªåŒ…å«äº†å¼•ç”¨ç±»å‹çš„åŒ¿åç±»ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\nÂ Â Â Â intÂ &__n;\n}\n```\n\n# 4.Â ç¤ºä¾‹3\nç»§ç»­å˜ç§ï¼Œâ€œ&â€çš„ä½œç”¨è®©Lambdaå‡½æ•°å¯ä½¿ç”¨Lambdaæ‰€åœ¨ä½œç”¨åŸŸå†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬Lambdaæ‰€åœ¨ç±»çš„thisï¼‰ï¼Œå¹¶ä¸”æ˜¯ä»¥å¼•ç”¨ä¼ é€’æ–¹å¼ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nintÂ main()Â {\nÂ Â intÂ nÂ =Â 3;\nÂ Â autoÂ fÂ =Â [&]()Â mutableÂ {Â printf(\"%d\\n\",Â n);Â };\nÂ Â f();\nÂ Â returnÂ 0;\n\n}\n```\nÂ \n\nâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\nÂ Â Â Â intÂ &__n;\n}\n```\nÂ \n\nå˜ç¨å¤æ‚ä¸€ç‚¹ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nintÂ main()Â {\nÂ Â intÂ nÂ =Â 3;\nÂ Â intÂ mÂ =Â 5;\nÂ Â autoÂ fÂ =Â [&]()Â mutableÂ {Â printf(\"%d\\n\",Â n);Â };\nÂ Â f();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nå¯ä»¥çœ‹åˆ°ï¼Œâ€œfâ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\nÂ Â Â Â intÂ &__n;\n}\n```\n\n# 5.Â ç¤ºä¾‹4\nç»§ç»­å¢åŠ å¤æ‚åº¦ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nintÂ main()Â {\nÂ Â intÂ nÂ =Â 3;\nÂ Â intÂ mÂ =Â 5;\nÂ Â autoÂ fÂ =Â [&]()Â mutableÂ {Â printf(\"%d,%d\\n\",Â n,Â m);Â };\nÂ Â f();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nå¯ä»¥çœ‹åˆ°â€œfâ€å˜äº†ï¼š\n\n```\ntypeÂ =Â structÂ <lambda()>Â {\nÂ Â Â Â intÂ &__n;\nÂ Â Â Â intÂ &__m;\n}\n```\nÂ \n\nä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åªä¼šæŠŠLambdaå‡½æ•°ç”¨åˆ°çš„å˜é‡æ‰“åŒ…è¿›å¯¹åº”çš„åŒ¿åç±»ã€‚ç»§ç»­ä¸€ä¸ªç¨å¤æ‚ç‚¹çš„ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nstructÂ XÂ {\nÂ Â voidÂ foo()Â {Â printf(\"foo\\n\");Â }\nÂ Â voidÂ xoo()Â {\nÂ Â Â Â autoÂ fÂ =Â [&]Â {Â foo();Â };\nÂ Â Â Â f();\nÂ Â }\n};\n\nintÂ main()Â {\nÂ Â X().xoo();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nè¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š\n\n```\ntypeÂ =Â structÂ X::<lambda()>Â {\nÂ Â Â Â XÂ *Â constÂ __this;Â //Â Xç±»å‹çš„æŒ‡é’ˆï¼ˆéå¯¹è±¡ï¼‰\n}\n```\nÂ \n\nå¦‚æœå°†â€œautoÂ fÂ =Â [&]Â {Â foo();Â };â€ä¸­çš„â€œ&â€å»æ‰ï¼Œåˆ™ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºâ€œthisâ€æ²¡æœ‰è¢«Lambdaå‡½æ•°æ•è·ï¼š\n\n```\na2.cpp:Â InÂ lambdaÂ function:\na2.cpp:5:23:Â error:Â 'this'Â wasÂ notÂ capturedÂ forÂ thisÂ lambdaÂ function\nÂ Â Â Â 5Â |Â Â Â Â Â autoÂ fÂ =Â []Â {Â foo();Â };\nÂ Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^\na2.cpp:5:23:Â error:Â cannotÂ callÂ memberÂ functionÂ 'voidÂ X::foo()'Â withoutÂ object\n```\nÂ \næ”¹æˆä¸‹åˆ—æ–¹å¼æ•è·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\nstructÂ XÂ {\nÂ Â voidÂ foo()Â {Â printf(\"foo\\n\");Â }\nÂ Â voidÂ xoo()Â {\nÂ Â Â Â autoÂ fÂ =Â [this]Â {Â foo();Â };\nÂ Â Â Â f();\nÂ Â }\n};\n\nintÂ main()Â {\nÂ Â X().xoo();\nÂ Â returnÂ 0;\n}\n\n```\n\nå¦‚æœæ˜¯C++17ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17\n#includeÂ <stdio.h>\nstructÂ XÂ {\nÂ Â voidÂ foo()Â {Â printf(\"foo\\n\");Â }\nÂ Â voidÂ xoo()Â {\nÂ Â Â Â autoÂ fÂ =Â [*this]()Â mutableÂ {Â foo();Â };\nÂ Â Â Â f();\nÂ Â }\n};\n\nintÂ main()Â {\nÂ Â X().xoo();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\næ³¨æ„å¾—æœ‰â€œmutableâ€ä¿®é¥°ï¼Œä¸ç„¶æŠ¥å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š\n\n```\na2.cpp:Â InÂ lambdaÂ function:\na2.cpp:5:30:Â error:Â passingÂ 'constÂ X'Â asÂ 'this'Â argumentÂ discardsÂ qualifiersÂ [-fpermissive]\nÂ Â Â Â 5Â |Â Â Â Â Â autoÂ fÂ =Â [*this]()Â {Â foo();Â };\nÂ Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^\na2.cpp:3:8:Â note:Â Â Â inÂ callÂ toÂ 'voidÂ X::foo()'\nÂ Â Â Â 3Â |Â Â Â voidÂ foo()Â {Â printf(\"foo\\n\");Â }\nÂ Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~~\n```\n\nä¹Ÿå¯ä»¥è¿™æ ·ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17\n\n#includeÂ <stdio.h>\nstructÂ XÂ {\nÂ Â voidÂ foo()Â {Â printf(\"foo\\n\");Â }\nÂ Â voidÂ xoo()Â {\nÂ Â Â Â autoÂ fÂ =Â [&,*this]()Â mutableÂ {Â foo();Â };\nÂ Â Â Â f();\nÂ Â }\n};\n\nintÂ main()Â {\nÂ Â X().xoo();\nÂ Â returnÂ 0;\n}\n```\nÂ \n\nä½¿ç”¨â€œ*thisâ€æ—¶çš„â€œfâ€æ ·å­å¦‚ä¸‹ï¼š\n\n```\ntypeÂ =Â structÂ X::<lambda()>Â {\nÂ Â Â Â XÂ __this;Â //Â Xç±»å‹çš„å¯¹è±¡ï¼ˆéæŒ‡é’ˆï¼‰\n}\n```\n\n# 6.Â ç¤ºä¾‹5\nç»§ç»­ç ”ç©¶ï¼Œä½¿ç”¨C++Â RTTIï¼ˆRun-TimeÂ TypeÂ Identificationï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰è®¾æ–½â€œtypeidâ€æŸ¥çœ‹Lambdaå‡½æ•°ï¼š\n\n```\n//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11\n#includeÂ <stdio.h>\n#includeÂ <typeinfo>\nstructÂ XÂ {\nÂ Â voidÂ xoo()Â {\nÂ Â Â Â autoÂ fÂ =Â []Â {Â printf(\"f\\n\");Â };\nÂ Â Â Â printf(\"%s\\n\",Â typeid(f).name());\nÂ Â Â Â //Â æ³¨ï¼štypeidè¿”å›å€¼ç±»å‹ä¸ºâ€œstd::type_infoâ€\nÂ Â }\n};\n\nintÂ main()Â {\nÂ Â X().xoo();\nÂ Â returnÂ 0;\n}\n```\nÂ \nè¿è¡Œè¾“å‡ºï¼š\n\n`ZN1X3xooEvEUlvE_`\n\n# 7. åŒ¿åç±»è§„åˆ™\nç¼–è¯‘å™¨ä¸ºLambdaç”Ÿæˆçš„åŒ¿åç±»è§„åˆ™ï¼ˆä¸åŒæ ‡å‡†æœ‰åŒºåˆ«ï¼‰ï¼š\n<table align=\"center\" border=\"1\" cellspacing=\"0\"><tbody><tr><td rowspan=\"4\">\t\t\t<p style=\"margin-left:0pt;\">æ„é€ å‡½æ•°</p>\t\t\t<p style=\"margin-left:0pt;\">æ‹·è´æ„é€ å‡½æ•°</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType()&nbsp;=&nbsp;<strong>delete</strong>;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++14å‰</p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType()&nbsp;=&nbsp;default;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++20èµ·ï¼Œ</p>\t\t\t<p style=\"margin-left:0pt;\">ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶</p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType(const&nbsp;ClosureType&amp;&nbsp;)&nbsp;=&nbsp;default;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++14èµ·</p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType(ClosureType&amp;&amp;&nbsp;)&nbsp;=&nbsp;default;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++14èµ·</p>\t\t\t</td>\t\t</tr><tr><td rowspan=\"3\" style=\"width:69.35pt;\">\t\t\t<p style=\"margin-left:0pt;\">æ‹·è´å¤åˆ¶å‡½æ•°</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;<strong>delete</strong>;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\"><span style=\"color:#0000ff;\"><strong>C++20å‰</strong></span></p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;default;</p>\t\t\t<p style=\"margin-left:0pt;\">ClosureType&amp;&nbsp;operator=(ClosureType&amp;&amp;)&nbsp;=&nbsp;default;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++20èµ·ï¼Œ</p>\t\t\t<p style=\"margin-left:0pt;\">ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶</p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;<strong>delete</strong>;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">C++20èµ·ï¼Œå…¶ä»–æƒ…å†µ</p>\t\t\t</td>\t\t</tr><tr><td style=\"vertical-align:top;width:69.35pt;\">\t\t\t<p style=\"margin-left:0pt;\">ææ„å‡½æ•°</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:250.8pt;\">\t\t\t<p style=\"margin-left:0pt;\">~ClosureType()&nbsp;=&nbsp;default;</p>\t\t\t</td>\t\t\t<td style=\"vertical-align:top;width:105.95pt;\">\t\t\t<p style=\"margin-left:0pt;\">ææ„å‡½æ•°æ˜¯éšå¼å£°æ˜çš„</p>\t\t\t</td>\t\t</tr></tbody></table>\n\t\t\nå¯¹äºæ ‡è®°ä¸ºâ€œdeleteâ€çš„å‡½æ•°æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œå¦‚ä¸‹åˆ—ä»£ç ä¸­çš„â€œf2Â =Â f1;â€å°†è§¦å‘ç¼–è¯‘é”™è¯¯ï¼š\n\n```\nintÂ main()Â {\n\nÂ Â autoÂ f1Â =Â []{};\n\nÂ Â autoÂ f2Â =Â f1;\n\nÂ Â f2Â =Â f1;\n\nÂ Â returnÂ 0;\n\n}\n```\n\nä¸Šåˆ—ä»£ç åœ¨C++11ã€C++14å’ŒC++17å‡ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¦‚è§„åˆ™æ‰€ç¤ºï¼ŒC++20ï¼ˆå«C++2aï¼‰ä¸Šåˆ™å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼š\n\n```\na3.cpp:Â InÂ functionÂ 'intÂ main()':\na3.cpp:4:8:Â error:Â useÂ ofÂ deletedÂ functionÂ 'main()::<lambda()>&Â main()::<lambda()>::operator=(constÂ main()::<lambda()>&)'\nÂ Â Â Â 4Â |Â Â Â f2Â =Â f1;\nÂ Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~\na3.cpp:2:14:Â note:Â aÂ lambdaÂ closureÂ typeÂ hasÂ aÂ deletedÂ copyÂ assignmentÂ operator\nÂ Â Â Â 2Â |Â Â Â autoÂ f1Â =Â []{};\nÂ Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^\n```\nÂ \n\nå¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œå¯¹ç†è§£Lambdaæœ‰æ‰€å¸®åŠ©ã€‚\n\n# 8.Â å‚è€ƒèµ„æ–™\n* 1)Â [https://zh.cppreference.com/w/cpp/language/lambda](https://zh.cppreference.com/w/cpp/language/lambda)\n\n* 2)Â [https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-2019](https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-2019)\n\n* 3)Â [https://en.cpprefeence.com/w/cpp/language/lambda](https://en.cpprefeence.com/w/cpp/language/lambda)\n\n* 4)Â [https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11](https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11)\n\n* 5)Â [https://www.cprogramming.com/c++11/c++11-lambda-closures.html](https://www.cprogramming.com/c++11/c++11-lambda-closures.html)\n\n\n--------------------- \t\t\n{% note info %}\n\nä½œè€…ï¼šä¸€è§ \næ¥æºï¼šCSDN \nåŸæ–‡ï¼šhttps://blog.csdn.net/Aquester/article/details/90691479 \n\n{% endnote %}","content":"<h1 id=\"1-å‰è¨€\"><a href=\"#1-å‰è¨€\" class=\"headerlink\" title=\"1. å‰è¨€\"></a>1. å‰è¨€</h1><p>æœ¬æ–‡ä»£ç æµ‹è¯•ç¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FxdWVzdGVyL2FydGljbGUvZGV0YWlscy84OTczNTQ2Ng==\" title=\"https://blog.csdn.net/Aquester/article/details/89735466\">å®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–<i class=\"fa fa-external-link\"></i></span>ã€‹ï¼Œé€‚ç”¨äºâ€œGCC-9.1.0â€ã€‚</p><p>æœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®é™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperator ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æ„ä½“å®é™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æ§åˆ¶ï¼‰ã€‚</p><p>å¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚</p><a id=\"more\"></a><h1 id=\"2-ç¤ºä¾‹1\"><a href=\"#2-ç¤ºä¾‹1\" class=\"headerlink\" title=\"2. ç¤ºä¾‹1\"></a>2. ç¤ºä¾‹1</h1><p>å…ˆçœ‹ä¸€æ®µå‡ ä¹æœ€ç®€å•çš„Lambdaä»£ç ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â fÂ =Â []Â &#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"f\\n\"</span>);Â &#125;;Â <span class=\"comment\">//Â æ³¨æ„â€œ&#125;â€åçš„â€œ;â€å¿…ä¸å¯å°‘ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™</span></span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœLambdaè¡¨è¾¾å¼ï¼ˆæˆ–å‡½æ•°ï¼‰æ²¡æœ‰ä»¥â€œ;â€ç»“å°¾ï¼Œåˆ™ç¼–è¯‘æ—¶å°†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class=\"highlight scilab\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a3.cpp:Â InÂ <span class=\"function\"><span class=\"keyword\">function</span>Â '<span class=\"title\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>':</span></span><br><span class=\"line\">a3.cpp:<span class=\"number\">4</span>:<span class=\"number\">3</span>:Â <span class=\"built_in\">error</span>:Â expectedÂ <span class=\"string\">','</span>Â <span class=\"built_in\">or</span>Â <span class=\"string\">';'</span>Â beforeÂ <span class=\"string\">'return'</span></span><br><span class=\"line\">Â Â Â Â <span class=\"number\">4</span>Â |Â Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â ^~~~~~</span><br></pre></td></tr></table></figure><p>Lambdaä¹‹æ‰€ä»¥ç¥å¥‡ï¼Œè¿™å¾—ç›ŠäºC++ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä¸Šè¿°â€œfâ€å®é™…é•¿è¿™æ ·ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°â€œoperator () constâ€ã€‚æ³¨æ„è¿™é‡Œæˆå‘˜å‡½æ•°æ˜¯â€constâ€ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚å¦‚æœéœ€éâ€constâ€æˆå‘˜å‡½æ•°ï¼Œéœ€è¦åŠ â€mutableâ€ä¿®é¥°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">autoÂ fÂ =Â [<span class=\"string\">n</span>](<span class=\"link\"></span>)Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¾‹å­å¯¹åº”çš„åŒ¿åç±»æ²¡æœ‰ä»»ä½•ç±»æ•°æ®æˆå‘˜ï¼Œç°åœ¨æ¥ä¸ªæœ‰ç±»æ•°æ®æˆå‘˜çš„ä»£ç ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â <span class=\"keyword\">int</span>Â nÂ =Â <span class=\"number\">3</span>;</span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [n]Â &#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,Â n);Â &#125;;</span><br><span class=\"line\">Â Â f();Â <span class=\"comment\">//Â è¿™é‡Œå®é™…è°ƒç”¨çš„æ˜¯åŒ¿åç±»çš„æˆå‘˜å‡½æ•°â€œoperatorÂ ()â€</span></span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰ç±»æ•°æ®æˆå‘˜çš„åŒ¿åç±»ï¼Œè€Œä¸å†æ˜¯ç©ºæ— ä¸€ç‰¹çš„ç±»ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">Â Â Â Â intÂ __n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"3-ç¤ºä¾‹2\"><a href=\"#3-ç¤ºä¾‹2\" class=\"headerlink\" title=\"3. ç¤ºä¾‹2\"></a>3. ç¤ºä¾‹2</h1><p>ç»§ç»­æ¥ä¸ªå˜ç§ï¼š</p><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">#includeÂ &lt;stdio.h&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">intÂ main()Â &#123;</span><br><span class=\"line\">Â Â intÂ nÂ =Â 3;</span><br><span class=\"line\">Â Â autoÂ fÂ =Â [<span class=\"string\">&amp;n</span>](<span class=\"link\"></span>)Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;</span><br><span class=\"line\">Â Â f();</span><br><span class=\"line\">Â Â returnÂ 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼Œä¸€ä¸ªåŒ…å«äº†å¼•ç”¨ç±»å‹çš„åŒ¿åç±»ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">Â Â Â Â intÂ &amp;__n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"4-ç¤ºä¾‹3\"><a href=\"#4-ç¤ºä¾‹3\" class=\"headerlink\" title=\"4. ç¤ºä¾‹3\"></a>4. ç¤ºä¾‹3</h1><p>ç»§ç»­å˜ç§ï¼Œâ€œ&amp;â€çš„ä½œç”¨è®©Lambdaå‡½æ•°å¯ä½¿ç”¨Lambdaæ‰€åœ¨ä½œç”¨åŸŸå†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬Lambdaæ‰€åœ¨ç±»çš„thisï¼‰ï¼Œå¹¶ä¸”æ˜¯ä»¥å¼•ç”¨ä¼ é€’æ–¹å¼ï¼š</p><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span><br><span class=\"line\"><span class=\"section\">#includeÂ &lt;stdio.h&gt;</span></span><br><span class=\"line\">intÂ main()Â &#123;</span><br><span class=\"line\">Â Â intÂ nÂ =Â 3;</span><br><span class=\"line\">Â Â autoÂ fÂ =Â [<span class=\"string\">&amp;</span>](<span class=\"link\"></span>)Â mutableÂ &#123;Â printf(\"%d\\n\",Â n);Â &#125;;</span><br><span class=\"line\">Â Â f();</span><br><span class=\"line\">Â Â returnÂ 0;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>â€œfâ€å®é™…é•¿è¿™æ ·ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">Â Â Â Â intÂ &amp;__n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å˜ç¨å¤æ‚ä¸€ç‚¹ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â <span class=\"keyword\">int</span>Â nÂ =Â <span class=\"number\">3</span>;</span><br><span class=\"line\">Â Â <span class=\"keyword\">int</span>Â mÂ =Â <span class=\"number\">5</span>;</span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [&amp;]()Â <span class=\"keyword\">mutable</span>Â &#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d\\n\"</span>,Â n);Â &#125;;</span><br><span class=\"line\">Â Â f();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œâ€œfâ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">Â Â Â Â intÂ &amp;__n;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"5-ç¤ºä¾‹4\"><a href=\"#5-ç¤ºä¾‹4\" class=\"headerlink\" title=\"5. ç¤ºä¾‹4\"></a>5. ç¤ºä¾‹4</h1><p>ç»§ç»­å¢åŠ å¤æ‚åº¦ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â <span class=\"keyword\">int</span>Â nÂ =Â <span class=\"number\">3</span>;</span><br><span class=\"line\">Â Â <span class=\"keyword\">int</span>Â mÂ =Â <span class=\"number\">5</span>;</span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [&amp;]()Â <span class=\"keyword\">mutable</span>Â &#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"%d,%d\\n\"</span>,Â n,Â m);Â &#125;;</span><br><span class=\"line\">Â Â f();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°â€œfâ€å˜äº†ï¼š</p><figure class=\"highlight crystal\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â <span class=\"class\"><span class=\"keyword\">struct</span>Â &lt;<span class=\"title\">lambda</span>()&gt;Â &#123;</span></span><br><span class=\"line\">Â Â Â Â intÂ &amp;__n;</span><br><span class=\"line\">Â Â Â Â intÂ &amp;__m;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åªä¼šæŠŠLambdaå‡½æ•°ç”¨åˆ°çš„å˜é‡æ‰“åŒ…è¿›å¯¹åº”çš„åŒ¿åç±»ã€‚ç»§ç»­ä¸€ä¸ªç¨å¤æ‚ç‚¹çš„ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span>Â <span class=\"title\">X</span>Â &#123;</span></span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">foo</span><span class=\"params\">()</span>Â </span>&#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"foo\\n\"</span>);Â &#125;</span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">xoo</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [&amp;]Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â f();</span><br><span class=\"line\">Â Â &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â X().xoo();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶ï¼Œâ€œfâ€å®é™…é•¿è¿™æ ·ï¼š</p><figure class=\"highlight elm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â structÂ <span class=\"type\">X</span>::&lt;lambda()&gt;Â &#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"type\">X</span>Â *Â constÂ __this;Â //Â <span class=\"type\">X</span>ç±»å‹çš„æŒ‡é’ˆï¼ˆéå¯¹è±¡ï¼‰</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå°†â€œauto f = [&amp;] { foo(); };â€ä¸­çš„â€œ&amp;â€å»æ‰ï¼Œåˆ™ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºâ€œthisâ€æ²¡æœ‰è¢«Lambdaå‡½æ•°æ•è·ï¼š</p><figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a2.cpp:Â <span class=\"keyword\">In</span>Â lambdaÂ <span class=\"keyword\">function</span>:</span><br><span class=\"line\">a2.cpp:<span class=\"number\">5</span>:<span class=\"number\">23</span>:Â error:Â <span class=\"symbol\">'this</span>'Â wasÂ <span class=\"keyword\">not</span>Â capturedÂ <span class=\"keyword\">for</span>Â thisÂ lambdaÂ <span class=\"keyword\">function</span></span><br><span class=\"line\">Â Â Â Â <span class=\"number\">5</span>Â |Â Â Â Â Â autoÂ fÂ =Â []Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^</span><br><span class=\"line\">a2.cpp:<span class=\"number\">5</span>:<span class=\"number\">23</span>:Â error:Â cannotÂ callÂ memberÂ <span class=\"keyword\">function</span>Â <span class=\"title\">'void</span>Â X::foo()'Â <span class=\"keyword\">with</span><span class=\"keyword\">out</span>Â object</span><br></pre></td></tr></table></figure><p>æ”¹æˆä¸‹åˆ—æ–¹å¼æ•è·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span>Â <span class=\"title\">X</span>Â &#123;</span></span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">foo</span><span class=\"params\">()</span>Â </span>&#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"foo\\n\"</span>);Â &#125;</span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">xoo</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [<span class=\"keyword\">this</span>]Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â f();</span><br><span class=\"line\">Â Â &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â X().xoo();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯C++17ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span>Â <span class=\"title\">X</span>Â &#123;</span></span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">foo</span><span class=\"params\">()</span>Â </span>&#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"foo\\n\"</span>);Â &#125;</span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">xoo</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [*<span class=\"keyword\">this</span>]()Â <span class=\"keyword\">mutable</span>Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â f();</span><br><span class=\"line\">Â Â &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â X().xoo();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„å¾—æœ‰â€œmutableâ€ä¿®é¥°ï¼Œä¸ç„¶æŠ¥å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š</p><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a2.<span class=\"string\">cpp:</span>Â InÂ lambdaÂ <span class=\"string\">function:</span></span><br><span class=\"line\">a2.<span class=\"string\">cpp:</span><span class=\"number\">5</span>:<span class=\"number\">30</span>:Â <span class=\"string\">error:</span>Â passingÂ <span class=\"string\">'constÂ X'</span>Â <span class=\"keyword\">as</span>Â <span class=\"string\">'this'</span>Â argumentÂ discardsÂ qualifiersÂ [-fpermissive]</span><br><span class=\"line\">Â Â Â Â <span class=\"number\">5</span>Â |Â Â Â Â Â autoÂ fÂ =Â [*<span class=\"keyword\">this</span>]()Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^</span><br><span class=\"line\">a2.<span class=\"string\">cpp:</span><span class=\"number\">3</span>:<span class=\"number\">8</span>:Â <span class=\"string\">note:</span>Â Â Â <span class=\"keyword\">in</span>Â callÂ toÂ <span class=\"string\">'voidÂ X::foo()'</span></span><br><span class=\"line\">Â Â Â Â <span class=\"number\">3</span>Â |Â Â Â <span class=\"keyword\">void</span>Â foo()Â &#123;Â printf(<span class=\"string\">\"foo\\n\"</span>);Â &#125;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~~</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥è¿™æ ·ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++17</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span>Â <span class=\"title\">X</span>Â &#123;</span></span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">foo</span><span class=\"params\">()</span>Â </span>&#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"foo\\n\"</span>);Â &#125;</span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">xoo</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"keyword\">auto</span>Â fÂ =Â [&amp;,*<span class=\"keyword\">this</span>]()Â <span class=\"keyword\">mutable</span>Â &#123;Â foo();Â &#125;;</span><br><span class=\"line\">Â Â Â Â f();</span><br><span class=\"line\">Â Â &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â X().xoo();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨â€œ*thisâ€æ—¶çš„â€œfâ€æ ·å­å¦‚ä¸‹ï¼š</p><figure class=\"highlight elm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span>Â =Â structÂ <span class=\"type\">X</span>::&lt;lambda()&gt;Â &#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"type\">X</span>Â __this;Â //Â <span class=\"type\">X</span>ç±»å‹çš„å¯¹è±¡ï¼ˆéæŒ‡é’ˆï¼‰</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h1 id=\"6-ç¤ºä¾‹5\"><a href=\"#6-ç¤ºä¾‹5\" class=\"headerlink\" title=\"6. ç¤ºä¾‹5\"></a>6. ç¤ºä¾‹5</h1><p>ç»§ç»­ç ”ç©¶ï¼Œä½¿ç”¨C++ RTTIï¼ˆRun-Time Type Identificationï¼Œè¿è¡Œæ—¶ç±»å‹è¯†åˆ«ï¼‰è®¾æ–½â€œtypeidâ€æŸ¥çœ‹Lambdaå‡½æ•°ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Â g++Â -gÂ -oÂ a1Â a1.cppÂ -std=c++11</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span>Â <span class=\"meta-string\">&lt;typeinfo&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span>Â <span class=\"title\">X</span>Â &#123;</span></span><br><span class=\"line\">Â Â <span class=\"function\"><span class=\"keyword\">void</span>Â <span class=\"title\">xoo</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â Â Â <span class=\"keyword\">auto</span>Â fÂ =Â []Â &#123;Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"f\\n\"</span>);Â &#125;;</span><br><span class=\"line\">Â Â Â Â <span class=\"built_in\">printf</span>(<span class=\"string\">\"%s\\n\"</span>,Â <span class=\"keyword\">typeid</span>(f).name());</span><br><span class=\"line\">Â Â Â Â <span class=\"comment\">//Â æ³¨ï¼štypeidè¿”å›å€¼ç±»å‹ä¸ºâ€œstd::type_infoâ€</span></span><br><span class=\"line\">Â Â &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\">Â Â X().xoo();</span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¾“å‡ºï¼š</p><p><code>ZN1X3xooEvEUlvE_</code></p><h1 id=\"7-åŒ¿åç±»è§„åˆ™\"><a href=\"#7-åŒ¿åç±»è§„åˆ™\" class=\"headerlink\" title=\"7. åŒ¿åç±»è§„åˆ™\"></a>7. åŒ¿åç±»è§„åˆ™</h1><p>ç¼–è¯‘å™¨ä¸ºLambdaç”Ÿæˆçš„åŒ¿åç±»è§„åˆ™ï¼ˆä¸åŒæ ‡å‡†æœ‰åŒºåˆ«ï¼‰ï¼š</p><table align=\"center\" border=\"1\" cellspacing=\"0\"><tbody><tr><td rowspan=\"4\"><p style=\"margin-left:0\">æ„é€ å‡½æ•°</p><p style=\"margin-left:0\">æ‹·è´æ„é€ å‡½æ•°</p></td><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType()&nbsp;=&nbsp;<strong>delete</strong>;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++14å‰</p></td></tr><tr><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType()&nbsp;=&nbsp;default;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++20èµ·ï¼Œ</p><p style=\"margin-left:0\">ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶</p></td></tr><tr><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType(const&nbsp;ClosureType&amp;&nbsp;)&nbsp;=&nbsp;default;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++14èµ·</p></td></tr><tr><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType(ClosureType&amp;&amp;&nbsp;)&nbsp;=&nbsp;default;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++14èµ·</p></td></tr><tr><td rowspan=\"3\" style=\"width:69.35pt\"><p style=\"margin-left:0\">æ‹·è´å¤åˆ¶å‡½æ•°</p></td><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;<strong>delete</strong>;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\"><span style=\"color:#00f\"><strong>C++20å‰</strong></span></p></td></tr><tr><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;default;</p><p style=\"margin-left:0\">ClosureType&amp;&nbsp;operator=(ClosureType&amp;&amp;)&nbsp;=&nbsp;default;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++20èµ·ï¼Œ</p><p style=\"margin-left:0\">ä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜è·æ—¶</p></td></tr><tr><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;<strong>delete</strong>;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">C++20èµ·ï¼Œå…¶ä»–æƒ…å†µ</p></td></tr><tr><td style=\"vertical-align:top;width:69.35pt\"><p style=\"margin-left:0\">ææ„å‡½æ•°</p></td><td style=\"vertical-align:top;width:250.8pt\"><p style=\"margin-left:0\">~ClosureType()&nbsp;=&nbsp;default;</p></td><td style=\"vertical-align:top;width:105.95pt\"><p style=\"margin-left:0\">ææ„å‡½æ•°æ˜¯éšå¼å£°æ˜çš„</p></td></tr></tbody></table><p>å¯¹äºæ ‡è®°ä¸ºâ€œdeleteâ€çš„å‡½æ•°æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œå¦‚ä¸‹åˆ—ä»£ç ä¸­çš„â€œf2 = f1;â€å°†è§¦å‘ç¼–è¯‘é”™è¯¯ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>Â </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â f1Â =Â []&#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â <span class=\"keyword\">auto</span>Â f2Â =Â f1;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â f2Â =Â f1;</span><br><span class=\"line\"></span><br><span class=\"line\">Â Â <span class=\"keyword\">return</span>Â <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šåˆ—ä»£ç åœ¨C++11ã€C++14å’ŒC++17å‡ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¦‚è§„åˆ™æ‰€ç¤ºï¼ŒC++20ï¼ˆå«C++2aï¼‰ä¸Šåˆ™å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼š</p><figure class=\"highlight scilab\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a3.cpp:Â InÂ <span class=\"function\"><span class=\"keyword\">function</span>Â '<span class=\"title\">int</span>Â <span class=\"title\">main</span><span class=\"params\">()</span>':</span></span><br><span class=\"line\">a3.cpp:<span class=\"number\">4</span>:<span class=\"number\">8</span>:Â <span class=\"built_in\">error</span>:Â useÂ ofÂ deletedÂ <span class=\"function\"><span class=\"keyword\">function</span>Â '<span class=\"title\">main</span><span class=\"params\">()</span>::&lt;<span class=\"title\">lambda</span><span class=\"params\">()</span>&gt;&amp;Â <span class=\"title\">main</span><span class=\"params\">()</span>::&lt;<span class=\"title\">lambda</span><span class=\"params\">()</span>&gt;::<span class=\"title\">operator</span>=<span class=\"params\">(constÂ main()</span>::&lt;<span class=\"title\">lambda</span><span class=\"params\">()</span>&gt;&amp;)'</span></span><br><span class=\"line\">Â Â Â Â <span class=\"number\">4</span>Â |Â Â Â f2Â =Â f1;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â Â Â Â Â Â ^~</span><br><span class=\"line\">a3.cpp:<span class=\"number\">2</span>:<span class=\"number\">14</span>:Â note:Â aÂ lambdaÂ closureÂ <span class=\"built_in\">type</span>Â hasÂ aÂ deletedÂ copyÂ assignmentÂ operator</span><br><span class=\"line\">Â Â Â Â <span class=\"number\">2</span>Â |Â Â Â autoÂ f1Â =Â []&#123;&#125;;</span><br><span class=\"line\">Â Â Â Â Â Â |Â Â Â Â Â Â Â Â Â Â Â Â Â Â ^</span><br></pre></td></tr></table></figure><p>å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œå¯¹ç†è§£Lambdaæœ‰æ‰€å¸®åŠ©ã€‚</p><h1 id=\"8-å‚è€ƒèµ„æ–™\"><a href=\"#8-å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"8. å‚è€ƒèµ„æ–™\"></a>8. å‚è€ƒèµ„æ–™</h1><ul><li><p>1) <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2xhbmd1YWdlL2xhbWJkYQ==\" title=\"https://zh.cppreference.com/w/cpp/language/lambda\">https://zh.cppreference.com/w/cpp/language/lambda<i class=\"fa fa-external-link\"></i></span></p></li><li><p>2) <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvY3BwL2NwcC9sYW1iZGEtZXhwcmVzc2lvbnMtaW4tY3BwP3ZpZXc9dnMtMjAxOQ==\" title=\"https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-2019\">https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-2019<i class=\"fa fa-external-link\"></i></span></p></li><li><p>3) <span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi5jcHByZWZlZW5jZS5jb20vdy9jcHAvbGFuZ3VhZ2UvbGFtYmRh\" title=\"https://en.cpprefeence.com/w/cpp/language/lambda\">https://en.cpprefeence.com/w/cpp/language/lambda<i class=\"fa fa-external-link\"></i></span></p></li><li><p>4) <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNzYyNzA5OC93aGF0LWlzLWEtbGFtYmRhLWV4cHJlc3Npb24taW4tYzEx\" title=\"https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11\">https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c11<i class=\"fa fa-external-link\"></i></span></p></li><li><p>5) <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3Byb2dyYW1taW5nLmNvbS9jKysxMS9jKysxMS1sYW1iZGEtY2xvc3VyZXMuaHRtbA==\" title=\"https://www.cprogramming.com/c++11/c++11-lambda-closures.html\">https://www.cprogramming.com/c++11/c++11-lambda-closures.html<i class=\"fa fa-external-link\"></i></span></p></li></ul><hr><div class=\"note info\"><p>ä½œè€…ï¼šä¸€è§<br>æ¥æºï¼šCSDN<br>åŸæ–‡ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0FxdWVzdGVyL2FydGljbGUvZGV0YWlscy85MDY5MTQ3OQ==\" title=\"https://blog.csdn.net/Aquester/article/details/90691479\">https://blog.csdn.net/Aquester/article/details/90691479<i class=\"fa fa-external-link\"></i></span></p></div>","slug":"Lambda","updated":"2019-06-06T08:21:20.053Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/95b963ee/","excerpt":"1. å‰è¨€æœ¬æ–‡ä»£ç æµ‹è¯•ç¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Šå®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–ã€‹ï¼Œé€‚ç”¨äºâ€œGCC-9.1.0â€ã€‚æœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®é™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperator ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æ„ä½“å®é™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æ§åˆ¶ï¼‰ã€‚å¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æ„ä½“ï¼‰ï¼Œå®é™…ä¸Šä¹Ÿç¡®å®å¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚","categories":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/tags/C/"}]},{"title":"C++ æ¨¡æ¿åç‰¹åŒ–ï¼æ¥è‡ªSTLçš„æ€è€ƒ","date":"2019-05-31T06:29:52.000Z","path":"posts/2a215b70/","text":"ä¹‹å‰å­¦ä¹ STLæ—¶æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›å‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€STLä»å¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›å‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–å…ˆç®€è¦å›é¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸ç±»æ¨¡æ¿å‡½æ•°æ¨¡æ¿12345678910template&lt;class T&gt;T add(T a, T b) &#123; return a + b;&#125;int main()&#123; int a = 1, b = 2; std::cout &lt;&lt; add(a + b) &lt;&lt; std::endl; return 0;&#125;å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å®ä¾‹åŒ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå®å‚ç±»å‹æ¨å¯¼ä¸Šé¢ç±»å‹Tå°±è¢«è‡ªåŠ¨æ¨å¯¼ä¸ºintç±»å‹ç±»æ¨¡æ¿12345678910111213141516templete&lt;class T&gt;class A&#123;public: explicit A(T val) : t(val) &#123; &#125; T add(T x) &#123; return t + y; &#125; privete: T t;&#125;;int main()&#123; A&lt;int&gt; a(10); std::cout &lt;&lt; a.add(5) &lt;&lt; std::endl; return 0;&#125;å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„ç±»æ¨¡æ¿ï¼Œå®ä¾‹åŒ–ç±»æ¨¡æ¿å¿…é¡»è¦æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨æ— æ³•ä¸ºç±»æ¨¡æ¿è‡ªåŠ¨æ¨å¯¼ç±»å‹å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼‘ï¼ç±»æ¨¡æ¿çš„å’Œå‡½æ•°æ¨¡æ¿éƒ½å¿…é¡»å®šä¹‰åœ¨.hå¤´æ–‡ä»¶ä¸­ï¼’ï¼æ¨¡æ¿çš„å®ä¾‹åŒ–ç±»å‹ç¡®å®šæ˜¯åœ¨ç¼–è¯‘æœŸé—´ï¼“ï¼åªæ˜¯æ¨¡æ¿å†™å¥½äº†ï¼Œç¼–è¯‘ä¸€èˆ¬ä¸ä¼šå¾ˆå¤šå‡ºé”™ï¼Œå‡ºé”™ä¸€èˆ¬ä¼šåœ¨å®ä¾‹åŒ–ç¼–è¯‘ä¹‹åï¼”ï¼æ¨¡æ¿å®ä¾‹åŒ–åªä¼šå®ä¾‹åŒ–ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†å°†ä¸ä¼šè¢«å®ä¾‹åŒ–æˆ‘è§‰å¾—æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–æ˜¯æ¨¡æ¿ä¸­æ¯”è¾ƒç²¾é«“çš„ä¸œè¥¿æœ‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œå…¶ä¸­åˆåˆ†ä¸ºå…¨ç‰¹åŒ–ä¸åç‰¹åŒ–ä¸»è¦çš„ç”¨é€”éƒ½æ˜¯å¯¹äºç‰¹å®šçš„ç±»å‹ï¼ŒæŒ‡å®šç‰¹å®šçš„å¤„ç†æ–¹å¼å°±ç›¸å½“äºæ™®é€šç¼–ç¨‹ä¸­if-else if - elseè¿™æ ·çš„æ–¹å¼ç¼–è¯‘é˜¶æ®µç¡®å®šå¦‚æœæ˜¯æŸä¸ªç‰¹åŒ–ç±»å‹ï¼Œå°±ç”¨ç‰¹åŒ–çš„æ¨¡æ¿å¦‚æœéƒ½ä¸æ˜¯ï¼Œå°±ç”¨æœ€ä¸€èˆ¬çš„æ¨¡æ¿å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–å‡½æ•°æ¨¡æ¿åªèƒ½å…¨ç‰¹åŒ–ï¼Œä¸èƒ½åç‰¹åŒ–ï¼Œå¦‚æœè¦åç‰¹åŒ–çš„è¯åªèƒ½é‡è½½å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–1234567891011template&lt; &gt; // å…¨ç‰¹åŒ– æ³¨æ„è¯­æ³•double add(double a, double b) &#123; return a + b; &#125;int main()&#123; int x = 10, y = 20; double z = 1.1, w = 2.2; std::cout &lt;&lt; add(x, y) &lt;&lt; std::endl; // è°ƒç”¨æ™®é€šç‰ˆæœ¬ std::cout &lt;&lt; add(z, w) &lt;&lt; std::endl; // è°ƒç”¨å…¨ç‰¹åŒ–ç‰ˆæœ¬ return 0;&#125;å¦‚æœæœ‰ä¸å®å‚æ›´åŠ åŒ¹é…çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨å°†ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–ç‰ˆæœ¬å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰å› ä¸ºåç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¨¡æ¿ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥é‡è½½ä¸€ä¸ªå‡½æ•°æ¨¡æ¿12345678910template&lt;class T1&gt; // é‡è½½ç‰ˆæœ¬ï¼Œæ¥æ”¶å‚æ•°ä¸ºæŒ‡é’ˆT1 add(T1* a, T1* b) &#123; return *a + *b; &#125; int main()&#123; int a = 10, b = 20; int *x = &amp;a, *y = &amp;b; add(a, b); // è°ƒç”¨æ™®é€šæ¨¡æ¿ add(x, y); // è°ƒç”¨é‡è½½çš„æ¨¡æ¿ return 0;&#125;å¦‚ä¸Šï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ¥æ”¶æŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨é‡è½½æ¨¡æ¿å®ç°å‡½æ•°æ¨¡æ¿ä¸å­˜åœ¨åç‰¹åŒ–ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿æ—¢æœ‰å…¨ç‰¹åŒ–ï¼Œåˆæœ‰åç‰¹åŒ–è¿™é‡Œé‡æ–°å†™ä¸€ä¸ªæ›´ä¸€èˆ¬çš„æ¨¡æ¿ç±»æ¥è¯´æ˜ç±»æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿å…¨ç‰¹åŒ–æ¯”è¾ƒå¥½ç†è§£ï¼Œè·Ÿå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå…¨ç‰¹åŒ–æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå½“ç¼–è¯‘å™¨åŒ¹é…æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‚æ•°ä¸€è‡´çš„å®ä¾‹123456789template&lt; &gt; // æ³¨æ„è¯­æ³•class A&lt;char*&gt; // ä¸€ä¸ªå…¨ç‰¹åŒ–çš„æ¨¡æ¿ç±»A&#123; // å½“ç”¨char*ç±»å‹æ¥å®ä¾‹åŒ–ç±»æ¨¡æ¿Aæ—¶ï¼Œå°†ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªå…¨ç‰¹åŒ–å®ä¾‹public: explicit A(char* val) : t(val) &#123; &#125; char* add(char* a, char* b) &#123; return strcat(a, b); &#125;private: char* t;&#125;;ç±»æ¨¡æ¿çš„åç‰¹åŒ–ç±»æ¨¡æ¿çš„åç‰¹åŒ–ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒæœ‰å¤šç§å½¢å¼ç±»æ¨¡æ¿åç‰¹åŒ–æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡å®šéƒ¨åˆ†ç±»å‹ï¼Œè®©åç‰¹åŒ–ç‰ˆæœ¬ç§°ä¸ºæ™®é€šç‰ˆæœ¬çš„å­é›†ï¼Œè‹¥å®ä¾‹åŒ–æ—¶å‚æ•°ç±»å‹ä¸ºæŒ‡å®šçš„ç±»å‹ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ç¬¬ä¸€ç§å½¢å¼12345template&lt;class T1, class T2&gt; // æ™®é€šç‰ˆæœ¬ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°class B &#123; ..... &#125;;template&lt;class T2&gt; // åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒæŒ‡å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå³æŒ‡å®šäº†éƒ¨åˆ†ç±»å‹class B&lt;int , T2&gt; &#123; ..... &#125;; // å½“å®ä¾‹åŒ–æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºint åˆ™ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªç‰ˆæœ¬ç¬¬äºŒç§å½¢å¼ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ç‰ˆæœ¬12345678template&lt;class T&gt; // æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt; //è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥æ”¶æŒ‡é’ˆç±»å‹çš„æ¨¡æ¿å®å‚ class B&lt;T*&gt; &#123; ..... &#125;; template&lt;class T&gt;class B&lt;T&amp;&gt; &#123; ..... &#125;; // è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥å—å¼•ç”¨ç±»å‹çš„æ¨¡æ¿å®å‚ç¬¬ä¸‰ç§å½¢å¼12345template&lt;class T&gt; //æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt; // è¿™ç§åªæ¥å—ç”¨Tå®ä¾‹åŒ–çš„vectorçš„æ¨¡æ¿å®å‚ï¼ä¹Ÿæ˜¯ä¸€ç§åç‰¹åŒ–class B&lt;vector&lt;T&gt;&gt; &#123; ...... &#125;;å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼‘ï¼ç‰¹ä¾‹åŒ–æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬é¡¶æ›¿äº†ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸®ç¼–è¯‘å™¨åšäº†ç±»å‹æ¨å¯¼ï¼’ï¼å…¨ç‰¹åŒ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œåç‰¹åŒ–æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œåªæ˜¯åŸæ¥æ¨¡æ¿çš„ä¸€ä¸ªå­é›†ï¼“ï¼æ‰€ä»¥å…¨ç‰¹åŒ–çš„å‡½æ•°æ¨¡æ¿ï¼Œæœ¬è´¨ä¸Šæ˜¯å®ä¾‹ï¼Œä»è€Œä¸ä¼šä¸å‡½æ•°æ¨¡æ¿äº§ç”ŸäºŒä¹‰æ€§ï¼”ï¼è‹¥æƒ³è®©ç”¨æˆ·èƒ½ä½¿ç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬å¿…é¡»ä¸æ¨¡æ¿å®šä¹‰åœ¨åŒä¸€ä¸ª.hå¤´æ–‡ä»¶ä¸­STLä¸­çš„è¿­ä»£å™¨å®ç°ä¸é«˜æ•ˆå®ç°ä¸æ¨¡æ¿åç‰¹åŒ–æ¯æ¯ç›¸å…³ï¼ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STLåç‰¹åŒ–åœ¨STLä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåº”ç”¨ï¼‘ï¼åº”ç”¨åœ¨è¿­ä»£å™¨è®¾è®¡ä¸­ï¼Œä¸ºäº†ä½¿è¿­ä»£å™¨æ—¢å¯ä»¥èƒå–å‡ºå€¼ç±»å‹ï¼Œåˆå¯ä»¥åŒ…å®¹åŸç”ŸæŒ‡é’ˆå¦‚æœè¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å°±èƒ½çŸ¥é“å®ƒçš„å€¼ç±»å‹ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šä½¿ç”¨iterator_traitsè¿­ä»£å™¨èƒå–æŠ€æœ¯çš„ä¸¤ä¸ªæ ¸å¿ƒæ˜¯ï¼šï¼‘ï¼‰åœ¨æ¯ä¸ªè¿­ä»£å™¨ç±»ä¸­å®šä¹‰value_typeå€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼Œè¿™æ ·ç›´æ¥é€šè¿‡è¿­ä»£å™¨çš„value_typeç±»å‹æˆå‘˜å°±å¯ä»¥çŸ¥é“å€¼ç±»å‹ï¼’ï¼‰é—®é¢˜å°±åœ¨äºï¼Œè¿­ä»£å™¨å¿…é¡»å…¼å®¹åŸç”ŸæŒ‡é’ˆï¼Œè€ŒåŸç”ŸæŒ‡é’ˆå¾ˆéš¾è¢«é‡æ–°å®šä¹‰ï¼Œå³è¦åœ¨åŸç”ŸæŒ‡é’ˆçš„ç±»ä¸­æ·»åŠ value_typeçš„å€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼è¿™æ—¶å€™ï¼Œé çš„å°±æ˜¯ç±»æ¨¡æ¿çš„åç‰¹åŒ–äº†ï¼æ–°æ·»åŠ ä¸€å±‚iterator_traitsç±»ï¼Œä¸“é—¨èƒå–è¿­ä»£å™¨çš„å±æ€§ï¼Œç„¶åå†å¯¹iterator_traitsç±»è®¾è®¡åŸç”ŸæŒ‡é’ˆä¸åŸç”Ÿå¼•ç”¨çš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå°±è§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼’ï¼ type_traitsç±»å‹èƒå–ï¼Œå¯¹å¾…ç‰¹æ®Šç±»å‹ï¼Œç‰¹æ®Šå¤„ç†ï¼Œæé«˜æ•ˆç‡å¯¹äºæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ç­‰çš„å†…ç½®ç±»å‹ï¼Œå¦‚æœä¸å¤æ‚ç±»å‹ä¸€æ ·ï¼Œæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ•ˆç‡ä¸é«˜çš„å…ˆå®ç°ä¸€ä¸ªå¯¹æ‰€æœ‰ç±»å‹éƒ½è®¾ç½®ä¸€ä¸ªæœ€ä¿å®ˆå€¼çš„type_traitsæ¨¡æ¿ç±»ï¼Œç„¶åå†å¯¹æ¯ä¸ªå†…ç½®ç±»å‹è®¾ç½®åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå†…ç½®ç±»å‹è®¾ç½®ä¸€ä¸ªæ›´ä¸ºæ¿€è¿›çš„å€¼ï¼Œè¡¨æ˜å¯ä»¥é‡‡å–æ›´ä¸ºé«˜æ•ˆçš„æ“ä½œæ¥æé«˜æ•ˆç‡æ¯”å¦‚copyå‡½æ•°ï¼Œå¦‚æœä¼ é€’çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œé‚£ä¹ˆå¯èƒ½åªèƒ½é‡‡å–æœ€ä¿å®ˆçš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ„é€ ï¼›å¦‚æœæ˜¯å†…ç½®ç±»å‹ï¼Œè¿™æ ·æ˜¾ç„¶å¤ªä½æ•ˆï¼Œä½¿ç”¨memcpy()å¯èƒ½ä¼šå¥½ä¸€äº›å…¶å®iterator_traitsä¹Ÿä¸æ­¢æ˜¯å¤„ç†å…¼å®¹åŸç”ŸæŒ‡é’ˆçš„é—®é¢˜ï¼Œå®ƒä¹Ÿå¯ä»¥æé«˜æ•ˆç‡ï¼è¿­ä»£å™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰å¯ä»¥éšæœºè®¿é—®çš„ï¼ˆvectorï¼‰ï¼Œæœ‰åªèƒ½å‰åä¸€ä¸ªä¸€ä¸ªç§»åŠ¨çš„ï¼ˆlistï¼‰,ä¹Ÿæœ‰åªèƒ½å•å‘ç§»åŠ¨çš„ï¼ˆslistï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æŠŠè¿­ä»£å™¨åˆ†ä¸ºäº”ç§ï¼šInputIterator è¾“å…¥è¿­ä»£å™¨OutputIterator è¾“å‡ºè¿­ä»£å™¨ForwardIterator å•å‘è¿­ä»£å™¨BidirectionIterator åŒå‘è¿­ä»£å™¨RandomAccessIterator éšæœºè®¿é—®è¿­ä»£å™¨æ¯”å¦‚ä¸€ä¸ªadvance(n)å‡½æ•°ï¼Œå¯¹äºå•å‘è¿­ä»£å™¨åªèƒ½ä¸€ä¸ªä¸€ä¸ªç§»åŠ¨è¿‡å»ï¼Œä½†æ˜¯è¿™ç§å®ç°å¯¹äºéšæœºè®¿é—®è¿­ä»£å™¨æ˜¾ç„¶ä¸æ˜¯ç†æƒ³çš„å¤„ç†æ–¹å¼å¤„ç†çš„æ–¹å¼å°±æ˜¯å…ˆå®ç°è¿™äº”ä¸ªç±»ï¼Œç”¨ä½œæ ‡è®°ç”¨ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å™¨é‡Œé¢éƒ½å®šä¹‰è¿­ä»£å™¨ç±»å‹çš„ç±»å‹æˆå‘˜iterator_catagoryï¼Œå†å¯¹ä¸åŒç‰ˆæœ¬çš„è¿­ä»£å™¨å®ç°ä¸åŒçš„advance(n)å¤„ç†æ–¹å¼æ¯”å¦‚stlä¸­æ·»åŠ å³å€¼å¼•ç”¨å…ƒæ¨¡æ¿çš„å®ç°ï¼š1234567891011121314template&lt;typename _Tp, bool = __and_&lt;__not_&lt;is_reference&lt;_Tp&gt;&gt;, __not_&lt;is_void&lt;_Tp&gt;&gt;&gt;::value&gt; struct __add_rvalue_reference_helper &#123;typedef __Tp type; &#125;;template&lt;typename _Tp&gt; struct __add_rvalue_reference_helper&lt;__Tp, true&gt; &#123;typedef __Tp&amp;&amp; type; &#125;; template&lt;typename _Tp&gt;struct add_rvalue_reference: public __add_rvalue_reference_helper&lt;_Tp&gt;&#123; &#125;;å¯ä»¥å‘ç°è°ƒç”¨æ—¶ä¸€èˆ¬ä¸ºstatic_cast&lt;typenameadd_rvalue_reference&lt;T&gt;::type&gt;(__t),é¦–å…ˆä¼šåŒ¹é…æ³›åŒ–ç‰ˆæœ¬çš„å…ƒæ¨¡æ¿ç±»ï¼Œç¬¬äºŒä¸ªæ¨¡ç‰ˆå‚æ•°boolä¼šåŒ¹é…_Tpçš„ç±»å‹ï¼Œå¦‚æœåŸæ¥ä¸æ˜¯å¼•ç”¨ç±»å‹çš„è¯å°±ç›´æ¥åŒ¹é…trueçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œå¦åˆ™falseä¸ºåŸæ³›åŒ–ç‰ˆæœ¬ã€‚çŸ­çŸ­å‡ è¡Œä»£ç å·²ç»å±•ç¤ºå‡ºäº†æ¨¡æ¿å/å…¨ç‰¹åŒ–çš„å¼ºå¤§åŒ¹é…åŠŸèƒ½ï¼","raw":"---\ntitle: C++ æ¨¡æ¿åç‰¹åŒ–ï¼æ¥è‡ªSTLçš„æ€è€ƒ\ntags: C++\ncategories: C++\nabbrlink: 2a215b70\ndate: 2019-05-31 14:29:52\ncopyright: true\ntype:\nkeyword:\ntop:\ncomments:\npassword:\ndescription:\n---\n\nä¹‹å‰å­¦ä¹ STLæ—¶æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›å‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€\nSTLä»å¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›å‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–\n\n-----------------------\n\n* å…ˆç®€è¦å›é¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸ç±»æ¨¡æ¿\n\n## å‡½æ•°æ¨¡æ¿\n\n```\n\ntemplate<class T>\nT add(T a, T b) { return a + b;}\n\nint main()\n{\n    int a = 1, b = 2;\n    std::cout << add(a + b) << std::endl;\n    return 0;\n}\n\n```\n\n<!-- more -->\n\nå¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å®ä¾‹åŒ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå®å‚ç±»å‹æ¨å¯¼\nä¸Šé¢ç±»å‹Tå°±è¢«è‡ªåŠ¨æ¨å¯¼ä¸ºintç±»å‹\n\n## ç±»æ¨¡æ¿\n\n```\ntemplete<class T>\nclass A\n{\npublic:\n    explicit A(T val) : t(val) { }\n    T add(T x) { return t + y; }    \nprivete:\n    T t;\n};\n\nint main()\n{\n    A<int> a(10);\n    std::cout << a.add(5) << std::endl;\n    return 0;\n}\n```\n\nå¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„ç±»æ¨¡æ¿ï¼Œå®ä¾‹åŒ–ç±»æ¨¡æ¿å¿…é¡»è¦æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨æ— æ³•ä¸ºç±»æ¨¡æ¿è‡ªåŠ¨æ¨å¯¼ç±»å‹\n\n### å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹\n\n* ï¼‘ï¼ç±»æ¨¡æ¿çš„å’Œå‡½æ•°æ¨¡æ¿éƒ½å¿…é¡»å®šä¹‰åœ¨.hå¤´æ–‡ä»¶ä¸­\n\n* ï¼’ï¼æ¨¡æ¿çš„å®ä¾‹åŒ–ç±»å‹ç¡®å®šæ˜¯åœ¨ç¼–è¯‘æœŸé—´\n\n* ï¼“ï¼åªæ˜¯æ¨¡æ¿å†™å¥½äº†ï¼Œç¼–è¯‘ä¸€èˆ¬ä¸ä¼šå¾ˆå¤šå‡ºé”™ï¼Œå‡ºé”™ä¸€èˆ¬ä¼šåœ¨å®ä¾‹åŒ–ç¼–è¯‘ä¹‹å\n\n* ï¼”ï¼æ¨¡æ¿å®ä¾‹åŒ–åªä¼šå®ä¾‹åŒ–ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†å°†ä¸ä¼šè¢«å®ä¾‹åŒ–\n\n-------------\n\næˆ‘è§‰å¾—æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–æ˜¯æ¨¡æ¿ä¸­æ¯”è¾ƒç²¾é«“çš„ä¸œè¥¿\næœ‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œå…¶ä¸­åˆåˆ†ä¸ºå…¨ç‰¹åŒ–ä¸åç‰¹åŒ–\nä¸»è¦çš„ç”¨é€”éƒ½æ˜¯å¯¹äºç‰¹å®šçš„ç±»å‹ï¼ŒæŒ‡å®šç‰¹å®šçš„å¤„ç†æ–¹å¼\nå°±ç›¸å½“äºæ™®é€šç¼–ç¨‹ä¸­if-else if - elseè¿™æ ·çš„æ–¹å¼\nç¼–è¯‘é˜¶æ®µç¡®å®šå¦‚æœæ˜¯æŸä¸ªç‰¹åŒ–ç±»å‹ï¼Œå°±ç”¨ç‰¹åŒ–çš„æ¨¡æ¿\nå¦‚æœéƒ½ä¸æ˜¯ï¼Œå°±ç”¨æœ€ä¸€èˆ¬çš„æ¨¡æ¿\n\n## å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–\n\nå‡½æ•°æ¨¡æ¿åªèƒ½å…¨ç‰¹åŒ–ï¼Œ{% label primary@ä¸èƒ½åç‰¹åŒ– %}ï¼Œå¦‚æœè¦åç‰¹åŒ–çš„è¯åªèƒ½é‡è½½\n\n### å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–\n\n```\ntemplate< >                                  // å…¨ç‰¹åŒ–ã€€æ³¨æ„è¯­æ³•\ndouble add(double a, double b)  { return a + b; }\n\nint main()\n{\n    int x = 10, y = 20;\n    double z = 1.1, w = 2.2;\n    std::cout << add(x, y) << std::endl;   // è°ƒç”¨æ™®é€šç‰ˆæœ¬\n    std::cout << add(z, w) << std::endl;   // è°ƒç”¨å…¨ç‰¹åŒ–ç‰ˆæœ¬\n    return 0;\n}\n```\n\nå¦‚æœæœ‰ä¸å®å‚æ›´åŠ åŒ¹é…çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨å°†ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–ç‰ˆæœ¬\n\n### å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰\n\nå› ä¸ºåç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¨¡æ¿ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥é‡è½½ä¸€ä¸ªå‡½æ•°æ¨¡æ¿\n\n```\ntemplate<class T1>ã€€ã€€// é‡è½½ç‰ˆæœ¬ï¼Œæ¥æ”¶å‚æ•°ä¸ºæŒ‡é’ˆ\nT1 add(T1* a, T1* b) { return *a + *b; }   \nint main()\n{\n    int a = 10, b = 20;\n    int *x = &a, *y = &b;\n    add(a, b);    // è°ƒç”¨æ™®é€šæ¨¡æ¿\n    add(x, y);ã€€  // è°ƒç”¨é‡è½½çš„æ¨¡æ¿\n    return 0;\n}\n```\nå¦‚ä¸Šï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ¥æ”¶æŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨é‡è½½æ¨¡æ¿å®ç°\nå‡½æ•°æ¨¡æ¿ä¸å­˜åœ¨åç‰¹åŒ–\n\n## ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–\n\nç±»æ¨¡æ¿æ—¢æœ‰å…¨ç‰¹åŒ–ï¼Œåˆæœ‰åç‰¹åŒ–\nè¿™é‡Œé‡æ–°å†™ä¸€ä¸ªæ›´ä¸€èˆ¬çš„æ¨¡æ¿ç±»æ¥è¯´æ˜ç±»æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–\n\nç±»æ¨¡æ¿å…¨ç‰¹åŒ–æ¯”è¾ƒå¥½ç†è§£ï¼Œè·Ÿå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå…¨ç‰¹åŒ–æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå½“ç¼–è¯‘å™¨åŒ¹é…æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‚æ•°ä¸€è‡´çš„å®ä¾‹\n\n```\ntemplate< >     ã€€ã€€ã€€// æ³¨æ„è¯­æ³•\nclass A<char*>       // ä¸€ä¸ªå…¨ç‰¹åŒ–çš„æ¨¡æ¿ç±»A\n{                    // å½“ç”¨char*ç±»å‹æ¥å®ä¾‹åŒ–ç±»æ¨¡æ¿Aæ—¶ï¼Œå°†ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªå…¨ç‰¹åŒ–å®ä¾‹\npublic:\n    explicit A(char* val) : t(val) { }\n    char* add(char* a, char* b) { return strcat(a, b); }\nprivate:\n    char* t;\n};\n```\n\n## ç±»æ¨¡æ¿çš„åç‰¹åŒ–\n\nç±»æ¨¡æ¿çš„åç‰¹åŒ–ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒæœ‰å¤šç§å½¢å¼\nç±»æ¨¡æ¿åç‰¹åŒ–æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡å®šéƒ¨åˆ†ç±»å‹ï¼Œè®©åç‰¹åŒ–ç‰ˆæœ¬ç§°ä¸ºæ™®é€šç‰ˆæœ¬çš„å­é›†ï¼Œè‹¥å®ä¾‹åŒ–æ—¶å‚æ•°ç±»å‹ä¸ºæŒ‡å®šçš„ç±»å‹ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬\nç¬¬ä¸€ç§å½¢å¼\n\n```\ntemplate<class T1, class T2>      // æ™®é€šç‰ˆæœ¬ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°\nclass B { ..... };\n\ntemplate<class T2>ã€€ã€€ã€€         // åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒæŒ‡å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå³æŒ‡å®šäº†éƒ¨åˆ†ç±»å‹\nclass B<int , T2> { ..... };ã€€ã€€// å½“å®ä¾‹åŒ–æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºint åˆ™ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªç‰ˆæœ¬\n```\n\nç¬¬äºŒç§å½¢å¼ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ç‰ˆæœ¬\n\n```\ntemplate<class T>     // æ™®é€šç‰ˆæœ¬\nclass B { ..... };\n\ntemplate<class T>ã€€ã€€ã€€//è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥æ”¶æŒ‡é’ˆç±»å‹çš„æ¨¡æ¿å®å‚ \nclass B<T*> { ..... }; \n\ntemplate<class T>\nclass B<T&> { ..... };     // è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥å—å¼•ç”¨ç±»å‹çš„æ¨¡æ¿å®å‚\n```\n\nç¬¬ä¸‰ç§å½¢å¼\n\n```\ntemplate<class T>    //æ™®é€šç‰ˆæœ¬\nclass B { ..... };\n\ntemplate<class T>ã€€ã€€ã€€// è¿™ç§åªæ¥å—ç”¨Tå®ä¾‹åŒ–çš„vectorçš„æ¨¡æ¿å®å‚ï¼ä¹Ÿæ˜¯ä¸€ç§åç‰¹åŒ–\nclass B<vector<T>> { ......  };  \n```\n\n<strong>å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹</strong>\n\n* ï¼‘ï¼ç‰¹ä¾‹åŒ–æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬é¡¶æ›¿äº†ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸®ç¼–è¯‘å™¨åšäº†ç±»å‹æ¨å¯¼\n* ï¼’ï¼å…¨ç‰¹åŒ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œåç‰¹åŒ–æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œåªæ˜¯åŸæ¥æ¨¡æ¿çš„ä¸€ä¸ªå­é›†\n* ï¼“ï¼æ‰€ä»¥å…¨ç‰¹åŒ–çš„å‡½æ•°æ¨¡æ¿ï¼Œæœ¬è´¨ä¸Šæ˜¯å®ä¾‹ï¼Œä»è€Œä¸ä¼šä¸å‡½æ•°æ¨¡æ¿äº§ç”ŸäºŒä¹‰æ€§\n* ï¼”ï¼è‹¥æƒ³è®©ç”¨æˆ·èƒ½ä½¿ç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬å¿…é¡»ä¸æ¨¡æ¿å®šä¹‰åœ¨åŒä¸€ä¸ª.hå¤´æ–‡ä»¶ä¸­\n\n----------\n\nSTLä¸­çš„è¿­ä»£å™¨å®ç°ä¸é«˜æ•ˆå®ç°ä¸æ¨¡æ¿åç‰¹åŒ–æ¯æ¯ç›¸å…³ï¼\n\n## ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STL\n\n<strong>åç‰¹åŒ–åœ¨STLä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåº”ç”¨</strong>\n\nï¼‘ï¼åº”ç”¨åœ¨è¿­ä»£å™¨è®¾è®¡ä¸­ï¼Œä¸ºäº†ä½¿è¿­ä»£å™¨æ—¢å¯ä»¥èƒå–å‡ºå€¼ç±»å‹ï¼Œåˆå¯ä»¥åŒ…å®¹åŸç”ŸæŒ‡é’ˆ\nå¦‚æœè¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å°±èƒ½çŸ¥é“å®ƒçš„å€¼ç±»å‹ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šä½¿ç”¨iterator_traits\nè¿­ä»£å™¨èƒå–æŠ€æœ¯çš„ä¸¤ä¸ªæ ¸å¿ƒæ˜¯ï¼š\n\n* ï¼‘ï¼‰åœ¨æ¯ä¸ªè¿­ä»£å™¨ç±»ä¸­å®šä¹‰value_typeå€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼Œè¿™æ ·ç›´æ¥é€šè¿‡è¿­ä»£å™¨çš„value_typeç±»å‹æˆå‘˜å°±å¯ä»¥çŸ¥é“å€¼ç±»å‹\n* ï¼’ï¼‰é—®é¢˜å°±åœ¨äºï¼Œè¿­ä»£å™¨å¿…é¡»å…¼å®¹åŸç”ŸæŒ‡é’ˆï¼Œè€ŒåŸç”ŸæŒ‡é’ˆå¾ˆéš¾è¢«é‡æ–°å®šä¹‰ï¼Œå³è¦åœ¨åŸç”ŸæŒ‡é’ˆçš„ç±»ä¸­æ·»åŠ value_typeçš„å€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼è¿™æ—¶å€™ï¼Œé çš„å°±æ˜¯ç±»æ¨¡æ¿çš„åç‰¹åŒ–äº†ï¼æ–°æ·»åŠ ä¸€å±‚iterator_traitsç±»ï¼Œä¸“é—¨èƒå–è¿­ä»£å™¨çš„å±æ€§ï¼Œç„¶åå†å¯¹iterator_traitsç±»è®¾è®¡åŸç”ŸæŒ‡é’ˆä¸åŸç”Ÿå¼•ç”¨çš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå°±è§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜\n\nï¼’ï¼{% label success@ type_traits %}ç±»å‹èƒå–ï¼Œå¯¹å¾…ç‰¹æ®Šç±»å‹ï¼Œç‰¹æ®Šå¤„ç†ï¼Œæé«˜æ•ˆç‡\nå¯¹äºæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ç­‰çš„å†…ç½®ç±»å‹ï¼Œå¦‚æœä¸å¤æ‚ç±»å‹ä¸€æ ·ï¼Œæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ•ˆç‡ä¸é«˜çš„\nå…ˆå®ç°ä¸€ä¸ªå¯¹æ‰€æœ‰ç±»å‹éƒ½è®¾ç½®ä¸€ä¸ªæœ€ä¿å®ˆå€¼çš„type_traitsæ¨¡æ¿ç±»ï¼Œç„¶åå†å¯¹æ¯ä¸ªå†…ç½®ç±»å‹è®¾ç½®åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå†…ç½®ç±»å‹è®¾ç½®ä¸€ä¸ªæ›´ä¸ºæ¿€è¿›çš„å€¼ï¼Œè¡¨æ˜å¯ä»¥é‡‡å–æ›´ä¸ºé«˜æ•ˆçš„æ“ä½œæ¥æé«˜æ•ˆç‡\næ¯”å¦‚copyå‡½æ•°ï¼Œå¦‚æœä¼ é€’çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œé‚£ä¹ˆå¯èƒ½åªèƒ½é‡‡å–æœ€ä¿å®ˆçš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ„é€ ï¼›å¦‚æœæ˜¯å†…ç½®ç±»å‹ï¼Œè¿™æ ·æ˜¾ç„¶å¤ªä½æ•ˆï¼Œä½¿ç”¨memcpy()å¯èƒ½ä¼šå¥½ä¸€äº›\n\nå…¶å®iterator_traitsä¹Ÿä¸æ­¢æ˜¯å¤„ç†å…¼å®¹åŸç”ŸæŒ‡é’ˆçš„é—®é¢˜ï¼Œå®ƒä¹Ÿå¯ä»¥æé«˜æ•ˆç‡ï¼\nè¿­ä»£å™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰å¯ä»¥éšæœºè®¿é—®çš„ï¼ˆvectorï¼‰ï¼Œæœ‰åªèƒ½å‰åä¸€ä¸ªä¸€ä¸ªç§»åŠ¨çš„ï¼ˆlistï¼‰,ä¹Ÿæœ‰åªèƒ½å•å‘ç§»åŠ¨çš„ï¼ˆslistï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æŠŠè¿­ä»£å™¨åˆ†ä¸ºäº”ç§ï¼š\n\n* InputIteratorã€€ã€€ã€€ã€€ã€€ã€€ã€€è¾“å…¥è¿­ä»£å™¨\n* OutputIterator ã€€ã€€ã€€ã€€ã€€ ã€€è¾“å‡ºè¿­ä»£å™¨\n* ForwardIteratorã€€ã€€ã€€ã€€ã€€ã€€å•å‘è¿­ä»£å™¨\n* BidirectionIteratorã€€ã€€ã€€ã€€ã€€åŒå‘è¿­ä»£å™¨\n* RandomAccessIteratorã€€ã€€ã€€éšæœºè®¿é—®è¿­ä»£å™¨\n\næ¯”å¦‚ä¸€ä¸ªadvance(n)å‡½æ•°ï¼Œå¯¹äºå•å‘è¿­ä»£å™¨åªèƒ½ä¸€ä¸ªä¸€ä¸ªç§»åŠ¨è¿‡å»ï¼Œä½†æ˜¯è¿™ç§å®ç°å¯¹äºéšæœºè®¿é—®è¿­ä»£å™¨æ˜¾ç„¶ä¸æ˜¯ç†æƒ³çš„å¤„ç†æ–¹å¼\nå¤„ç†çš„æ–¹å¼å°±æ˜¯å…ˆå®ç°è¿™äº”ä¸ªç±»ï¼Œç”¨ä½œæ ‡è®°ç”¨ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å™¨é‡Œé¢éƒ½å®šä¹‰è¿­ä»£å™¨ç±»å‹çš„ç±»å‹æˆå‘˜iterator_catagoryï¼Œå†å¯¹ä¸åŒç‰ˆæœ¬çš„è¿­ä»£å™¨å®ç°ä¸åŒçš„advance(n)å¤„ç†æ–¹å¼\n\næ¯”å¦‚stlä¸­æ·»åŠ å³å€¼å¼•ç”¨å…ƒæ¨¡æ¿çš„å®ç°ï¼š\n\n```\ntemplate<typename _Tp,\n\t\t   bool = __and_<__not_<is_reference<_Tp>>,\n\t\t   \t\t\t\t\t__not_<is_void<_Tp>>>::value>\n\tstruct __add_rvalue_reference_helper\n\t{typedef __Tp   type; };\n\ntemplate<typename _Tp>\n\tstruct __add_rvalue_reference_helper<__Tp, true>\n\t{typedef __Tp&&  type; };\n\t\ntemplate<typename _Tp>\nstruct add_rvalue_reference\n: public __add_rvalue_reference_helper<_Tp>\n{ };\t\t    \t\t\t\t\t\n```\n\nå¯ä»¥å‘ç°è°ƒç”¨æ—¶ä¸€èˆ¬ä¸º`static_cast<typenameadd_rvalue_reference<T>::type>(__t)`,é¦–å…ˆä¼šåŒ¹é…æ³›åŒ–ç‰ˆæœ¬çš„å…ƒæ¨¡æ¿ç±»ï¼Œç¬¬äºŒä¸ªæ¨¡ç‰ˆå‚æ•°boolä¼šåŒ¹é…_Tpçš„ç±»å‹ï¼Œå¦‚æœåŸæ¥ä¸æ˜¯å¼•ç”¨ç±»å‹çš„è¯å°±ç›´æ¥åŒ¹é…trueçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œå¦åˆ™falseä¸ºåŸæ³›åŒ–ç‰ˆæœ¬ã€‚\n\nçŸ­çŸ­å‡ è¡Œä»£ç å·²ç»å±•ç¤ºå‡ºäº†æ¨¡æ¿å/å…¨ç‰¹åŒ–çš„å¼ºå¤§åŒ¹é…åŠŸèƒ½ï¼\n","content":"<p>ä¹‹å‰å­¦ä¹ STLæ—¶æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›å‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€<br>STLä»å¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›å‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–</p><hr><ul><li>å…ˆç®€è¦å›é¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸ç±»æ¨¡æ¿</li></ul><h2 id=\"å‡½æ•°æ¨¡æ¿\"><a href=\"#å‡½æ•°æ¨¡æ¿\" class=\"headerlink\" title=\"å‡½æ•°æ¨¡æ¿\"></a>å‡½æ•°æ¨¡æ¿</h2><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">T</span> <span class=\"title\">add</span>(<span class=\"title\">T</span> <span class=\"title\">a</span>, <span class=\"title\">T</span> <span class=\"title\">b</span>) &#123;</span> <span class=\"keyword\">return</span> a + b;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a = <span class=\"number\">1</span>, b = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; add(a + b) &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><a id=\"more\"></a><p>å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å®ä¾‹åŒ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå®å‚ç±»å‹æ¨å¯¼<br>ä¸Šé¢ç±»å‹Tå°±è¢«è‡ªåŠ¨æ¨å¯¼ä¸ºintç±»å‹</p><h2 id=\"ç±»æ¨¡æ¿\"><a href=\"#ç±»æ¨¡æ¿\" class=\"headerlink\" title=\"ç±»æ¨¡æ¿\"></a>ç±»æ¨¡æ¿</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">templete&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">class</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"function\">explicit <span class=\"title\">A</span><span class=\"params\">(T val)</span> : <span class=\"title\">t</span><span class=\"params\">(val)</span> </span>&#123; &#125;</span><br><span class=\"line\">    <span class=\"function\">T <span class=\"title\">add</span><span class=\"params\">(T x)</span> </span>&#123; <span class=\"keyword\">return</span> t + y; &#125;    </span><br><span class=\"line\">privete:</span><br><span class=\"line\">    T t;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"function\">A&lt;<span class=\"keyword\">int</span>&gt; <span class=\"title\">a</span><span class=\"params\">(<span class=\"number\">10</span>)</span></span>;</span><br><span class=\"line\">    std::cout &lt;&lt; a.add(<span class=\"number\">5</span>) &lt;&lt; std::endl;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„ç±»æ¨¡æ¿ï¼Œå®ä¾‹åŒ–ç±»æ¨¡æ¿å¿…é¡»è¦æŒ‡å®šç±»å‹ï¼Œç¼–è¯‘å™¨æ— æ³•ä¸ºç±»æ¨¡æ¿è‡ªåŠ¨æ¨å¯¼ç±»å‹</p><h3 id=\"å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹\"><a href=\"#å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹\" class=\"headerlink\" title=\"å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹\"></a>å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</h3><ul><li><p>ï¼‘ï¼ç±»æ¨¡æ¿çš„å’Œå‡½æ•°æ¨¡æ¿éƒ½å¿…é¡»å®šä¹‰åœ¨.hå¤´æ–‡ä»¶ä¸­</p></li><li><p>ï¼’ï¼æ¨¡æ¿çš„å®ä¾‹åŒ–ç±»å‹ç¡®å®šæ˜¯åœ¨ç¼–è¯‘æœŸé—´</p></li><li><p>ï¼“ï¼åªæ˜¯æ¨¡æ¿å†™å¥½äº†ï¼Œç¼–è¯‘ä¸€èˆ¬ä¸ä¼šå¾ˆå¤šå‡ºé”™ï¼Œå‡ºé”™ä¸€èˆ¬ä¼šåœ¨å®ä¾‹åŒ–ç¼–è¯‘ä¹‹å</p></li><li><p>ï¼”ï¼æ¨¡æ¿å®ä¾‹åŒ–åªä¼šå®ä¾‹åŒ–ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†å°†ä¸ä¼šè¢«å®ä¾‹åŒ–</p></li></ul><hr><p>æˆ‘è§‰å¾—æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–æ˜¯æ¨¡æ¿ä¸­æ¯”è¾ƒç²¾é«“çš„ä¸œè¥¿<br>æœ‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œå…¶ä¸­åˆåˆ†ä¸ºå…¨ç‰¹åŒ–ä¸åç‰¹åŒ–<br>ä¸»è¦çš„ç”¨é€”éƒ½æ˜¯å¯¹äºç‰¹å®šçš„ç±»å‹ï¼ŒæŒ‡å®šç‰¹å®šçš„å¤„ç†æ–¹å¼<br>å°±ç›¸å½“äºæ™®é€šç¼–ç¨‹ä¸­if-else if - elseè¿™æ ·çš„æ–¹å¼<br>ç¼–è¯‘é˜¶æ®µç¡®å®šå¦‚æœæ˜¯æŸä¸ªç‰¹åŒ–ç±»å‹ï¼Œå°±ç”¨ç‰¹åŒ–çš„æ¨¡æ¿<br>å¦‚æœéƒ½ä¸æ˜¯ï¼Œå°±ç”¨æœ€ä¸€èˆ¬çš„æ¨¡æ¿</p><h2 id=\"å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–\"><a href=\"#å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–\" class=\"headerlink\" title=\"å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–\"></a>å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–</h2><p>å‡½æ•°æ¨¡æ¿åªèƒ½å…¨ç‰¹åŒ–ï¼Œ<span class=\"label primary\">ä¸èƒ½åç‰¹åŒ–</span>ï¼Œå¦‚æœè¦åç‰¹åŒ–çš„è¯åªèƒ½é‡è½½</p><h3 id=\"å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–\"><a href=\"#å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–\" class=\"headerlink\" title=\"å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–\"></a>å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–</h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt; &gt;                                  <span class=\"comment\">// å…¨ç‰¹åŒ–ã€€æ³¨æ„è¯­æ³•</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">double</span> <span class=\"title\">add</span><span class=\"params\">(<span class=\"keyword\">double</span> a, <span class=\"keyword\">double</span> b)</span>  </span>&#123; <span class=\"keyword\">return</span> a + b; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> x = <span class=\"number\">10</span>, y = <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> z = <span class=\"number\">1.1</span>, w = <span class=\"number\">2.2</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; add(x, y) &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;   <span class=\"comment\">// è°ƒç”¨æ™®é€šç‰ˆæœ¬</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; add(z, w) &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;   <span class=\"comment\">// è°ƒç”¨å…¨ç‰¹åŒ–ç‰ˆæœ¬</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰ä¸å®å‚æ›´åŠ åŒ¹é…çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨å°†ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–ç‰ˆæœ¬</p><h3 id=\"å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰\"><a href=\"#å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰\" class=\"headerlink\" title=\"å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰\"></a>å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰</h3><p>å› ä¸ºåç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¨¡æ¿ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥é‡è½½ä¸€ä¸ªå‡½æ•°æ¨¡æ¿</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T1</span>&gt;ã€€ã€€// é‡è½½ç‰ˆæœ¬ï¼Œæ¥æ”¶å‚æ•°ä¸ºæŒ‡é’ˆ</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"title\">T1</span> <span class=\"title\">add</span>(<span class=\"title\">T1</span>* <span class=\"title\">a</span>, <span class=\"title\">T1</span>* <span class=\"title\">b</span>) &#123;</span> <span class=\"keyword\">return</span> *a + *b; &#125;   </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> a = <span class=\"number\">10</span>, b = <span class=\"number\">20</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> *x = &amp;a, *y = &amp;b;</span><br><span class=\"line\">    add(a, b);    <span class=\"comment\">// è°ƒç”¨æ™®é€šæ¨¡æ¿</span></span><br><span class=\"line\">    add(x, y);ã€€  <span class=\"comment\">// è°ƒç”¨é‡è½½çš„æ¨¡æ¿</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªæ¥æ”¶æŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨é‡è½½æ¨¡æ¿å®ç°<br>å‡½æ•°æ¨¡æ¿ä¸å­˜åœ¨åç‰¹åŒ–</p><h2 id=\"ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–\"><a href=\"#ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–\" class=\"headerlink\" title=\"ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–\"></a>ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–</h2><p>ç±»æ¨¡æ¿æ—¢æœ‰å…¨ç‰¹åŒ–ï¼Œåˆæœ‰åç‰¹åŒ–<br>è¿™é‡Œé‡æ–°å†™ä¸€ä¸ªæ›´ä¸€èˆ¬çš„æ¨¡æ¿ç±»æ¥è¯´æ˜ç±»æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–</p><p>ç±»æ¨¡æ¿å…¨ç‰¹åŒ–æ¯”è¾ƒå¥½ç†è§£ï¼Œè·Ÿå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå…¨ç‰¹åŒ–æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œå½“ç¼–è¯‘å™¨åŒ¹é…æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‚æ•°ä¸€è‡´çš„å®ä¾‹</p><figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt; &gt;     ã€€ã€€ã€€<span class=\"comment\">// æ³¨æ„è¯­æ³•</span></span><br><span class=\"line\">class A&lt;<span class=\"keyword\">char</span>*&gt;       <span class=\"comment\">// ä¸€ä¸ªå…¨ç‰¹åŒ–çš„æ¨¡æ¿ç±»A</span></span><br><span class=\"line\">&#123;                    <span class=\"comment\">// å½“ç”¨char*ç±»å‹æ¥å®ä¾‹åŒ–ç±»æ¨¡æ¿Aæ—¶ï¼Œå°†ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªå…¨ç‰¹åŒ–å®ä¾‹</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    <span class=\"keyword\">explicit</span> A(<span class=\"keyword\">char</span>* val) : t(val) &#123; &#125;</span><br><span class=\"line\">    <span class=\"keyword\">char</span>* add(<span class=\"keyword\">char</span>* a, <span class=\"keyword\">char</span>* b) &#123; <span class=\"built_in\">return</span> strcat(a, b); &#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">char</span>* t;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><h2 id=\"ç±»æ¨¡æ¿çš„åç‰¹åŒ–\"><a href=\"#ç±»æ¨¡æ¿çš„åç‰¹åŒ–\" class=\"headerlink\" title=\"ç±»æ¨¡æ¿çš„åç‰¹åŒ–\"></a>ç±»æ¨¡æ¿çš„åç‰¹åŒ–</h2><p>ç±»æ¨¡æ¿çš„åç‰¹åŒ–ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒæœ‰å¤šç§å½¢å¼<br>ç±»æ¨¡æ¿åç‰¹åŒ–æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡å®šéƒ¨åˆ†ç±»å‹ï¼Œè®©åç‰¹åŒ–ç‰ˆæœ¬ç§°ä¸ºæ™®é€šç‰ˆæœ¬çš„å­é›†ï¼Œè‹¥å®ä¾‹åŒ–æ—¶å‚æ•°ç±»å‹ä¸ºæŒ‡å®šçš„ç±»å‹ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬<br>ç¬¬ä¸€ç§å½¢å¼</p><figure class=\"highlight clean\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;<span class=\"keyword\">class</span> T1, <span class=\"keyword\">class</span> T2&gt;      <span class=\"comment\">// æ™®é€šç‰ˆæœ¬ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> B &#123; ..... &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;<span class=\"keyword\">class</span> T2&gt;ã€€ã€€ã€€         <span class=\"comment\">// åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒæŒ‡å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå³æŒ‡å®šäº†éƒ¨åˆ†ç±»å‹</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> B&lt;int , T2&gt; &#123; ..... &#125;;ã€€ã€€<span class=\"comment\">// å½“å®ä¾‹åŒ–æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºint åˆ™ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§å½¢å¼ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ç‰ˆæœ¬</p><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;     // æ™®é€šç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span> &#123; ..... &#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;ã€€ã€€ã€€//è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥æ”¶æŒ‡é’ˆç±»å‹çš„æ¨¡æ¿å®å‚ </span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span>&lt;T*&gt; &#123; ..... &#125;;</span> </span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span>&lt;T&amp;&gt; &#123; ..... &#125;;</span>     /<span class=\"regexp\">/ è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæ¥å—å¼•ç”¨ç±»å‹çš„æ¨¡æ¿å®å‚</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§å½¢å¼</p><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;    //æ™®é€šç‰ˆæœ¬</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span> &#123; ..... &#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;<span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">T</span>&gt;ã€€ã€€ã€€// è¿™ç§åªæ¥å—ç”¨<span class=\"title\">T</span>å®ä¾‹åŒ–çš„<span class=\"title\">vector</span>çš„æ¨¡æ¿å®å‚ï¼ä¹Ÿæ˜¯ä¸€ç§åç‰¹åŒ–</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span>&lt;vector&lt;T&gt;&gt; &#123; ......  &#125;;</span></span><br></pre></td></tr></table></figure><p><strong>å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹</strong></p><ul><li>ï¼‘ï¼ç‰¹ä¾‹åŒ–æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬é¡¶æ›¿äº†ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸®ç¼–è¯‘å™¨åšäº†ç±»å‹æ¨å¯¼</li><li>ï¼’ï¼å…¨ç‰¹åŒ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œåç‰¹åŒ–æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œåªæ˜¯åŸæ¥æ¨¡æ¿çš„ä¸€ä¸ªå­é›†</li><li>ï¼“ï¼æ‰€ä»¥å…¨ç‰¹åŒ–çš„å‡½æ•°æ¨¡æ¿ï¼Œæœ¬è´¨ä¸Šæ˜¯å®ä¾‹ï¼Œä»è€Œä¸ä¼šä¸å‡½æ•°æ¨¡æ¿äº§ç”ŸäºŒä¹‰æ€§</li><li>ï¼”ï¼è‹¥æƒ³è®©ç”¨æˆ·èƒ½ä½¿ç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬å¿…é¡»ä¸æ¨¡æ¿å®šä¹‰åœ¨åŒä¸€ä¸ª.hå¤´æ–‡ä»¶ä¸­</li></ul><hr><p>STLä¸­çš„è¿­ä»£å™¨å®ç°ä¸é«˜æ•ˆå®ç°ä¸æ¨¡æ¿åç‰¹åŒ–æ¯æ¯ç›¸å…³ï¼</p><h2 id=\"ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STL\"><a href=\"#ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STL\" class=\"headerlink\" title=\"ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STL\"></a>ç±»æ¨¡æ¿åç‰¹åŒ–ä¸STL</h2><p><strong>åç‰¹åŒ–åœ¨STLä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåº”ç”¨</strong></p><p>ï¼‘ï¼åº”ç”¨åœ¨è¿­ä»£å™¨è®¾è®¡ä¸­ï¼Œä¸ºäº†ä½¿è¿­ä»£å™¨æ—¢å¯ä»¥èƒå–å‡ºå€¼ç±»å‹ï¼Œåˆå¯ä»¥åŒ…å®¹åŸç”ŸæŒ‡é’ˆ<br>å¦‚æœè¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å°±èƒ½çŸ¥é“å®ƒçš„å€¼ç±»å‹ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šä½¿ç”¨iterator_traits<br>è¿­ä»£å™¨èƒå–æŠ€æœ¯çš„ä¸¤ä¸ªæ ¸å¿ƒæ˜¯ï¼š</p><ul><li>ï¼‘ï¼‰åœ¨æ¯ä¸ªè¿­ä»£å™¨ç±»ä¸­å®šä¹‰value_typeå€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼Œè¿™æ ·ç›´æ¥é€šè¿‡è¿­ä»£å™¨çš„value_typeç±»å‹æˆå‘˜å°±å¯ä»¥çŸ¥é“å€¼ç±»å‹</li><li>ï¼’ï¼‰é—®é¢˜å°±åœ¨äºï¼Œè¿­ä»£å™¨å¿…é¡»å…¼å®¹åŸç”ŸæŒ‡é’ˆï¼Œè€ŒåŸç”ŸæŒ‡é’ˆå¾ˆéš¾è¢«é‡æ–°å®šä¹‰ï¼Œå³è¦åœ¨åŸç”ŸæŒ‡é’ˆçš„ç±»ä¸­æ·»åŠ value_typeçš„å€¼ç±»å‹çš„ç±»å‹æˆå‘˜ï¼è¿™æ—¶å€™ï¼Œé çš„å°±æ˜¯ç±»æ¨¡æ¿çš„åç‰¹åŒ–äº†ï¼æ–°æ·»åŠ ä¸€å±‚iterator_traitsç±»ï¼Œä¸“é—¨èƒå–è¿­ä»£å™¨çš„å±æ€§ï¼Œç„¶åå†å¯¹iterator_traitsç±»è®¾è®¡åŸç”ŸæŒ‡é’ˆä¸åŸç”Ÿå¼•ç”¨çš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå°±è§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜</li></ul><p>ï¼’ï¼<span class=\"label success\"> type_traits</span>ç±»å‹èƒå–ï¼Œå¯¹å¾…ç‰¹æ®Šç±»å‹ï¼Œç‰¹æ®Šå¤„ç†ï¼Œæé«˜æ•ˆç‡<br>å¯¹äºæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œææ„å‡½æ•°ç­‰çš„å†…ç½®ç±»å‹ï¼Œå¦‚æœä¸å¤æ‚ç±»å‹ä¸€æ ·ï¼Œæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ•ˆç‡ä¸é«˜çš„<br>å…ˆå®ç°ä¸€ä¸ªå¯¹æ‰€æœ‰ç±»å‹éƒ½è®¾ç½®ä¸€ä¸ªæœ€ä¿å®ˆå€¼çš„type_traitsæ¨¡æ¿ç±»ï¼Œç„¶åå†å¯¹æ¯ä¸ªå†…ç½®ç±»å‹è®¾ç½®åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå†…ç½®ç±»å‹è®¾ç½®ä¸€ä¸ªæ›´ä¸ºæ¿€è¿›çš„å€¼ï¼Œè¡¨æ˜å¯ä»¥é‡‡å–æ›´ä¸ºé«˜æ•ˆçš„æ“ä½œæ¥æé«˜æ•ˆç‡<br>æ¯”å¦‚copyå‡½æ•°ï¼Œå¦‚æœä¼ é€’çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œé‚£ä¹ˆå¯èƒ½åªèƒ½é‡‡å–æœ€ä¿å®ˆçš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æ„é€ ï¼›å¦‚æœæ˜¯å†…ç½®ç±»å‹ï¼Œè¿™æ ·æ˜¾ç„¶å¤ªä½æ•ˆï¼Œä½¿ç”¨memcpy()å¯èƒ½ä¼šå¥½ä¸€äº›</p><p>å…¶å®iterator_traitsä¹Ÿä¸æ­¢æ˜¯å¤„ç†å…¼å®¹åŸç”ŸæŒ‡é’ˆçš„é—®é¢˜ï¼Œå®ƒä¹Ÿå¯ä»¥æé«˜æ•ˆç‡ï¼<br>è¿­ä»£å™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰å¯ä»¥éšæœºè®¿é—®çš„ï¼ˆvectorï¼‰ï¼Œæœ‰åªèƒ½å‰åä¸€ä¸ªä¸€ä¸ªç§»åŠ¨çš„ï¼ˆlistï¼‰,ä¹Ÿæœ‰åªèƒ½å•å‘ç§»åŠ¨çš„ï¼ˆslistï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æŠŠè¿­ä»£å™¨åˆ†ä¸ºäº”ç§ï¼š</p><ul><li>InputIteratorã€€ã€€ã€€ã€€ã€€ã€€ã€€è¾“å…¥è¿­ä»£å™¨</li><li>OutputIterator ã€€ã€€ã€€ã€€ã€€ ã€€è¾“å‡ºè¿­ä»£å™¨</li><li>ForwardIteratorã€€ã€€ã€€ã€€ã€€ã€€å•å‘è¿­ä»£å™¨</li><li>BidirectionIteratorã€€ã€€ã€€ã€€ã€€åŒå‘è¿­ä»£å™¨</li><li>RandomAccessIteratorã€€ã€€ã€€éšæœºè®¿é—®è¿­ä»£å™¨</li></ul><p>æ¯”å¦‚ä¸€ä¸ªadvance(n)å‡½æ•°ï¼Œå¯¹äºå•å‘è¿­ä»£å™¨åªèƒ½ä¸€ä¸ªä¸€ä¸ªç§»åŠ¨è¿‡å»ï¼Œä½†æ˜¯è¿™ç§å®ç°å¯¹äºéšæœºè®¿é—®è¿­ä»£å™¨æ˜¾ç„¶ä¸æ˜¯ç†æƒ³çš„å¤„ç†æ–¹å¼<br>å¤„ç†çš„æ–¹å¼å°±æ˜¯å…ˆå®ç°è¿™äº”ä¸ªç±»ï¼Œç”¨ä½œæ ‡è®°ç”¨ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å™¨é‡Œé¢éƒ½å®šä¹‰è¿­ä»£å™¨ç±»å‹çš„ç±»å‹æˆå‘˜iterator_catagoryï¼Œå†å¯¹ä¸åŒç‰ˆæœ¬çš„è¿­ä»£å™¨å®ç°ä¸åŒçš„advance(n)å¤„ç†æ–¹å¼</p><p>æ¯”å¦‚stlä¸­æ·»åŠ å³å€¼å¼•ç”¨å…ƒæ¨¡æ¿çš„å®ç°ï¼š</p><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename _Tp,</span><br><span class=\"line\">\t\t   bool = __and_&lt;__not_&lt;is_reference&lt;_Tp&gt;&gt;,</span><br><span class=\"line\">\t\t   \t\t\t\t\t__not_&lt;is_void&lt;_Tp&gt;&gt;&gt;::value&gt;</span><br><span class=\"line\">\tstruct __add_rvalue_reference_helper</span><br><span class=\"line\">\t&#123;typedef __Tp  <span class=\"built_in\"> type; </span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;typename _Tp&gt;</span><br><span class=\"line\">\tstruct __add_rvalue_reference_helper&lt;__Tp, <span class=\"literal\">true</span>&gt;</span><br><span class=\"line\">\t&#123;typedef __Tp&amp;&amp; <span class=\"built_in\"> type; </span>&#125;;</span><br><span class=\"line\">\t</span><br><span class=\"line\">template&lt;typename _Tp&gt;</span><br><span class=\"line\">struct add_rvalue_reference</span><br><span class=\"line\">: public __add_rvalue_reference_helper&lt;_Tp&gt;</span><br><span class=\"line\">&#123; &#125;;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°è°ƒç”¨æ—¶ä¸€èˆ¬ä¸º<code>static_cast&lt;typenameadd_rvalue_reference&lt;T&gt;::type&gt;(__t)</code>,é¦–å…ˆä¼šåŒ¹é…æ³›åŒ–ç‰ˆæœ¬çš„å…ƒæ¨¡æ¿ç±»ï¼Œç¬¬äºŒä¸ªæ¨¡ç‰ˆå‚æ•°boolä¼šåŒ¹é…_Tpçš„ç±»å‹ï¼Œå¦‚æœåŸæ¥ä¸æ˜¯å¼•ç”¨ç±»å‹çš„è¯å°±ç›´æ¥åŒ¹é…trueçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œå¦åˆ™falseä¸ºåŸæ³›åŒ–ç‰ˆæœ¬ã€‚</p><p>çŸ­çŸ­å‡ è¡Œä»£ç å·²ç»å±•ç¤ºå‡ºäº†æ¨¡æ¿å/å…¨ç‰¹åŒ–çš„å¼ºå¤§åŒ¹é…åŠŸèƒ½ï¼</p>","slug":"æ¨¡æ¿ç‰¹åŒ–","updated":"2019-06-05T06:15:31.653Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/2a215b70/","excerpt":"ä¹‹å‰å­¦ä¹ STLæ—¶æ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›å‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€STLä»å¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›å‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–å…ˆç®€è¦å›é¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸ç±»æ¨¡æ¿å‡½æ•°æ¨¡æ¿12345678910template&lt;class T&gt;T add(T a, T b) &#123; return a + b;&#125;int main()&#123; int a = 1, b = 2; std::cout &lt;&lt; add(a + b) &lt;&lt; std::endl; return 0;&#125;","categories":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/tags/C/"}]},{"title":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘","date":"2019-05-29T02:05:19.000Z","path":"posts/dc484a2e/","text":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š1234567891011121314151617#include &lt;iostream&gt;using std::cout;using std::endl;template&lt;typename T&gt;void func(T&amp; param) &#123; cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); return 0;&#125;è¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ1234int main() &#123; func(2019); return 0;&#125;åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœã€‚1234567891011121314151617template&lt;typename T&gt;void func(T&amp; param) &#123; cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" &lt;&lt; endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å³å€¼\" &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); func(2019); return 0;&#125;è¾“å‡ºç»“æœï¼š12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å³å€¼ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æ¥æ”¶å·¦å€¼åˆå¯ä»¥æ¥æ”¶å³å€¼å‘¢ï¼ŸC++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&amp;&amp;ç±»å‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚ä½†æ˜¯æ³¨æ„äº†ï¼šåªæœ‰å‘ç”Ÿç±»å‹æ¨å¯¼çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼› å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š123456789101112template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); func(2019); return 0;&#125;å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰ä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼Œæ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®å‚çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼šå·¦å€¼-å·¦å€¼ T&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨å·¦å€¼-å³å€¼ T&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨å³å€¼-å·¦å€¼ T&amp;&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨å³å€¼-å³å€¼ T&amp;&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨ä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼šæ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚å³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ä¸‹é¢æ¥ç€è¯´å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹2ä¸ªä¾‹å­ï¼šğŸŒ°æ —å­[1]è¦äº†è§£å®Œç¾è½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„æ¨å¯¼è¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æ¨å¯¼å‚æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚12345678910111213141516171819202122232425262728template &lt;typename T&gt;void func(T&amp;&amp; arg) &#123; auto is_lval = std::is_lvalue_reference&lt;T&gt;::value; auto is_rval = std::is_rvalue_reference&lt;T&gt;::value; if(std::is_same&lt;T, int&gt;::value) &#123; std::cout &lt;&lt; \"'T' is type[int]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt; \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl; &#125; else if(std::is_same&lt;T, int&amp;&gt;::value) &#123; std::cout &lt;&lt; \"'T' is type[int&amp;]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt; \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl; &#125; else if(std::is_same&lt;T, int&amp;&amp;&gt;::value) &#123; std::cout &lt;&lt; \"'T' is type[int&amp;&amp;]\" &lt;&lt; \" ?is lvalue reference:\" &lt;&lt; is_lval &lt;&lt; \" ?is rvalue reference:\" &lt;&lt; is_rval &lt;&lt; \" arg:\" &lt;&lt; arg &lt;&lt; std::endl; &#125; std::cout &lt;&lt; \"-----------------\" &lt;&lt; std::endl;&#125;int main() &#123; int a = 1; func(a); func(2); func(static_cast&lt;int&amp;&gt;(a)); func(static_cast&lt;int&amp;&amp;&gt;(a));&#125;è¾“å‡ºç»“æœä¸ºï¼š12345678'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:2-----------------'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:1-----------------å¯ä»¥å‘ç°ï¼Œå½“å®å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œå·¦å€¼ä¼ é€’Tä¸ºint&amp;ï¼Œå³å€¼ä¼ é€’Tä¸ºintã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå¦‚æœå°†æ¨¡ç‰ˆå‚æ•°æ˜¾ç¤ºç»‘å®šï¼š1234567int main() &#123; int a = 1; func&lt;int&gt;(a); //é”™è¯¯âŒ func&lt;int&gt;(2); func&lt;int&amp;&gt;(static_cast&lt;int&amp;&gt;(a)); func&lt;int&amp;&amp;&gt;(static_cast&lt;int&amp;&amp;&gt;(a));&#125;ä¼šå‘ç°æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š1234In function 'int main()'error: no matching for call to 'func(int&amp;)' func&lt;int&gt;(a); ...æ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®å‚æ¨æ–­Note:å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡ç‰ˆæ¿å‚æ•°ç±»å‹çš„å³å€¼å¼•ç”¨(å¦‚ï¼ŒT&amp;&amp;)ï¼Œåˆ™å¯ä»¥ä¼ é€’ç»™å®ƒä»»æ„ç±»å‹çš„å®å‚ã€‚å¦‚æœå°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™è¿™æ ·çš„å‚æ•°ï¼Œåˆ™å‡½æ•°å‚æ•°è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨(T&amp;)ã€‚ï¼Œä¼°è®¡æ˜¯ç¼–è¯‘å™¨åšäº†ç‰¹æ®Šçš„å¤„ç†ã€‚ç”±äºintæ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥åªèƒ½æ ¹æ®å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰è§„åˆ™ï¼Œint&amp; &amp;&amp;=int&amp;ï¼Œint &amp;&amp;= int&amp;&amp;ã€‚ä¿ç•™äº†å‚æ•°çš„å·¦å€¼å³å€¼ç‰¹æ€§ã€‚è¿™ä¹Ÿç¬¦åˆå¼•ç”¨æŠ˜å è§„åˆ™ã€‚å½“å®å‚æ•°ä»¥å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œint&amp;è¿˜æ˜¯æ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥T=int&amp;ï¼Œè€Œint&amp;&amp;åˆšå¥½åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥Tå°±æ˜¯intã€‚ğŸŒ°æ —å­[2]ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨std::forwardå‡½æ•°copyå‡ºæ¥ï¼Œå¢åŠ è¾“å‡ºä¸€æ¡å†…å®¹ï¼Œæ”¹ä¸ºtest::forwardï¼Œå…¶ä»–ä¿æŒä¸å˜ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;iostream&gt;#include &lt;bits/move.h&gt;// add print contentnamespace test&#123;template&lt;typename _Tp&gt; constexpr _Tp&amp;&amp; forward(typename std::remove_reference&lt;_Tp&gt;::type&amp; __t) noexcept &#123; std::cout &lt;&lt; \"Forward an l-value.\" &lt;&lt; std::endl; return static_cast&lt;_Tp&amp;&amp;&gt;(__t); &#125;template&lt;typename _Tp&gt; constexpr _Tp&amp;&amp; forward(typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp; __t) noexcept &#123; std::cout &lt;&lt; \"Forward an r-value.\" &lt;&lt; std::endl; static_assert(!std::is_lvalue_reference&lt;_Tp&gt;::value, \"template argument\" \" substituting _Tp is an lvalue reference type\"); return static_cast&lt;_Tp&amp;&amp;&gt;(__t); &#125;&#125;// my template functionstemplate&lt;typename T&gt;void func(T&amp; param) &#123; std::cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; std::cout &lt;&lt; \"ä¼ å…¥çš„æ˜¯å³å€¼\" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(param);&#125;extern \"C\" &#123;int main(int argc, char* argv[]) &#123; int num = 2019; warp(num); warp(2019); return 0;&#125;&#125;è¾“å‡ºç»“æœä¸ºï¼š12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å·¦å€¼æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŸå› ï¼šwarp()å‡½æ•°æœ¬èº«çš„å½¢å‚æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå³å¯ä»¥æ¥å—å·¦å€¼åˆå¯ä»¥æ¥å—å³å€¼ï¼›ç¬¬ä¸€ä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ï¼Œwarp()å‡½æ•°ä¸­è°ƒç”¨func()ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåº”è¯¥æ˜¯å·¦å€¼ï¼›ç¬¬äºŒä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å³å€¼ï¼Œæ ¹æ®ä¸Šé¢æ‰€è¯´çš„å¼•ç”¨æŠ˜å è§„åˆ™ï¼Œwarp()å‡½æ•°æ¥æ”¶çš„å‚æ•°ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå´è°ƒç”¨äº†è°ƒç”¨func()çš„å·¦å€¼ç‰ˆæœ¬äº†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨warp()å‡½æ•°å†…éƒ¨ï¼Œå³å€¼å¼•ç”¨ç±»å‹å˜ä¸ºäº†å·¦å€¼ï¼Œå› ä¸ºå‚æ•°æœ‰äº†åç§°ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡å˜é‡åå–å¾—å˜é‡åœ°å€ã€‚ç»“è®ºï¼šæ— è®ºä¼ å…¥wrap()çš„å‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œåˆ°äº†å‡½æ•°å†…éƒ¨éƒ½å˜æˆäº†å·¦å€¼ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¿æŒå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå˜é‡ç±»å‹çš„ä¸å˜å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œå®Œç¾è½¬å‘â€æŠ€æœ¯ï¼Œåœ¨C++11ä¸­é€šè¿‡std::forward()å‡½æ•°æ¥å®ç°ã€‚æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„warp()å‡½æ•°å¦‚ä¸‹ï¼š1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(test::forward&lt;T&gt;(param));&#125;è¾“å‡ºç»“æœä¸ºï¼š1234Forward an l-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an l-value.ä¼ å…¥çš„æ˜¯å³å€¼ç°åœ¨è·Ÿæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´äº†ï¼Œä½†æ˜¯åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿforward()å‡½æ•°å†…éƒ¨ä¸éš¾å‘ç°ï¼Œä¼ å…¥çš„å‚æ•°åšäº†ç§»é™¤å¼•ç”¨çš„æ“ä½œï¼Œä½¿å…¶éƒ½ä¸º&amp;&amp; æˆ– &amp;ï¼Œæ‰€ä»¥æœ‰2ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œé‡ç‚¹åœ¨äºæ¨¡ç‰ˆè¿”å›çš„æ—¶å€™return static_cast&lt;_Tp&amp;&amp;&gt;(__t);å¼ºåˆ¶å°†å®å‚è½¬æ¢æˆTåŸæœ‰çš„å¼•ç”¨ç±»å‹ï¼Œæ ¹æ®å¼•ç”¨æŠ˜å åŸåˆ™ï¼ŒT&amp;&amp; &amp;è¿˜æ˜¯&amp;ï¼ŒT&amp;&amp; &amp;&amp;è¿˜æ˜¯&amp;&amp;ã€‚æ‰€ä»¥å®ç°äº†â€œå®Œç¾è½¬å‘â€ã€‚å¦‚æœå°†wrap()å‡½æ•°æ”¹ä¸ºè¿™æ ·å‘¢ï¼Ÿ1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(test::forward&lt;T&gt;(std::move(param)));&#125;ç¼–è¯‘ç»“æœï¼š12Errorï¼šstatic_assert(template argument substituting _Tp is an lvalue reference type\");å¯ä»¥å‘ç°æˆåŠŸèµ°åˆ°äº†ç¬¬äºŒä¸ªforward()å‡½æ•°ç‰ˆæœ¬ã€‚å°†static_assert&lt;&gt;æ³¨é‡Šæ‰ï¼Œç¼–è¯‘é€šè¿‡ã€‚è¾“å‡ºç»“æœä¸ºï¼š1234Forward an r-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an r-value.ä¼ å…¥çš„æ˜¯å³å€¼å¯¹æ¯”std::move()çš„è¿”å›å€¼å°±å¯ä»¥å‘ç°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯return static_cast&lt;typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp;&gt;(__t);ä¸éš¾çœ‹å‡ºï¼Œå¿…æ˜¯å³å€¼å¼•ç”¨ã€‚è€Œstd::forward()å‡½æ•°åˆ™å°†å…¶æŒ‰Tçš„å¼•ç”¨ç±»å‹ä¿æŒä¸å˜åŸæ ·è¿”å›ã€‚","raw":"---\ntitle: C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\ncopyright: true\ntags: C++\ncategories: C++\nabbrlink: dc484a2e\ndate: 2019-05-29 10:05:19\ntype:\nkeyword:\ntop:\ncomments:\npassword:\ndescription:\n---\n\n## C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\n* é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–\n\n* ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒ\n\n### ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n<!-- more -->\n\n```\n#include <iostream>\n\nusing std::cout;\nusing std::endl;\n\n\ntemplate<typename T>\nvoid func(T& param) {\n    cout << param << endl;\n}\n\n\nint main() {\n    int num = 2019;\n    func(num);\n    return 0;\n}\n```\n\nè¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ\n\n```\nint main() {\n    func(2019);\n    return 0;\n}\n```\n\nåˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœã€‚\n\n```\ntemplate<typename T>\nvoid func(T& param) {\n    cout << \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" << endl;\n}\ntemplate<typename T>\nvoid func(T&& param) {\n    cout << \"ä¼ å…¥çš„æ˜¯å³å€¼\" << endl;\n}\n\n\n\nint main() {\n    int num = 2019;\n    func(num);\n    func(2019);\n    return 0;\n}\n```\n\nè¾“å‡ºç»“æœï¼š\n\n```\nä¼ å…¥çš„æ˜¯å·¦å€¼\nä¼ å…¥çš„æ˜¯å³å€¼\n```\n\nç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æ¥æ”¶å·¦å€¼åˆå¯ä»¥æ¥æ”¶å³å€¼å‘¢ï¼Ÿ\n\nC++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&&ç±»å‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚\n\nä½†æ˜¯æ³¨æ„äº†ï¼š<strong>åªæœ‰å‘ç”Ÿç±»å‹æ¨å¯¼çš„æ—¶å€™ï¼ŒT&&æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼›</strong> å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚\n\næ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š\n\n```\ntemplate<typename T>\nvoid func(T&& param) {\n    cout << param << endl;\n}\n\n\nint main() {\n    int num = 2019;\n    func(num);\n    func(2019);\n    return 0;\n}\n```\n\n## å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰\nä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼Œæ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®å‚çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼š\n\n* å·¦å€¼-å·¦å€¼ T& &        # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨\n* å·¦å€¼-å³å€¼ T& &&      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨\n* å³å€¼-å·¦å€¼ T&& &      # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨\n* å³å€¼-å³å€¼ T&& &&    # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨\n\nä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼š\n\næ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚\n\nå³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚\n\n## å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰\n\nä¸‹é¢æ¥ç€è¯´å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹2ä¸ªä¾‹å­ï¼š\n\nğŸŒ°æ —å­[1]\nè¦äº†è§£å®Œç¾è½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„<strong>æ¨å¯¼è¿‡ç¨‹</strong>ï¼Œ{% label success@åœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æ¨å¯¼å‚æ•° %}ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚\n\n```\ntemplate <typename T>\nvoid func(T&& arg) {\n    auto is_lval = std::is_lvalue_reference<T>::value;\n    auto is_rval  = std::is_rvalue_reference<T>::value;\n\n    if(std::is_same<T, int>::value) {\n        std::cout << \"'T' is type[int]\" << \" ?is lvalue reference:\" << is_lval <<\n                     \" ?is rvalue reference:\" << is_rval << \" arg:\" << arg << std::endl;\n    }\n    else if(std::is_same<T, int&>::value) {\n        std::cout << \"'T' is type[int&]\" << \" ?is lvalue reference:\" << is_lval <<\n                     \" ?is rvalue reference:\" << is_rval << \" arg:\" << arg << std::endl;\n    }\n    else if(std::is_same<T, int&&>::value) {\n        std::cout << \"'T' is type[int&&]\" << \" ?is lvalue reference:\" << is_lval <<\n                     \" ?is rvalue reference:\" << is_rval << \" arg:\" << arg << std::endl;\n    }\n    \n    std::cout << \"-----------------\" << std::endl;\n}\n\nint main() {\n  int a = 1;\n  func(a);\n  func(2);\n  func(static_cast<int&>(a));\n  func(static_cast<int&&>(a));\n}\n```\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\n'T' is type[int&] ?is lvalue reference:1 ?is rvalue reference:0 arg:1\n-----------------\n'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:2\n-----------------\n'T' is type[int&] ?is lvalue reference:1 ?is rvalue reference:0 arg:1\n-----------------\n'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:1\n-----------------\n```\nå¯ä»¥å‘ç°ï¼Œå½“å®å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œå·¦å€¼ä¼ é€’Tä¸ºint&ï¼Œå³å€¼ä¼ é€’Tä¸ºintã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ\n\nå¦‚æœå°†æ¨¡ç‰ˆå‚æ•°æ˜¾ç¤ºç»‘å®šï¼š\n\n```\nint main() {\n  int a = 1;\n  func<int>(a); //é”™è¯¯âŒ\n  func<int>(2);\n  func<int&>(static_cast<int&>(a));\n  func<int&&>(static_cast<int&&>(a));\n}\n```\nä¼šå‘ç°æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š\n\n```\nIn function 'int main()'\nerror: no matching for call to 'func(int&)'\n\tfunc<int>(a);\n\t...\n```\n\n{% label success@æ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®å‚æ¨æ–­%}\n<strong>Note:å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡ç‰ˆæ¿å‚æ•°ç±»å‹çš„å³å€¼å¼•ç”¨(å¦‚ï¼ŒT&&)ï¼Œåˆ™å¯ä»¥ä¼ é€’ç»™å®ƒä»»æ„ç±»å‹çš„å®å‚ã€‚å¦‚æœå°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™è¿™æ ·çš„å‚æ•°ï¼Œåˆ™å‡½æ•°å‚æ•°è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨(T&)ã€‚</strong>ï¼Œä¼°è®¡æ˜¯ç¼–è¯‘å™¨åšäº†ç‰¹æ®Šçš„å¤„ç†ã€‚\n\nç”±äºintæ— æ³•åŒ¹é…T&&ï¼Œæ‰€ä»¥åªèƒ½æ ¹æ®{% label success@å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰%}è§„åˆ™ï¼Œint& &&=int&ï¼Œint &&= int&&ã€‚ä¿ç•™äº†å‚æ•°çš„å·¦å€¼å³å€¼ç‰¹æ€§ã€‚\nè¿™ä¹Ÿç¬¦åˆå¼•ç”¨æŠ˜å è§„åˆ™ã€‚\n\nå½“å®å‚æ•°ä»¥å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œint&è¿˜æ˜¯æ— æ³•åŒ¹é…T&&ï¼Œæ‰€ä»¥T=int&ï¼Œè€Œint&&åˆšå¥½åŒ¹é…T&&ï¼Œæ‰€ä»¥Tå°±æ˜¯intã€‚\n\nğŸŒ°æ —å­[2]\n\nä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨std::forwardå‡½æ•°copyå‡ºæ¥ï¼Œå¢åŠ è¾“å‡ºä¸€æ¡å†…å®¹ï¼Œæ”¹ä¸ºtest::forwardï¼Œå…¶ä»–ä¿æŒä¸å˜ã€‚\n\n```\n#include <iostream>\n#include <bits/move.h>\n\n// add print content\nnamespace test{\ntemplate<typename _Tp>\n  constexpr _Tp&&\n  forward(typename std::remove_reference<_Tp>::type& __t) noexcept {\n    std::cout << \"Forward an l-value.\" << std::endl;\n    return static_cast<_Tp&&>(__t);\n  }\n\ntemplate<typename _Tp>\n  constexpr _Tp&&\n  forward(typename std::remove_reference<_Tp>::type&& __t) noexcept {\n    std::cout << \"Forward an r-value.\" << std::endl;\n    static_assert(!std::is_lvalue_reference<_Tp>::value, \"template argument\"\n          \" substituting _Tp is an lvalue reference type\");\n    return static_cast<_Tp&&>(__t);\n  }\n}\n\n// my template functions\ntemplate<typename T>\nvoid func(T& param) {\n    std::cout << \"ä¼ å…¥çš„æ˜¯å·¦å€¼\" << std::endl;\n}\n\ntemplate<typename T>\nvoid func(T&& param) {\n    std::cout << \"ä¼ å…¥çš„æ˜¯å³å€¼\" << std::endl;\n}\n\ntemplate<typename T>\nvoid warp(T&& param) {\n    func(param);\n}\n\nextern \"C\" {\nint main(int argc, char* argv[]) {\n    int num = 2019;\n    warp(num);\n    warp(2019);\n    return 0;\n}}\n```\n\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\nä¼ å…¥çš„æ˜¯å·¦å€¼\nä¼ å…¥çš„æ˜¯å·¦å€¼\n```\n\næ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŸå› ï¼š\n\n<strong>warp()</strong>å‡½æ•°æœ¬èº«çš„å½¢å‚æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå³å¯ä»¥æ¥å—å·¦å€¼åˆå¯ä»¥æ¥å—å³å€¼ï¼›ç¬¬ä¸€ä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ï¼Œ<strong>warp()</strong>å‡½æ•°ä¸­è°ƒç”¨<strong>func()</strong>ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåº”è¯¥æ˜¯å·¦å€¼ï¼›ç¬¬äºŒä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å³å€¼ï¼Œæ ¹æ®ä¸Šé¢æ‰€è¯´çš„å¼•ç”¨æŠ˜å è§„åˆ™ï¼Œ<strong>warp()å‡½æ•°æ¥æ”¶çš„å‚æ•°ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå´è°ƒç”¨äº†è°ƒç”¨func()çš„å·¦å€¼ç‰ˆæœ¬äº†å‘¢ï¼Ÿ</strong>è¿™æ˜¯å› ä¸ºåœ¨warp()å‡½æ•°å†…éƒ¨ï¼Œå³å€¼å¼•ç”¨ç±»å‹å˜ä¸ºäº†å·¦å€¼ï¼Œå› ä¸ºå‚æ•°æœ‰äº†åç§°ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡å˜é‡åå–å¾—å˜é‡åœ°å€ã€‚\n\nç»“è®ºï¼šæ— è®ºä¼ å…¥wrap()çš„å‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œåˆ°äº†å‡½æ•°å†…éƒ¨éƒ½å˜æˆäº†å·¦å€¼ã€‚\n\né‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¿æŒå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå˜é‡ç±»å‹çš„ä¸å˜å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œå®Œç¾è½¬å‘â€æŠ€æœ¯ï¼Œåœ¨C++11ä¸­é€šè¿‡std::forward()å‡½æ•°æ¥å®ç°ã€‚æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„warp()å‡½æ•°å¦‚ä¸‹ï¼š\n\n```\ntemplate<typename T>\nvoid warp(T&& param) {\n    func(test::forward<T>(param));\n}\n```\nè¾“å‡ºç»“æœä¸ºï¼š\n\n```\nForward an l-value.\nä¼ å…¥çš„æ˜¯å·¦å€¼\nForward an l-value.\nä¼ å…¥çš„æ˜¯å³å€¼\n```\n\nç°åœ¨è·Ÿæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´äº†ï¼Œä½†æ˜¯åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿforward()å‡½æ•°å†…éƒ¨ä¸éš¾å‘ç°ï¼Œä¼ å…¥çš„å‚æ•°åšäº†<strong>ç§»é™¤å¼•ç”¨</strong>çš„æ“ä½œï¼Œä½¿å…¶éƒ½ä¸º&& æˆ– &ï¼Œæ‰€ä»¥æœ‰2ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œé‡ç‚¹åœ¨äºæ¨¡ç‰ˆè¿”å›çš„æ—¶å€™<strong>return static_cast<_Tp&&>(__t);</strong>å¼ºåˆ¶å°†å®å‚è½¬æ¢æˆTåŸæœ‰çš„å¼•ç”¨ç±»å‹ï¼Œæ ¹æ®<strong>å¼•ç”¨æŠ˜å </strong>åŸåˆ™ï¼ŒT&& &è¿˜æ˜¯&ï¼ŒT&& &&è¿˜æ˜¯&&ã€‚æ‰€ä»¥å®ç°äº†â€œå®Œç¾è½¬å‘â€ã€‚\n\nå¦‚æœå°†wrap()å‡½æ•°æ”¹ä¸ºè¿™æ ·å‘¢ï¼Ÿ\n\n```\ntemplate<typename T>\nvoid warp(T&& param) {\n    func(test::forward<T>(std::move(param)));\n}\n```\n\nç¼–è¯‘ç»“æœï¼š\n\n```\nErrorï¼š\nstatic_assert(template argument substituting _Tp is an lvalue reference type\");\n```\n\nå¯ä»¥å‘ç°æˆåŠŸèµ°åˆ°äº†ç¬¬äºŒä¸ªforward()å‡½æ•°ç‰ˆæœ¬ã€‚å°†<strong>static_assert<></strong>æ³¨é‡Šæ‰ï¼Œç¼–è¯‘é€šè¿‡ã€‚è¾“å‡ºç»“æœä¸ºï¼š\n\n```\nForward an r-value.\nä¼ å…¥çš„æ˜¯å·¦å€¼\nForward an r-value.\nä¼ å…¥çš„æ˜¯å³å€¼\n```\n\nå¯¹æ¯”std::move()çš„è¿”å›å€¼å°±å¯ä»¥å‘ç°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯<strong>return static_cast<typename  std::remove_reference<_Tp>::type&&>(__t);</strong>ä¸éš¾çœ‹å‡ºï¼Œå¿…æ˜¯å³å€¼å¼•ç”¨ã€‚è€Œstd::forward()å‡½æ•°åˆ™å°†å…¶æŒ‰Tçš„å¼•ç”¨ç±»å‹ä¿æŒä¸å˜åŸæ ·è¿”å›ã€‚","content":"<h2 id=\"C-ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\"><a href=\"#C-ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\" class=\"headerlink\" title=\"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘\"></a>C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘</h2><ul><li><p>é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–</p></li><li><p>ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒ</p></li></ul><h3 id=\"ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal-Referenceï¼‰\"><a href=\"#ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal-Referenceï¼‰\" class=\"headerlink\" title=\"ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰\"></a>ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><a id=\"more\"></a><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; param &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> num = <span class=\"number\">2019</span>;</span><br><span class=\"line\">    func(num);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ</p><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">int</span> main() &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"number\">2019</span>)</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span><span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœã€‚</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å·¦å€¼\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp;&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å³å€¼\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> num = <span class=\"number\">2019</span>;</span><br><span class=\"line\">    func(num);</span><br><span class=\"line\">    func(<span class=\"number\">2019</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å³å€¼</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æ¥æ”¶å·¦å€¼åˆå¯ä»¥æ¥æ”¶å³å€¼å‘¢ï¼Ÿ</p><p>C++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&amp;&amp;ç±»å‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚</p><p>ä½†æ˜¯æ³¨æ„äº†ï¼š<strong>åªæœ‰å‘ç”Ÿç±»å‹æ¨å¯¼çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼›</strong> å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p><figure class=\"highlight autoit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename T&gt;</span><br><span class=\"line\">void <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(T&amp;&amp; param)</span> &#123;</span></span><br><span class=\"line\">    cout &lt;&lt; param &lt;&lt; endl<span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">int</span> main() &#123;</span><br><span class=\"line\">    <span class=\"built_in\">int</span> num = <span class=\"number\">2019</span><span class=\"comment\">;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(num)</span>;</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(<span class=\"number\">2019</span>)</span>;</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span><span class=\"comment\">;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><h2 id=\"å¼•ç”¨æŠ˜å ï¼ˆUniversal-Collapseï¼‰\"><a href=\"#å¼•ç”¨æŠ˜å ï¼ˆUniversal-Collapseï¼‰\" class=\"headerlink\" title=\"å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰\"></a>å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰</h2><p>ä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼Œæ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®å‚çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼š</p><ul><li>å·¦å€¼-å·¦å€¼ T&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨</li><li>å·¦å€¼-å³å€¼ T&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨</li><li>å³å€¼-å·¦å€¼ T&amp;&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å·¦å€¼å¼•ç”¨</li><li>å³å€¼-å³å€¼ T&amp;&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®å‚æ˜¯å³å€¼å¼•ç”¨</li></ul><p>ä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼š</p><p>æ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æœä¸ºå³å€¼å¼•ç”¨ã€‚</p><p>å³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚</p><h2 id=\"å®Œç¾è½¬å‘ï¼ˆPerfect-Forwardingï¼‰\"><a href=\"#å®Œç¾è½¬å‘ï¼ˆPerfect-Forwardingï¼‰\" class=\"headerlink\" title=\"å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰\"></a>å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰</h2><p>ä¸‹é¢æ¥ç€è¯´å®Œç¾è½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹2ä¸ªä¾‹å­ï¼š</p><p>ğŸŒ°æ —å­[1]<br>è¦äº†è§£å®Œç¾è½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„<strong>æ¨å¯¼è¿‡ç¨‹</strong>ï¼Œ<span class=\"label success\">åœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æ¨å¯¼å‚æ•°</span>ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæ¨å¯¼è¿‡ç¨‹ã€‚</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp;&amp; arg)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> is_lval = <span class=\"built_in\">std</span>::is_lvalue_reference&lt;T&gt;::value;</span><br><span class=\"line\">    <span class=\"keyword\">auto</span> is_rval  = <span class=\"built_in\">std</span>::is_rvalue_reference&lt;T&gt;::value;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">int</span>&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[int]\"</span> &lt;&lt; <span class=\"string\">\" ?is lvalue reference:\"</span> &lt;&lt; is_lval &lt;&lt;</span><br><span class=\"line\">                     <span class=\"string\">\" ?is rvalue reference:\"</span> &lt;&lt; is_rval &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">int</span>&amp;&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[int&amp;]\"</span> &lt;&lt; <span class=\"string\">\" ?is lvalue reference:\"</span> &lt;&lt; is_lval &lt;&lt;</span><br><span class=\"line\">                     <span class=\"string\">\" ?is rvalue reference:\"</span> &lt;&lt; is_rval &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"built_in\">std</span>::is_same&lt;T, <span class=\"keyword\">int</span>&amp;&amp;&gt;::value) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"'T' is type[int&amp;&amp;]\"</span> &lt;&lt; <span class=\"string\">\" ?is lvalue reference:\"</span> &lt;&lt; is_lval &lt;&lt;</span><br><span class=\"line\">                     <span class=\"string\">\" ?is rvalue reference:\"</span> &lt;&lt; is_rval &lt;&lt; <span class=\"string\">\" arg:\"</span> &lt;&lt; arg &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"-----------------\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  func(a);</span><br><span class=\"line\">  func(<span class=\"number\">2</span>);</span><br><span class=\"line\">  func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&gt;(a));</span><br><span class=\"line\">  func(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&amp;&gt;(a));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>&amp;] ?<span class=\"keyword\">is</span> lvalue reference:<span class=\"number\">1</span> ?<span class=\"keyword\">is</span> rvalue reference:<span class=\"number\">0</span> <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>] ?<span class=\"keyword\">is</span> lvalue reference:<span class=\"number\">0</span> ?<span class=\"keyword\">is</span> rvalue reference:<span class=\"number\">0</span> <span class=\"keyword\">ar</span><span class=\"variable\">g:2</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>&amp;] ?<span class=\"keyword\">is</span> lvalue reference:<span class=\"number\">1</span> ?<span class=\"keyword\">is</span> rvalue reference:<span class=\"number\">0</span> <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br><span class=\"line\"><span class=\"string\">'T'</span> <span class=\"keyword\">is</span> <span class=\"built_in\">type</span>[<span class=\"keyword\">int</span>] ?<span class=\"keyword\">is</span> lvalue reference:<span class=\"number\">0</span> ?<span class=\"keyword\">is</span> rvalue reference:<span class=\"number\">0</span> <span class=\"keyword\">ar</span><span class=\"variable\">g:1</span></span><br><span class=\"line\">-----------------</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œå½“å®å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œå·¦å€¼ä¼ é€’Tä¸ºint&amp;ï¼Œå³å€¼ä¼ é€’Tä¸ºintã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ</p><p>å¦‚æœå°†æ¨¡ç‰ˆå‚æ•°æ˜¾ç¤ºç»‘å®šï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">int</span> a = <span class=\"number\">1</span>;</span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&gt;(a); <span class=\"comment\">//é”™è¯¯âŒ</span></span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">2</span>);</span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&amp;&gt;(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&gt;(a));</span><br><span class=\"line\">  func&lt;<span class=\"keyword\">int</span>&amp;&amp;&gt;(<span class=\"keyword\">static_cast</span>&lt;<span class=\"keyword\">int</span>&amp;&amp;&gt;(a));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š</p><figure class=\"highlight subunit\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">In function 'int main()'</span><br><span class=\"line\"><span class=\"keyword\">error: </span>no matching for call to 'func(int&amp;)'</span><br><span class=\"line\">\tfunc&lt;int&gt;(a);</span><br><span class=\"line\">\t...</span><br></pre></td></tr></table></figure><span class=\"label success\">æ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®å‚æ¨æ–­</span><p><strong>Note:å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡ç‰ˆæ¿å‚æ•°ç±»å‹çš„å³å€¼å¼•ç”¨(å¦‚ï¼ŒT&amp;&amp;)ï¼Œåˆ™å¯ä»¥ä¼ é€’ç»™å®ƒä»»æ„ç±»å‹çš„å®å‚ã€‚å¦‚æœå°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™è¿™æ ·çš„å‚æ•°ï¼Œåˆ™å‡½æ•°å‚æ•°è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨(T&amp;)ã€‚</strong>ï¼Œä¼°è®¡æ˜¯ç¼–è¯‘å™¨åšäº†ç‰¹æ®Šçš„å¤„ç†ã€‚</p><p>ç”±äºintæ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥åªèƒ½æ ¹æ®<span class=\"label success\">å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰</span>è§„åˆ™ï¼Œint&amp; &amp;&amp;=int&amp;ï¼Œint &amp;&amp;= int&amp;&amp;ã€‚ä¿ç•™äº†å‚æ•°çš„å·¦å€¼å³å€¼ç‰¹æ€§ã€‚<br>è¿™ä¹Ÿç¬¦åˆå¼•ç”¨æŠ˜å è§„åˆ™ã€‚</p><p>å½“å®å‚æ•°ä»¥å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ–¹å¼æ¨å¯¼æ—¶ï¼Œint&amp;è¿˜æ˜¯æ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥T=int&amp;ï¼Œè€Œint&amp;&amp;åˆšå¥½åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥Tå°±æ˜¯intã€‚</p><p>ğŸŒ°æ —å­[2]</p><p>ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨std::forwardå‡½æ•°copyå‡ºæ¥ï¼Œå¢åŠ è¾“å‡ºä¸€æ¡å†…å®¹ï¼Œæ”¹ä¸ºtest::forwardï¼Œå…¶ä»–ä¿æŒä¸å˜ã€‚</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;bits/move.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// add print content</span></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> test&#123;</span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> _Tp&gt;</span><br><span class=\"line\">  <span class=\"keyword\">constexpr</span> _Tp&amp;&amp;</span><br><span class=\"line\">  forward(<span class=\"keyword\">typename</span> <span class=\"built_in\">std</span>::remove_reference&lt;_Tp&gt;::type&amp; <span class=\"keyword\">__t</span>) <span class=\"keyword\">noexcept</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Forward an l-value.\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">static_cast</span>&lt;_Tp&amp;&amp;&gt;(<span class=\"keyword\">__t</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> _Tp&gt;</span><br><span class=\"line\">  <span class=\"keyword\">constexpr</span> _Tp&amp;&amp;</span><br><span class=\"line\">  forward(<span class=\"keyword\">typename</span> <span class=\"built_in\">std</span>::remove_reference&lt;_Tp&gt;::type&amp;&amp; <span class=\"keyword\">__t</span>) <span class=\"keyword\">noexcept</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Forward an r-value.\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    <span class=\"keyword\">static_assert</span>(!<span class=\"built_in\">std</span>::is_lvalue_reference&lt;_Tp&gt;::value, <span class=\"string\">\"template argument\"</span></span><br><span class=\"line\">          <span class=\"string\">\" substituting _Tp is an lvalue reference type\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">static_cast</span>&lt;_Tp&amp;&amp;&gt;(<span class=\"keyword\">__t</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// my template functions</span></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å·¦å€¼\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">func</span><span class=\"params\">(T&amp;&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"ä¼ å…¥çš„æ˜¯å³å€¼\"</span> &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">warp</span><span class=\"params\">(T&amp;&amp; param)</span> </span>&#123;</span><br><span class=\"line\">    func(param);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">extern</span> <span class=\"string\">\"C\"</span> &#123;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> num = <span class=\"number\">2019</span>;</span><br><span class=\"line\">    warp(num);</span><br><span class=\"line\">    warp(<span class=\"number\">2019</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹åŸå› ï¼š</p><p><strong>warp()</strong>å‡½æ•°æœ¬èº«çš„å½¢å‚æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå³å¯ä»¥æ¥å—å·¦å€¼åˆå¯ä»¥æ¥å—å³å€¼ï¼›ç¬¬ä¸€ä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ï¼Œ<strong>warp()</strong>å‡½æ•°ä¸­è°ƒç”¨<strong>func()</strong>ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåº”è¯¥æ˜¯å·¦å€¼ï¼›ç¬¬äºŒä¸ªwarp()å‡½æ•°è°ƒç”¨å®å‚æ˜¯å³å€¼ï¼Œæ ¹æ®ä¸Šé¢æ‰€è¯´çš„å¼•ç”¨æŠ˜å è§„åˆ™ï¼Œ<strong>warp()å‡½æ•°æ¥æ”¶çš„å‚æ•°ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå´è°ƒç”¨äº†è°ƒç”¨func()çš„å·¦å€¼ç‰ˆæœ¬äº†å‘¢ï¼Ÿ</strong>è¿™æ˜¯å› ä¸ºåœ¨warp()å‡½æ•°å†…éƒ¨ï¼Œå³å€¼å¼•ç”¨ç±»å‹å˜ä¸ºäº†å·¦å€¼ï¼Œå› ä¸ºå‚æ•°æœ‰äº†åç§°ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡å˜é‡åå–å¾—å˜é‡åœ°å€ã€‚</p><p>ç»“è®ºï¼šæ— è®ºä¼ å…¥wrap()çš„å‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œåˆ°äº†å‡½æ•°å†…éƒ¨éƒ½å˜æˆäº†å·¦å€¼ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€ä¹ˆä¿æŒå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå˜é‡ç±»å‹çš„ä¸å˜å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œå®Œç¾è½¬å‘â€æŠ€æœ¯ï¼Œåœ¨C++11ä¸­é€šè¿‡std::forward()å‡½æ•°æ¥å®ç°ã€‚æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„warp()å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename <span class=\"type\">T</span>&gt;</span><br><span class=\"line\">void warp(<span class=\"type\">T</span>&amp;&amp; param) &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(test::forward&lt;T&gt;<span class=\"params\">(param)</span></span></span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Forward <span class=\"keyword\">an</span> l-<span class=\"built_in\">value</span>.</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br><span class=\"line\">Forward <span class=\"keyword\">an</span> l-<span class=\"built_in\">value</span>.</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å³å€¼</span><br></pre></td></tr></table></figure><p>ç°åœ¨è·Ÿæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´äº†ï¼Œä½†æ˜¯åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿforward()å‡½æ•°å†…éƒ¨ä¸éš¾å‘ç°ï¼Œä¼ å…¥çš„å‚æ•°åšäº†<strong>ç§»é™¤å¼•ç”¨</strong>çš„æ“ä½œï¼Œä½¿å…¶éƒ½ä¸º&amp;&amp; æˆ– &amp;ï¼Œæ‰€ä»¥æœ‰2ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œé‡ç‚¹åœ¨äºæ¨¡ç‰ˆè¿”å›çš„æ—¶å€™<strong>return static_cast&lt;_Tp&amp;&amp;&gt;(__t);</strong>å¼ºåˆ¶å°†å®å‚è½¬æ¢æˆTåŸæœ‰çš„å¼•ç”¨ç±»å‹ï¼Œæ ¹æ®<strong>å¼•ç”¨æŠ˜å </strong>åŸåˆ™ï¼ŒT&amp;&amp; &amp;è¿˜æ˜¯&amp;ï¼ŒT&amp;&amp; &amp;&amp;è¿˜æ˜¯&amp;&amp;ã€‚æ‰€ä»¥å®ç°äº†â€œå®Œç¾è½¬å‘â€ã€‚</p><p>å¦‚æœå°†wrap()å‡½æ•°æ”¹ä¸ºè¿™æ ·å‘¢ï¼Ÿ</p><figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">template&lt;typename <span class=\"type\">T</span>&gt;</span><br><span class=\"line\">void warp(<span class=\"type\">T</span>&amp;&amp; param) &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(test::forward&lt;T&gt;<span class=\"params\">(std::move<span class=\"params\">(param)</span></span></span></span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç»“æœï¼š</p><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Errorï¼š</span><br><span class=\"line\">static_assert(template <span class=\"keyword\">argument</span> substituting _Tp <span class=\"keyword\">is</span> <span class=\"keyword\">an</span> lvalue reference <span class=\"built_in\">type</span><span class=\"comment\">\");</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°æˆåŠŸèµ°åˆ°äº†ç¬¬äºŒä¸ªforward()å‡½æ•°ç‰ˆæœ¬ã€‚å°†<strong>static_assert&lt;&gt;</strong>æ³¨é‡Šæ‰ï¼Œç¼–è¯‘é€šè¿‡ã€‚è¾“å‡ºç»“æœä¸ºï¼š</p><figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Forward <span class=\"keyword\">an</span> r-<span class=\"built_in\">value</span>.</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å·¦å€¼</span><br><span class=\"line\">Forward <span class=\"keyword\">an</span> r-<span class=\"built_in\">value</span>.</span><br><span class=\"line\">ä¼ å…¥çš„æ˜¯å³å€¼</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”std::move()çš„è¿”å›å€¼å°±å¯ä»¥å‘ç°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯<strong>return static_cast&lt;typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp;&gt;(__t);</strong>ä¸éš¾çœ‹å‡ºï¼Œå¿…æ˜¯å³å€¼å¼•ç”¨ã€‚è€Œstd::forward()å‡½æ•°åˆ™å°†å…¶æŒ‰Tçš„å¼•ç”¨ç±»å‹ä¿æŒä¸å˜åŸæ ·è¿”å›ã€‚</p>","slug":"å®Œç¾è½¬å‘","updated":"2019-06-14T02:58:49.517Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/dc484a2e/","excerpt":"C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾è½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š","categories":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/tags/C/"}]},{"title":"ä»4è¡Œä»£ç çœ‹å³å€¼å¼•ç”¨","date":"2019-05-23T06:50:40.000Z","path":"posts/9d2f4ec8/","text":"æ¦‚è¿° å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®ä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š12int i = 0;int&amp; j = i; è¿™é‡Œçš„int&amp;æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&amp;å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&amp;&amp;ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»å‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&amp;&amp;æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š 1int&amp;&amp; i = 0; è¿™é‡Œæˆ‘ä»¬ç»‘å®šäº†ä¸€ä¸ªå³å€¼0ï¼Œå…³äºå³å€¼çš„æ¦‚å¿µä¼šåœ¨åé¢ä»‹ç»ã€‚å³å€¼å¼•ç”¨æ˜¯C++11ä¸­æ–°å¢åŠ çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä»–ä¸»æ˜¯è¦ç”¨æ¥è§£å†³C++98/03ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸´æ—¶å¯¹è±¡éå¿…è¦çš„æ˜‚è´µçš„æ‹·è´æ“ä½œï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­å¦‚ä½•æŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ”¹è¿›äº†ç¨‹åºæ€§èƒ½ï¼Œåé¢å°†ä¼šè¯¦ç»†ä»‹ç»å³å€¼å¼•ç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚ å’Œå³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šå³å€¼ã€çº¯å³å€¼ã€å°†äº¡å€¼ã€universal referencesã€å¼•ç”¨æŠ˜å ã€ç§»åŠ¨è¯­ä¹‰ã€moveè¯­ä¹‰å’Œå®Œç¾è½¬å‘ç­‰ç­‰ã€‚å¾ˆå¤šéƒ½æ˜¯æ–°æ¦‚å¿µï¼Œå¯¹äºåˆšå­¦ä¹ C++11å³å€¼å¼•ç”¨çš„åˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šè§‰å¾—å³å€¼å¼•ç”¨è¿‡äºå¤æ‚ï¼Œæ¦‚å¿µä¹‹é—´çš„å…³ç³»éš¾ä»¥ç†æ¸…ã€‚å³å€¼å¼•ç”¨å®é™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå…¶å®æ˜¯å…³äº4è¡Œä»£ç çš„æ•…äº‹ï¼Œé€šè¿‡ç®€å•çš„4è¡Œä»£ç æˆ‘ä»¬å°±èƒ½æ¸…æ™°çš„ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µäº†ã€‚æœ¬æ–‡å¸Œæœ›å¸¦é¢†è¯»è€…é€šè¿‡4è¡Œä»£ç æ¥ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µï¼Œç†æ¸…ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æœ€ç»ˆèƒ½é€å½»åœ°æŒæ¡C++11çš„æ–°ç‰¹æ€§â€“å³å€¼å¼•ç”¨ã€‚å››è¡Œä»£ç çš„æ•…äº‹ç¬¬1è¡Œä»£ç çš„æ•…äº‹1int i = getVar(); ä¸Šé¢çš„è¿™è¡Œä»£ç å¾ˆç®€å•ï¼Œä»getVar()å‡½æ•°è·å–ä¸€ä¸ªæ•´å½¢å€¼ï¼Œç„¶è€Œï¼Œè¿™è¡Œä»£ç ä¼šäº§ç”Ÿå‡ ç§ç±»å‹çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šäº§ç”Ÿä¸¤ç§ç±»å‹çš„å€¼ï¼Œä¸€ç§æ˜¯å·¦å€¼iï¼Œä¸€ç§æ˜¯å‡½æ•°getVar()è¿”å›çš„ä¸´æ—¶å€¼ï¼Œè¿™ä¸ªä¸´æ—¶å€¼åœ¨è¡¨è¾¾å¼ç»“æŸåå°±é”€æ¯äº†ï¼Œè€Œå·¦å€¼iåœ¨è¡¨è¾¾å¼ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªä¸´æ—¶å€¼å°±æ˜¯å³å€¼ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œå³å€¼æ˜¯ä¸å…·åçš„ã€‚åŒºåˆ†å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªç®€å•åŠæ³•æ˜¯ï¼šçœ‹èƒ½ä¸èƒ½å¯¹è¡¨è¾¾å¼å–åœ°å€ï¼Œå¦‚æœèƒ½ï¼Œåˆ™ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚ æ‰€æœ‰çš„å…·åå˜é‡æˆ–å¯¹è±¡éƒ½æ˜¯å·¦å€¼ï¼Œè€ŒåŒ¿åå˜é‡åˆ™æ˜¯å³å€¼ï¼Œæ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼è¯­å¥ï¼š1int i = 0; åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œi æ˜¯å·¦å€¼ï¼Œ0 æ˜¯å­—é¢é‡ï¼Œå°±æ˜¯å³å€¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œi å¯ä»¥è¢«å¼•ç”¨ï¼Œ0 å°±ä¸å¯ä»¥äº†ã€‚å…·ä½“æ¥è¯´ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­ç­‰å·å³è¾¹çš„0æ˜¯çº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œåœ¨C++11ä¸­æ‰€æœ‰çš„å€¼å¿…å±äºå·¦å€¼ã€å°†äº¡å€¼ã€çº¯å³å€¼ä¸‰è€…ä¹‹ä¸€ã€‚æ¯”å¦‚ï¼Œéå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€åŸå§‹å­—é¢é‡å’Œlambdaè¡¨è¾¾å¼ç­‰éƒ½æ˜¯çº¯å³å€¼ã€‚è€Œå°†äº¡å€¼æ˜¯C++11æ–°å¢çš„ã€ä¸å³å€¼å¼•ç”¨ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼Œå°†è¦è¢«ç§»åŠ¨çš„å¯¹è±¡ã€T&amp;&amp;å‡½æ•°è¿”å›å€¼ã€std::moveè¿”å›å€¼å’Œè½¬æ¢ä¸ºT&amp;&amp;çš„ç±»å‹çš„è½¬æ¢å‡½æ•°çš„è¿”å›å€¼ç­‰ã€‚å…³äºå°†äº¡å€¼æˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š123int j = 5;auto f = []&#123;return 5;&#125;; ä¸Šé¢çš„ä»£ç ä¸­5æ˜¯ä¸€ä¸ªåŸå§‹å­—é¢é‡ï¼Œ []{return 5;}æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œéƒ½æ˜¯å±äºçº¯å³å€¼ï¼Œä»–ä»¬çš„ç‰¹ç‚¹æ˜¯åœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ã€‚ é€šè¿‡åœ°è¡Œä»£ç æˆ‘ä»¬å¯¹å³å€¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ç¬¬äºŒè¡Œä»£ç ã€‚ç¬¬2è¡Œä»£ç çš„æ•…äº‹1T&amp;&amp; k = getVar(); ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç å¾ˆåƒï¼Œåªæ˜¯ç›¸æ¯”ç¬¬ä¸€è¡Œä»£ç å¤šäº†â€œ&amp;&amp;â€ï¼Œä»–å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“å·¦å€¼å¼•ç”¨æ˜¯å¯¹å·¦å€¼çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œå¯¹åº”çš„ï¼Œå¯¹å³å€¼çš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œä¸”å³å€¼æ˜¯åŒ¿åå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥è·å–å³å€¼ã€‚è™½ç„¶ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯å®é™…ä¸Šè¯­ä¹‰çš„å·®åˆ«å¾ˆå¤§ï¼Œè¿™é‡Œï¼ŒgetVar()äº§ç”Ÿçš„ä¸´æ—¶å€¼ä¸ä¼šåƒç¬¬ä¸€è¡Œä»£ç é‚£æ ·ï¼Œåœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ï¼Œè€Œæ˜¯ä¼šè¢«â€œç»­å‘½â€ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šé€šè¿‡å³å€¼å¼•ç”¨å¾—ä»¥å»¶ç»­ï¼Œå’Œå˜é‡kçš„å£°æ˜å‘¨æœŸä¸€æ ·é•¿ã€‚å³å€¼å¼•ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹ é€šè¿‡å³å€¼å¼•ç”¨çš„å£°æ˜ï¼Œå³å€¼åˆâ€œé‡è·æ–°ç”Ÿâ€ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸å³å€¼å¼•ç”¨ç±»å‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œåªè¦è¯¥å˜é‡è¿˜æ´»ç€ï¼Œè¯¥å³å€¼ä¸´æ—¶é‡å°†ä¼šä¸€ç›´å­˜æ´»ä¸‹å»ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä»£ç æ¸…å•1-1æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-112345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;using namespace std;int g_constructCount=0;int g_copyConstructCount=0;int g_destructCount=0;struct A&#123; A()&#123; cout&lt;&lt;\"construct: \"&lt;&lt;++g_constructCount&lt;&lt;endl; &#125; A(const A&amp; a) &#123; cout&lt;&lt;\"copy construct: \"&lt;&lt;++g_copyConstructCount &lt;&lt;endl; &#125; ~A() &#123; cout&lt;&lt;\"destruct: \"&lt;&lt;++g_destructCount&lt;&lt;endl; &#125;&#125;;A GetA()&#123; return A();&#125;int main() &#123; A a = GetA(); return 0;&#125; ä¸ºäº†æ¸…æ¥šçš„è§‚å¯Ÿä¸´æ—¶å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsç”¨æ¥å…³é—­è¿”å›å€¼ä¼˜åŒ–æ•ˆæœã€‚ è¾“å‡ºç»“æœï¼š123456construct: 1copy construct: 1destruct: 1copy construct: 2destruct: 2destruct: 3 ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰è¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‹·è´æ„é€ å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯GetA()å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¯¹è±¡è¿”å›å‡ºæ¥æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡äº§ç”Ÿçš„ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨mainå‡½æ•°ä¸­æ„é€ aå¯¹è±¡äº§ç”Ÿçš„ã€‚ç¬¬äºŒæ¬¡çš„destructæ˜¯å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨æ„é€ aå¯¹è±¡ä¹‹åå°±é”€æ¯äº†ã€‚å¦‚æœå¼€å¯è¿”å›å€¼ä¼˜åŒ–çš„è¯ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼šconstruct: 1destruct: 1 å¯ä»¥çœ‹åˆ°è¿”å›å€¼ä¼˜åŒ–å°†ä¼šæŠŠä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æ‰ï¼Œä½†è¿™ä¸æ˜¯c++æ ‡å‡†ï¼Œæ˜¯å„ç¼–è¯‘å™¨çš„ä¼˜åŒ–è§„åˆ™ã€‚æˆ‘ä»¬åœ¨å›åˆ°ä¹‹å‰æåˆ°çš„å¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨æ¥å»¶é•¿ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡å³å€¼å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›å€¼çš„è¯ï¼Œç»“æœåˆä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsã€‚123456789int main() &#123; A&amp;&amp; a = GetA(); return 0;&#125;è¾“å‡ºç»“æœï¼šconstruct: 1copy construct: 1destruct: 1destruct: 2 é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæ¯”ä¹‹å‰å°‘äº†ä¸€æ¬¡æ‹·è´æ„é€ å’Œä¸€æ¬¡ææ„ï¼ŒåŸå› åœ¨äºå³å€¼å¼•ç”¨ç»‘å®šäº†å³å€¼ï¼Œè®©ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå³é¿å…ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æ„é€ å’Œææ„ï¼Œäº‹å®ä¸Šï¼Œåœ¨c++98/03ä¸­ï¼Œé€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨ä¹Ÿç»å¸¸ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ã€‚ä¸Šé¢çš„ä»£ç æ”¹æˆï¼š const A&amp; a = GetA(); è¾“å‡ºçš„ç»“æœå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œå› ä¸ºå¸¸é‡å·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªâ€œä¸‡èƒ½â€çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æ¥å—å·¦å€¼ã€å³å€¼ã€å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ™®é€šçš„å·¦å€¼å¼•ç”¨ä¸èƒ½æ¥å—å³å€¼ï¼Œæ¯”å¦‚è¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯¹çš„ï¼š A&amp; a = GetA(); ä¸Šé¢çš„ä»£ç ä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºéå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½æ¥å—å·¦å€¼ã€‚å³å€¼å¼•ç”¨çš„ç¬¬äºŒä¸ªç‰¹ç‚¹ å³å€¼å¼•ç”¨ç‹¬ç«‹äºå·¦å€¼å’Œå³å€¼ã€‚æ„æ€æ˜¯å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š1int&amp;&amp; var1 = 1; var1ç±»å‹ä¸ºå³å€¼å¼•ç”¨ï¼Œä½†var1æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå…·åå˜é‡éƒ½æ˜¯å·¦å€¼ã€‚ å…³äºå³å€¼å¼•ç”¨ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜æ˜¯ï¼šT&amp;&amp;æ˜¯ä»€ä¹ˆï¼Œä¸€å®šæ˜¯å³å€¼å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š12345template&lt;typename T&gt;void f(T&amp;&amp; t)&#123;&#125;f(10); //tæ˜¯å³å€¼int x = 10;f(x); //tæ˜¯å·¦å€¼ ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒT&amp;&amp;è¡¨ç¤ºçš„å€¼ç±»å‹ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯å·¦å€¼åˆå¯èƒ½æ˜¯å³å€¼ï¼Œè¿™ä¸€ç‚¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™å°±æ˜¯å³å€¼å¼•ç”¨çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚å³å€¼å¼•ç”¨çš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹ T&amp;&amp; tåœ¨å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨æ–­çš„æ—¶å€™ï¼Œå®ƒæ˜¯æœªå®šçš„å¼•ç”¨ç±»å‹ï¼ˆuniversal referencesï¼‰ï¼Œå¦‚æœè¢«ä¸€ä¸ªå·¦å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼›å¦‚æœå®ƒè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå®ƒæ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼å–å†³äºå®ƒçš„åˆå§‹åŒ–ã€‚æˆ‘ä»¬å†å›è¿‡å¤´çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹äºå‡½æ•°templatevoid f(T&amp;&amp; t)ï¼Œå½“å‚æ•°ä¸ºå³å€¼10çš„æ—¶å€™ï¼Œæ ¹æ®universal referencesçš„ç‰¹ç‚¹ï¼Œtè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯å³å€¼ï¼›å½“å‚æ•°ä¸ºå·¦å€¼xæ—¶ï¼Œtè¢«ä¸€ä¸ªå·¦å€¼å¼•ç”¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…æ˜¯å½“å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œæˆ–autoå…³é”®å­—ï¼‰çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰æ˜¯universal referencesã€‚å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š1234567template&lt;typename T&gt;void f(T&amp;&amp; param); template&lt;typename T&gt;class Test &#123; Test(Test&amp;&amp; rhs); &#125;; ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œparamæ˜¯universal referenceï¼Œrhsæ˜¯Test&amp;&amp;å³å€¼å¼•ç”¨ï¼Œå› ä¸ºæ¨¡ç‰ˆå‡½æ•°få‘ç”Ÿäº†ç±»å‹æ¨æ–­ï¼Œè€ŒTest&amp;&amp;å¹¶æ²¡æœ‰å‘ç”Ÿç±»å‹æ¨å¯¼ï¼Œå› ä¸ºTest&amp;&amp;æ˜¯ç¡®å®šçš„ç±»å‹äº†ã€‚ æ­£æ˜¯å› ä¸ºå³å€¼å¼•ç”¨å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œä¾èµ–äºåˆå§‹åŒ–ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šæ–‡ç« ï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚ è¿™é‡Œå†æä¸€ä¸‹å¼•ç”¨æŠ˜å ï¼Œæ­£æ˜¯å› ä¸ºå¼•å…¥äº†å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„æŠ˜å ï¼ŒC++11ç¡®å®šäº†å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæ‰€æœ‰çš„å³å€¼å¼•ç”¨å åŠ åˆ°å³å€¼å¼•ç”¨ä¸Šä»ç„¶è¿˜æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼›æ‰€æœ‰çš„å…¶ä»–å¼•ç”¨ç±»å‹ä¹‹é—´çš„å åŠ éƒ½å°†å˜æˆå·¦å€¼å¼•ç”¨ã€‚ç¬¬3è¡Œä»£ç çš„æ•…äº‹1T(T&amp;&amp; a) : m_val(val)&#123; a.m_val=nullptr; &#125; è¿™è¡Œä»£ç å®é™…ä¸Šæ¥è‡ªäºä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä¸ºä»€ä¹ˆå°†å³å€¼å¼•ç”¨ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°å‘¢ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚ä»£ç æ¸…å•1-2æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-21234567891011121314151617181920class A&#123;public: A():m_ptr(new int(0))&#123;cout &lt;&lt; \"construct\" &lt;&lt; endl;&#125; A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•° &#123; cout &lt;&lt; \"copy construct\" &lt;&lt; endl; &#125; ~A()&#123; delete m_ptr;&#125;private: int* m_ptr;&#125;;int main() &#123; A a = GetA(); return 0;&#125; è¾“å‡ºï¼šconstructcopy constructcopy construct è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸€ä¸ªå¸¦æœ‰å †å†…å­˜çš„ç±»ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæ·±æ‹·è´æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œä¼šå‘ç”Ÿâ€œæŒ‡é’ˆæ‚¬æŒ‚â€çš„é—®é¢˜ã€‚å¦‚æœä¸æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä¸Šé¢çš„æµ‹è¯•ä»£ç å°†ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆç¼–è¯‘é€‰é¡¹-fno-elide-constructorsï¼‰ï¼Œå†…éƒ¨çš„m_ptrå°†ä¼šè¢«åˆ é™¤ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¸´æ—¶å³å€¼ææ„çš„æ—¶å€™åˆ é™¤ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡å¤–é¢æ„é€ çš„aå¯¹è±¡é‡Šæ”¾æ—¶åˆ é™¤ä¸€æ¬¡ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„m_ptræ˜¯åŒä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æŒ‡é’ˆæ‚¬æŒ‚é—®é¢˜ã€‚æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°è™½ç„¶å¯ä»¥ä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ä¼šé€ æˆé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™ç§æ·±æ‹·è´æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š ä¸Šé¢ä»£ç ä¸­çš„GetAå‡½æ•°ä¼šè¿”å›ä¸´æ—¶å˜é‡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡aï¼Œä¸´æ—¶å˜é‡åœ¨æ‹·è´æ„é€ å®Œæˆä¹‹åå°±é”€æ¯äº†ï¼Œå¦‚æœå †å†…å­˜å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ‹·è´æ„é€ çš„ä»£ä»·ä¼šå¾ˆå¤§ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸´æ—¶å˜é‡å¹¶é€ æˆé¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œæœ‰æ²¡æœ‰åŠæ³•é¿å…ä¸´æ—¶å˜é‡é€ æˆçš„æ€§èƒ½æŸå¤±å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒC++11å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚ä»£ç æ¸…å•1-3æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-3123456789101112131415161718192021222324class A&#123;public: A() :m_ptr(new int(0))&#123;&#125; A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•° &#123; cout &lt;&lt; \"copy construct\" &lt;&lt; endl; &#125; A(A&amp;&amp; a) :m_ptr(a.m_ptr) &#123; a.m_ptr = nullptr; cout &lt;&lt; \"move construct\" &lt;&lt; endl; &#125; ~A()&#123; delete m_ptr;&#125;private: int* m_ptr;&#125;;int main()&#123; A a = Get(false); &#125; è¾“å‡ºï¼šconstructmove constructmove construct ä»£ç æ¸…å•1-3å’Œ1-2ç›¸æ¯”åªå¤šäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å‡ºç»“æœè¡¨æ˜ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œåªè°ƒç”¨äº†move constructå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªmove constructå‡½æ•°ï¼š12345A(A&amp;&amp; a) :m_ptr(a.m_ptr)&#123; a.m_ptr = nullptr; cout &lt;&lt; \"move construct\" &lt;&lt; endl;&#125; è¿™ä¸ªæ„é€ å‡½æ•°å¹¶æ²¡æœ‰åšæ·±æ‹·è´ï¼Œä»…ä»…æ˜¯å°†æŒ‡é’ˆçš„æ‰€æœ‰è€…è½¬ç§»åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†å‚æ•°å¯¹è±¡açš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œè¿™é‡Œä»…ä»…æ˜¯åšäº†æµ…æ‹·è´ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°é¿å…äº†ä¸´æ—¶å˜é‡çš„æ·±æ‹·è´é—®é¢˜ã€‚ ä¸Šé¢è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œçš„A&amp;&amp;è¡¨ç¤ºå³å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‰é¢å·²ç»æåˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å‘ç”Ÿç±»å‹æ¨æ–­ï¼Œæ˜¯ç¡®å®šçš„å³å€¼å¼•ç”¨ç±»å‹ã€‚ä¸ºä»€ä¹ˆä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ï¼Ÿå› ä¸ºè¿™ä¸ªæ„é€ å‡½æ•°åªèƒ½æ¥å—å³å€¼å‚æ•°ï¼Œè€Œå‡½æ•°è¿”å›å€¼æ˜¯å³å€¼ï¼Œæ‰€ä»¥å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„A&amp;&amp;å¯ä»¥çœ‹ä½œæ˜¯ä¸´æ—¶å€¼çš„æ ‡è¯†ï¼Œå¯¹äºä¸´æ—¶å€¼æˆ‘ä»¬ä»…ä»…éœ€è¦åšæµ…æ‹·è´å³å¯ï¼Œæ— éœ€å†åšæ·±æ‹·è´ï¼Œä»è€Œè§£å†³äº†å‰é¢æåˆ°çš„ä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº§ç”Ÿçš„æ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç§»åŠ¨è¯­ä¹‰ï¼Œå³å€¼å¼•ç”¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬æä¾›ç§»åŠ¨æ„é€ å‡½æ•°çš„åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ï¼Œä»¥é˜²æ­¢ç§»åŠ¨ä¸æˆåŠŸçš„æ—¶å€™è¿˜èƒ½æ‹·è´æ„é€ ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®‰å…¨ã€‚ æˆ‘ä»¬çŸ¥é“ç§»åŠ¨è¯­ä¹‰æ˜¯é€šè¿‡å³å€¼å¼•ç”¨æ¥åŒ¹é…ä¸´æ—¶å€¼çš„ï¼Œé‚£ä¹ˆï¼Œæ™®é€šçš„å·¦å€¼æ˜¯å¦ä¹Ÿèƒ½å€ŸåŠ©ç§»åŠ¨è¯­ä¹‰æ¥ä¼˜åŒ–æ€§èƒ½å‘¢ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿäº‹å®ä¸ŠC++11ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†std::moveæ–¹æ³•æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œä»è€Œæ–¹ä¾¿åº”ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚moveæ˜¯å°†å¯¹è±¡èµ„æºçš„æ‰€æœ‰æƒä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯è½¬ç§»ï¼Œæ²¡æœ‰å†…å­˜çš„æ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„moveè¯­ä¹‰ã€‚å¦‚å›¾1-1æ‰€ç¤ºæ˜¯æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«ã€‚å›¾1-1 æ·±æ‹·è´å’Œmoveçš„åŒºåˆ« å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š1234567&#123; std::list&lt; std::string&gt; tokens; //çœç•¥åˆå§‹åŒ–... std::list&lt; std::string&gt; t = tokens; //è¿™é‡Œå­˜åœ¨æ‹·è´ &#125;std::list&lt; std::string&gt; tokens;std::list&lt; std::string&gt; t = std::move(tokens); //è¿™é‡Œæ²¡æœ‰æ‹·è´ å¦‚æœä¸ç”¨std::moveï¼Œæ‹·è´çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½è¾ƒä½ã€‚ä½¿ç”¨moveå‡ ä¹æ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œåªæ˜¯è½¬æ¢äº†èµ„æºçš„æ‰€æœ‰æƒã€‚ä»–å®é™…ä¸Šå°†å·¦å€¼å˜æˆå³å€¼å¼•ç”¨ï¼Œç„¶ååº”ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå°±é¿å…äº†æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å†…éƒ¨æœ‰è¾ƒå¤§çš„å¯¹å†…å­˜æˆ–è€…åŠ¨æ€æ•°ç»„æ—¶ï¼Œå¾ˆæœ‰å¿…è¦å†™moveè¯­ä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°ï¼Œé¿å…æ— è°“çš„æ·±æ‹·è´ï¼Œä»¥æé«˜æ€§èƒ½ã€‚äº‹å®ä¸Šï¼ŒC++11ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ã€‚ è¿™é‡Œä¹Ÿè¦æ³¨æ„å¯¹moveè¯­ä¹‰çš„è¯¯è§£ï¼Œmoveå®é™…ä¸Šå®ƒå¹¶ä¸èƒ½ç§»åŠ¨ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚å¦‚æœæ˜¯ä¸€äº›åŸºæœ¬ç±»å‹æ¯”å¦‚intå’Œchar[10]å®šé•¿æ•°ç»„ç­‰ç±»å‹ï¼Œä½¿ç”¨moveçš„è¯ä»ç„¶ä¼šå‘ç”Ÿæ‹·è´ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œmoveå¯¹äºå«èµ„æºï¼ˆå †å†…å­˜æˆ–å¥æŸ„ï¼‰çš„å¯¹è±¡æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚ç¬¬4è¡Œä»£ç æ•…äº‹1template &lt;typename T&gt;void f(T&amp;&amp; val)&#123; foo(std::forward&lt;T&gt;(val)); &#125; C++11ä¹‹å‰è°ƒç”¨æ¨¡æ¿å‡½æ•°æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚ä½•æ­£ç¡®çš„ä¼ é€’å‚æ•°ã€‚æ¯”å¦‚ï¼š12345678910template &lt;typename T&gt;void forwardValue(T&amp; val)&#123; processValue(val); //å³å€¼å‚æ•°ä¼šå˜æˆå·¦å€¼ &#125;template &lt;typename T&gt;void forwardValue(const T&amp; val)&#123; processValue(val); //å‚æ•°éƒ½å˜æˆå¸¸é‡å·¦å€¼å¼•ç”¨äº† &#125;éƒ½ä¸èƒ½æŒ‰ç…§å‚æ•°çš„æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚ C++11å¼•å…¥äº†å®Œç¾è½¬å‘ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œå®Œå…¨ä¾ç…§æ¨¡æ¿çš„å‚æ•°çš„ç±»å‹ï¼ˆå³ä¿æŒå‚æ•°çš„å·¦å€¼ã€å³å€¼ç‰¹å¾ï¼‰ï¼Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ¨¡æ¿ä¸­è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚C++11ä¸­çš„std::forwardæ­£æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œä»–ä¼šæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š12345678910111213141516void processValue(int&amp; a)&#123; cout &lt;&lt; \"lvalue\" &lt;&lt; endl; &#125;void processValue(int&amp;&amp; a)&#123; cout &lt;&lt; \"rvalue\" &lt;&lt; endl; &#125;template &lt;typename T&gt;void forwardValue(T&amp;&amp; val)&#123; processValue(std::forward&lt;T&gt;(val)); //ç…§å‚æ•°æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚&#125;void Testdelcl()&#123; int i = 0; forwardValue(i); //ä¼ å…¥å·¦å€¼ forwardValue(0);//ä¼ å…¥å³å€¼ &#125;è¾“å‡ºï¼šlvaue rvalue å³å€¼å¼•ç”¨T&amp;&amp;æ˜¯ä¸€ä¸ªuniversal referencesï¼Œå¯ä»¥æ¥å—å·¦å€¼æˆ–è€…å³å€¼ï¼Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§è®©ä»–é€‚åˆä½œä¸ºä¸€ä¸ªå‚æ•°çš„è·¯ç”±ï¼Œç„¶åå†é€šè¿‡std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹å»åŒ¹é…å¯¹åº”çš„é‡è½½å‡½æ•°ï¼Œæœ€ç»ˆå®ç°å®Œç¾è½¬å‘ã€‚ æˆ‘ä»¬å¯ä»¥ç»“åˆå®Œç¾è½¬å‘å’Œç§»åŠ¨è¯­ä¹‰æ¥å®ç°ä¸€ä¸ªæ³›å‹çš„å·¥å‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š12345template&lt;typenameâ€¦ Args&gt;T* Instance(Args&amp;&amp;â€¦ args)&#123; return new T(std::forward&lt;Args &gt;(args)â€¦);&#125; è¿™ä¸ªå·¥å‚å‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ç±»å‹ï¼Œå†…éƒ¨ä½¿ç”¨std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ï¼Œå¦‚æœå‚æ•°çš„å®é™…ç±»å‹æ˜¯å³å€¼ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åŒ¹é…ç§»åŠ¨æ„é€ ï¼Œå¦‚æœæ˜¯å·¦å€¼åˆ™ä¼šåŒ¹é…æ‹·è´æ„é€ ã€‚æ€»ç»“ é€šè¿‡4è¡Œä»£ç æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä»¥åŠå³å€¼å¼•ç”¨çš„ä¸€äº›ç‰¹ç‚¹ï¼Œåˆ©ç”¨è¿™äº›ç‰¹ç‚¹æˆ‘ä»¬æ‰æ–¹ä¾¿å®ç°ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚C++11æ­£æ˜¯é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥é¿å…æ— è°“æ‹·è´çš„é—®é¢˜ï¼Œé€šè¿‡moveè¯­ä¹‰æ¥å°†ä¸´æ—¶ç”Ÿæˆçš„å·¦å€¼ä¸­çš„èµ„æºæ— ä»£ä»·çš„è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼Œé€šè¿‡å®Œç¾è½¬å‘æ¥è§£å†³ä¸èƒ½æŒ‰ç…§å‚æ•°å®é™…ç±»å‹æ¥è½¬å‘çš„é—®é¢˜ï¼ˆåŒæ—¶ï¼Œå®Œç¾è½¬å‘è·å¾—çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®ç°ç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚æœ¬æ–‡æ›¾å‘è¡¨äºã€Šç¨‹åºå‘˜ã€‹2015å¹´1æœˆåˆŠã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚åè®°ï¼šæœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªäºæˆ‘åœ¨å…¬å¸å†…éƒ¨åŸ¹è®­çš„ä¸€æ¬¡è¯¾ç¨‹ï¼Œå› ä¸ºå¾ˆå¤šäººå¯¹C++11å³å€¼å¼•ç”¨æä¸æ¸…æˆ–è€…ç†è§£å¾—ä¸æ·±å…¥ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå°±æ•´ç†äº†ä¸€ä¸‹å‘åˆ°ç¨‹åºå‘˜æ‚å¿—äº†ï¼Œæˆ‘ç›¸ä¿¡è¯»è€…çœ‹å®Œä¹‹åå¯¹å³å€¼å¼•ç”¨ä¼šæœ‰å…¨é¢æ·±å…¥çš„äº†è§£ã€‚ä¸€ç‚¹æ¢¦æƒ³ï¼šå°½è‡ªå·±ä¸€ä»½åŠ›ï¼Œè®©c++çš„ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼","raw":"---\ntitle: ä»4è¡Œä»£ç çœ‹å³å€¼å¼•ç”¨\ntags: C++\ncategories: C++\nabbrlink: 9d2f4ec8\ndate: 2019-05-23 14:50:40\ncopyright: true\ntype:\nkeyword:\ntop:\ncomments:\npassword:\ndescription:\n---\n\n## æ¦‚è¿°\nã€€ã€€å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®ä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š\n\n```\nint i = 0;\nint& j = i;\n```\n\nã€€ã€€è¿™é‡Œçš„int&æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&&ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»å‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&&æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š\nã€€ã€€\n<!-- more -->ã€€ã€€\n\n```\nint&& i = 0;\n```\n\nã€€ã€€è¿™é‡Œæˆ‘ä»¬ç»‘å®šäº†ä¸€ä¸ªå³å€¼0ï¼Œå…³äºå³å€¼çš„æ¦‚å¿µä¼šåœ¨åé¢ä»‹ç»ã€‚å³å€¼å¼•ç”¨æ˜¯C++11ä¸­æ–°å¢åŠ çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä»–ä¸»æ˜¯è¦ç”¨æ¥è§£å†³C++98/03ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸´æ—¶å¯¹è±¡éå¿…è¦çš„æ˜‚è´µçš„æ‹·è´æ“ä½œï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­å¦‚ä½•æŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ”¹è¿›äº†ç¨‹åºæ€§èƒ½ï¼Œåé¢å°†ä¼šè¯¦ç»†ä»‹ç»å³å€¼å¼•ç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚\n\nã€€ã€€å’Œå³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šå³å€¼ã€çº¯å³å€¼ã€å°†äº¡å€¼ã€universal referencesã€å¼•ç”¨æŠ˜å ã€ç§»åŠ¨è¯­ä¹‰ã€moveè¯­ä¹‰å’Œå®Œç¾è½¬å‘ç­‰ç­‰ã€‚å¾ˆå¤šéƒ½æ˜¯æ–°æ¦‚å¿µï¼Œå¯¹äºåˆšå­¦ä¹ C++11å³å€¼å¼•ç”¨çš„åˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šè§‰å¾—å³å€¼å¼•ç”¨è¿‡äºå¤æ‚ï¼Œæ¦‚å¿µä¹‹é—´çš„å…³ç³»éš¾ä»¥ç†æ¸…ã€‚\n\nå³å€¼å¼•ç”¨å®é™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå…¶å®æ˜¯å…³äº4è¡Œä»£ç çš„æ•…äº‹ï¼Œé€šè¿‡ç®€å•çš„4è¡Œä»£ç æˆ‘ä»¬å°±èƒ½æ¸…æ™°çš„ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µäº†ã€‚æœ¬æ–‡å¸Œæœ›å¸¦é¢†è¯»è€…é€šè¿‡4è¡Œä»£ç æ¥ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µï¼Œç†æ¸…ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æœ€ç»ˆèƒ½é€å½»åœ°æŒæ¡C++11çš„æ–°ç‰¹æ€§--å³å€¼å¼•ç”¨ã€‚\n\n## å››è¡Œä»£ç çš„æ•…äº‹\n### ç¬¬1è¡Œä»£ç çš„æ•…äº‹\n```\nint i = getVar();\n```\nã€€ã€€ä¸Šé¢çš„è¿™è¡Œä»£ç å¾ˆç®€å•ï¼Œä»getVar()å‡½æ•°è·å–ä¸€ä¸ªæ•´å½¢å€¼ï¼Œç„¶è€Œï¼Œè¿™è¡Œä»£ç ä¼šäº§ç”Ÿå‡ ç§ç±»å‹çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šäº§ç”Ÿä¸¤ç§ç±»å‹çš„å€¼ï¼Œä¸€ç§æ˜¯å·¦å€¼iï¼Œä¸€ç§æ˜¯å‡½æ•°getVar()è¿”å›çš„ä¸´æ—¶å€¼ï¼Œè¿™ä¸ªä¸´æ—¶å€¼åœ¨è¡¨è¾¾å¼ç»“æŸåå°±é”€æ¯äº†ï¼Œè€Œå·¦å€¼iåœ¨è¡¨è¾¾å¼ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªä¸´æ—¶å€¼å°±æ˜¯å³å€¼ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œå³å€¼æ˜¯ä¸å…·åçš„ã€‚åŒºåˆ†å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªç®€å•åŠæ³•æ˜¯ï¼šçœ‹èƒ½ä¸èƒ½å¯¹è¡¨è¾¾å¼å–åœ°å€ï¼Œå¦‚æœèƒ½ï¼Œåˆ™ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚\n\nã€€ã€€æ‰€æœ‰çš„å…·åå˜é‡æˆ–å¯¹è±¡éƒ½æ˜¯å·¦å€¼ï¼Œè€ŒåŒ¿åå˜é‡åˆ™æ˜¯å³å€¼ï¼Œæ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼è¯­å¥ï¼š\n\n```\nint i = 0;\n```\n\nã€€ã€€åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œi æ˜¯å·¦å€¼ï¼Œ0 æ˜¯å­—é¢é‡ï¼Œå°±æ˜¯å³å€¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œi å¯ä»¥è¢«å¼•ç”¨ï¼Œ0 å°±ä¸å¯ä»¥äº†ã€‚å…·ä½“æ¥è¯´ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­ç­‰å·å³è¾¹çš„0æ˜¯çº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œåœ¨C++11ä¸­æ‰€æœ‰çš„å€¼å¿…å±äºå·¦å€¼ã€å°†äº¡å€¼ã€çº¯å³å€¼ä¸‰è€…ä¹‹ä¸€ã€‚æ¯”å¦‚ï¼Œéå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€åŸå§‹å­—é¢é‡å’Œlambdaè¡¨è¾¾å¼ç­‰éƒ½æ˜¯çº¯å³å€¼ã€‚è€Œå°†äº¡å€¼æ˜¯C++11æ–°å¢çš„ã€ä¸å³å€¼å¼•ç”¨ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼Œå°†è¦è¢«ç§»åŠ¨çš„å¯¹è±¡ã€T&&å‡½æ•°è¿”å›å€¼ã€std::moveè¿”å›å€¼å’Œè½¬æ¢ä¸ºT&&çš„ç±»å‹çš„è½¬æ¢å‡½æ•°çš„è¿”å›å€¼ç­‰ã€‚å…³äºå°†äº¡å€¼æˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š\n\n```\nint j = 5;\n\nauto f = []{return 5;};\n```\n\nã€€ã€€ä¸Šé¢çš„ä»£ç ä¸­5æ˜¯ä¸€ä¸ªåŸå§‹å­—é¢é‡ï¼Œ []{return 5;}æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œéƒ½æ˜¯å±äºçº¯å³å€¼ï¼Œä»–ä»¬çš„ç‰¹ç‚¹æ˜¯åœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ã€‚\n\nã€€ã€€é€šè¿‡åœ°è¡Œä»£ç æˆ‘ä»¬å¯¹å³å€¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ç¬¬äºŒè¡Œä»£ç ã€‚\n\n### ç¬¬2è¡Œä»£ç çš„æ•…äº‹\n```\nT&& k = getVar();\n```\nã€€ã€€ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç å¾ˆåƒï¼Œåªæ˜¯ç›¸æ¯”ç¬¬ä¸€è¡Œä»£ç å¤šäº†â€œ&&â€ï¼Œä»–å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“å·¦å€¼å¼•ç”¨æ˜¯å¯¹å·¦å€¼çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œå¯¹åº”çš„ï¼Œå¯¹å³å€¼çš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œä¸”å³å€¼æ˜¯åŒ¿åå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥è·å–å³å€¼ã€‚è™½ç„¶ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯å®é™…ä¸Šè¯­ä¹‰çš„å·®åˆ«å¾ˆå¤§ï¼Œè¿™é‡Œï¼ŒgetVar()äº§ç”Ÿçš„ä¸´æ—¶å€¼ä¸ä¼šåƒç¬¬ä¸€è¡Œä»£ç é‚£æ ·ï¼Œåœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ï¼Œè€Œæ˜¯ä¼šè¢«â€œç»­å‘½â€ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šé€šè¿‡å³å€¼å¼•ç”¨å¾—ä»¥å»¶ç»­ï¼Œå’Œå˜é‡kçš„å£°æ˜å‘¨æœŸä¸€æ ·é•¿ã€‚\n\nå³å€¼å¼•ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹\nã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨çš„å£°æ˜ï¼Œå³å€¼åˆâ€œé‡è·æ–°ç”Ÿâ€ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸å³å€¼å¼•ç”¨ç±»å‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œåªè¦è¯¥å˜é‡è¿˜æ´»ç€ï¼Œè¯¥å³å€¼ä¸´æ—¶é‡å°†ä¼šä¸€ç›´å­˜æ´»ä¸‹å»ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä»£ç æ¸…å•1-1æ‰€ç¤ºã€‚\n\nä»£ç æ¸…å•1-1 \n\n```\n#include <iostream>\nusing namespace std;\n\nint g_constructCount=0;\nint g_copyConstructCount=0;\nint g_destructCount=0;\nstruct A\n{\n    A(){\n        cout<<\"construct: \"<<++g_constructCount<<endl;    \n    }\n    \n    A(const A& a)\n    {\n        cout<<\"copy construct: \"<<++g_copyConstructCount <<endl;\n    }\n    ~A()\n    {\n        cout<<\"destruct: \"<<++g_destructCount<<endl;\n    }\n};\n\nA GetA()\n{\n    return A();\n}\n\nint main() {\n    A a = GetA();\n    return 0;\n}\n```\n\nã€€ã€€ä¸ºäº†æ¸…æ¥šçš„è§‚å¯Ÿä¸´æ—¶å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsç”¨æ¥å…³é—­è¿”å›å€¼ä¼˜åŒ–æ•ˆæœã€‚\n\nã€€ã€€è¾“å‡ºç»“æœï¼š\n\n```\nconstruct: 1\ncopy construct: 1\ndestruct: 1\ncopy construct: 2\ndestruct: 2\ndestruct: 3\n```\nã€€ã€€ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰è¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‹·è´æ„é€ å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯GetA()å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¯¹è±¡è¿”å›å‡ºæ¥æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡äº§ç”Ÿçš„ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨mainå‡½æ•°ä¸­æ„é€ aå¯¹è±¡äº§ç”Ÿçš„ã€‚ç¬¬äºŒæ¬¡çš„destructæ˜¯å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨æ„é€ aå¯¹è±¡ä¹‹åå°±é”€æ¯äº†ã€‚å¦‚æœå¼€å¯è¿”å›å€¼ä¼˜åŒ–çš„è¯ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼š\n\nconstruct: 1\n\ndestruct: 1\n\nã€€ã€€å¯ä»¥çœ‹åˆ°è¿”å›å€¼ä¼˜åŒ–å°†ä¼šæŠŠä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æ‰ï¼Œä½†è¿™ä¸æ˜¯c++æ ‡å‡†ï¼Œæ˜¯å„ç¼–è¯‘å™¨çš„ä¼˜åŒ–è§„åˆ™ã€‚æˆ‘ä»¬åœ¨å›åˆ°ä¹‹å‰æåˆ°çš„å¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨æ¥å»¶é•¿ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡å³å€¼å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›å€¼çš„è¯ï¼Œç»“æœåˆä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsã€‚\n\n```\nint main() {\n    A&& a = GetA();\n    return 0;\n}\nè¾“å‡ºç»“æœï¼š\nconstruct: 1\ncopy construct: 1\ndestruct: 1\ndestruct: 2\n```\nã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæ¯”ä¹‹å‰å°‘äº†ä¸€æ¬¡æ‹·è´æ„é€ å’Œä¸€æ¬¡ææ„ï¼ŒåŸå› åœ¨äºå³å€¼å¼•ç”¨ç»‘å®šäº†å³å€¼ï¼Œè®©ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå³é¿å…ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æ„é€ å’Œææ„ï¼Œäº‹å®ä¸Šï¼Œåœ¨c++98/03ä¸­ï¼Œé€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨ä¹Ÿç»å¸¸ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ã€‚ä¸Šé¢çš„ä»£ç æ”¹æˆï¼š\n\nã€€ã€€const A& a = GetA();\n\nã€€ã€€è¾“å‡ºçš„ç»“æœå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œå› ä¸ºå¸¸é‡å·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªâ€œä¸‡èƒ½â€çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æ¥å—å·¦å€¼ã€å³å€¼ã€å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ™®é€šçš„å·¦å€¼å¼•ç”¨ä¸èƒ½æ¥å—å³å€¼ï¼Œæ¯”å¦‚è¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯¹çš„ï¼š\n\nã€€ã€€A& a = GetA();\n\nã€€ã€€ä¸Šé¢çš„ä»£ç ä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºéå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½æ¥å—å·¦å€¼ã€‚\n\nå³å€¼å¼•ç”¨çš„ç¬¬äºŒä¸ªç‰¹ç‚¹\nã€€ã€€å³å€¼å¼•ç”¨ç‹¬ç«‹äºå·¦å€¼å’Œå³å€¼ã€‚æ„æ€æ˜¯å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```\nint&& var1 = 1; \n```\n\nã€€ã€€var1ç±»å‹ä¸ºå³å€¼å¼•ç”¨ï¼Œä½†var1æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå…·åå˜é‡éƒ½æ˜¯å·¦å€¼ã€‚\n\nã€€ã€€å…³äºå³å€¼å¼•ç”¨ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜æ˜¯ï¼šT&&æ˜¯ä»€ä¹ˆï¼Œä¸€å®šæ˜¯å³å€¼å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```\ntemplate<typename T>\nvoid f(T&& t){}\nf(10); //tæ˜¯å³å€¼\nint x = 10;\nf(x); //tæ˜¯å·¦å€¼\n```\n\nã€€ã€€ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒT&&è¡¨ç¤ºçš„å€¼ç±»å‹ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯å·¦å€¼åˆå¯èƒ½æ˜¯å³å€¼ï¼Œè¿™ä¸€ç‚¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™å°±æ˜¯å³å€¼å¼•ç”¨çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚\n\nå³å€¼å¼•ç”¨çš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹\nã€€ã€€T&& tåœ¨å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨æ–­çš„æ—¶å€™ï¼Œå®ƒæ˜¯æœªå®šçš„å¼•ç”¨ç±»å‹ï¼ˆuniversal referencesï¼‰ï¼Œå¦‚æœè¢«ä¸€ä¸ªå·¦å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼›å¦‚æœå®ƒè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå®ƒæ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼å–å†³äºå®ƒçš„åˆå§‹åŒ–ã€‚\n\næˆ‘ä»¬å†å›è¿‡å¤´çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹äºå‡½æ•°template<typename T>void f(T&& t)ï¼Œå½“å‚æ•°ä¸ºå³å€¼10çš„æ—¶å€™ï¼Œæ ¹æ®universal referencesçš„ç‰¹ç‚¹ï¼Œtè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯å³å€¼ï¼›å½“å‚æ•°ä¸ºå·¦å€¼xæ—¶ï¼Œtè¢«ä¸€ä¸ªå·¦å€¼å¼•ç”¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…æ˜¯å½“å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œæˆ–autoå…³é”®å­—ï¼‰çš„æ—¶å€™ï¼ŒT&&æ‰æ˜¯universal referencesã€‚å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```\ntemplate<typename T>\nvoid f(T&& param); \n\ntemplate<typename T>\nclass Test {\n    Test(Test&& rhs); \n};\n```\nã€€ã€€ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œparamæ˜¯universal referenceï¼Œrhsæ˜¯Test&&å³å€¼å¼•ç”¨ï¼Œå› ä¸ºæ¨¡ç‰ˆå‡½æ•°få‘ç”Ÿäº†ç±»å‹æ¨æ–­ï¼Œè€ŒTest&&å¹¶æ²¡æœ‰å‘ç”Ÿç±»å‹æ¨å¯¼ï¼Œå› ä¸ºTest&&æ˜¯ç¡®å®šçš„ç±»å‹äº†ã€‚\n\nã€€ã€€æ­£æ˜¯å› ä¸ºå³å€¼å¼•ç”¨å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œä¾èµ–äºåˆå§‹åŒ–ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šæ–‡ç« ï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚\n\nã€€ã€€è¿™é‡Œå†æä¸€ä¸‹å¼•ç”¨æŠ˜å ï¼Œæ­£æ˜¯å› ä¸ºå¼•å…¥äº†å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„æŠ˜å ï¼ŒC++11ç¡®å®šäº†å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼š\n\n*   æ‰€æœ‰çš„å³å€¼å¼•ç”¨å åŠ åˆ°å³å€¼å¼•ç”¨ä¸Šä»ç„¶è¿˜æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼›\n*   æ‰€æœ‰çš„å…¶ä»–å¼•ç”¨ç±»å‹ä¹‹é—´çš„å åŠ éƒ½å°†å˜æˆå·¦å€¼å¼•ç”¨ã€‚\n\n### ç¬¬3è¡Œä»£ç çš„æ•…äº‹\n```\nT(T&& a) : m_val(val){ a.m_val=nullptr; }\n```\nã€€ã€€è¿™è¡Œä»£ç å®é™…ä¸Šæ¥è‡ªäºä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä¸ºä»€ä¹ˆå°†å³å€¼å¼•ç”¨ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°å‘¢ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚ä»£ç æ¸…å•1-2æ‰€ç¤ºã€‚\n\nä»£ç æ¸…å•1-2\n\n```\nclass A\n{\npublic:\n    A():m_ptr(new int(0)){cout << \"construct\" << endl;}\n    A(const A& a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°\n    {\n        cout << \"copy construct\" << endl;\n    }\n    ~A(){ delete m_ptr;}\nprivate:\n    int* m_ptr;\n};\nint main() {\n    A a = GetA();\n    return 0;\n}\n    è¾“å‡ºï¼š\nconstruct\ncopy construct\ncopy construct\n```\nã€€ã€€è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸€ä¸ªå¸¦æœ‰å †å†…å­˜çš„ç±»ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæ·±æ‹·è´æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œä¼šå‘ç”Ÿâ€œæŒ‡é’ˆæ‚¬æŒ‚â€çš„é—®é¢˜ã€‚å¦‚æœä¸æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä¸Šé¢çš„æµ‹è¯•ä»£ç å°†ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆç¼–è¯‘é€‰é¡¹-fno-elide-constructorsï¼‰ï¼Œå†…éƒ¨çš„m_ptrå°†ä¼šè¢«åˆ é™¤ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¸´æ—¶å³å€¼ææ„çš„æ—¶å€™åˆ é™¤ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡å¤–é¢æ„é€ çš„aå¯¹è±¡é‡Šæ”¾æ—¶åˆ é™¤ä¸€æ¬¡ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„m_ptræ˜¯åŒä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æŒ‡é’ˆæ‚¬æŒ‚é—®é¢˜ã€‚æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°è™½ç„¶å¯ä»¥ä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ä¼šé€ æˆé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™ç§æ·±æ‹·è´æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š\n\n\n\nã€€ã€€ä¸Šé¢ä»£ç ä¸­çš„GetAå‡½æ•°ä¼šè¿”å›ä¸´æ—¶å˜é‡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡aï¼Œä¸´æ—¶å˜é‡åœ¨æ‹·è´æ„é€ å®Œæˆä¹‹åå°±é”€æ¯äº†ï¼Œå¦‚æœå †å†…å­˜å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ‹·è´æ„é€ çš„ä»£ä»·ä¼šå¾ˆå¤§ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸´æ—¶å˜é‡å¹¶é€ æˆé¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œæœ‰æ²¡æœ‰åŠæ³•é¿å…ä¸´æ—¶å˜é‡é€ æˆçš„æ€§èƒ½æŸå¤±å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒC++11å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚ä»£ç æ¸…å•1-3æ‰€ç¤ºã€‚\n\nä»£ç æ¸…å•1-3\n\n```\nclass A\n{\npublic:\n    A() :m_ptr(new int(0)){}\n    A(const A& a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°\n    {\n        cout << \"copy construct\" << endl;\n    }\n    A(A&& a) :m_ptr(a.m_ptr)\n    {\n        a.m_ptr = nullptr;\n        cout << \"move construct\" << endl;\n    }\n    ~A(){ delete m_ptr;}\nprivate:\n    int* m_ptr;\n};\nint main(){\n    A a = Get(false); \n} \nè¾“å‡ºï¼š\nconstruct\nmove construct\nmove construct\n```\nã€€ã€€ä»£ç æ¸…å•1-3å’Œ1-2ç›¸æ¯”åªå¤šäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å‡ºç»“æœè¡¨æ˜ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œåªè°ƒç”¨äº†move constructå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªmove constructå‡½æ•°ï¼š\n\n```\nA(A&& a) :m_ptr(a.m_ptr)\n{\n    a.m_ptr = nullptr;\n    cout << \"move construct\" << endl;\n}\n```\n\nã€€ã€€è¿™ä¸ªæ„é€ å‡½æ•°å¹¶æ²¡æœ‰åšæ·±æ‹·è´ï¼Œä»…ä»…æ˜¯å°†æŒ‡é’ˆçš„æ‰€æœ‰è€…è½¬ç§»åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†å‚æ•°å¯¹è±¡açš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œè¿™é‡Œä»…ä»…æ˜¯åšäº†æµ…æ‹·è´ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°é¿å…äº†ä¸´æ—¶å˜é‡çš„æ·±æ‹·è´é—®é¢˜ã€‚\n\nã€€ã€€ä¸Šé¢è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œçš„A&&è¡¨ç¤ºå³å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‰é¢å·²ç»æåˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å‘ç”Ÿç±»å‹æ¨æ–­ï¼Œæ˜¯ç¡®å®šçš„å³å€¼å¼•ç”¨ç±»å‹ã€‚ä¸ºä»€ä¹ˆä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ï¼Ÿå› ä¸ºè¿™ä¸ªæ„é€ å‡½æ•°åªèƒ½æ¥å—å³å€¼å‚æ•°ï¼Œè€Œå‡½æ•°è¿”å›å€¼æ˜¯å³å€¼ï¼Œæ‰€ä»¥å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„A&&å¯ä»¥çœ‹ä½œæ˜¯ä¸´æ—¶å€¼çš„æ ‡è¯†ï¼Œå¯¹äºä¸´æ—¶å€¼æˆ‘ä»¬ä»…ä»…éœ€è¦åšæµ…æ‹·è´å³å¯ï¼Œæ— éœ€å†åšæ·±æ‹·è´ï¼Œä»è€Œè§£å†³äº†å‰é¢æåˆ°çš„ä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº§ç”Ÿçš„æ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç§»åŠ¨è¯­ä¹‰ï¼Œå³å€¼å¼•ç”¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ã€‚\n\nã€€ã€€éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬æä¾›ç§»åŠ¨æ„é€ å‡½æ•°çš„åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ï¼Œä»¥é˜²æ­¢ç§»åŠ¨ä¸æˆåŠŸçš„æ—¶å€™è¿˜èƒ½æ‹·è´æ„é€ ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®‰å…¨ã€‚\n\nã€€ã€€æˆ‘ä»¬çŸ¥é“ç§»åŠ¨è¯­ä¹‰æ˜¯é€šè¿‡å³å€¼å¼•ç”¨æ¥åŒ¹é…ä¸´æ—¶å€¼çš„ï¼Œé‚£ä¹ˆï¼Œæ™®é€šçš„å·¦å€¼æ˜¯å¦ä¹Ÿèƒ½å€ŸåŠ©ç§»åŠ¨è¯­ä¹‰æ¥ä¼˜åŒ–æ€§èƒ½å‘¢ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿäº‹å®ä¸ŠC++11ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†std::moveæ–¹æ³•æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œä»è€Œæ–¹ä¾¿åº”ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚moveæ˜¯å°†å¯¹è±¡èµ„æºçš„æ‰€æœ‰æƒä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯è½¬ç§»ï¼Œæ²¡æœ‰å†…å­˜çš„æ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„moveè¯­ä¹‰ã€‚å¦‚å›¾1-1æ‰€ç¤ºæ˜¯æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«ã€‚\n\n\n\nå›¾1-1 æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«\n\nã€€ã€€å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```\n{\n    std::list< std::string> tokens;\n    //çœç•¥åˆå§‹åŒ–...\n    std::list< std::string> t = tokens; //è¿™é‡Œå­˜åœ¨æ‹·è´ \n}\nstd::list< std::string> tokens;\nstd::list< std::string> t = std::move(tokens);  //è¿™é‡Œæ²¡æœ‰æ‹·è´ \n```\nã€€ã€€å¦‚æœä¸ç”¨std::moveï¼Œæ‹·è´çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½è¾ƒä½ã€‚ä½¿ç”¨moveå‡ ä¹æ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œåªæ˜¯è½¬æ¢äº†èµ„æºçš„æ‰€æœ‰æƒã€‚ä»–å®é™…ä¸Šå°†å·¦å€¼å˜æˆå³å€¼å¼•ç”¨ï¼Œç„¶ååº”ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå°±é¿å…äº†æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å†…éƒ¨æœ‰è¾ƒå¤§çš„å¯¹å†…å­˜æˆ–è€…åŠ¨æ€æ•°ç»„æ—¶ï¼Œå¾ˆæœ‰å¿…è¦å†™moveè¯­ä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°ï¼Œé¿å…æ— è°“çš„æ·±æ‹·è´ï¼Œä»¥æé«˜æ€§èƒ½ã€‚äº‹å®ä¸Šï¼ŒC++11ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ã€‚\n\nã€€ã€€è¿™é‡Œä¹Ÿè¦æ³¨æ„å¯¹moveè¯­ä¹‰çš„è¯¯è§£ï¼Œmoveå®é™…ä¸Šå®ƒå¹¶ä¸èƒ½ç§»åŠ¨ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚å¦‚æœæ˜¯ä¸€äº›åŸºæœ¬ç±»å‹æ¯”å¦‚intå’Œchar[10]å®šé•¿æ•°ç»„ç­‰ç±»å‹ï¼Œä½¿ç”¨moveçš„è¯ä»ç„¶ä¼šå‘ç”Ÿæ‹·è´ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œmoveå¯¹äºå«èµ„æºï¼ˆå †å†…å­˜æˆ–å¥æŸ„ï¼‰çš„å¯¹è±¡æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚\n\n### ç¬¬4è¡Œä»£ç æ•…äº‹\n```\ntemplate <typename T>void f(T&& val){ foo(std::forward<T>(val)); }\n```\nã€€ã€€C++11ä¹‹å‰è°ƒç”¨æ¨¡æ¿å‡½æ•°æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚ä½•æ­£ç¡®çš„ä¼ é€’å‚æ•°ã€‚æ¯”å¦‚ï¼š \n\n```\ntemplate <typename T>\nvoid forwardValue(T& val)\n{\n    processValue(val); //å³å€¼å‚æ•°ä¼šå˜æˆå·¦å€¼ \n}\ntemplate <typename T>\nvoid forwardValue(const T& val)\n{\n    processValue(val); //å‚æ•°éƒ½å˜æˆå¸¸é‡å·¦å€¼å¼•ç”¨äº† \n}\n```\néƒ½ä¸èƒ½æŒ‰ç…§å‚æ•°çš„æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚\n\nã€€ã€€C++11å¼•å…¥äº†å®Œç¾è½¬å‘ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œå®Œå…¨ä¾ç…§æ¨¡æ¿çš„å‚æ•°çš„ç±»å‹ï¼ˆå³ä¿æŒå‚æ•°çš„å·¦å€¼ã€å³å€¼ç‰¹å¾ï¼‰ï¼Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ¨¡æ¿ä¸­è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚C++11ä¸­çš„std::forwardæ­£æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œä»–ä¼šæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š\n\n```\nvoid processValue(int& a){ cout << \"lvalue\" << endl; }\nvoid processValue(int&& a){ cout << \"rvalue\" << endl; }\ntemplate <typename T>\nvoid forwardValue(T&& val)\n{\n    processValue(std::forward<T>(val)); //ç…§å‚æ•°æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚\n}\nvoid Testdelcl()\n{\n    int i = 0;\n    forwardValue(i); //ä¼ å…¥å·¦å€¼ \n    forwardValue(0);//ä¼ å…¥å³å€¼ \n}\nè¾“å‡ºï¼š\nlvaue \nrvalue\n```\nã€€ã€€å³å€¼å¼•ç”¨T&&æ˜¯ä¸€ä¸ªuniversal referencesï¼Œå¯ä»¥æ¥å—å·¦å€¼æˆ–è€…å³å€¼ï¼Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§è®©ä»–é€‚åˆä½œä¸ºä¸€ä¸ªå‚æ•°çš„è·¯ç”±ï¼Œç„¶åå†é€šè¿‡std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹å»åŒ¹é…å¯¹åº”çš„é‡è½½å‡½æ•°ï¼Œæœ€ç»ˆå®ç°å®Œç¾è½¬å‘ã€‚\n\nã€€ã€€æˆ‘ä»¬å¯ä»¥ç»“åˆå®Œç¾è½¬å‘å’Œç§»åŠ¨è¯­ä¹‰æ¥å®ç°ä¸€ä¸ªæ³›å‹çš„å·¥å‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š\n\n```\ntemplate<typenameâ€¦  Args>\nT* Instance(Args&&â€¦ args)\n{\n    return new T(std::forward<Args >(args)â€¦);\n}\n```\nã€€ã€€è¿™ä¸ªå·¥å‚å‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ç±»å‹ï¼Œå†…éƒ¨ä½¿ç”¨std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ï¼Œå¦‚æœå‚æ•°çš„å®é™…ç±»å‹æ˜¯å³å€¼ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åŒ¹é…ç§»åŠ¨æ„é€ ï¼Œå¦‚æœæ˜¯å·¦å€¼åˆ™ä¼šåŒ¹é…æ‹·è´æ„é€ ã€‚\n\n## æ€»ç»“\nã€€ã€€é€šè¿‡4è¡Œä»£ç æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä»¥åŠå³å€¼å¼•ç”¨çš„ä¸€äº›ç‰¹ç‚¹ï¼Œåˆ©ç”¨è¿™äº›ç‰¹ç‚¹æˆ‘ä»¬æ‰æ–¹ä¾¿å®ç°ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚C++11æ­£æ˜¯é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥é¿å…æ— è°“æ‹·è´çš„é—®é¢˜ï¼Œé€šè¿‡moveè¯­ä¹‰æ¥å°†ä¸´æ—¶ç”Ÿæˆçš„å·¦å€¼ä¸­çš„èµ„æºæ— ä»£ä»·çš„è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼Œé€šè¿‡å®Œç¾è½¬å‘æ¥è§£å†³ä¸èƒ½æŒ‰ç…§å‚æ•°å®é™…ç±»å‹æ¥è½¬å‘çš„é—®é¢˜ï¼ˆåŒæ—¶ï¼Œå®Œç¾è½¬å‘è·å¾—çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®ç°ç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚\n\n*æœ¬æ–‡æ›¾å‘è¡¨äºã€Šç¨‹åºå‘˜ã€‹2015å¹´1æœˆåˆŠã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚*\n\n*åè®°ï¼š*æœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªäºæˆ‘åœ¨å…¬å¸å†…éƒ¨åŸ¹è®­çš„ä¸€æ¬¡è¯¾ç¨‹ï¼Œå› ä¸ºå¾ˆå¤šäººå¯¹C++11å³å€¼å¼•ç”¨æä¸æ¸…æˆ–è€…ç†è§£å¾—ä¸æ·±å…¥ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå°±æ•´ç†äº†ä¸€ä¸‹å‘åˆ°ç¨‹åºå‘˜æ‚å¿—äº†ï¼Œæˆ‘ç›¸ä¿¡è¯»è€…çœ‹å®Œä¹‹åå¯¹å³å€¼å¼•ç”¨ä¼šæœ‰å…¨é¢æ·±å…¥çš„äº†è§£ã€‚\n\n \n\nä¸€ç‚¹æ¢¦æƒ³ï¼šå°½è‡ªå·±ä¸€ä»½åŠ›ï¼Œè®©c++çš„ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼","content":"<h2 id=\"æ¦‚è¿°\"><a href=\"#æ¦‚è¿°\" class=\"headerlink\" title=\"æ¦‚è¿°\"></a>æ¦‚è¿°</h2><p>ã€€ã€€å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®ä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š</p><figure class=\"highlight matlab\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int <span class=\"built_in\">i</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">int&amp; <span class=\"built_in\">j</span> = <span class=\"built_in\">i</span>;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™é‡Œçš„int&amp;æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&amp;å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&amp;&amp;ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»å‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&amp;&amp;æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š<br>ã€€ã€€<br><a id=\"more\"></a>ã€€ã€€</p><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int<span class=\"meta\">&amp;&amp; i = 0;</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™é‡Œæˆ‘ä»¬ç»‘å®šäº†ä¸€ä¸ªå³å€¼0ï¼Œå…³äºå³å€¼çš„æ¦‚å¿µä¼šåœ¨åé¢ä»‹ç»ã€‚å³å€¼å¼•ç”¨æ˜¯C++11ä¸­æ–°å¢åŠ çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä»–ä¸»æ˜¯è¦ç”¨æ¥è§£å†³C++98/03ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸´æ—¶å¯¹è±¡éå¿…è¦çš„æ˜‚è´µçš„æ‹·è´æ“ä½œï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­å¦‚ä½•æŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ”¹è¿›äº†ç¨‹åºæ€§èƒ½ï¼Œåé¢å°†ä¼šè¯¦ç»†ä»‹ç»å³å€¼å¼•ç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚</p><p>ã€€ã€€å’Œå³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šå³å€¼ã€çº¯å³å€¼ã€å°†äº¡å€¼ã€universal referencesã€å¼•ç”¨æŠ˜å ã€ç§»åŠ¨è¯­ä¹‰ã€moveè¯­ä¹‰å’Œå®Œç¾è½¬å‘ç­‰ç­‰ã€‚å¾ˆå¤šéƒ½æ˜¯æ–°æ¦‚å¿µï¼Œå¯¹äºåˆšå­¦ä¹ C++11å³å€¼å¼•ç”¨çš„åˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šè§‰å¾—å³å€¼å¼•ç”¨è¿‡äºå¤æ‚ï¼Œæ¦‚å¿µä¹‹é—´çš„å…³ç³»éš¾ä»¥ç†æ¸…ã€‚</p><p>å³å€¼å¼•ç”¨å®é™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå…¶å®æ˜¯å…³äº4è¡Œä»£ç çš„æ•…äº‹ï¼Œé€šè¿‡ç®€å•çš„4è¡Œä»£ç æˆ‘ä»¬å°±èƒ½æ¸…æ™°çš„ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µäº†ã€‚æœ¬æ–‡å¸Œæœ›å¸¦é¢†è¯»è€…é€šè¿‡4è¡Œä»£ç æ¥ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µï¼Œç†æ¸…ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æœ€ç»ˆèƒ½é€å½»åœ°æŒæ¡C++11çš„æ–°ç‰¹æ€§â€“å³å€¼å¼•ç”¨ã€‚</p><h2 id=\"å››è¡Œä»£ç çš„æ•…äº‹\"><a href=\"#å››è¡Œä»£ç çš„æ•…äº‹\" class=\"headerlink\" title=\"å››è¡Œä»£ç çš„æ•…äº‹\"></a>å››è¡Œä»£ç çš„æ•…äº‹</h2><h3 id=\"ç¬¬1è¡Œä»£ç çš„æ•…äº‹\"><a href=\"#ç¬¬1è¡Œä»£ç çš„æ•…äº‹\" class=\"headerlink\" title=\"ç¬¬1è¡Œä»£ç çš„æ•…äº‹\"></a>ç¬¬1è¡Œä»£ç çš„æ•…äº‹</h3><figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">int i</span> = getVar();</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢çš„è¿™è¡Œä»£ç å¾ˆç®€å•ï¼Œä»getVar()å‡½æ•°è·å–ä¸€ä¸ªæ•´å½¢å€¼ï¼Œç„¶è€Œï¼Œè¿™è¡Œä»£ç ä¼šäº§ç”Ÿå‡ ç§ç±»å‹çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šäº§ç”Ÿä¸¤ç§ç±»å‹çš„å€¼ï¼Œä¸€ç§æ˜¯å·¦å€¼iï¼Œä¸€ç§æ˜¯å‡½æ•°getVar()è¿”å›çš„ä¸´æ—¶å€¼ï¼Œè¿™ä¸ªä¸´æ—¶å€¼åœ¨è¡¨è¾¾å¼ç»“æŸåå°±é”€æ¯äº†ï¼Œè€Œå·¦å€¼iåœ¨è¡¨è¾¾å¼ç»“æŸåä»ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªä¸´æ—¶å€¼å°±æ˜¯å³å€¼ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œå³å€¼æ˜¯ä¸å…·åçš„ã€‚åŒºåˆ†å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªç®€å•åŠæ³•æ˜¯ï¼šçœ‹èƒ½ä¸èƒ½å¯¹è¡¨è¾¾å¼å–åœ°å€ï¼Œå¦‚æœèƒ½ï¼Œåˆ™ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚</p><p>ã€€ã€€æ‰€æœ‰çš„å…·åå˜é‡æˆ–å¯¹è±¡éƒ½æ˜¯å·¦å€¼ï¼Œè€ŒåŒ¿åå˜é‡åˆ™æ˜¯å³å€¼ï¼Œæ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼è¯­å¥ï¼š</p><figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">int i</span> = 0;</span><br></pre></td></tr></table></figure><p>ã€€ã€€åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œi æ˜¯å·¦å€¼ï¼Œ0 æ˜¯å­—é¢é‡ï¼Œå°±æ˜¯å³å€¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œi å¯ä»¥è¢«å¼•ç”¨ï¼Œ0 å°±ä¸å¯ä»¥äº†ã€‚å…·ä½“æ¥è¯´ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­ç­‰å·å³è¾¹çš„0æ˜¯çº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œåœ¨C++11ä¸­æ‰€æœ‰çš„å€¼å¿…å±äºå·¦å€¼ã€å°†äº¡å€¼ã€çº¯å³å€¼ä¸‰è€…ä¹‹ä¸€ã€‚æ¯”å¦‚ï¼Œéå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€åŸå§‹å­—é¢é‡å’Œlambdaè¡¨è¾¾å¼ç­‰éƒ½æ˜¯çº¯å³å€¼ã€‚è€Œå°†äº¡å€¼æ˜¯C++11æ–°å¢çš„ã€ä¸å³å€¼å¼•ç”¨ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼Œå°†è¦è¢«ç§»åŠ¨çš„å¯¹è±¡ã€T&amp;&amp;å‡½æ•°è¿”å›å€¼ã€std::moveè¿”å›å€¼å’Œè½¬æ¢ä¸ºT&amp;&amp;çš„ç±»å‹çš„è½¬æ¢å‡½æ•°çš„è¿”å›å€¼ç­‰ã€‚å…³äºå°†äº¡å€¼æˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> j = <span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">auto</span> f = []&#123;<span class=\"keyword\">return</span> <span class=\"number\">5</span>;&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢çš„ä»£ç ä¸­5æ˜¯ä¸€ä¸ªåŸå§‹å­—é¢é‡ï¼Œ []{return 5;}æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œéƒ½æ˜¯å±äºçº¯å³å€¼ï¼Œä»–ä»¬çš„ç‰¹ç‚¹æ˜¯åœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ã€‚</p><p>ã€€ã€€é€šè¿‡åœ°è¡Œä»£ç æˆ‘ä»¬å¯¹å³å€¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼ï¼Œæ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ç¬¬äºŒè¡Œä»£ç ã€‚</p><h3 id=\"ç¬¬2è¡Œä»£ç çš„æ•…äº‹\"><a href=\"#ç¬¬2è¡Œä»£ç çš„æ•…äº‹\" class=\"headerlink\" title=\"ç¬¬2è¡Œä»£ç çš„æ•…äº‹\"></a>ç¬¬2è¡Œä»£ç çš„æ•…äº‹</h3><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">T<span class=\"meta\">&amp;&amp; k = getVar();</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç å¾ˆåƒï¼Œåªæ˜¯ç›¸æ¯”ç¬¬ä¸€è¡Œä»£ç å¤šäº†â€œ&amp;&amp;â€ï¼Œä»–å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“å·¦å€¼å¼•ç”¨æ˜¯å¯¹å·¦å€¼çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œå¯¹åº”çš„ï¼Œå¯¹å³å€¼çš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œä¸”å³å€¼æ˜¯åŒ¿åå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥è·å–å³å€¼ã€‚è™½ç„¶ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯å®é™…ä¸Šè¯­ä¹‰çš„å·®åˆ«å¾ˆå¤§ï¼Œè¿™é‡Œï¼ŒgetVar()äº§ç”Ÿçš„ä¸´æ—¶å€¼ä¸ä¼šåƒç¬¬ä¸€è¡Œä»£ç é‚£æ ·ï¼Œåœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åå°±é”€æ¯äº†ï¼Œè€Œæ˜¯ä¼šè¢«â€œç»­å‘½â€ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šé€šè¿‡å³å€¼å¼•ç”¨å¾—ä»¥å»¶ç»­ï¼Œå’Œå˜é‡kçš„å£°æ˜å‘¨æœŸä¸€æ ·é•¿ã€‚</p><p>å³å€¼å¼•ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹<br>ã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨çš„å£°æ˜ï¼Œå³å€¼åˆâ€œé‡è·æ–°ç”Ÿâ€ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸å³å€¼å¼•ç”¨ç±»å‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œåªè¦è¯¥å˜é‡è¿˜æ´»ç€ï¼Œè¯¥å³å€¼ä¸´æ—¶é‡å°†ä¼šä¸€ç›´å­˜æ´»ä¸‹å»ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä»£ç æ¸…å•1-1æ‰€ç¤ºã€‚</p><p>ä»£ç æ¸…å•1-1</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> g_constructCount=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> g_copyConstructCount=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> g_destructCount=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    A()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span>&lt;&lt;<span class=\"string\">\"construct: \"</span>&lt;&lt;++g_constructCount&lt;&lt;<span class=\"built_in\">endl</span>;    </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    A(<span class=\"keyword\">const</span> A&amp; a)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span>&lt;&lt;<span class=\"string\">\"copy construct: \"</span>&lt;&lt;++g_copyConstructCount &lt;&lt;<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ~A()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span>&lt;&lt;<span class=\"string\">\"destruct: \"</span>&lt;&lt;++g_destructCount&lt;&lt;<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">A <span class=\"title\">GetA</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> A();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    A a = GetA();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸ºäº†æ¸…æ¥šçš„è§‚å¯Ÿä¸´æ—¶å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsç”¨æ¥å…³é—­è¿”å›å€¼ä¼˜åŒ–æ•ˆæœã€‚</p><p>ã€€ã€€è¾“å‡ºç»“æœï¼š</p><figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">construc<span class=\"variable\">t:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">copy</span> construc<span class=\"variable\">t:</span> <span class=\"number\">1</span></span><br><span class=\"line\">destruc<span class=\"variable\">t:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">copy</span> construc<span class=\"variable\">t:</span> <span class=\"number\">2</span></span><br><span class=\"line\">destruc<span class=\"variable\">t:</span> <span class=\"number\">2</span></span><br><span class=\"line\">destruc<span class=\"variable\">t:</span> <span class=\"number\">3</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰è¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‹·è´æ„é€ å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯GetA()å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¯¹è±¡è¿”å›å‡ºæ¥æ„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡äº§ç”Ÿçš„ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨mainå‡½æ•°ä¸­æ„é€ aå¯¹è±¡äº§ç”Ÿçš„ã€‚ç¬¬äºŒæ¬¡çš„destructæ˜¯å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨æ„é€ aå¯¹è±¡ä¹‹åå°±é”€æ¯äº†ã€‚å¦‚æœå¼€å¯è¿”å›å€¼ä¼˜åŒ–çš„è¯ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼š</p><p>construct: 1</p><p>destruct: 1</p><p>ã€€ã€€å¯ä»¥çœ‹åˆ°è¿”å›å€¼ä¼˜åŒ–å°†ä¼šæŠŠä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æ‰ï¼Œä½†è¿™ä¸æ˜¯c++æ ‡å‡†ï¼Œæ˜¯å„ç¼–è¯‘å™¨çš„ä¼˜åŒ–è§„åˆ™ã€‚æˆ‘ä»¬åœ¨å›åˆ°ä¹‹å‰æåˆ°çš„å¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨æ¥å»¶é•¿ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡å³å€¼å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›å€¼çš„è¯ï¼Œç»“æœåˆä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsã€‚</p><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> main() &#123;</span><br><span class=\"line\">    A&amp;&amp; a = GetA();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">è¾“å‡ºç»“æœï¼š</span><br><span class=\"line\"><span class=\"string\">construct:</span> <span class=\"number\">1</span></span><br><span class=\"line\">copy <span class=\"string\">construct:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"string\">destruct:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"string\">destruct:</span> <span class=\"number\">2</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæ¯”ä¹‹å‰å°‘äº†ä¸€æ¬¡æ‹·è´æ„é€ å’Œä¸€æ¬¡ææ„ï¼ŒåŸå› åœ¨äºå³å€¼å¼•ç”¨ç»‘å®šäº†å³å€¼ï¼Œè®©ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå³é¿å…ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æ„é€ å’Œææ„ï¼Œäº‹å®ä¸Šï¼Œåœ¨c++98/03ä¸­ï¼Œé€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨ä¹Ÿç»å¸¸ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ã€‚ä¸Šé¢çš„ä»£ç æ”¹æˆï¼š</p><p>ã€€ã€€const A&amp; a = GetA();</p><p>ã€€ã€€è¾“å‡ºçš„ç»“æœå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œå› ä¸ºå¸¸é‡å·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªâ€œä¸‡èƒ½â€çš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥æ¥å—å·¦å€¼ã€å³å€¼ã€å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ™®é€šçš„å·¦å€¼å¼•ç”¨ä¸èƒ½æ¥å—å³å€¼ï¼Œæ¯”å¦‚è¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯¹çš„ï¼š</p><p>ã€€ã€€A&amp; a = GetA();</p><p>ã€€ã€€ä¸Šé¢çš„ä»£ç ä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºéå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½æ¥å—å·¦å€¼ã€‚</p><p>å³å€¼å¼•ç”¨çš„ç¬¬äºŒä¸ªç‰¹ç‚¹<br>ã€€ã€€å³å€¼å¼•ç”¨ç‹¬ç«‹äºå·¦å€¼å’Œå³å€¼ã€‚æ„æ€æ˜¯å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int<span class=\"meta\">&amp;&amp; var1 = 1;</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€var1ç±»å‹ä¸ºå³å€¼å¼•ç”¨ï¼Œä½†var1æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå…·åå˜é‡éƒ½æ˜¯å·¦å€¼ã€‚</p><p>ã€€ã€€å…³äºå³å€¼å¼•ç”¨ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜æ˜¯ï¼šT&amp;&amp;æ˜¯ä»€ä¹ˆï¼Œä¸€å®šæ˜¯å³å€¼å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">f</span><span class=\"params\">(T&amp;&amp; t)</span></span>&#123;&#125;</span><br><span class=\"line\">f(<span class=\"number\">10</span>); <span class=\"comment\">//tæ˜¯å³å€¼</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> x = <span class=\"number\">10</span>;</span><br><span class=\"line\">f(x); <span class=\"comment\">//tæ˜¯å·¦å€¼</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»ä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒT&amp;&amp;è¡¨ç¤ºçš„å€¼ç±»å‹ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯å·¦å€¼åˆå¯èƒ½æ˜¯å³å€¼ï¼Œè¿™ä¸€ç‚¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™å°±æ˜¯å³å€¼å¼•ç”¨çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚</p><p>å³å€¼å¼•ç”¨çš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹<br>ã€€ã€€T&amp;&amp; tåœ¨å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨æ–­çš„æ—¶å€™ï¼Œå®ƒæ˜¯æœªå®šçš„å¼•ç”¨ç±»å‹ï¼ˆuniversal referencesï¼‰ï¼Œå¦‚æœè¢«ä¸€ä¸ªå·¦å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼›å¦‚æœå®ƒè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå®ƒæ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼å–å†³äºå®ƒçš„åˆå§‹åŒ–ã€‚</p><p>æˆ‘ä»¬å†å›è¿‡å¤´çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹äºå‡½æ•°template<typename t=\"\">void f(T&amp;&amp; t)ï¼Œå½“å‚æ•°ä¸ºå³å€¼10çš„æ—¶å€™ï¼Œæ ¹æ®universal referencesçš„ç‰¹ç‚¹ï¼Œtè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯å³å€¼ï¼›å½“å‚æ•°ä¸ºå·¦å€¼xæ—¶ï¼Œtè¢«ä¸€ä¸ªå·¦å€¼å¼•ç”¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…æ˜¯å½“å‘ç”Ÿè‡ªåŠ¨ç±»å‹æ¨å¯¼ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»å‹è‡ªåŠ¨æ¨å¯¼ï¼Œæˆ–autoå…³é”®å­—ï¼‰çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰æ˜¯universal referencesã€‚å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</typename></p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">f</span><span class=\"params\">(T&amp;&amp; param)</span></span>; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> &#123;</span></span><br><span class=\"line\">    Test(Test&amp;&amp; rhs); </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œparamæ˜¯universal referenceï¼Œrhsæ˜¯Test&amp;&amp;å³å€¼å¼•ç”¨ï¼Œå› ä¸ºæ¨¡ç‰ˆå‡½æ•°få‘ç”Ÿäº†ç±»å‹æ¨æ–­ï¼Œè€ŒTest&amp;&amp;å¹¶æ²¡æœ‰å‘ç”Ÿç±»å‹æ¨å¯¼ï¼Œå› ä¸ºTest&amp;&amp;æ˜¯ç¡®å®šçš„ç±»å‹äº†ã€‚</p><p>ã€€ã€€æ­£æ˜¯å› ä¸ºå³å€¼å¼•ç”¨å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œä¾èµ–äºåˆå§‹åŒ–ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šæ–‡ç« ï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚</p><p>ã€€ã€€è¿™é‡Œå†æä¸€ä¸‹å¼•ç”¨æŠ˜å ï¼Œæ­£æ˜¯å› ä¸ºå¼•å…¥äº†å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨çš„æŠ˜å ï¼ŒC++11ç¡®å®šäº†å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>æ‰€æœ‰çš„å³å€¼å¼•ç”¨å åŠ åˆ°å³å€¼å¼•ç”¨ä¸Šä»ç„¶è¿˜æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼›</li><li>æ‰€æœ‰çš„å…¶ä»–å¼•ç”¨ç±»å‹ä¹‹é—´çš„å åŠ éƒ½å°†å˜æˆå·¦å€¼å¼•ç”¨ã€‚</li></ul><h3 id=\"ç¬¬3è¡Œä»£ç çš„æ•…äº‹\"><a href=\"#ç¬¬3è¡Œä»£ç çš„æ•…äº‹\" class=\"headerlink\" title=\"ç¬¬3è¡Œä»£ç çš„æ•…äº‹\"></a>ç¬¬3è¡Œä»£ç çš„æ•…äº‹</h3><figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">T</span>(<span class=\"built_in\">T</span>&amp;&amp; a) <span class=\"symbol\">:</span> m_val(val)&#123; a.m_val=nullptr; &#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™è¡Œä»£ç å®é™…ä¸Šæ¥è‡ªäºä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä¸ºä»€ä¹ˆå°†å³å€¼å¼•ç”¨ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°å‘¢ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚ä»£ç æ¸…å•1-2æ‰€ç¤ºã€‚</p><p>ä»£ç æ¸…å•1-2</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    A():m_ptr(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>(<span class=\"number\">0</span>))&#123;<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"construct\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;&#125;</span><br><span class=\"line\">    A(<span class=\"keyword\">const</span> A&amp; a):m_ptr(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>(*a.m_ptr)) <span class=\"comment\">//æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"copy construct\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ~A()&#123; <span class=\"keyword\">delete</span> m_ptr;&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* m_ptr;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    A a = GetA();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    è¾“å‡ºï¼š</span><br><span class=\"line\">construct</span><br><span class=\"line\">copy construct</span><br><span class=\"line\">copy construct</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸€ä¸ªå¸¦æœ‰å †å†…å­˜çš„ç±»ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæ·±æ‹·è´æ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤çš„æ‹·è´æ„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œä¼šå‘ç”Ÿâ€œæŒ‡é’ˆæ‚¬æŒ‚â€çš„é—®é¢˜ã€‚å¦‚æœä¸æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œä¸Šé¢çš„æµ‹è¯•ä»£ç å°†ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆç¼–è¯‘é€‰é¡¹-fno-elide-constructorsï¼‰ï¼Œå†…éƒ¨çš„m_ptrå°†ä¼šè¢«åˆ é™¤ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¸´æ—¶å³å€¼ææ„çš„æ—¶å€™åˆ é™¤ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡å¤–é¢æ„é€ çš„aå¯¹è±¡é‡Šæ”¾æ—¶åˆ é™¤ä¸€æ¬¡ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„m_ptræ˜¯åŒä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æŒ‡é’ˆæ‚¬æŒ‚é—®é¢˜ã€‚æä¾›æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°è™½ç„¶å¯ä»¥ä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ä¼šé€ æˆé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™ç§æ·±æ‹·è´æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><p>ã€€ã€€ä¸Šé¢ä»£ç ä¸­çš„GetAå‡½æ•°ä¼šè¿”å›ä¸´æ—¶å˜é‡ï¼Œç„¶åé€šè¿‡è¿™ä¸ªä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡aï¼Œä¸´æ—¶å˜é‡åœ¨æ‹·è´æ„é€ å®Œæˆä¹‹åå°±é”€æ¯äº†ï¼Œå¦‚æœå †å†…å­˜å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ‹·è´æ„é€ çš„ä»£ä»·ä¼šå¾ˆå¤§ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸´æ—¶å˜é‡å¹¶é€ æˆé¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œæœ‰æ²¡æœ‰åŠæ³•é¿å…ä¸´æ—¶å˜é‡é€ æˆçš„æ€§èƒ½æŸå¤±å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒC++11å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚ä»£ç æ¸…å•1-3æ‰€ç¤ºã€‚</p><p>ä»£ç æ¸…å•1-3</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    A() :m_ptr(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>(<span class=\"number\">0</span>))&#123;&#125;</span><br><span class=\"line\">    A(<span class=\"keyword\">const</span> A&amp; a):m_ptr(<span class=\"keyword\">new</span> <span class=\"keyword\">int</span>(*a.m_ptr)) <span class=\"comment\">//æ·±æ‹·è´çš„æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"copy construct\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    A(A&amp;&amp; a) :m_ptr(a.m_ptr)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        a.m_ptr = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"move construct\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ~A()&#123; <span class=\"keyword\">delete</span> m_ptr;&#125;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* m_ptr;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    A a = Get(<span class=\"literal\">false</span>); </span><br><span class=\"line\">&#125; </span><br><span class=\"line\">è¾“å‡ºï¼š</span><br><span class=\"line\">construct</span><br><span class=\"line\">move construct</span><br><span class=\"line\">move construct</span><br></pre></td></tr></table></figure><p>ã€€ã€€ä»£ç æ¸…å•1-3å’Œ1-2ç›¸æ¯”åªå¤šäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œè¾“å‡ºç»“æœè¡¨æ˜ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ï¼Œåªè°ƒç”¨äº†move constructå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªmove constructå‡½æ•°ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A(A&amp;&amp; a) :m_ptr(a.m_ptr)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    a.m_ptr = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">    <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"move construct\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªæ„é€ å‡½æ•°å¹¶æ²¡æœ‰åšæ·±æ‹·è´ï¼Œä»…ä»…æ˜¯å°†æŒ‡é’ˆçš„æ‰€æœ‰è€…è½¬ç§»åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†å‚æ•°å¯¹è±¡açš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œè¿™é‡Œä»…ä»…æ˜¯åšäº†æµ…æ‹·è´ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæ„é€ å‡½æ•°é¿å…äº†ä¸´æ—¶å˜é‡çš„æ·±æ‹·è´é—®é¢˜ã€‚</p><p>ã€€ã€€ä¸Šé¢è¿™ä¸ªå‡½æ•°å…¶å®å°±æ˜¯ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»å‹ï¼Œè¿™é‡Œçš„A&amp;&amp;è¡¨ç¤ºå³å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‰é¢å·²ç»æåˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å‘ç”Ÿç±»å‹æ¨æ–­ï¼Œæ˜¯ç¡®å®šçš„å³å€¼å¼•ç”¨ç±»å‹ã€‚ä¸ºä»€ä¹ˆä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ï¼Ÿå› ä¸ºè¿™ä¸ªæ„é€ å‡½æ•°åªèƒ½æ¥å—å³å€¼å‚æ•°ï¼Œè€Œå‡½æ•°è¿”å›å€¼æ˜¯å³å€¼ï¼Œæ‰€ä»¥å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªæ„é€ å‡½æ•°ã€‚è¿™é‡Œçš„A&amp;&amp;å¯ä»¥çœ‹ä½œæ˜¯ä¸´æ—¶å€¼çš„æ ‡è¯†ï¼Œå¯¹äºä¸´æ—¶å€¼æˆ‘ä»¬ä»…ä»…éœ€è¦åšæµ…æ‹·è´å³å¯ï¼Œæ— éœ€å†åšæ·±æ‹·è´ï¼Œä»è€Œè§£å†³äº†å‰é¢æåˆ°çš„ä¸´æ—¶å˜é‡æ‹·è´æ„é€ äº§ç”Ÿçš„æ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç§»åŠ¨è¯­ä¹‰ï¼Œå³å€¼å¼•ç”¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ã€‚</p><p>ã€€ã€€éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬æä¾›ç§»åŠ¨æ„é€ å‡½æ•°çš„åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°ï¼Œä»¥é˜²æ­¢ç§»åŠ¨ä¸æˆåŠŸçš„æ—¶å€™è¿˜èƒ½æ‹·è´æ„é€ ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®‰å…¨ã€‚</p><p>ã€€ã€€æˆ‘ä»¬çŸ¥é“ç§»åŠ¨è¯­ä¹‰æ˜¯é€šè¿‡å³å€¼å¼•ç”¨æ¥åŒ¹é…ä¸´æ—¶å€¼çš„ï¼Œé‚£ä¹ˆï¼Œæ™®é€šçš„å·¦å€¼æ˜¯å¦ä¹Ÿèƒ½å€ŸåŠ©ç§»åŠ¨è¯­ä¹‰æ¥ä¼˜åŒ–æ€§èƒ½å‘¢ï¼Œé‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿäº‹å®ä¸ŠC++11ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†std::moveæ–¹æ³•æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œä»è€Œæ–¹ä¾¿åº”ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚moveæ˜¯å°†å¯¹è±¡èµ„æºçš„æ‰€æœ‰æƒä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯è½¬ç§»ï¼Œæ²¡æœ‰å†…å­˜çš„æ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„moveè¯­ä¹‰ã€‚å¦‚å›¾1-1æ‰€ç¤ºæ˜¯æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«ã€‚</p><p>å›¾1-1 æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«</p><p>ã€€ã€€å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">list</span>&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&gt; tokens;</span><br><span class=\"line\">    <span class=\"comment\">//çœç•¥åˆå§‹åŒ–...</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">list</span>&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&gt; t = tokens; <span class=\"comment\">//è¿™é‡Œå­˜åœ¨æ‹·è´ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">list</span>&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&gt; tokens;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">list</span>&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">string</span>&gt; t = <span class=\"built_in\">std</span>::move(tokens);  <span class=\"comment\">//è¿™é‡Œæ²¡æœ‰æ‹·è´</span></span><br></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœä¸ç”¨std::moveï¼Œæ‹·è´çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½è¾ƒä½ã€‚ä½¿ç”¨moveå‡ ä¹æ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œåªæ˜¯è½¬æ¢äº†èµ„æºçš„æ‰€æœ‰æƒã€‚ä»–å®é™…ä¸Šå°†å·¦å€¼å˜æˆå³å€¼å¼•ç”¨ï¼Œç„¶ååº”ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå°±é¿å…äº†æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å†…éƒ¨æœ‰è¾ƒå¤§çš„å¯¹å†…å­˜æˆ–è€…åŠ¨æ€æ•°ç»„æ—¶ï¼Œå¾ˆæœ‰å¿…è¦å†™moveè¯­ä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°ï¼Œé¿å…æ— è°“çš„æ·±æ‹·è´ï¼Œä»¥æé«˜æ€§èƒ½ã€‚äº‹å®ä¸Šï¼ŒC++11ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å®ç°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ã€‚</p><p>ã€€ã€€è¿™é‡Œä¹Ÿè¦æ³¨æ„å¯¹moveè¯­ä¹‰çš„è¯¯è§£ï¼Œmoveå®é™…ä¸Šå®ƒå¹¶ä¸èƒ½ç§»åŠ¨ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚å¦‚æœæ˜¯ä¸€äº›åŸºæœ¬ç±»å‹æ¯”å¦‚intå’Œchar[10]å®šé•¿æ•°ç»„ç­‰ç±»å‹ï¼Œä½¿ç”¨moveçš„è¯ä»ç„¶ä¼šå‘ç”Ÿæ‹·è´ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œmoveå¯¹äºå«èµ„æºï¼ˆå †å†…å­˜æˆ–å¥æŸ„ï¼‰çš„å¯¹è±¡æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚</p><h3 id=\"ç¬¬4è¡Œä»£ç æ•…äº‹\"><a href=\"#ç¬¬4è¡Œä»£ç æ•…äº‹\" class=\"headerlink\" title=\"ç¬¬4è¡Œä»£ç æ•…äº‹\"></a>ç¬¬4è¡Œä»£ç æ•…äº‹</h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;<span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">f</span><span class=\"params\">(T&amp;&amp; val)</span></span>&#123; foo(<span class=\"built_in\">std</span>::forward&lt;T&gt;(val)); &#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€C++11ä¹‹å‰è°ƒç”¨æ¨¡æ¿å‡½æ•°æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚ä½•æ­£ç¡®çš„ä¼ é€’å‚æ•°ã€‚æ¯”å¦‚ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">forwardValue</span><span class=\"params\">(T&amp; val)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    processValue(val); <span class=\"comment\">//å³å€¼å‚æ•°ä¼šå˜æˆå·¦å€¼ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">forwardValue</span><span class=\"params\">(<span class=\"keyword\">const</span> T&amp; val)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    processValue(val); <span class=\"comment\">//å‚æ•°éƒ½å˜æˆå¸¸é‡å·¦å€¼å¼•ç”¨äº† </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>éƒ½ä¸èƒ½æŒ‰ç…§å‚æ•°çš„æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚</p><p>ã€€ã€€C++11å¼•å…¥äº†å®Œç¾è½¬å‘ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œå®Œå…¨ä¾ç…§æ¨¡æ¿çš„å‚æ•°çš„ç±»å‹ï¼ˆå³ä¿æŒå‚æ•°çš„å·¦å€¼ã€å³å€¼ç‰¹å¾ï¼‰ï¼Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ¨¡æ¿ä¸­è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚C++11ä¸­çš„std::forwardæ­£æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œä»–ä¼šæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">processValue</span><span class=\"params\">(<span class=\"keyword\">int</span>&amp; a)</span></span>&#123; <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"lvalue\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">processValue</span><span class=\"params\">(<span class=\"keyword\">int</span>&amp;&amp; a)</span></span>&#123; <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"rvalue\"</span> &lt;&lt; <span class=\"built_in\">endl</span>; &#125;</span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">forwardValue</span><span class=\"params\">(T&amp;&amp; val)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    processValue(<span class=\"built_in\">std</span>::forward&lt;T&gt;(val)); <span class=\"comment\">//ç…§å‚æ•°æœ¬æ¥çš„ç±»å‹è¿›è¡Œè½¬å‘ã€‚</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Testdelcl</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">    forwardValue(i); <span class=\"comment\">//ä¼ å…¥å·¦å€¼ </span></span><br><span class=\"line\">    forwardValue(<span class=\"number\">0</span>);<span class=\"comment\">//ä¼ å…¥å³å€¼ </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">è¾“å‡ºï¼š</span><br><span class=\"line\">lvaue </span><br><span class=\"line\">rvalue</span><br></pre></td></tr></table></figure><p>ã€€ã€€å³å€¼å¼•ç”¨T&amp;&amp;æ˜¯ä¸€ä¸ªuniversal referencesï¼Œå¯ä»¥æ¥å—å·¦å€¼æˆ–è€…å³å€¼ï¼Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§è®©ä»–é€‚åˆä½œä¸ºä¸€ä¸ªå‚æ•°çš„è·¯ç”±ï¼Œç„¶åå†é€šè¿‡std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹å»åŒ¹é…å¯¹åº”çš„é‡è½½å‡½æ•°ï¼Œæœ€ç»ˆå®ç°å®Œç¾è½¬å‘ã€‚</p><p>ã€€ã€€æˆ‘ä»¬å¯ä»¥ç»“åˆå®Œç¾è½¬å‘å’Œç§»åŠ¨è¯­ä¹‰æ¥å®ç°ä¸€ä¸ªæ³›å‹çš„å·¥å‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»å‹çš„å¯¹è±¡ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">typename</span>â€¦  Args&gt;</span><br><span class=\"line\"><span class=\"function\">T* <span class=\"title\">Instance</span><span class=\"params\">(Args&amp;&amp;â€¦ args)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> T(<span class=\"built_in\">std</span>::forward&lt;Args &gt;(args)â€¦);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªå·¥å‚å‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ç±»å‹ï¼Œå†…éƒ¨ä½¿ç”¨std::forwardæŒ‰ç…§å‚æ•°çš„å®é™…ç±»å‹è¿›è¡Œè½¬å‘ï¼Œå¦‚æœå‚æ•°çš„å®é™…ç±»å‹æ˜¯å³å€¼ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åŒ¹é…ç§»åŠ¨æ„é€ ï¼Œå¦‚æœæ˜¯å·¦å€¼åˆ™ä¼šåŒ¹é…æ‹·è´æ„é€ ã€‚</p><h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>ã€€ã€€é€šè¿‡4è¡Œä»£ç æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä»¥åŠå³å€¼å¼•ç”¨çš„ä¸€äº›ç‰¹ç‚¹ï¼Œåˆ©ç”¨è¿™äº›ç‰¹ç‚¹æˆ‘ä»¬æ‰æ–¹ä¾¿å®ç°ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚C++11æ­£æ˜¯é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥é¿å…æ— è°“æ‹·è´çš„é—®é¢˜ï¼Œé€šè¿‡moveè¯­ä¹‰æ¥å°†ä¸´æ—¶ç”Ÿæˆçš„å·¦å€¼ä¸­çš„èµ„æºæ— ä»£ä»·çš„è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­å»ï¼Œé€šè¿‡å®Œç¾è½¬å‘æ¥è§£å†³ä¸èƒ½æŒ‰ç…§å‚æ•°å®é™…ç±»å‹æ¥è½¬å‘çš„é—®é¢˜ï¼ˆåŒæ—¶ï¼Œå®Œç¾è½¬å‘è·å¾—çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®ç°ç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚</p><p><em>æœ¬æ–‡æ›¾å‘è¡¨äºã€Šç¨‹åºå‘˜ã€‹2015å¹´1æœˆåˆŠã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</em></p><p><em>åè®°ï¼š</em>æœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªäºæˆ‘åœ¨å…¬å¸å†…éƒ¨åŸ¹è®­çš„ä¸€æ¬¡è¯¾ç¨‹ï¼Œå› ä¸ºå¾ˆå¤šäººå¯¹C++11å³å€¼å¼•ç”¨æä¸æ¸…æˆ–è€…ç†è§£å¾—ä¸æ·±å…¥ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå°±æ•´ç†äº†ä¸€ä¸‹å‘åˆ°ç¨‹åºå‘˜æ‚å¿—äº†ï¼Œæˆ‘ç›¸ä¿¡è¯»è€…çœ‹å®Œä¹‹åå¯¹å³å€¼å¼•ç”¨ä¼šæœ‰å…¨é¢æ·±å…¥çš„äº†è§£ã€‚</p><p>ä¸€ç‚¹æ¢¦æƒ³ï¼šå°½è‡ªå·±ä¸€ä»½åŠ›ï¼Œè®©c++çš„ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼</p>","slug":"å³å€¼å¼•ç”¨","updated":"2019-06-05T06:14:58.377Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/9d2f4ec8/","excerpt":"æ¦‚è¿° å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®ä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š12int i = 0;int&amp; j = i; è¿™é‡Œçš„int&amp;æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&amp;å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&amp;&amp;ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»å‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&amp;&amp;æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š","categories":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/categories/C/"}],"tags":[{"name":"C++","slug":"C","permalink":"https://shuntan.github.io/tags/C/"}]},{"title":"squidä»‹ç»åŠå…¶ç®€å•é…ç½®","date":"2019-05-15T07:15:30.000Z","path":"posts/55e3d16d/","text":"squidçš„æ¦‚å¿µsquidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»ç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚ä¸‹è½½åœ°å€squid-cache å®˜ç½‘ http://www.squid-cache.orgsquidä»‹ç»åŠå…¶ç®€å•é…ç½® https://www.cnblogs.com/cherishry/p/5706736.htmlCentOS 7å®‰è£…squidä»£ç†æœåŠ¡å™¨ https://blog.csdn.net/ithomer/article/details/78136993squidä»£ç†çš„ä½œç”¨é€šè¿‡ç¼“å­˜çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›Webè®¿é—®åŠ é€Ÿå¯¹ç”¨æˆ·çš„Webè®¿é—®è¿›è¡Œè¿‡æ»¤æ§åˆ¶å·¥ä½œæµç¨‹å½“ä»£ç†æœåŠ¡å™¨ä¸­æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶ï¼ša.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›b.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›c.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼Œå–å‡ºæ•°æ®ï¼›d.ä»£ç†æœåŠ¡å™¨å°†ä»ç¼“å­˜ä¸­å–å¾—çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚å½“ä»£ç†æœåŠ¡å™¨ä¸­æ²¡æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶äº†ï¼š1.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›2.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›3.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼›4.ä»£ç†æœåŠ¡å™¨å‘Internet ä¸Šçš„è¿œç«¯æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›5.è¿œç«¯æœåŠ¡å™¨å“åº”ï¼Œè¿”å›ç›¸åº”çš„æ•°æ®ï¼›6.ä»£ç†æœåŠ¡å™¨å–å¾—è¿œç«¯æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿ç•™ä¸€ä»½åˆ°è‡ªå·±çš„æ•°æ®ç¼“å­˜ä¸­ã€‚Squidä»£ç†æœåŠ¡å™¨å·¥ä½œåœ¨TCP/IPåº”ç”¨å±‚Squidå„ç§ä»£ç†çš„å®šä¹‰æ­£å‘ä»£ç†æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡è¢«ç”¨äºç¼“å­˜é™æ€çš„ç½‘é¡µåˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸€å°ä¸»æœºä¸Šï¼ˆå³ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚å½“è¢«ç¼“å­˜çš„é¡µé¢è¢«ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»æœ¬åœ°ä»£ç†æœåŠ¡å™¨é‚£é‡Œè·å–è¯·æ±‚æ•°æ®è€Œä¸å†å‘åŸwebç«™ç‚¹è¯·æ±‚æ•°æ®ã€‚è¿™æ ·å°±èŠ‚çœäº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œè¦æƒ³å®ç°è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æ¯ä¸€ä¸ªå†…éƒ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šæ˜ç¡®æŒ‡åä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚å®¢æˆ·ç«¯ä¸Šç½‘æ—¶ï¼Œæ¯æ¬¡éƒ½æŠŠè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†,ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ç¡®å®šæ˜¯å¦è¿æ¥åˆ°è¿œç¨‹webæœåŠ¡å™¨è·å–æ•°æ®ã€‚å¦‚æœåœ¨æœ¬åœ°ç¼“å†²åŒºæœ‰ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™ç›´æ¥å°†æ–‡ä»¶ä¼ ç»™ç”¨æˆ·å³å¯ã€‚å¦‚æœæ²¡æœ‰çš„è¯åˆ™å…ˆå–å›æ–‡ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½ç¼“å†²ï¼Œç„¶åå°†æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œä»£ç†æ“ä½œå¯¹å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ˜¯é€æ˜çš„ï¼ˆå³ä¸éœ€æŒ‡æ˜ä»£ç†æœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼‰ã€‚é€æ˜ä»£ç†æœåŠ¡å™¨é˜»æ–­ç½‘ç»œé€šä¿¡ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºè®¿é—®å¤–éƒ¨çš„HTTPï¼ˆ80ç«¯å£ï¼‰æµé‡ã€‚å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœ¬åœ°æœ‰ç¼“å†²åˆ™å°†ç¼“å†²çš„æ•°æ®ç›´æ¥å‘ç»™ç”¨æˆ·ï¼Œå¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰ç¼“å†²åˆ™å‘è¿œç¨‹webæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä½™æ“ä½œå’Œæ ‡å‡†çš„ä»£ç†æœåŠ¡å™¨å®Œå…¨ç›¸åŒã€‚å¯¹äºlinuxæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé€æ˜ä»£ç†ä½¿ç”¨Iptablesæˆ–è€…Ipchainså®ç°ã€‚å› æ­¤ä¸éœ€è¦å¯¹æµè§ˆå™¨ä½œä»»ä½•è®¾ç½®ï¼Œæ‰€ä»¥ï¼Œé€æ˜ä»£ç†å¯¹äºISPï¼ˆInternetæœåŠ¡å™¨æä¾›å•†ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚åå‘ä»£ç†åå‘ä»£ç†ç¼“å†²å™¨åå‘ä»£ç†æ˜¯å’Œå‰ä¸¤ç§ä»£ç†å®Œå…¨ä¸åŒçš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚ä½¿ç”¨å®ƒå¯ä»¥é™ä½åŸå§‹WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚åå‘ä»£ç†æœåŠ¡å™¨æ‰¿æ‹…äº†å¯¹åŸå§‹WEBæœåŠ¡å™¨çš„é™æ€é¡µé¢çš„è¯·æ±‚ï¼Œé˜²æ­¢åŸå§‹æœåŠ¡å™¨è¿‡è½½ã€‚å®ƒä½äºWEBæœåŠ¡å™¨å’ŒInternetä¹‹é—´ï¼Œå¤„ç†æ‰€æœ‰å¯¹WEBæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œç»„ç»‡äº†WEBæœåŠ¡å™¨å’ŒInternetçš„ç›´æ¥é€šä¿¡ã€‚å¦‚æœäº’è”ç½‘ç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å†²çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å†²å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åˆ™å…ˆå‘WEBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹å¼é€šè¿‡é™ä½äº†WEBæœåŠ¡å™¨çš„è¯·æ±‚æ•°ä»è€Œé™ä½äº†WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«æ¦‚å¿µæ­£å‘ä»£ç†ï¼šå¯¹äºåŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äººåå‘ä»£ç†ï¼šå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨ç”¨é€”æ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚å®‰å…¨æ€§æ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚åå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚Squidä¸»è¦ç»„æˆéƒ¨åˆ†æœåŠ¡åï¼šsquidä¸»ç¨‹åºï¼š/usr/sbin/squidé…ç½®ç›®å½•ï¼š/etc/squidä¸»é…ç½®æ–‡ä»¶ï¼š/etc/squid/squid.confç›‘å¬tcpç«¯å£å·ï¼š3128é»˜è®¤è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼š/var/log/squid/access.logsquidå¸¸ç”¨é…ç½®é€‰é¡¹/etc/squid/squid.conf123456789101112131415http_port 3128 (è¿˜å¯ä»¥åªç›‘å¬ä¸€ä¸ªIP http_port 192.168.0.1:3128)cache_mem 64MB #ç¼“å­˜å å†…å­˜å¤§å°maximum_object_size 4096KB #æœ€å¤§ç¼“å­˜å—reply_body_max_size 1024000 allow all #é™å®šä¸‹è½½æ–‡ä»¶å¤§å°access_log /var/log/squid/access.log #è®¿é—®æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹visible_hostname proxy.test.xom #å¯è§çš„ä¸»æœºåcache_dir ufs /var/spool/squid 100 16 256 #ufs:ç¼“å­˜æ•°æ®çš„å­˜å‚¨æ ¼å¼#/var/spool/squid ç¼“å­˜ç›®å½•#100ï¼šç¼“å­˜ç›®å½•å ç£ç›˜ç©ºé—´å¤§å°ï¼ˆMï¼‰#16ï¼šç¼“å­˜ç©ºé—´ä¸€çº§å­ç›®å½•ä¸ªæ•°#256ï¼šç¼“å­˜ç©ºé—´äºŒçº§å­ç›®å½•ä¸ªæ•°cache_mgr webmaster@test.com #å®šä¹‰ç®¡ç†å‘˜é‚®ç®±http_access deny all #è®¿é—®æ§åˆ¶squidä¸­çš„è®¿é—®æ§åˆ¶ä½¿ç”¨è®¿é—®æ§åˆ¶ç‰¹æ€§ï¼Œå¯ä»¥æ§åˆ¶åœ¨è®¿é—®æ—¶æ ¹æ®ç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œç¼“å­˜ã€è®¿é—®ç‰¹å®šç«™ç‚¹æˆ–ä¸€ç»„ç«™ç‚¹ç­‰ç­‰ã€‚squidè®¿é—®æ§åˆ¶æœ‰ä¸¤ä¸ªè¦ç´ ï¼šACLå…ƒç´ å’Œè®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä»¥å…è®¸æˆ–æ‹’ç»æŸäº›ç”¨æˆ·å¯¹æ­¤æœåŠ¡çš„è®¿é—®ã€‚ACLå…ƒç´ ç±»å‹srcï¼šæºåœ°å€ï¼ˆå³å®¢æˆ·æœºIPåœ°å€ï¼‰dstï¼šç›®æ ‡åœ°å€ï¼ˆå³æœåŠ¡å™¨IPåœ°å€ï¼‰srcdomainï¼šæºåç§°ï¼ˆå³å®¢æˆ·æœºåç§°ï¼‰dstdomainï¼šç›®æ ‡åç§°ï¼ˆå³æœåŠ¡å™¨åç§°ï¼‰timeï¼šä¸€å¤©ä¸­çš„æ—¶åˆ»å’Œä¸€å‘¨å†…çš„ä¸€å¤©url_regexï¼šURLè§„åˆ™è¡¨è¾¾å¼åŒ¹é…urlpath_regexï¼šURL-pathè§„åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œç•¥å»åè®®å’Œä¸»æœºåproxy_authï¼šé€šè¿‡å¤–éƒ¨ç¨‹åºè¿›è¡Œç”¨æˆ·éªŒè¯maxconnï¼šå•ä¸€IPçš„æœ€å¤§è¿æ¥æ•°ACLæ ¼å¼ä¸ºäº†ä½¿ç”¨æ§åˆ¶åŠŸèƒ½ï¼Œå¿…é¡»å…ˆè®¾ç½®ACLè§„åˆ™å¹¶åº”ç”¨ã€‚ACLå£°æ˜çš„æ ¼å¼å¦‚ä¸‹ï¼š æ³¨ï¼šacl_element_name å¯ä»¥æ˜¯ä»»ä¸€ä¸ªåœ¨ACLä¸­å®šä¹‰çš„åç§°ä»»ä½•ä¸¤ä¸ªACLå…ƒç´ ä¸èƒ½ç”¨ç›¸åŒçš„åå­—æ¯ä¸ªACLç”±åˆ—è¡¨å€¼ç»„æˆã€‚å½“è¿›è¡ŒåŒ¹é…æ£€æµ‹çš„æ—¶å€™ï¼Œå¤šä¸ªå€¼ç”±é€»è¾‘æˆ–è¿ç®—è¿æ¥ï¼›æ¢è¨€ä¹‹ï¼Œå³ä»»ä¸€ACLå…ƒç´ çš„å€¼è¢«åŒ¹é…ï¼Œåˆ™è¿™ä¸ªACLå…ƒç´ å³è¢«åŒ¹é…ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰ACLå…ƒç´ éƒ½èƒ½ä½¿ç”¨è®¿é—®åˆ—è¡¨ä¸­çš„å…¨éƒ¨ç±»å‹ä¸åŒçš„ACLå…ƒç´ å†™åœ¨ä¸åŒè¡Œä¸­ï¼Œsquidå°†æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­è®¿é—®æ¡ç›®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„è®¿é—®æ¡ç›®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ä¸ªï¼šhttp_access:å…è®¸HTTPè®¿é—®no_cache:å®šä¹‰å¯¹ç¼“å­˜è¯·æ±‚çš„å“åº”ã€‚è®¿é—®åˆ—è¡¨çš„è§„åˆ™ç”±ä¸€äº›ç±»ä¼¼â€™allowâ€™æˆ–â€˜denyâ€™çš„å…³é”®å­—æ„æˆï¼Œç”¨ä»¥å…è®¸æˆ–æ‹’ç»å‘ç‰¹å®šæˆ–ä¸€ç»„ACLå…ƒç´ æä¾›æœåŠ¡ã€‚ä¸€ä¸ªè®¿é—®åˆ—è¡¨å¯ä»¥ç”±å¤šæ¡è§„åˆ™ç»„æˆå¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™ä¸è®¿é—®è¯·æ±‚åŒ¹é…ï¼Œé»˜è®¤åŠ¨ä½œå°†ä¸åˆ—è¡¨ä¸­æœ€åä¸€æ¡è§„åˆ™å¯¹åº”ã€‚ä¸€ä¸ªè®¿é—®æ¡ç›®ä¸­æ‰€æœ‰å…ƒç´ å°†ç”¨é€»è¾‘ä¸è¿ç®—è¿æ¥http_access Action å£°æ˜1 AND å£°æ˜2 AND å£°æ˜ OR.http_access Action å£°æ˜3å¤šä¸ªhttp_accessså£°æ˜é—´ç”¨æˆ–è¿ç®—è¿æ¥ï¼Œä½†æ¯ä¸ªè®¿é—®æ¡ç›®çš„å…ƒç´ é—´ç”¨ä¸è¿ç®—è¿æ¥ã€‚åˆ—è¡¨ä¸­çš„è§„åˆ™æ€»æ˜¯éµå¾ªç”±ä¸Šè€Œä¸‹çš„é¡ºåºè¿™äº›è§„åˆ™æŒ‰ç…§ä»–ä»¬çš„æ’åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°åŒ¹é…çš„è§„åˆ™ï¼ŒåŒ¹é…å°±ç«‹å³ç»“æŸã€‚Squid.confé…ç½®æ–‡ä»¶è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156#acl all src 0.0.0.0/0.0.0.0 and http_access allow allé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚è¯¦ç»†æƒ…å†µå‚è§å’ŒSquidè½¯ä»¶#æºå¸¦çš„æ–‡æ¡£ã€‚è¿™é‡Œçš„è®¿é—®æ§åˆ¶åˆ—è¡¨å…è®¸æ‰€æœ‰å¯¹ä»£ç†æœåŠ¡çš„è®¿é—®ï¼Œå› ä¸ºè¿™é‡Œè¯¥ä»£ç†æ˜¯åŠ é€ŸwebæœåŠ¡å™¨ã€‚acl all src 0.0.0.0/0.0.0.0 #å…è®¸æ‰€æœ‰IPè®¿é—®acl manager proto http #manager urlåè®®ä¸ºhttpacl localhost src 127.0.0.1/255.255.255.255 #å…åˆæœ¬æœºIPacl to_localhost dst 127.0.0.1 #å…åˆç›®çš„åœ°å€ä¸ºæœ¬æœºIPacl Safe_ports port 80 # å…è®¸å®‰å…¨æ›´æ–°çš„ç«¯å£ä¸º80acl CONNECT method CONNECT #è¯·æ±‚æ–¹æ³•ä»¥CONNECThttp_access allow all #å…è®¸æ‰€æœ‰äººä½¿ç”¨è¯¥ä»£ç†.å› ä¸ºè¿™é‡Œæ˜¯ä»£ç†åŠ é€ŸwebæœåŠ¡å™¨http_reply_access allow all #å…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ä»£ç†acl OverConnLimit maxconn 16 #é™åˆ¶æ¯ä¸ªIPæœ€å¤§å…è®¸16ä¸ªè¿æ¥ï¼Œé˜²æ­¢æ”»å‡»http_access deny OverConnLimiticp_access deny all #ç¦æ­¢ä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚.miss_access allow all #å…è®¸ç›´æ¥æ›´æ–°è¯·æ±‚ident_lookup_access deny all #ç¦æ­¢lookupæ£€æŸ¥DNShttp_port 8080 transparent #æŒ‡å®šSquidç›‘å¬æµè§ˆå™¨å®¢æˆ·è¯·æ±‚çš„ç«¯å£å·ã€‚hierarchy_stoplist cgi-bin ? #ç”¨æ¥å¼ºåˆ¶æŸäº›ç‰¹å®šçš„å¯¹è±¡ä¸è¢«ç¼“å­˜ï¼Œä¸»è¦æ˜¯å¤„äºå®‰å…¨çš„ç›®çš„ã€‚acl QUERY urlpath_regex cgi-bin \\?cache deny QUERYcache_mem 1 GB #è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œå¢åŠ è¯¥å†…å­˜å€¼æœ‰åˆ©äºç¼“å­˜ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼š #ä¸€èˆ¬æ¥è¯´å¦‚æœç³»ç»Ÿæœ‰å†…å­˜ï¼Œè®¾ç½®è¯¥å€¼ä¸º(n/)3Mã€‚ç°åœ¨æ˜¯3G æ‰€ä»¥è¿™é‡Œ1Gfqdncache_size 1024 #FQDN é«˜é€Ÿç¼“å­˜å¤§å°maximum_object_size_in_memory 2 MB #å…è®¸æœ€å¤§çš„æ–‡ä»¶è½½å…¥å†…å­˜memory_replacement_policy heap LFUDA #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºå†…å­˜cachecache_replacement_policy heap LFUDA #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºç¡¬ç›˜cachecache_dir ufs /home/cache 5000 32 512 #é«˜é€Ÿç¼“å­˜ç›®å½• ufs ç±»å‹ ä½¿ç”¨çš„ç¼“å†²å€¼æœ€å¤§å…åˆ1000MBç©ºé—´ï¼Œ#32ä¸ªä¸€çº§ç›®å½•ï¼Œ512ä¸ªäºŒçº§ç›®å½•max_open_disk_fds 0 #å…è®¸æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡,0 æ— é™åˆ¶minimum_object_size 1 KB #å…åˆæœ€å°æ–‡ä»¶è¯·æ±‚ä½“å¤§å°maximum_object_size 20 MB #å…åˆæœ€å¤§æ–‡ä»¶è¯·æ±‚ä½“å¤§å°cache_swap_low 90 #æœ€å°å…è®¸ä½¿ç”¨swap 90%cache_swap_high 95 #æœ€å¤šå…è®¸ä½¿ç”¨swap 95%ipcache_size 2048 # IP åœ°å€é«˜é€Ÿç¼“å­˜å¤§å° 2Mipcache_low 90 #æœ€å°å…è®¸ipcacheä½¿ç”¨swap 90%ipcache_high 95 #æœ€å¤§å…è®¸ipcacheä½¿ç”¨swap 90%access_log /var/log/squid/access.log squid #å®šä¹‰æ—¥å¿—å­˜æ”¾è®°å½•cache_log /var/log/squid/cache.log squidcache_store_log none #ç¦æ­¢storeæ—¥å¿—emulate_httpd_log on #å°†ä½¿Squidä»¿ç…§WebæœåŠ¡å™¨çš„æ ¼å¼åˆ›å»ºè®¿é—®è®°å½•ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨ #Webè®¿é—®è®°å½•åˆ†æç¨‹åºï¼Œå°±éœ€è¦è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚refresh_pattern . 0 20% 4320 override-expire override-lastmod reload-into-ims ignore-reload #æ›´æ–°cacheè§„åˆ™acl buggy_server url_regex ^http://.... http:// #åªå…è®¸httpçš„è¯·æ±‚broken_posts allow buggy_serveracl apache rep_header Server ^Apache #å…è®¸apacheçš„ç¼–ç broken_vary_encoding allow apacherequest_entities off #ç¦æ­¢éhttpçš„æ ‡åˆ†å‡†è¯·æ±‚ï¼Œé˜²æ­¢æ”»å‡»header_access header allow all #å…è®¸æ‰€æœ‰çš„httpæŠ¥å¤´relaxed_header_parser on #ä¸ä¸¥æ ¼åˆ†æhttpæŠ¥å¤´.client_lifetime 120 minute #æœ€å¤§å®¢æˆ·è¿æ¥æ—¶é—´ 120åˆ†é’Ÿcache_mgr sky@test.com #æŒ‡å®šå½“ç¼“å†²å‡ºç°é—®é¢˜æ—¶å‘ç¼“å†²ç®¡ç†è€…å‘é€å‘Šè­¦ä¿¡æ¯çš„åœ°å€ä¿¡æ¯ã€‚cache_effective_user squid #è¿™é‡Œä»¥ç”¨æˆ·squidçš„èº«ä»½SquidæœåŠ¡å™¨cache_effective_group squidicp_port 0 #æŒ‡å®šSquidä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚çš„ç«¯å£å·ã€‚ #è¿™é‡Œè®¾ç½®ä¸º0æ˜¯å› ä¸ºè¿™é‡Œé…ç½®Squidä¸ºå†…éƒ¨WebæœåŠ¡å™¨çš„åŠ é€Ÿå™¨ï¼Œ #æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨é‚»å±…æœåŠ¡å™¨çš„ç¼“å†²ã€‚0æ˜¯ç¦ç”¨# cache_peer è®¾ç½®å…è®¸æ›´æ–°ç¼“å­˜çš„ä¸»æœºï¼Œå› æ˜¯æœ¬æœºæ‰€ä»¥127.0.0.1cache_peer 127.0.0.1 parent 80 0 no-query default multicast-responder no-netdb-exchangecache_peer_domain 127.0.0.1 hostname_aliases 127.0.0.1error_directory /usr/share/squid/errors/Simplify_Chinese #å®šä¹‰é”™è¯¯è·¯å¾„always_direct allow all # cacheä¸¢å¤±æˆ–ä¸å­˜åœ¨æ˜¯å…è®¸æ‰€æœ‰è¯·æ±‚ç›´æ¥è½¬å‘åˆ°åŸå§‹æœåŠ¡å™¨ignore_unknown_nameservers on #å¼€åDNSæŸ¥è¯¢ï¼Œå½“åŸŸååœ°å€ä¸ç›¸åŒæ—¶å€™ï¼Œç¦æ­¢è®¿é—®coredump_dir /var/log/squid #å®šä¹‰dumpçš„ç›®å½•max_filedesc 2048 #æœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°half_closed_clients off #ä½¿Squidåœ¨å½“readä¸å†è¿”å›æ•°æ®æ—¶ç«‹å³å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ #æœ‰æ—¶readä¸å†è¿”å›æ•°æ®æ˜¯ç”±äºæŸäº›å®¢æˆ·å…³é—­TCPçš„å‘é€æ•°æ® #è€Œä»ç„¶ä¿æŒæ¥æ”¶æ•°æ®ã€‚è€ŒSquidåˆ†è¾¨ä¸å‡ºTCPåŠå…³é—­å’Œå®Œå…¨å…³é—­ã€‚buffered_logs on #è‹¥æ‰“å¼€é€‰é¡¹â€œbuffered_logsâ€å¯ä»¥ç¨ç¨æé«˜åŠ é€ŸæŸäº›å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥ï¼Œè¯¥é€‰é¡¹ä¸»è¦æ˜¯å®ç°ä¼˜åŒ–ç‰¹æ€§ã€‚#é˜²æ­¢å¤©æ¶¯ç›—é“¾ï¼Œè½¬å«ç»™ç™¾åº¦acl tianya referer_regex -i tianyahttp_access deny tianyadeny_info tianya#é˜»æ­¢baiduèœ˜è››acl baidu req_header User-Agent Baiduspiderhttp_access deny baidu#é™åˆ¶åŒä¸€IPå®¢æˆ·ç«¯çš„æœ€å¤§è¿æ¥æ•°acl OverConnLimit maxconn 128http_access deny OverConnLimit#é˜²æ­¢è¢«äººåˆ©ç”¨ä¸ºHTTPä»£ç†ï¼Œè®¾ç½®å…è®¸è®¿é—®çš„IPåœ°å€acl myip dst 222.18.63.37http_access deny !myip#å…è®¸æœ¬åœ°ç®¡ç†acl Manager proto cache_objectacl Localhost src 127.0.0.1 222.18.63.37http_access allow Manager Localhostcachemgr_passwd 53034338 allhttp_access deny Manager#ä»…ä»…å…è®¸80ç«¯å£çš„ä»£ç†acl all src 0.0.0.0/0.0.0.0acl Safe_ports port 80 # httphttp_access deny !Safe_portshttp_access allow all#Squidä¿¡æ¯è®¾ç½®visible_hostname happy.swjtu.edu.cncache_mgr ooopic2008@qq.com#åŸºæœ¬è®¾ç½®cache_effective_user squidcache_effective_group squidtcp_recv_bufsize 65535 bytes#2.6çš„åå‘ä»£ç†åŠ é€Ÿé…ç½®cache_peer 127.0.0.1 parent 80 0 no-query originserver#é”™è¯¯æ–‡æ¡£error_directory /usr/local/squid/share/errors/Simplify_Chinese#å•å°ä½¿ç”¨ï¼Œä¸ä½¿ç”¨è¯¥åŠŸèƒ½icp_port 0hierarchy_stoplist cgi-bin ?acl QUERY urlpath_regex cgi-bin \\? .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .execache deny QUERYacl apache rep_header Server ^Apachebroken_vary_encoding allow apacherefresh_pattern ^ftp: 1440 20% 10080refresh_pattern ^gopher: 1440 0% 1440refresh_pattern . 0 20% 4320cache_store_log nonepid_filename /usr/local/squid/var/logs/squid.pidemulate_httpd_log onSquidå¸¸ç”¨å‘½ä»¤åˆå§‹åŒ–åœ¨squid.confé‡Œé…ç½®çš„cacheç›®å½•squid -zå¦‚æœæœ‰é”™è¯¯æç¤ºï¼Œè¯·æ£€æŸ¥cacheç›®å½•çš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹ç›®å½•æƒé™chown -R squid:squid /cacheç›®å½•å¯¹squid.confæ’é”™ï¼Œå³éªŒè¯squid.confçš„è¯­æ³•å’Œé…ç½®squid -k parseå¦‚æœåœ¨squid.confä¸­æœ‰è¯­æ³•æˆ–é…ç½®é”™è¯¯ï¼Œè¿™é‡Œä¼šè¿”å›æç¤ºï¼Œè‹¥æ— è¿”å›ï¼Œå°è¯•å¯åŠ¨squidå‰å°å¯åŠ¨squidï¼Œå¹¶è¾“å‡ºå¯åŠ¨è¿‡ç¨‹/usr/local/squid/sbin/squid -N -d1å¦‚æœæœ‰ready to server requesç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜squidå¯åŠ¨æˆåŠŸç„¶åctrl+c ,åœæ­¢squid,å¹¶ä»¥åå°è¿è¡Œçš„æ–¹å¼å¯åŠ¨å®ƒå¯åŠ¨squidåœ¨åå°è¿è¡Œsquid -så¯ä»¥ä½¿ç”¨ps -ax | grep squid æ¥æŸ¥çœ‹squidè¿›ç¨‹æ˜¯å¦å­˜åœ¨åœæ­¢squidsquid -k shutdowné‡æ–°å¼•å¯¼ä¿®æ”¹è¿‡çš„squid.confsquid -k reconfigure -f /XXX/squid.confå½“squidè¿›è¡Œé…ç½®æ›´æ”¹åï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œsquidé…ç½®é‡è½½æŠŠsquidæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹vim /etc/rc.local/usr/local/squid/sbin/squid -sä¿®æ”¹cacheç¼“å­˜ç›®å½•çš„æƒé™chown -R squid.squid /cacheç›®å½•cacheç¼“å­˜ç›®å½•æ ¹æ®è‡ªå·±çš„é…ç½®æ›´æ”¹ï¼Œsquidç”¨æˆ·å’Œç»„æ˜¯squidï¼Œsquidä¿®æ”¹squidæ—¥å¿—ç›®å½•çš„æƒé™chown -R squid.squid å®šä¹‰çš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è¿™ä¸€æ­¥å¹¶ä¸æ˜¯é€‚åˆæ¯ä¸€ä¸ªä½¿ç”¨squidçš„ç”¨æˆ·ï¼Œæ„ä¸ºè®©squidæœ‰æƒé™åœ¨è¯¥ç›®å½•é‡Œè¿›è¡Œå†™æ“ä½œæŸ¥çœ‹ä½ çš„æ—¥å¿—æ–‡æ¡£more /usr/local/squid/var/logs/access.log | grep TCP_MEM_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°cacheç›®å½•ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_MISSè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶æ²¡æœ‰è¢«squidç¼“å­˜ï¼Œè€Œæ˜¯ä»åŸå§‹æœåŠ¡å™¨è·å–å¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚Squidå‘½ä¸­ç‡åˆ†æ12/usr/local/squid/bin/squidclient -p 80 mgr:info/usr/local/squid/bin/squidclient -p 80 mgr:5minå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½æƒ…å†µ,å…¶ä¸­PORTæ˜¯ä½ çš„proxyçš„ç«¯å£ï¼Œ5minå¯ä»¥æ˜¯60minå–å¾—squidè¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š1squidclient -p 80 mgr:infoå–å¾—squidå†…å­˜ä½¿ç”¨æƒ…å†µï¼š1squidclient -p 80 mgr:memå–å¾—squidå·²ç»ç¼“å­˜çš„åˆ—è¡¨ï¼š1squidclient -p 80 mgr:bjects. use it carefully,it may crashå–å¾—squidçš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š1squidclient -p 80 mgr:diskdå¼ºåˆ¶æ›´æ–°æŸä¸ªurlï¼š1squidclient -p 80 -m PURGE http://www.xxx.com/xxx.phpæ›´å¤šçš„è¯·æŸ¥çœ‹ï¼šsquidclient-h æˆ–è€… squidclient -p 80 mgr:æŸ¥å‘½ä¸­ç‡ï¼š1squidclient -h IP(å…·ä½“ä¾¦å¬IP) -p 80(å…·ä½“ä¾¦å¬ç«¯å£) mgr:infoå®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®123/path/to/squid/sbin/squid -k rotate -f /path/to/squid/conf_filevi /etc/crontab0 0 * * * root /usr/local/sbin/squid -k rotate -f /usr/local/etc/squid/squid1.confå½“squidåº”ç”¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œcache_dirå¯¹åº”çš„swap.stateæ–‡ä»¶å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‡Œé¢çš„æ— æ•ˆæ¥å£æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½å½±å“squidçš„å“åº”æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨squidæ¸…ç†swap.stateé‡Œé¢çš„æ— æ•ˆæ•°æ®ï¼Œå‡å°‘swap.stateçš„å¤§å°ã€‚","raw":"---\ntitle: squidä»‹ç»åŠå…¶ç®€å•é…ç½®\ncopyright: true\ntags:\n  - squid\n  - proxy\ncategories:\n  - Linux\nabbrlink: 55e3d16d\ndate: 2019-05-15 15:15:30\ntype:\nkeyword:\ntop:\ncomments:\npassword:\n---\n\n# squidçš„æ¦‚å¿µ\n\nsquidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»ç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚\n\n<!-- more -->\n\n# ä¸‹è½½åœ°å€\n\nsquid-cache å®˜ç½‘ http://www.squid-cache.org\n\nsquidä»‹ç»åŠå…¶ç®€å•é…ç½® https://www.cnblogs.com/cherishry/p/5706736.html\n\nCentOS 7å®‰è£…squidä»£ç†æœåŠ¡å™¨ https://blog.csdn.net/ithomer/article/details/78136993\n\n## squidä»£ç†çš„ä½œç”¨\n\n*   é€šè¿‡ç¼“å­˜çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›Webè®¿é—®åŠ é€Ÿ\n*   å¯¹ç”¨æˆ·çš„Webè®¿é—®è¿›è¡Œè¿‡æ»¤æ§åˆ¶\n\n## å·¥ä½œæµç¨‹\n\nå½“ä»£ç†æœåŠ¡å™¨ä¸­æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶ï¼š\n\na.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\n\nb.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›\n\nc.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼Œå–å‡ºæ•°æ®ï¼›\n\nd.ä»£ç†æœåŠ¡å™¨å°†ä»ç¼“å­˜ä¸­å–å¾—çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n\nå½“ä»£ç†æœåŠ¡å™¨ä¸­æ²¡æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶äº†ï¼š\n\n1.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\n\n2.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›\n\n3.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼›\n\n4.ä»£ç†æœåŠ¡å™¨å‘Internet ä¸Šçš„è¿œç«¯æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›\n\n5.è¿œç«¯æœåŠ¡å™¨å“åº”ï¼Œè¿”å›ç›¸åº”çš„æ•°æ®ï¼›\n\n6.ä»£ç†æœåŠ¡å™¨å–å¾—è¿œç«¯æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿ç•™ä¸€ä»½åˆ°è‡ªå·±çš„æ•°æ®ç¼“å­˜ä¸­ã€‚\n\n![](https://images2015.cnblogs.com/blog/872781/201607/872781-20160726112850919-758636566.jpg)\n\nSquidä»£ç†æœåŠ¡å™¨å·¥ä½œåœ¨TCP/IPåº”ç”¨å±‚\n\n![](https://images2015.cnblogs.com/blog/872781/201607/872781-20160726112935653-887103660.jpg)\n\n## Squidå„ç§ä»£ç†çš„å®šä¹‰\n\n### æ­£å‘ä»£ç†\n\n#### æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨\n\nä¸€ä¸ªæ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡è¢«ç”¨äºç¼“å­˜é™æ€çš„ç½‘é¡µåˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸€å°ä¸»æœºä¸Šï¼ˆå³ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚å½“è¢«ç¼“å­˜çš„é¡µé¢è¢«ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»æœ¬åœ°ä»£ç†æœåŠ¡å™¨é‚£é‡Œè·å–è¯·æ±‚æ•°æ®è€Œä¸å†å‘åŸwebç«™ç‚¹è¯·æ±‚æ•°æ®ã€‚è¿™æ ·å°±èŠ‚çœäº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œè¦æƒ³å®ç°è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æ¯ä¸€ä¸ªå†…éƒ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šæ˜ç¡®æŒ‡åä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚å®¢æˆ·ç«¯ä¸Šç½‘æ—¶ï¼Œæ¯æ¬¡éƒ½æŠŠè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†,ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ç¡®å®šæ˜¯å¦è¿æ¥åˆ°è¿œç¨‹webæœåŠ¡å™¨è·å–æ•°æ®ã€‚å¦‚æœåœ¨æœ¬åœ°ç¼“å†²åŒºæœ‰ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™ç›´æ¥å°†æ–‡ä»¶ä¼ ç»™ç”¨æˆ·å³å¯ã€‚å¦‚æœæ²¡æœ‰çš„è¯åˆ™å…ˆå–å›æ–‡ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½ç¼“å†²ï¼Œç„¶åå°†æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚\n\n#### é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨\n\né€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œä»£ç†æ“ä½œå¯¹å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ˜¯é€æ˜çš„ï¼ˆå³ä¸éœ€æŒ‡æ˜ä»£ç†æœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼‰ã€‚é€æ˜ä»£ç†æœåŠ¡å™¨é˜»æ–­ç½‘ç»œé€šä¿¡ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºè®¿é—®å¤–éƒ¨çš„HTTPï¼ˆ80ç«¯å£ï¼‰æµé‡ã€‚å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœ¬åœ°æœ‰ç¼“å†²åˆ™å°†ç¼“å†²çš„æ•°æ®ç›´æ¥å‘ç»™ç”¨æˆ·ï¼Œå¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰ç¼“å†²åˆ™å‘è¿œç¨‹webæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä½™æ“ä½œå’Œæ ‡å‡†çš„ä»£ç†æœåŠ¡å™¨å®Œå…¨ç›¸åŒã€‚å¯¹äºlinuxæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé€æ˜ä»£ç†ä½¿ç”¨Iptablesæˆ–è€…Ipchainså®ç°ã€‚å› æ­¤ä¸éœ€è¦å¯¹æµè§ˆå™¨ä½œä»»ä½•è®¾ç½®ï¼Œæ‰€ä»¥ï¼Œé€æ˜ä»£ç†å¯¹äºISPï¼ˆInternetæœåŠ¡å™¨æä¾›å•†ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚\n\n### åå‘ä»£ç†\n\n#### åå‘ä»£ç†ç¼“å†²å™¨\n\nåå‘ä»£ç†æ˜¯å’Œå‰ä¸¤ç§ä»£ç†å®Œå…¨ä¸åŒçš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚ä½¿ç”¨å®ƒå¯ä»¥é™ä½åŸå§‹WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚åå‘ä»£ç†æœåŠ¡å™¨æ‰¿æ‹…äº†å¯¹åŸå§‹WEBæœåŠ¡å™¨çš„é™æ€é¡µé¢çš„è¯·æ±‚ï¼Œé˜²æ­¢åŸå§‹æœåŠ¡å™¨è¿‡è½½ã€‚å®ƒä½äºWEBæœåŠ¡å™¨å’ŒInternetä¹‹é—´ï¼Œå¤„ç†æ‰€æœ‰å¯¹WEBæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œç»„ç»‡äº†WEBæœåŠ¡å™¨å’ŒInternetçš„ç›´æ¥é€šä¿¡ã€‚å¦‚æœäº’è”ç½‘ç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å†²çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å†²å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åˆ™å…ˆå‘WEBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹å¼é€šè¿‡é™ä½äº†WEBæœåŠ¡å™¨çš„è¯·æ±‚æ•°ä»è€Œé™ä½äº†WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚\n\n### æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«\n\n### æ¦‚å¿µ\n\næ­£å‘ä»£ç†ï¼šå¯¹äºåŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äºº\nåå‘ä»£ç†ï¼šå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨\n\n### ç”¨é€”\n\næ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚\nåå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚\n\n### å®‰å…¨æ€§\n\næ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚\nåå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚\n\n## Squidä¸»è¦ç»„æˆéƒ¨åˆ†\n\næœåŠ¡åï¼š`squid`\nä¸»ç¨‹åºï¼š`/usr/sbin/squid`\né…ç½®ç›®å½•ï¼š`/etc/squid`\nä¸»é…ç½®æ–‡ä»¶ï¼š`/etc/squid/squid.conf`\nç›‘å¬tcpç«¯å£å·ï¼š`3128`\né»˜è®¤è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼š`/var/log/squid/access.log`\n\n## squidå¸¸ç”¨é…ç½®é€‰é¡¹\n\n`/etc/squid/squid.conf`\n\n```\n\nhttp_port 3128  (è¿˜å¯ä»¥åªç›‘å¬ä¸€ä¸ªIP http_port 192.168.0.1:3128)\ncache_mem 64MB  #ç¼“å­˜å å†…å­˜å¤§å°\nmaximum_object_size 4096KB  #æœ€å¤§ç¼“å­˜å—\nreply_body_max_size  1024000 allow all      #é™å®šä¸‹è½½æ–‡ä»¶å¤§å°\naccess_log /var/log/squid/access.log    #è®¿é—®æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹\nvisible_hostname    proxy.test.xom  #å¯è§çš„ä¸»æœºå\ncache_dir ufs /var/spool/squid  100 16 256 \n#ufs:ç¼“å­˜æ•°æ®çš„å­˜å‚¨æ ¼å¼\n#/var/spool/squid    ç¼“å­˜ç›®å½•\n#100ï¼šç¼“å­˜ç›®å½•å ç£ç›˜ç©ºé—´å¤§å°ï¼ˆMï¼‰\n#16ï¼šç¼“å­˜ç©ºé—´ä¸€çº§å­ç›®å½•ä¸ªæ•°\n#256ï¼šç¼“å­˜ç©ºé—´äºŒçº§å­ç›®å½•ä¸ªæ•°\ncache_mgr webmaster@test.com    #å®šä¹‰ç®¡ç†å‘˜é‚®ç®±\nhttp_access deny all    #è®¿é—®æ§åˆ¶\n\n```\n## squidä¸­çš„è®¿é—®æ§åˆ¶\n\n  ä½¿ç”¨è®¿é—®æ§åˆ¶ç‰¹æ€§ï¼Œå¯ä»¥æ§åˆ¶åœ¨è®¿é—®æ—¶æ ¹æ®ç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œç¼“å­˜ã€è®¿é—®ç‰¹å®šç«™ç‚¹æˆ–ä¸€ç»„ç«™ç‚¹ç­‰ç­‰ã€‚squidè®¿é—®æ§åˆ¶æœ‰ä¸¤ä¸ªè¦ç´ ï¼šACLå…ƒç´ å’Œè®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä»¥å…è®¸æˆ–æ‹’ç»æŸäº›ç”¨æˆ·å¯¹æ­¤æœåŠ¡çš„è®¿é—®ã€‚\n\n### ACLå…ƒç´ ç±»å‹\n\n*   srcï¼šæºåœ°å€ï¼ˆå³å®¢æˆ·æœºIPåœ°å€ï¼‰\n*   dstï¼šç›®æ ‡åœ°å€ï¼ˆå³æœåŠ¡å™¨IPåœ°å€ï¼‰\n*   srcdomainï¼šæºåç§°ï¼ˆå³å®¢æˆ·æœºåç§°ï¼‰\n*   dstdomainï¼šç›®æ ‡åç§°ï¼ˆå³æœåŠ¡å™¨åç§°ï¼‰\n*   timeï¼šä¸€å¤©ä¸­çš„æ—¶åˆ»å’Œä¸€å‘¨å†…çš„ä¸€å¤©\n*   url_regexï¼šURLè§„åˆ™è¡¨è¾¾å¼åŒ¹é…\n*   urlpath_regexï¼šURL-pathè§„åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œç•¥å»åè®®å’Œä¸»æœºå\n*   proxy_authï¼šé€šè¿‡å¤–éƒ¨ç¨‹åºè¿›è¡Œç”¨æˆ·éªŒè¯\n*   maxconnï¼šå•ä¸€IPçš„æœ€å¤§è¿æ¥æ•°\n\n### ACLæ ¼å¼\n\n\tä¸ºäº†ä½¿ç”¨æ§åˆ¶åŠŸèƒ½ï¼Œå¿…é¡»å…ˆè®¾ç½®ACLè§„åˆ™å¹¶åº”ç”¨ã€‚ACLå£°æ˜çš„æ ¼å¼å¦‚ä¸‹ï¼š\n\næ³¨ï¼š\n\n*   acl_element_name å¯ä»¥æ˜¯ä»»ä¸€ä¸ªåœ¨ACLä¸­å®šä¹‰çš„åç§°\n*   ä»»ä½•ä¸¤ä¸ªACLå…ƒç´ ä¸èƒ½ç”¨ç›¸åŒçš„åå­—\n*   æ¯ä¸ªACLç”±åˆ—è¡¨å€¼ç»„æˆã€‚å½“è¿›è¡ŒåŒ¹é…æ£€æµ‹çš„æ—¶å€™ï¼Œå¤šä¸ªå€¼ç”±é€»è¾‘æˆ–è¿ç®—è¿æ¥ï¼›æ¢è¨€ä¹‹ï¼Œå³ä»»ä¸€ACLå…ƒç´ çš„å€¼è¢«åŒ¹é…ï¼Œåˆ™è¿™ä¸ªACLå…ƒç´ å³è¢«åŒ¹é…ã€‚\n*   å¹¶ä¸æ˜¯æ‰€æœ‰ACLå…ƒç´ éƒ½èƒ½ä½¿ç”¨è®¿é—®åˆ—è¡¨ä¸­çš„å…¨éƒ¨ç±»å‹\n*   ä¸åŒçš„ACLå…ƒç´ å†™åœ¨ä¸åŒè¡Œä¸­ï¼Œsquidå°†æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­\n\n### è®¿é—®æ¡ç›®\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„è®¿é—®æ¡ç›®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ä¸ªï¼š\n\n*   http_access:å…è®¸HTTPè®¿é—®\n*   no_cache:å®šä¹‰å¯¹ç¼“å­˜è¯·æ±‚çš„å“åº”ã€‚\n    è®¿é—®åˆ—è¡¨çš„è§„åˆ™ç”±ä¸€äº›ç±»ä¼¼'allow'æˆ–â€˜denyâ€™çš„å…³é”®å­—æ„æˆï¼Œç”¨ä»¥å…è®¸æˆ–æ‹’ç»å‘ç‰¹å®šæˆ–ä¸€ç»„ACLå…ƒç´ æä¾›æœåŠ¡ã€‚\n\n1.  ä¸€ä¸ªè®¿é—®åˆ—è¡¨å¯ä»¥ç”±å¤šæ¡è§„åˆ™ç»„æˆ\n2.  å¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™ä¸è®¿é—®è¯·æ±‚åŒ¹é…ï¼Œé»˜è®¤åŠ¨ä½œå°†ä¸åˆ—è¡¨ä¸­æœ€åä¸€æ¡è§„åˆ™å¯¹åº”ã€‚\n3.  ä¸€ä¸ªè®¿é—®æ¡ç›®ä¸­æ‰€æœ‰å…ƒç´ å°†ç”¨é€»è¾‘ä¸è¿ç®—è¿æ¥\n    http_access Action å£°æ˜1 AND å£°æ˜2 AND å£°æ˜ OR.\n    http_access Action å£°æ˜3\n    å¤šä¸ªhttp_accessså£°æ˜é—´ç”¨æˆ–è¿ç®—è¿æ¥ï¼Œä½†æ¯ä¸ªè®¿é—®æ¡ç›®çš„å…ƒç´ é—´ç”¨ä¸è¿ç®—è¿æ¥ã€‚\n4.  åˆ—è¡¨ä¸­çš„è§„åˆ™æ€»æ˜¯éµå¾ªç”±ä¸Šè€Œä¸‹çš„é¡ºåº\n5.  è¿™äº›è§„åˆ™æŒ‰ç…§ä»–ä»¬çš„æ’åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°åŒ¹é…çš„è§„åˆ™ï¼ŒåŒ¹é…å°±ç«‹å³ç»“æŸã€‚\n\n## Squid.confé…ç½®æ–‡ä»¶è¯¦è§£\n\n```\n#acl all src 0.0.0.0/0.0.0.0 and http_access allow allé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚è¯¦ç»†æƒ…å†µå‚è§å’ŒSquidè½¯ä»¶\n#æºå¸¦çš„æ–‡æ¡£ã€‚è¿™é‡Œçš„è®¿é—®æ§åˆ¶åˆ—è¡¨å…è®¸æ‰€æœ‰å¯¹ä»£ç†æœåŠ¡çš„è®¿é—®ï¼Œå› ä¸ºè¿™é‡Œè¯¥ä»£ç†æ˜¯åŠ é€ŸwebæœåŠ¡å™¨ã€‚\nacl all src 0.0.0.0/0.0.0.0                 #å…è®¸æ‰€æœ‰IPè®¿é—®\nacl manager proto http                 #manager urlåè®®ä¸ºhttp\nacl localhost src 127.0.0.1/255.255.255.255  #å…åˆæœ¬æœºIP\nacl to_localhost dst 127.0.0.1                 #å…åˆç›®çš„åœ°å€ä¸ºæœ¬æœºIP\nacl Safe_ports port 80                # å…è®¸å®‰å…¨æ›´æ–°çš„ç«¯å£ä¸º80\nacl CONNECT method CONNECT        #è¯·æ±‚æ–¹æ³•ä»¥CONNECT\nhttp_access allow all                #å…è®¸æ‰€æœ‰äººä½¿ç”¨è¯¥ä»£ç†.å› ä¸ºè¿™é‡Œæ˜¯ä»£ç†åŠ é€ŸwebæœåŠ¡å™¨\nhttp_reply_access allow all                #å…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ä»£ç†\n\nacl OverConnLimit maxconn 16        #é™åˆ¶æ¯ä¸ªIPæœ€å¤§å…è®¸16ä¸ªè¿æ¥ï¼Œé˜²æ­¢æ”»å‡»\nhttp_access deny OverConnLimit\n\nicp_access deny all                        #ç¦æ­¢ä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚.\nmiss_access allow all                #å…è®¸ç›´æ¥æ›´æ–°è¯·æ±‚\nident_lookup_access deny all                                #ç¦æ­¢lookupæ£€æŸ¥DNS\nhttp_port 8080 transparent                                #æŒ‡å®šSquidç›‘å¬æµè§ˆå™¨å®¢æˆ·è¯·æ±‚çš„ç«¯å£å·ã€‚\n\nhierarchy_stoplist cgi-bin ?                #ç”¨æ¥å¼ºåˆ¶æŸäº›ç‰¹å®šçš„å¯¹è±¡ä¸è¢«ç¼“å­˜ï¼Œä¸»è¦æ˜¯å¤„äºå®‰å…¨çš„ç›®çš„ã€‚\nacl QUERY urlpath_regex cgi-bin \\?\ncache deny QUERY\n\ncache_mem 1 GB        #è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œå¢åŠ è¯¥å†…å­˜å€¼æœ‰åˆ©äºç¼“å­˜ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼š\n                     #ä¸€èˆ¬æ¥è¯´å¦‚æœç³»ç»Ÿæœ‰å†…å­˜ï¼Œè®¾ç½®è¯¥å€¼ä¸º(n/)3Mã€‚ç°åœ¨æ˜¯3G æ‰€ä»¥è¿™é‡Œ1G\nfqdncache_size 1024        #FQDN é«˜é€Ÿç¼“å­˜å¤§å°\nmaximum_object_size_in_memory 2 MB        #å…è®¸æœ€å¤§çš„æ–‡ä»¶è½½å…¥å†…å­˜\n\nmemory_replacement_policy heap LFUDA  #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºå†…å­˜cache\ncache_replacement_policy heap LFUDA         #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºç¡¬ç›˜cache\n\ncache_dir ufs /home/cache 5000 32 512  #é«˜é€Ÿç¼“å­˜ç›®å½• ufs ç±»å‹ ä½¿ç”¨çš„ç¼“å†²å€¼æœ€å¤§å…åˆ1000MBç©ºé—´ï¼Œ\n#32ä¸ªä¸€çº§ç›®å½•ï¼Œ512ä¸ªäºŒçº§ç›®å½•\n\nmax_open_disk_fds 0                                 #å…è®¸æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡,0 æ— é™åˆ¶\nminimum_object_size 1 KB                         #å…åˆæœ€å°æ–‡ä»¶è¯·æ±‚ä½“å¤§å°\nmaximum_object_size 20 MB                 #å…åˆæœ€å¤§æ–‡ä»¶è¯·æ±‚ä½“å¤§å°\n\ncache_swap_low 90                            #æœ€å°å…è®¸ä½¿ç”¨swap 90%\ncache_swap_high 95                            #æœ€å¤šå…è®¸ä½¿ç”¨swap 95%\n\nipcache_size 2048                                # IP åœ°å€é«˜é€Ÿç¼“å­˜å¤§å° 2M\nipcache_low 90                                #æœ€å°å…è®¸ipcacheä½¿ç”¨swap 90%\nipcache_high 95                                  #æœ€å¤§å…è®¸ipcacheä½¿ç”¨swap 90%\n\n\naccess_log /var/log/squid/access.log squid        #å®šä¹‰æ—¥å¿—å­˜æ”¾è®°å½•\ncache_log /var/log/squid/cache.log squid\ncache_store_log none                        #ç¦æ­¢storeæ—¥å¿—\n\nemulate_httpd_log on        #å°†ä½¿Squidä»¿ç…§WebæœåŠ¡å™¨çš„æ ¼å¼åˆ›å»ºè®¿é—®è®°å½•ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨\n                                #Webè®¿é—®è®°å½•åˆ†æç¨‹åºï¼Œå°±éœ€è¦è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚\n\nrefresh_pattern . 0 20% 4320 override-expire override-lastmod reload-into-ims ignore-reload   #æ›´æ–°cacheè§„åˆ™\n\nacl buggy_server url_regex ^http://.... http://          #åªå…è®¸httpçš„è¯·æ±‚\nbroken_posts allow buggy_server\n\nacl apache rep_header Server ^Apache                 #å…è®¸apacheçš„ç¼–ç \nbroken_vary_encoding allow apache\n\nrequest_entities off                                        #ç¦æ­¢éhttpçš„æ ‡åˆ†å‡†è¯·æ±‚ï¼Œé˜²æ­¢æ”»å‡»\nheader_access header allow all                        #å…è®¸æ‰€æœ‰çš„httpæŠ¥å¤´\nrelaxed_header_parser on                                #ä¸ä¸¥æ ¼åˆ†æhttpæŠ¥å¤´.\nclient_lifetime 120 minute                                #æœ€å¤§å®¢æˆ·è¿æ¥æ—¶é—´ 120åˆ†é’Ÿ\n\ncache_mgr sky@test.com                        #æŒ‡å®šå½“ç¼“å†²å‡ºç°é—®é¢˜æ—¶å‘ç¼“å†²ç®¡ç†è€…å‘é€å‘Šè­¦ä¿¡æ¯çš„åœ°å€ä¿¡æ¯ã€‚\n\ncache_effective_user squid                        #è¿™é‡Œä»¥ç”¨æˆ·squidçš„èº«ä»½SquidæœåŠ¡å™¨\ncache_effective_group squid\n\nicp_port 0                       #æŒ‡å®šSquidä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚çš„ç«¯å£å·ã€‚\n                     #è¿™é‡Œè®¾ç½®ä¸º0æ˜¯å› ä¸ºè¿™é‡Œé…ç½®Squidä¸ºå†…éƒ¨WebæœåŠ¡å™¨çš„åŠ é€Ÿå™¨ï¼Œ\n                     #æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨é‚»å±…æœåŠ¡å™¨çš„ç¼“å†²ã€‚0æ˜¯ç¦ç”¨\n\n# cache_peer è®¾ç½®å…è®¸æ›´æ–°ç¼“å­˜çš„ä¸»æœºï¼Œå› æ˜¯æœ¬æœºæ‰€ä»¥127.0.0.1\ncache_peer 127.0.0.1 parent 80 0 no-query default multicast-responder no-netdb-exchange\ncache_peer_domain 127.0.0.1                                 \nhostname_aliases 127.0.0.1\n\nerror_directory /usr/share/squid/errors/Simplify_Chinese        #å®šä¹‰é”™è¯¯è·¯å¾„\n\nalways_direct allow all                # cacheä¸¢å¤±æˆ–ä¸å­˜åœ¨æ˜¯å…è®¸æ‰€æœ‰è¯·æ±‚ç›´æ¥è½¬å‘åˆ°åŸå§‹æœåŠ¡å™¨\nignore_unknown_nameservers on        #å¼€åDNSæŸ¥è¯¢ï¼Œå½“åŸŸååœ°å€ä¸ç›¸åŒæ—¶å€™ï¼Œç¦æ­¢è®¿é—®\ncoredump_dir  /var/log/squid                 #å®šä¹‰dumpçš„ç›®å½•\n\nmax_filedesc 2048                #æœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°\n\nhalf_closed_clients off        #ä½¿Squidåœ¨å½“readä¸å†è¿”å›æ•°æ®æ—¶ç«‹å³å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ã€‚\n                                #æœ‰æ—¶readä¸å†è¿”å›æ•°æ®æ˜¯ç”±äºæŸäº›å®¢æˆ·å…³é—­TCPçš„å‘é€æ•°æ®\n                                #è€Œä»ç„¶ä¿æŒæ¥æ”¶æ•°æ®ã€‚è€ŒSquidåˆ†è¾¨ä¸å‡ºTCPåŠå…³é—­å’Œå®Œå…¨å…³é—­ã€‚\n\nbuffered_logs on #è‹¥æ‰“å¼€é€‰é¡¹â€œbuffered_logsâ€å¯ä»¥ç¨ç¨æé«˜åŠ é€ŸæŸäº›å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥ï¼Œè¯¥é€‰é¡¹ä¸»è¦æ˜¯å®ç°ä¼˜åŒ–ç‰¹æ€§ã€‚\n\n#é˜²æ­¢å¤©æ¶¯ç›—é“¾ï¼Œè½¬å«ç»™ç™¾åº¦\nacl tianya referer_regex -i tianya\nhttp_access deny tianya\ndeny_info  tianya\n#é˜»æ­¢baiduèœ˜è››\nacl baidu req_header User-Agent Baiduspider\nhttp_access deny baidu\n#é™åˆ¶åŒä¸€IPå®¢æˆ·ç«¯çš„æœ€å¤§è¿æ¥æ•°\nacl OverConnLimit maxconn 128\nhttp_access deny OverConnLimit\n\n#é˜²æ­¢è¢«äººåˆ©ç”¨ä¸ºHTTPä»£ç†ï¼Œè®¾ç½®å…è®¸è®¿é—®çš„IPåœ°å€\nacl myip dst 222.18.63.37\nhttp_access deny !myip\n\n#å…è®¸æœ¬åœ°ç®¡ç†\nacl Manager proto cache_object\nacl Localhost src 127.0.0.1 222.18.63.37\nhttp_access allow Manager Localhost\ncachemgr_passwd 53034338 all\nhttp_access deny Manager\n\n#ä»…ä»…å…è®¸80ç«¯å£çš„ä»£ç†\nacl all src 0.0.0.0/0.0.0.0\nacl Safe_ports port 80 # http\nhttp_access deny !Safe_ports\nhttp_access allow all\n\n#Squidä¿¡æ¯è®¾ç½®\nvisible_hostname happy.swjtu.edu.cn\ncache_mgr  ooopic2008@qq.com\n\n#åŸºæœ¬è®¾ç½®\ncache_effective_user squid\ncache_effective_group squid\ntcp_recv_bufsize 65535 bytes\n\n#2.6çš„åå‘ä»£ç†åŠ é€Ÿé…ç½®\ncache_peer 127.0.0.1 parent 80 0 no-query originserver\n\n#é”™è¯¯æ–‡æ¡£\nerror_directory /usr/local/squid/share/errors/Simplify_Chinese\n\n#å•å°ä½¿ç”¨ï¼Œä¸ä½¿ç”¨è¯¥åŠŸèƒ½\nicp_port 0\n\nhierarchy_stoplist cgi-bin ?\n\nacl QUERY urlpath_regex cgi-bin \\? .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .exe\ncache deny QUERY\n\nacl apache rep_header Server ^Apache\nbroken_vary_encoding allow apache\n\n\nrefresh_pattern ^ftp:           1440 20%     10080\nrefresh_pattern ^gopher:        1440 0%    1440\nrefresh_pattern .             0    20%     4320\n\ncache_store_log none\npid_filename /usr/local/squid/var/logs/squid.pid\nemulate_httpd_log on\n```\n\n## Squidå¸¸ç”¨å‘½ä»¤\n\n1.  åˆå§‹åŒ–åœ¨squid.confé‡Œé…ç½®çš„cacheç›®å½•\n    squid -z\n    å¦‚æœæœ‰é”™è¯¯æç¤ºï¼Œè¯·æ£€æŸ¥cacheç›®å½•çš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹ç›®å½•æƒé™\n    chown -R squid:squid /cacheç›®å½•\n2.  å¯¹squid.confæ’é”™ï¼Œå³éªŒè¯squid.confçš„è¯­æ³•å’Œé…ç½®\n    squid -k parse\n    å¦‚æœåœ¨squid.confä¸­æœ‰è¯­æ³•æˆ–é…ç½®é”™è¯¯ï¼Œè¿™é‡Œä¼šè¿”å›æç¤ºï¼Œè‹¥æ— è¿”å›ï¼Œå°è¯•å¯åŠ¨squid\n3.  å‰å°å¯åŠ¨squidï¼Œå¹¶è¾“å‡ºå¯åŠ¨è¿‡ç¨‹\n    /usr/local/squid/sbin/squid -N -d1\n    å¦‚æœæœ‰ready to server requesç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜squidå¯åŠ¨æˆåŠŸ\n    ç„¶åctrl+c ,åœæ­¢squid,å¹¶ä»¥åå°è¿è¡Œçš„æ–¹å¼å¯åŠ¨å®ƒ\n4.  å¯åŠ¨squidåœ¨åå°è¿è¡Œ\n    squid -s\n    å¯ä»¥ä½¿ç”¨ps -ax | grep squid æ¥æŸ¥çœ‹squidè¿›ç¨‹æ˜¯å¦å­˜åœ¨\n5.  åœæ­¢squid\n    squid -k shutdown\n6.  é‡æ–°å¼•å¯¼ä¿®æ”¹è¿‡çš„squid.conf\n    squid -k reconfigure -f /XXX/squid.conf\n    å½“squidè¿›è¡Œé…ç½®æ›´æ”¹åï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œsquidé…ç½®é‡è½½\n7.  æŠŠsquidæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹\n    vim /etc/rc.local\n    /usr/local/squid/sbin/squid -s\n8.  ä¿®æ”¹cacheç¼“å­˜ç›®å½•çš„æƒé™\n    chown -R squid.squid /cacheç›®å½•\n    cacheç¼“å­˜ç›®å½•æ ¹æ®è‡ªå·±çš„é…ç½®æ›´æ”¹ï¼Œsquidç”¨æˆ·å’Œç»„æ˜¯squidï¼Œsquid\n9.  ä¿®æ”¹squidæ—¥å¿—ç›®å½•çš„æƒé™\n    chown -R squid.squid å®šä¹‰çš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•\n    è¿™ä¸€æ­¥å¹¶ä¸æ˜¯é€‚åˆæ¯ä¸€ä¸ªä½¿ç”¨squidçš„ç”¨æˆ·ï¼Œæ„ä¸ºè®©squidæœ‰æƒé™åœ¨è¯¥ç›®å½•é‡Œè¿›è¡Œå†™æ“ä½œ\n10.  æŸ¥çœ‹ä½ çš„æ—¥å¿—æ–‡æ¡£\n    more /usr/local/squid/var/logs/access.log | grep TCP_MEM_HIT\n    è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚\n    more /usr/local/squid/var/logs/access.log | grep TCP_HIT\n    è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°cacheç›®å½•ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚\n    more /usr/local/squid/var/logs/access.log | grep TCP_MISS\n    è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶æ²¡æœ‰è¢«squidç¼“å­˜ï¼Œè€Œæ˜¯ä»åŸå§‹æœåŠ¡å™¨è·å–å¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚\n\n## Squidå‘½ä¸­ç‡åˆ†æ\n\n```\n/usr/local/squid/bin/squidclient -p 80 mgr:info\n/usr/local/squid/bin/squidclient -p 80 mgr:5min\n```\nå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½æƒ…å†µ,å…¶ä¸­PORTæ˜¯ä½ çš„proxyçš„ç«¯å£ï¼Œ5minå¯ä»¥æ˜¯60min\nå–å¾—squidè¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š\n\n```\n squidclient -p 80 mgr:info\n```\n\nå–å¾—squidå†…å­˜ä½¿ç”¨æƒ…å†µï¼š\n\n```\nsquidclient -p 80 mgr:mem\n```\n\nå–å¾—squidå·²ç»ç¼“å­˜çš„åˆ—è¡¨ï¼š\n\n```\nsquidclient -p 80 mgr:bjects. use it carefully,it may crash\n```\n\nå–å¾—squidçš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š\n\n```\nsquidclient -p 80 mgr:diskd\n```\n\nå¼ºåˆ¶æ›´æ–°æŸä¸ªurlï¼š\n\n```\nsquidclient -p 80 -m PURGE http://www.xxx.com/xxx.php\n```\n\næ›´å¤šçš„è¯·æŸ¥çœ‹ï¼šsquidclient-h æˆ–è€… squidclient -p 80 mgr:\næŸ¥å‘½ä¸­ç‡ï¼š\n\n```\nsquidclient -h IP(å…·ä½“ä¾¦å¬IP) -p 80(å…·ä½“ä¾¦å¬ç«¯å£) mgr:info\n```\n\n## å®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®\n\n```\n/path/to/squid/sbin/squid -k rotate -f /path/to/squid/conf_file\nvi /etc/crontab\n0        0       *       *       *       root    /usr/local/sbin/squid -k rotate -f /usr/local/etc/squid/squid1.conf\n```\n\nå½“squidåº”ç”¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œcache_dirå¯¹åº”çš„swap.stateæ–‡ä»¶å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‡Œé¢çš„æ— æ•ˆæ¥å£æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½å½±å“squidçš„å“åº”æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨squidæ¸…ç†swap.stateé‡Œé¢çš„æ— æ•ˆæ•°æ®ï¼Œå‡å°‘swap.stateçš„å¤§å°ã€‚\n","content":"<h1 id=\"squidçš„æ¦‚å¿µ\"><a href=\"#squidçš„æ¦‚å¿µ\" class=\"headerlink\" title=\"squidçš„æ¦‚å¿µ\"></a>squidçš„æ¦‚å¿µ</h1><p>squidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»ç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚</p><a id=\"more\"></a><h1 id=\"ä¸‹è½½åœ°å€\"><a href=\"#ä¸‹è½½åœ°å€\" class=\"headerlink\" title=\"ä¸‹è½½åœ°å€\"></a>ä¸‹è½½åœ°å€</h1><p>squid-cache å®˜ç½‘ <span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5zcXVpZC1jYWNoZS5vcmc=\" title=\"http://www.squid-cache.org\">http://www.squid-cache.org<i class=\"fa fa-external-link\"></i></span></p><p>squidä»‹ç»åŠå…¶ç®€å•é…ç½® <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vY2hlcmlzaHJ5L3AvNTcwNjczNi5odG1s\" title=\"https://www.cnblogs.com/cherishry/p/5706736.html\">https://www.cnblogs.com/cherishry/p/5706736.html<i class=\"fa fa-external-link\"></i></span></p><p>CentOS 7å®‰è£…squidä»£ç†æœåŠ¡å™¨ <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l0aG9tZXIvYXJ0aWNsZS9kZXRhaWxzLzc4MTM2OTkz\" title=\"https://blog.csdn.net/ithomer/article/details/78136993\">https://blog.csdn.net/ithomer/article/details/78136993<i class=\"fa fa-external-link\"></i></span></p><h2 id=\"squidä»£ç†çš„ä½œç”¨\"><a href=\"#squidä»£ç†çš„ä½œç”¨\" class=\"headerlink\" title=\"squidä»£ç†çš„ä½œç”¨\"></a>squidä»£ç†çš„ä½œç”¨</h2><ul><li>é€šè¿‡ç¼“å­˜çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›Webè®¿é—®åŠ é€Ÿ</li><li>å¯¹ç”¨æˆ·çš„Webè®¿é—®è¿›è¡Œè¿‡æ»¤æ§åˆ¶</li></ul><h2 id=\"å·¥ä½œæµç¨‹\"><a href=\"#å·¥ä½œæµç¨‹\" class=\"headerlink\" title=\"å·¥ä½œæµç¨‹\"></a>å·¥ä½œæµç¨‹</h2><p>å½“ä»£ç†æœåŠ¡å™¨ä¸­æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶ï¼š</p><p>a.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›</p><p>b.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›</p><p>c.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼Œå–å‡ºæ•°æ®ï¼›</p><p>d.ä»£ç†æœåŠ¡å™¨å°†ä»ç¼“å­˜ä¸­å–å¾—çš„æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å½“ä»£ç†æœåŠ¡å™¨ä¸­æ²¡æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶äº†ï¼š</p><p>1.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›</p><p>2.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›</p><p>3.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼›</p><p>4.ä»£ç†æœåŠ¡å™¨å‘Internet ä¸Šçš„è¿œç«¯æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›</p><p>5.è¿œç«¯æœåŠ¡å™¨å“åº”ï¼Œè¿”å›ç›¸åº”çš„æ•°æ®ï¼›</p><p>6.ä»£ç†æœåŠ¡å™¨å–å¾—è¿œç«¯æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿ç•™ä¸€ä»½åˆ°è‡ªå·±çš„æ•°æ®ç¼“å­˜ä¸­ã€‚</p><p><img src=\"https://images2015.cnblogs.com/blog/872781/201607/872781-20160726112850919-758636566.jpg\" alt=\"\"></p><p>Squidä»£ç†æœåŠ¡å™¨å·¥ä½œåœ¨TCP/IPåº”ç”¨å±‚</p><p><img src=\"https://images2015.cnblogs.com/blog/872781/201607/872781-20160726112935653-887103660.jpg\" alt=\"\"></p><h2 id=\"Squidå„ç§ä»£ç†çš„å®šä¹‰\"><a href=\"#Squidå„ç§ä»£ç†çš„å®šä¹‰\" class=\"headerlink\" title=\"Squidå„ç§ä»£ç†çš„å®šä¹‰\"></a>Squidå„ç§ä»£ç†çš„å®šä¹‰</h2><h3 id=\"æ­£å‘ä»£ç†\"><a href=\"#æ­£å‘ä»£ç†\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†\"></a>æ­£å‘ä»£ç†</h3><h4 id=\"æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨\"><a href=\"#æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨\" class=\"headerlink\" title=\"æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨\"></a>æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨</h4><p>ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡è¢«ç”¨äºç¼“å­˜é™æ€çš„ç½‘é¡µåˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸€å°ä¸»æœºä¸Šï¼ˆå³ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚å½“è¢«ç¼“å­˜çš„é¡µé¢è¢«ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†ç›´æ¥ä»æœ¬åœ°ä»£ç†æœåŠ¡å™¨é‚£é‡Œè·å–è¯·æ±‚æ•°æ®è€Œä¸å†å‘åŸwebç«™ç‚¹è¯·æ±‚æ•°æ®ã€‚è¿™æ ·å°±èŠ‚çœäº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œè¦æƒ³å®ç°è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æ¯ä¸€ä¸ªå†…éƒ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šæ˜ç¡®æŒ‡åä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚å®¢æˆ·ç«¯ä¸Šç½‘æ—¶ï¼Œæ¯æ¬¡éƒ½æŠŠè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†,ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ç¡®å®šæ˜¯å¦è¿æ¥åˆ°è¿œç¨‹webæœåŠ¡å™¨è·å–æ•°æ®ã€‚å¦‚æœåœ¨æœ¬åœ°ç¼“å†²åŒºæœ‰ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™ç›´æ¥å°†æ–‡ä»¶ä¼ ç»™ç”¨æˆ·å³å¯ã€‚å¦‚æœæ²¡æœ‰çš„è¯åˆ™å…ˆå–å›æ–‡ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½ç¼“å†²ï¼Œç„¶åå°†æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚</p><h4 id=\"é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨\"><a href=\"#é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨\" class=\"headerlink\" title=\"é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨\"></a>é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨</h4><p>é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œä»£ç†æ“ä½œå¯¹å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ˜¯é€æ˜çš„ï¼ˆå³ä¸éœ€æŒ‡æ˜ä»£ç†æœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼‰ã€‚é€æ˜ä»£ç†æœåŠ¡å™¨é˜»æ–­ç½‘ç»œé€šä¿¡ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºè®¿é—®å¤–éƒ¨çš„HTTPï¼ˆ80ç«¯å£ï¼‰æµé‡ã€‚å¦‚æœå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœ¬åœ°æœ‰ç¼“å†²åˆ™å°†ç¼“å†²çš„æ•°æ®ç›´æ¥å‘ç»™ç”¨æˆ·ï¼Œå¦‚æœåœ¨æœ¬åœ°æ²¡æœ‰ç¼“å†²åˆ™å‘è¿œç¨‹webæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä½™æ“ä½œå’Œæ ‡å‡†çš„ä»£ç†æœåŠ¡å™¨å®Œå…¨ç›¸åŒã€‚å¯¹äºlinuxæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé€æ˜ä»£ç†ä½¿ç”¨Iptablesæˆ–è€…Ipchainså®ç°ã€‚å› æ­¤ä¸éœ€è¦å¯¹æµè§ˆå™¨ä½œä»»ä½•è®¾ç½®ï¼Œæ‰€ä»¥ï¼Œé€æ˜ä»£ç†å¯¹äºISPï¼ˆInternetæœåŠ¡å™¨æä¾›å•†ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚</p><h3 id=\"åå‘ä»£ç†\"><a href=\"#åå‘ä»£ç†\" class=\"headerlink\" title=\"åå‘ä»£ç†\"></a>åå‘ä»£ç†</h3><h4 id=\"åå‘ä»£ç†ç¼“å†²å™¨\"><a href=\"#åå‘ä»£ç†ç¼“å†²å™¨\" class=\"headerlink\" title=\"åå‘ä»£ç†ç¼“å†²å™¨\"></a>åå‘ä»£ç†ç¼“å†²å™¨</h4><p>åå‘ä»£ç†æ˜¯å’Œå‰ä¸¤ç§ä»£ç†å®Œå…¨ä¸åŒçš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚ä½¿ç”¨å®ƒå¯ä»¥é™ä½åŸå§‹WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚åå‘ä»£ç†æœåŠ¡å™¨æ‰¿æ‹…äº†å¯¹åŸå§‹WEBæœåŠ¡å™¨çš„é™æ€é¡µé¢çš„è¯·æ±‚ï¼Œé˜²æ­¢åŸå§‹æœåŠ¡å™¨è¿‡è½½ã€‚å®ƒä½äºWEBæœåŠ¡å™¨å’ŒInternetä¹‹é—´ï¼Œå¤„ç†æ‰€æœ‰å¯¹WEBæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œç»„ç»‡äº†WEBæœåŠ¡å™¨å’ŒInternetçš„ç›´æ¥é€šä¿¡ã€‚å¦‚æœäº’è”ç½‘ç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å†²çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æ¥å°†ç¼“å†²å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚å¦‚æœæ²¡æœ‰ç¼“å†²åˆ™å…ˆå‘WEBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›æ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åå†å‘ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹å¼é€šè¿‡é™ä½äº†WEBæœåŠ¡å™¨çš„è¯·æ±‚æ•°ä»è€Œé™ä½äº†WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚</p><h3 id=\"æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«\"><a href=\"#æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«\" class=\"headerlink\" title=\"æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«\"></a>æ­£å‘ä»£ç†ä¸åå‘ä»£ç†çš„åŒºåˆ«</h3><h3 id=\"æ¦‚å¿µ\"><a href=\"#æ¦‚å¿µ\" class=\"headerlink\" title=\"æ¦‚å¿µ\"></a>æ¦‚å¿µ</h3><p>æ­£å‘ä»£ç†ï¼šå¯¹äºåŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äºº<br>åå‘ä»£ç†ï¼šå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨</p><h3 id=\"ç”¨é€”\"><a href=\"#ç”¨é€”\" class=\"headerlink\" title=\"ç”¨é€”\"></a>ç”¨é€”</h3><p>æ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚<br>åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚</p><h3 id=\"å®‰å…¨æ€§\"><a href=\"#å®‰å…¨æ€§\" class=\"headerlink\" title=\"å®‰å…¨æ€§\"></a>å®‰å…¨æ€§</h3><p>æ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚<br>åå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚</p><h2 id=\"Squidä¸»è¦ç»„æˆéƒ¨åˆ†\"><a href=\"#Squidä¸»è¦ç»„æˆéƒ¨åˆ†\" class=\"headerlink\" title=\"Squidä¸»è¦ç»„æˆéƒ¨åˆ†\"></a>Squidä¸»è¦ç»„æˆéƒ¨åˆ†</h2><p>æœåŠ¡åï¼š<code>squid</code><br>ä¸»ç¨‹åºï¼š<code>/usr/sbin/squid</code><br>é…ç½®ç›®å½•ï¼š<code>/etc/squid</code><br>ä¸»é…ç½®æ–‡ä»¶ï¼š<code>/etc/squid/squid.conf</code><br>ç›‘å¬tcpç«¯å£å·ï¼š<code>3128</code><br>é»˜è®¤è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼š<code>/var/log/squid/access.log</code></p><h2 id=\"squidå¸¸ç”¨é…ç½®é€‰é¡¹\"><a href=\"#squidå¸¸ç”¨é…ç½®é€‰é¡¹\" class=\"headerlink\" title=\"squidå¸¸ç”¨é…ç½®é€‰é¡¹\"></a>squidå¸¸ç”¨é…ç½®é€‰é¡¹</h2><p><code>/etc/squid/squid.conf</code></p><figure class=\"highlight glsl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">http_port <span class=\"number\">3128</span>  (è¿˜å¯ä»¥åªç›‘å¬ä¸€ä¸ªIP http_port <span class=\"number\">192.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">3128</span>)</span><br><span class=\"line\">cache_mem <span class=\"number\">64</span>MB  <span class=\"meta\">#ç¼“å­˜å å†…å­˜å¤§å°</span></span><br><span class=\"line\">maximum_object_size <span class=\"number\">4096</span>KB  <span class=\"meta\">#æœ€å¤§ç¼“å­˜å—</span></span><br><span class=\"line\">reply_body_max_size  <span class=\"number\">1024000</span> allow <span class=\"built_in\">all</span>      <span class=\"meta\">#é™å®šä¸‹è½½æ–‡ä»¶å¤§å°</span></span><br><span class=\"line\">access_log /var/<span class=\"built_in\">log</span>/squid/access.<span class=\"built_in\">log</span>    <span class=\"meta\">#è®¿é—®æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹</span></span><br><span class=\"line\">visible_hostname    proxy.test.xom  <span class=\"meta\">#å¯è§çš„ä¸»æœºå</span></span><br><span class=\"line\">cache_dir ufs /var/spool/squid  <span class=\"number\">100</span> <span class=\"number\">16</span> <span class=\"number\">256</span> </span><br><span class=\"line\"><span class=\"meta\">#ufs:ç¼“å­˜æ•°æ®çš„å­˜å‚¨æ ¼å¼</span></span><br><span class=\"line\"><span class=\"meta\">#/var/spool/squid    ç¼“å­˜ç›®å½•</span></span><br><span class=\"line\"><span class=\"meta\">#100ï¼šç¼“å­˜ç›®å½•å ç£ç›˜ç©ºé—´å¤§å°ï¼ˆMï¼‰</span></span><br><span class=\"line\"><span class=\"meta\">#16ï¼šç¼“å­˜ç©ºé—´ä¸€çº§å­ç›®å½•ä¸ªæ•°</span></span><br><span class=\"line\"><span class=\"meta\">#256ï¼šç¼“å­˜ç©ºé—´äºŒçº§å­ç›®å½•ä¸ªæ•°</span></span><br><span class=\"line\">cache_mgr webmaster@test.com    <span class=\"meta\">#å®šä¹‰ç®¡ç†å‘˜é‚®ç®±</span></span><br><span class=\"line\">http_access deny <span class=\"built_in\">all</span>    <span class=\"meta\">#è®¿é—®æ§åˆ¶</span></span><br></pre></td></tr></table></figure><h2 id=\"squidä¸­çš„è®¿é—®æ§åˆ¶\"><a href=\"#squidä¸­çš„è®¿é—®æ§åˆ¶\" class=\"headerlink\" title=\"squidä¸­çš„è®¿é—®æ§åˆ¶\"></a>squidä¸­çš„è®¿é—®æ§åˆ¶</h2><p>ä½¿ç”¨è®¿é—®æ§åˆ¶ç‰¹æ€§ï¼Œå¯ä»¥æ§åˆ¶åœ¨è®¿é—®æ—¶æ ¹æ®ç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œç¼“å­˜ã€è®¿é—®ç‰¹å®šç«™ç‚¹æˆ–ä¸€ç»„ç«™ç‚¹ç­‰ç­‰ã€‚squidè®¿é—®æ§åˆ¶æœ‰ä¸¤ä¸ªè¦ç´ ï¼šACLå…ƒç´ å’Œè®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä»¥å…è®¸æˆ–æ‹’ç»æŸäº›ç”¨æˆ·å¯¹æ­¤æœåŠ¡çš„è®¿é—®ã€‚</p><h3 id=\"ACLå…ƒç´ ç±»å‹\"><a href=\"#ACLå…ƒç´ ç±»å‹\" class=\"headerlink\" title=\"ACLå…ƒç´ ç±»å‹\"></a>ACLå…ƒç´ ç±»å‹</h3><ul><li>srcï¼šæºåœ°å€ï¼ˆå³å®¢æˆ·æœºIPåœ°å€ï¼‰</li><li>dstï¼šç›®æ ‡åœ°å€ï¼ˆå³æœåŠ¡å™¨IPåœ°å€ï¼‰</li><li>srcdomainï¼šæºåç§°ï¼ˆå³å®¢æˆ·æœºåç§°ï¼‰</li><li>dstdomainï¼šç›®æ ‡åç§°ï¼ˆå³æœåŠ¡å™¨åç§°ï¼‰</li><li>timeï¼šä¸€å¤©ä¸­çš„æ—¶åˆ»å’Œä¸€å‘¨å†…çš„ä¸€å¤©</li><li>url_regexï¼šURLè§„åˆ™è¡¨è¾¾å¼åŒ¹é…</li><li>urlpath_regexï¼šURL-pathè§„åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œç•¥å»åè®®å’Œä¸»æœºå</li><li>proxy_authï¼šé€šè¿‡å¤–éƒ¨ç¨‹åºè¿›è¡Œç”¨æˆ·éªŒè¯</li><li>maxconnï¼šå•ä¸€IPçš„æœ€å¤§è¿æ¥æ•°</li></ul><h3 id=\"ACLæ ¼å¼\"><a href=\"#ACLæ ¼å¼\" class=\"headerlink\" title=\"ACLæ ¼å¼\"></a>ACLæ ¼å¼</h3><pre><code>ä¸ºäº†ä½¿ç”¨æ§åˆ¶åŠŸèƒ½ï¼Œå¿…é¡»å…ˆè®¾ç½®ACLè§„åˆ™å¹¶åº”ç”¨ã€‚ACLå£°æ˜çš„æ ¼å¼å¦‚ä¸‹ï¼š\n</code></pre><p>æ³¨ï¼š</p><ul><li>acl_element_name å¯ä»¥æ˜¯ä»»ä¸€ä¸ªåœ¨ACLä¸­å®šä¹‰çš„åç§°</li><li>ä»»ä½•ä¸¤ä¸ªACLå…ƒç´ ä¸èƒ½ç”¨ç›¸åŒçš„åå­—</li><li>æ¯ä¸ªACLç”±åˆ—è¡¨å€¼ç»„æˆã€‚å½“è¿›è¡ŒåŒ¹é…æ£€æµ‹çš„æ—¶å€™ï¼Œå¤šä¸ªå€¼ç”±é€»è¾‘æˆ–è¿ç®—è¿æ¥ï¼›æ¢è¨€ä¹‹ï¼Œå³ä»»ä¸€ACLå…ƒç´ çš„å€¼è¢«åŒ¹é…ï¼Œåˆ™è¿™ä¸ªACLå…ƒç´ å³è¢«åŒ¹é…ã€‚</li><li>å¹¶ä¸æ˜¯æ‰€æœ‰ACLå…ƒç´ éƒ½èƒ½ä½¿ç”¨è®¿é—®åˆ—è¡¨ä¸­çš„å…¨éƒ¨ç±»å‹</li><li>ä¸åŒçš„ACLå…ƒç´ å†™åœ¨ä¸åŒè¡Œä¸­ï¼Œsquidå°†æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­</li></ul><h3 id=\"è®¿é—®æ¡ç›®\"><a href=\"#è®¿é—®æ¡ç›®\" class=\"headerlink\" title=\"è®¿é—®æ¡ç›®\"></a>è®¿é—®æ¡ç›®</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„è®¿é—®æ¡ç›®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ä¸ªï¼š</p><ul><li>http_access:å…è®¸HTTPè®¿é—®</li><li>no_cache:å®šä¹‰å¯¹ç¼“å­˜è¯·æ±‚çš„å“åº”ã€‚<br>è®¿é—®åˆ—è¡¨çš„è§„åˆ™ç”±ä¸€äº›ç±»ä¼¼â€™allowâ€™æˆ–â€˜denyâ€™çš„å…³é”®å­—æ„æˆï¼Œç”¨ä»¥å…è®¸æˆ–æ‹’ç»å‘ç‰¹å®šæˆ–ä¸€ç»„ACLå…ƒç´ æä¾›æœåŠ¡ã€‚</li></ul><ol><li>ä¸€ä¸ªè®¿é—®åˆ—è¡¨å¯ä»¥ç”±å¤šæ¡è§„åˆ™ç»„æˆ</li><li>å¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™ä¸è®¿é—®è¯·æ±‚åŒ¹é…ï¼Œé»˜è®¤åŠ¨ä½œå°†ä¸åˆ—è¡¨ä¸­æœ€åä¸€æ¡è§„åˆ™å¯¹åº”ã€‚</li><li>ä¸€ä¸ªè®¿é—®æ¡ç›®ä¸­æ‰€æœ‰å…ƒç´ å°†ç”¨é€»è¾‘ä¸è¿ç®—è¿æ¥<br>http_access Action å£°æ˜1 AND å£°æ˜2 AND å£°æ˜ OR.<br>http_access Action å£°æ˜3<br>å¤šä¸ªhttp_accessså£°æ˜é—´ç”¨æˆ–è¿ç®—è¿æ¥ï¼Œä½†æ¯ä¸ªè®¿é—®æ¡ç›®çš„å…ƒç´ é—´ç”¨ä¸è¿ç®—è¿æ¥ã€‚</li><li>åˆ—è¡¨ä¸­çš„è§„åˆ™æ€»æ˜¯éµå¾ªç”±ä¸Šè€Œä¸‹çš„é¡ºåº</li><li>è¿™äº›è§„åˆ™æŒ‰ç…§ä»–ä»¬çš„æ’åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°åŒ¹é…çš„è§„åˆ™ï¼ŒåŒ¹é…å°±ç«‹å³ç»“æŸã€‚</li></ol><h2 id=\"Squid-confé…ç½®æ–‡ä»¶è¯¦è§£\"><a href=\"#Squid-confé…ç½®æ–‡ä»¶è¯¦è§£\" class=\"headerlink\" title=\"Squid.confé…ç½®æ–‡ä»¶è¯¦è§£\"></a>Squid.confé…ç½®æ–‡ä»¶è¯¦è§£</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#acl all src 0.0.0.0/0.0.0.0 and http_access allow allé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªè®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚è¯¦ç»†æƒ…å†µå‚è§å’ŒSquidè½¯ä»¶</span></span><br><span class=\"line\"><span class=\"comment\">#æºå¸¦çš„æ–‡æ¡£ã€‚è¿™é‡Œçš„è®¿é—®æ§åˆ¶åˆ—è¡¨å…è®¸æ‰€æœ‰å¯¹ä»£ç†æœåŠ¡çš„è®¿é—®ï¼Œå› ä¸ºè¿™é‡Œè¯¥ä»£ç†æ˜¯åŠ é€ŸwebæœåŠ¡å™¨ã€‚</span></span><br><span class=\"line\">acl all src 0.0.0.0/0.0.0.0                 <span class=\"comment\">#å…è®¸æ‰€æœ‰IPè®¿é—®</span></span><br><span class=\"line\">acl manager proto http                 <span class=\"comment\">#manager urlåè®®ä¸ºhttp</span></span><br><span class=\"line\">acl localhost src 127.0.0.1/255.255.255.255  <span class=\"comment\">#å…åˆæœ¬æœºIP</span></span><br><span class=\"line\">acl to_localhost dst 127.0.0.1                 <span class=\"comment\">#å…åˆç›®çš„åœ°å€ä¸ºæœ¬æœºIP</span></span><br><span class=\"line\">acl Safe_ports port 80                <span class=\"comment\"># å…è®¸å®‰å…¨æ›´æ–°çš„ç«¯å£ä¸º80</span></span><br><span class=\"line\">acl CONNECT method CONNECT        <span class=\"comment\">#è¯·æ±‚æ–¹æ³•ä»¥CONNECT</span></span><br><span class=\"line\">http_access allow all                <span class=\"comment\">#å…è®¸æ‰€æœ‰äººä½¿ç”¨è¯¥ä»£ç†.å› ä¸ºè¿™é‡Œæ˜¯ä»£ç†åŠ é€ŸwebæœåŠ¡å™¨</span></span><br><span class=\"line\">http_reply_access allow all                <span class=\"comment\">#å…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ä»£ç†</span></span><br><span class=\"line\"></span><br><span class=\"line\">acl OverConnLimit maxconn 16        <span class=\"comment\">#é™åˆ¶æ¯ä¸ªIPæœ€å¤§å…è®¸16ä¸ªè¿æ¥ï¼Œé˜²æ­¢æ”»å‡»</span></span><br><span class=\"line\">http_access deny OverConnLimit</span><br><span class=\"line\"></span><br><span class=\"line\">icp_access deny all                        <span class=\"comment\">#ç¦æ­¢ä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚.</span></span><br><span class=\"line\">miss_access allow all                <span class=\"comment\">#å…è®¸ç›´æ¥æ›´æ–°è¯·æ±‚</span></span><br><span class=\"line\">ident_lookup_access deny all                                <span class=\"comment\">#ç¦æ­¢lookupæ£€æŸ¥DNS</span></span><br><span class=\"line\">http_port 8080 transparent                                <span class=\"comment\">#æŒ‡å®šSquidç›‘å¬æµè§ˆå™¨å®¢æˆ·è¯·æ±‚çš„ç«¯å£å·ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">hierarchy_stoplist cgi-bin ?                <span class=\"comment\">#ç”¨æ¥å¼ºåˆ¶æŸäº›ç‰¹å®šçš„å¯¹è±¡ä¸è¢«ç¼“å­˜ï¼Œä¸»è¦æ˜¯å¤„äºå®‰å…¨çš„ç›®çš„ã€‚</span></span><br><span class=\"line\">acl QUERY urlpath_regex cgi-bin \\?</span><br><span class=\"line\"><span class=\"keyword\">cache</span> deny <span class=\"keyword\">QUERY</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_mem <span class=\"number\">1</span> GB        <span class=\"comment\">#è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œå¢åŠ è¯¥å†…å­˜å€¼æœ‰åˆ©äºç¼“å­˜ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼š</span></span><br><span class=\"line\">                     <span class=\"comment\">#ä¸€èˆ¬æ¥è¯´å¦‚æœç³»ç»Ÿæœ‰å†…å­˜ï¼Œè®¾ç½®è¯¥å€¼ä¸º(n/)3Mã€‚ç°åœ¨æ˜¯3G æ‰€ä»¥è¿™é‡Œ1G</span></span><br><span class=\"line\">fqdncache_size <span class=\"number\">1024</span>        <span class=\"comment\">#FQDN é«˜é€Ÿç¼“å­˜å¤§å°</span></span><br><span class=\"line\">maximum_object_size_in_memory <span class=\"number\">2</span> MB        <span class=\"comment\">#å…è®¸æœ€å¤§çš„æ–‡ä»¶è½½å…¥å†…å­˜</span></span><br><span class=\"line\"></span><br><span class=\"line\">memory_replacement_policy <span class=\"keyword\">heap</span> LFUDA  <span class=\"comment\">#åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºå†…å­˜cache</span></span><br><span class=\"line\">cache_replacement_policy <span class=\"keyword\">heap</span> LFUDA         <span class=\"comment\">#åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºç¡¬ç›˜cache</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_dir ufs /home/<span class=\"keyword\">cache</span> <span class=\"number\">5000</span> <span class=\"number\">32</span> <span class=\"number\">512</span>  <span class=\"comment\">#é«˜é€Ÿç¼“å­˜ç›®å½• ufs ç±»å‹ ä½¿ç”¨çš„ç¼“å†²å€¼æœ€å¤§å…åˆ1000MBç©ºé—´ï¼Œ</span></span><br><span class=\"line\"><span class=\"comment\">#32ä¸ªä¸€çº§ç›®å½•ï¼Œ512ä¸ªäºŒçº§ç›®å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\">max_open_disk_fds <span class=\"number\">0</span>                                 <span class=\"comment\">#å…è®¸æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡,0 æ— é™åˆ¶</span></span><br><span class=\"line\">minimum_object_size <span class=\"number\">1</span> KB                         <span class=\"comment\">#å…åˆæœ€å°æ–‡ä»¶è¯·æ±‚ä½“å¤§å°</span></span><br><span class=\"line\">maximum_object_size <span class=\"number\">20</span> MB                 <span class=\"comment\">#å…åˆæœ€å¤§æ–‡ä»¶è¯·æ±‚ä½“å¤§å°</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_swap_low <span class=\"number\">90</span>                            <span class=\"comment\">#æœ€å°å…è®¸ä½¿ç”¨swap 90%</span></span><br><span class=\"line\">cache_swap_high <span class=\"number\">95</span>                            <span class=\"comment\">#æœ€å¤šå…è®¸ä½¿ç”¨swap 95%</span></span><br><span class=\"line\"></span><br><span class=\"line\">ipcache_size <span class=\"number\">2048</span>                                <span class=\"comment\"># IP åœ°å€é«˜é€Ÿç¼“å­˜å¤§å° 2M</span></span><br><span class=\"line\">ipcache_low <span class=\"number\">90</span>                                <span class=\"comment\">#æœ€å°å…è®¸ipcacheä½¿ç”¨swap 90%</span></span><br><span class=\"line\">ipcache_high <span class=\"number\">95</span>                                  <span class=\"comment\">#æœ€å¤§å…è®¸ipcacheä½¿ç”¨swap 90%</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">access_log /<span class=\"keyword\">var</span>/<span class=\"keyword\">log</span>/squid/access.log squid        <span class=\"comment\">#å®šä¹‰æ—¥å¿—å­˜æ”¾è®°å½•</span></span><br><span class=\"line\">cache_log /<span class=\"keyword\">var</span>/<span class=\"keyword\">log</span>/squid/cache.log squid</span><br><span class=\"line\">cache_store_log <span class=\"keyword\">none</span>                        <span class=\"comment\">#ç¦æ­¢storeæ—¥å¿—</span></span><br><span class=\"line\"></span><br><span class=\"line\">emulate_httpd_log <span class=\"keyword\">on</span>        <span class=\"comment\">#å°†ä½¿Squidä»¿ç…§WebæœåŠ¡å™¨çš„æ ¼å¼åˆ›å»ºè®¿é—®è®°å½•ã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨</span></span><br><span class=\"line\">                                <span class=\"comment\">#Webè®¿é—®è®°å½•åˆ†æç¨‹åºï¼Œå°±éœ€è¦è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">refresh_pattern . <span class=\"number\">0</span> <span class=\"number\">20</span>% <span class=\"number\">4320</span> override-<span class=\"keyword\">expire</span> override-lastmod reload-<span class=\"keyword\">into</span>-ims <span class=\"keyword\">ignore</span>-reload   <span class=\"comment\">#æ›´æ–°cacheè§„åˆ™</span></span><br><span class=\"line\"></span><br><span class=\"line\">acl buggy_server url_regex ^<span class=\"keyword\">http</span>://.... <span class=\"keyword\">http</span>://          <span class=\"comment\">#åªå…è®¸httpçš„è¯·æ±‚</span></span><br><span class=\"line\">broken_posts <span class=\"keyword\">allow</span> buggy_server</span><br><span class=\"line\"></span><br><span class=\"line\">acl apache rep_header <span class=\"keyword\">Server</span> ^Apache                 <span class=\"comment\">#å…è®¸apacheçš„ç¼–ç </span></span><br><span class=\"line\">broken_vary_encoding <span class=\"keyword\">allow</span> apache</span><br><span class=\"line\"></span><br><span class=\"line\">request_entities <span class=\"keyword\">off</span>                                        <span class=\"comment\">#ç¦æ­¢éhttpçš„æ ‡åˆ†å‡†è¯·æ±‚ï¼Œé˜²æ­¢æ”»å‡»</span></span><br><span class=\"line\">header_access header <span class=\"keyword\">allow</span> all                        <span class=\"comment\">#å…è®¸æ‰€æœ‰çš„httpæŠ¥å¤´</span></span><br><span class=\"line\">relaxed_header_parser <span class=\"keyword\">on</span>                                <span class=\"comment\">#ä¸ä¸¥æ ¼åˆ†æhttpæŠ¥å¤´.</span></span><br><span class=\"line\">client_lifetime <span class=\"number\">120</span> <span class=\"keyword\">minute</span>                                <span class=\"comment\">#æœ€å¤§å®¢æˆ·è¿æ¥æ—¶é—´ 120åˆ†é’Ÿ</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_mgr sky@test.com                        <span class=\"comment\">#æŒ‡å®šå½“ç¼“å†²å‡ºç°é—®é¢˜æ—¶å‘ç¼“å†²ç®¡ç†è€…å‘é€å‘Šè­¦ä¿¡æ¯çš„åœ°å€ä¿¡æ¯ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_effective_user squid                        <span class=\"comment\">#è¿™é‡Œä»¥ç”¨æˆ·squidçš„èº«ä»½SquidæœåŠ¡å™¨</span></span><br><span class=\"line\">cache_effective_group squid</span><br><span class=\"line\"></span><br><span class=\"line\">icp_port <span class=\"number\">0</span>                       <span class=\"comment\">#æŒ‡å®šSquidä»é‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’Œæ¥æ”¶ICPè¯·æ±‚çš„ç«¯å£å·ã€‚</span></span><br><span class=\"line\">                     <span class=\"comment\">#è¿™é‡Œè®¾ç½®ä¸º0æ˜¯å› ä¸ºè¿™é‡Œé…ç½®Squidä¸ºå†…éƒ¨WebæœåŠ¡å™¨çš„åŠ é€Ÿå™¨ï¼Œ</span></span><br><span class=\"line\">                     <span class=\"comment\">#æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨é‚»å±…æœåŠ¡å™¨çš„ç¼“å†²ã€‚0æ˜¯ç¦ç”¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cache_peer è®¾ç½®å…è®¸æ›´æ–°ç¼“å­˜çš„ä¸»æœºï¼Œå› æ˜¯æœ¬æœºæ‰€ä»¥127.0.0.1</span></span><br><span class=\"line\">cache_peer <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> <span class=\"keyword\">parent</span> <span class=\"number\">80</span> <span class=\"number\">0</span> <span class=\"keyword\">no</span>-<span class=\"keyword\">query</span> <span class=\"keyword\">default</span> multicast-responder <span class=\"keyword\">no</span>-netdb-<span class=\"keyword\">exchange</span></span><br><span class=\"line\">cache_peer_domain <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>                                 </span><br><span class=\"line\">hostname_aliases <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\"></span><br><span class=\"line\">error_directory /usr/<span class=\"keyword\">share</span>/squid/<span class=\"keyword\">errors</span>/Simplify_Chinese        <span class=\"comment\">#å®šä¹‰é”™è¯¯è·¯å¾„</span></span><br><span class=\"line\"></span><br><span class=\"line\">always_direct <span class=\"keyword\">allow</span> all                <span class=\"comment\"># cacheä¸¢å¤±æˆ–ä¸å­˜åœ¨æ˜¯å…è®¸æ‰€æœ‰è¯·æ±‚ç›´æ¥è½¬å‘åˆ°åŸå§‹æœåŠ¡å™¨</span></span><br><span class=\"line\">ignore_unknown_nameservers <span class=\"keyword\">on</span>        <span class=\"comment\">#å¼€åDNSæŸ¥è¯¢ï¼Œå½“åŸŸååœ°å€ä¸ç›¸åŒæ—¶å€™ï¼Œç¦æ­¢è®¿é—®</span></span><br><span class=\"line\">coredump_dir  /<span class=\"keyword\">var</span>/<span class=\"keyword\">log</span>/squid                 <span class=\"comment\">#å®šä¹‰dumpçš„ç›®å½•</span></span><br><span class=\"line\"></span><br><span class=\"line\">max_filedesc <span class=\"number\">2048</span>                <span class=\"comment\">#æœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°</span></span><br><span class=\"line\"></span><br><span class=\"line\">half_closed_clients <span class=\"keyword\">off</span>        <span class=\"comment\">#ä½¿Squidåœ¨å½“readä¸å†è¿”å›æ•°æ®æ—¶ç«‹å³å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</span></span><br><span class=\"line\">                                <span class=\"comment\">#æœ‰æ—¶readä¸å†è¿”å›æ•°æ®æ˜¯ç”±äºæŸäº›å®¢æˆ·å…³é—­TCPçš„å‘é€æ•°æ®</span></span><br><span class=\"line\">                                <span class=\"comment\">#è€Œä»ç„¶ä¿æŒæ¥æ”¶æ•°æ®ã€‚è€ŒSquidåˆ†è¾¨ä¸å‡ºTCPåŠå…³é—­å’Œå®Œå…¨å…³é—­ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\">buffered_logs <span class=\"keyword\">on</span> <span class=\"comment\">#è‹¥æ‰“å¼€é€‰é¡¹â€œbuffered_logsâ€å¯ä»¥ç¨ç¨æé«˜åŠ é€ŸæŸäº›å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥ï¼Œè¯¥é€‰é¡¹ä¸»è¦æ˜¯å®ç°ä¼˜åŒ–ç‰¹æ€§ã€‚</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é˜²æ­¢å¤©æ¶¯ç›—é“¾ï¼Œè½¬å«ç»™ç™¾åº¦</span></span><br><span class=\"line\">acl tianya referer_regex -i tianya</span><br><span class=\"line\">http_access deny tianya</span><br><span class=\"line\">deny_info  tianya</span><br><span class=\"line\"><span class=\"comment\">#é˜»æ­¢baiduèœ˜è››</span></span><br><span class=\"line\">acl baidu req_header <span class=\"keyword\">User</span>-<span class=\"keyword\">Agent</span> Baiduspider</span><br><span class=\"line\">http_access deny baidu</span><br><span class=\"line\"><span class=\"comment\">#é™åˆ¶åŒä¸€IPå®¢æˆ·ç«¯çš„æœ€å¤§è¿æ¥æ•°</span></span><br><span class=\"line\">acl OverConnLimit maxconn <span class=\"number\">128</span></span><br><span class=\"line\">http_access deny OverConnLimit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é˜²æ­¢è¢«äººåˆ©ç”¨ä¸ºHTTPä»£ç†ï¼Œè®¾ç½®å…è®¸è®¿é—®çš„IPåœ°å€</span></span><br><span class=\"line\">acl myip dst <span class=\"number\">222.18</span><span class=\"number\">.63</span><span class=\"number\">.37</span></span><br><span class=\"line\">http_access deny !myip</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#å…è®¸æœ¬åœ°ç®¡ç†</span></span><br><span class=\"line\">acl Manager proto cache_object</span><br><span class=\"line\">acl Localhost src <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> <span class=\"number\">222.18</span><span class=\"number\">.63</span><span class=\"number\">.37</span></span><br><span class=\"line\">http_access <span class=\"keyword\">allow</span> Manager Localhost</span><br><span class=\"line\">cachemgr_passwd <span class=\"number\">53034338</span> all</span><br><span class=\"line\">http_access deny Manager</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#ä»…ä»…å…è®¸80ç«¯å£çš„ä»£ç†</span></span><br><span class=\"line\">acl all src <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>/<span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span></span><br><span class=\"line\">acl Safe_ports port <span class=\"number\">80</span> <span class=\"comment\"># http</span></span><br><span class=\"line\">http_access deny !Safe_ports</span><br><span class=\"line\">http_access <span class=\"keyword\">allow</span> all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Squidä¿¡æ¯è®¾ç½®</span></span><br><span class=\"line\">visible_hostname happy.swjtu.edu.cn</span><br><span class=\"line\">cache_mgr  ooopic2008@qq.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#åŸºæœ¬è®¾ç½®</span></span><br><span class=\"line\">cache_effective_user squid</span><br><span class=\"line\">cache_effective_group squid</span><br><span class=\"line\">tcp_recv_bufsize <span class=\"number\">65535</span> <span class=\"keyword\">bytes</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#2.6çš„åå‘ä»£ç†åŠ é€Ÿé…ç½®</span></span><br><span class=\"line\">cache_peer <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> <span class=\"keyword\">parent</span> <span class=\"number\">80</span> <span class=\"number\">0</span> <span class=\"keyword\">no</span>-<span class=\"keyword\">query</span> originserver</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#é”™è¯¯æ–‡æ¡£</span></span><br><span class=\"line\">error_directory /usr/<span class=\"keyword\">local</span>/squid/<span class=\"keyword\">share</span>/<span class=\"keyword\">errors</span>/Simplify_Chinese</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#å•å°ä½¿ç”¨ï¼Œä¸ä½¿ç”¨è¯¥åŠŸèƒ½</span></span><br><span class=\"line\">icp_port <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">hierarchy_stoplist cgi-<span class=\"keyword\">bin</span> ?</span><br><span class=\"line\"></span><br><span class=\"line\">acl <span class=\"keyword\">QUERY</span> urlpath_regex cgi-<span class=\"keyword\">bin</span> \\? .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .exe</span><br><span class=\"line\"><span class=\"keyword\">cache</span> deny <span class=\"keyword\">QUERY</span></span><br><span class=\"line\"></span><br><span class=\"line\">acl apache rep_header <span class=\"keyword\">Server</span> ^Apache</span><br><span class=\"line\">broken_vary_encoding <span class=\"keyword\">allow</span> apache</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">refresh_pattern ^<span class=\"keyword\">ftp</span>:           <span class=\"number\">1440</span> <span class=\"number\">20</span>%     <span class=\"number\">10080</span></span><br><span class=\"line\">refresh_pattern ^gopher:        <span class=\"number\">1440</span> <span class=\"number\">0</span>%    <span class=\"number\">1440</span></span><br><span class=\"line\">refresh_pattern .             <span class=\"number\">0</span>    <span class=\"number\">20</span>%     <span class=\"number\">4320</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache_store_log <span class=\"keyword\">none</span></span><br><span class=\"line\">pid_filename /usr/<span class=\"keyword\">local</span>/squid/<span class=\"keyword\">var</span>/<span class=\"keyword\">logs</span>/squid.pid</span><br><span class=\"line\">emulate_httpd_log <span class=\"keyword\">on</span></span><br></pre></td></tr></table></figure><h2 id=\"Squidå¸¸ç”¨å‘½ä»¤\"><a href=\"#Squidå¸¸ç”¨å‘½ä»¤\" class=\"headerlink\" title=\"Squidå¸¸ç”¨å‘½ä»¤\"></a>Squidå¸¸ç”¨å‘½ä»¤</h2><ol><li>åˆå§‹åŒ–åœ¨squid.confé‡Œé…ç½®çš„cacheç›®å½•<br>squid -z<br>å¦‚æœæœ‰é”™è¯¯æç¤ºï¼Œè¯·æ£€æŸ¥cacheç›®å½•çš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹ç›®å½•æƒé™<br>chown -R squid:squid /cacheç›®å½•</li><li>å¯¹squid.confæ’é”™ï¼Œå³éªŒè¯squid.confçš„è¯­æ³•å’Œé…ç½®<br>squid -k parse<br>å¦‚æœåœ¨squid.confä¸­æœ‰è¯­æ³•æˆ–é…ç½®é”™è¯¯ï¼Œè¿™é‡Œä¼šè¿”å›æç¤ºï¼Œè‹¥æ— è¿”å›ï¼Œå°è¯•å¯åŠ¨squid</li><li>å‰å°å¯åŠ¨squidï¼Œå¹¶è¾“å‡ºå¯åŠ¨è¿‡ç¨‹<br>/usr/local/squid/sbin/squid -N -d1<br>å¦‚æœæœ‰ready to server requesç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜squidå¯åŠ¨æˆåŠŸ<br>ç„¶åctrl+c ,åœæ­¢squid,å¹¶ä»¥åå°è¿è¡Œçš„æ–¹å¼å¯åŠ¨å®ƒ</li><li>å¯åŠ¨squidåœ¨åå°è¿è¡Œ<br>squid -s<br>å¯ä»¥ä½¿ç”¨ps -ax | grep squid æ¥æŸ¥çœ‹squidè¿›ç¨‹æ˜¯å¦å­˜åœ¨</li><li>åœæ­¢squid<br>squid -k shutdown</li><li>é‡æ–°å¼•å¯¼ä¿®æ”¹è¿‡çš„squid.conf<br>squid -k reconfigure -f /XXX/squid.conf<br>å½“squidè¿›è¡Œé…ç½®æ›´æ”¹åï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œsquidé…ç½®é‡è½½</li><li>æŠŠsquidæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹<br>vim /etc/rc.local<br>/usr/local/squid/sbin/squid -s</li><li>ä¿®æ”¹cacheç¼“å­˜ç›®å½•çš„æƒé™<br>chown -R squid.squid /cacheç›®å½•<br>cacheç¼“å­˜ç›®å½•æ ¹æ®è‡ªå·±çš„é…ç½®æ›´æ”¹ï¼Œsquidç”¨æˆ·å’Œç»„æ˜¯squidï¼Œsquid</li><li>ä¿®æ”¹squidæ—¥å¿—ç›®å½•çš„æƒé™<br>chown -R squid.squid å®šä¹‰çš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•<br>è¿™ä¸€æ­¥å¹¶ä¸æ˜¯é€‚åˆæ¯ä¸€ä¸ªä½¿ç”¨squidçš„ç”¨æˆ·ï¼Œæ„ä¸ºè®©squidæœ‰æƒé™åœ¨è¯¥ç›®å½•é‡Œè¿›è¡Œå†™æ“ä½œ</li><li>æŸ¥çœ‹ä½ çš„æ—¥å¿—æ–‡æ¡£<br>more /usr/local/squid/var/logs/access.log | grep TCP_MEM_HIT<br>è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚<br>more /usr/local/squid/var/logs/access.log | grep TCP_HIT<br>è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°cacheç›®å½•ä¸­ï¼Œå¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚<br>more /usr/local/squid/var/logs/access.log | grep TCP_MISS<br>è¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶æ²¡æœ‰è¢«squidç¼“å­˜ï¼Œè€Œæ˜¯ä»åŸå§‹æœåŠ¡å™¨è·å–å¹¶è¿”å›ç»™è®¿é—®ç”¨æˆ·ã€‚</li></ol><h2 id=\"Squidå‘½ä¸­ç‡åˆ†æ\"><a href=\"#Squidå‘½ä¸­ç‡åˆ†æ\" class=\"headerlink\" title=\"Squidå‘½ä¸­ç‡åˆ†æ\"></a>Squidå‘½ä¸­ç‡åˆ†æ</h2><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/squid/</span>bin/squidclient -p <span class=\"number\">80</span> <span class=\"string\">mgr:</span>info</span><br><span class=\"line\"><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/squid/</span>bin/squidclient -p <span class=\"number\">80</span> <span class=\"string\">mgr:</span><span class=\"number\">5</span>min</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½æƒ…å†µ,å…¶ä¸­PORTæ˜¯ä½ çš„proxyçš„ç«¯å£ï¼Œ5minå¯ä»¥æ˜¯60min<br>å–å¾—squidè¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š</p><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">squidclient</span> -p <span class=\"number\">80</span> mgr:<span class=\"literal\">info</span></span><br></pre></td></tr></table></figure><p>å–å¾—squidå†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">squidclient -<span class=\"selector-tag\">p</span> <span class=\"number\">80</span> mgr:mem</span><br></pre></td></tr></table></figure><p>å–å¾—squidå·²ç»ç¼“å­˜çš„åˆ—è¡¨ï¼š</p><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">squidclient</span> -p <span class=\"number\">80</span> mgr:<span class=\"keyword\">bjects. </span>use <span class=\"keyword\">it </span>carefully,<span class=\"keyword\">it </span>may crash</span><br></pre></td></tr></table></figure><p>å–å¾—squidçš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š</p><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">squidclient -<span class=\"selector-tag\">p</span> <span class=\"number\">80</span> mgr:diskd</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶æ›´æ–°æŸä¸ªurlï¼š</p><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">squidclient -<span class=\"selector-tag\">p</span> <span class=\"number\">80</span> -m PURGE http:<span class=\"comment\">//www.xxx.com/xxx.php</span></span><br></pre></td></tr></table></figure><p>æ›´å¤šçš„è¯·æŸ¥çœ‹ï¼šsquidclient-h æˆ–è€… squidclient -p 80 mgr:<br>æŸ¥å‘½ä¸­ç‡ï¼š</p><figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">squidclient</span> -h <span class=\"built_in\">IP</span>(å…·ä½“ä¾¦å¬<span class=\"built_in\">IP</span>) -p <span class=\"number\">80</span>(å…·ä½“ä¾¦å¬ç«¯å£) mgr:<span class=\"meta\">info</span></span><br></pre></td></tr></table></figure><h2 id=\"å®šæœŸæ¸…ç†swap-stateå†…æ— æ•ˆæ•°æ®\"><a href=\"#å®šæœŸæ¸…ç†swap-stateå†…æ— æ•ˆæ•°æ®\" class=\"headerlink\" title=\"å®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®\"></a>å®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®</h2><figure class=\"highlight dts\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta-keyword\">/path/</span>to<span class=\"meta-keyword\">/squid/</span>sbin/squid -k rotate -f <span class=\"meta-keyword\">/path/</span>to<span class=\"meta-keyword\">/squid/</span>conf_file</span><br><span class=\"line\">vi <span class=\"meta-keyword\">/etc/</span>crontab</span><br><span class=\"line\"><span class=\"number\">0</span>        <span class=\"number\">0</span>       *       *       *       root    <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/sbin/</span>squid -k rotate -f <span class=\"meta-keyword\">/usr/</span>local<span class=\"meta-keyword\">/etc/</span>squid/squid1.conf</span><br></pre></td></tr></table></figure><p>å½“squidåº”ç”¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œcache_dirå¯¹åº”çš„swap.stateæ–‡ä»¶å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‡Œé¢çš„æ— æ•ˆæ¥å£æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½å½±å“squidçš„å“åº”æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨squidæ¸…ç†swap.stateé‡Œé¢çš„æ— æ•ˆæ•°æ®ï¼Œå‡å°‘swap.stateçš„å¤§å°ã€‚</p>","slug":"squid","updated":"2019-05-23T12:33:08.392Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/55e3d16d/","excerpt":"squidçš„æ¦‚å¿µsquidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»ç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://shuntan.github.io/categories/Linux/"}],"tags":[{"name":"squid","slug":"squid","permalink":"https://shuntan.github.io/tags/squid/"},{"name":"proxy","slug":"proxy","permalink":"https://shuntan.github.io/tags/proxy/"}]},{"title":"ç§‘å­¦ä¸Šç½‘ï¼šç”¨ VPS æ­å»º shadowsocks æœåŠ¡å™¨","date":"2019-05-15T06:38:46.000Z","path":"posts/a067636e/","text":"shadowsocks ç®€ä»‹shadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºå…¶æµé‡ç‰¹å¾ä¸æ˜æ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚shadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åå†å‘å›å®¢æˆ·ç«¯ã€‚å› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚è´­ä¹° VPS æœåŠ¡å™¨ä¸»æµçš„ VPSï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æœåŠ¡å™¨æä¾›å•†æœ‰ä¸‰å®¶ï¼šlinodedigital oceanbandwagonä¸‹é¢çš„æ¯”ä¸Šé¢çš„ä¾¿å®œã€‚å¦‚æœåªæ˜¯è‡ªç”¨ï¼Œbandwagon è¶³å¤Ÿã€‚ä¸€èˆ¬ä½¿ç”¨ paypal ç»‘å®šä¸€ä¸ª visa æˆ– mastercard ä¿¡ç”¨å¡æ¥ä»˜æ¬¾ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚åœ¨ bandwagon è´­ä¹° VPS ä»¥åä¼šè·å¾—ä¸€ä¸ªä¸»æœºåœ°å€å’Œç”¨äº ssh ç™»å½•çš„ root å¯†ç ã€‚è¿œç¨‹ç™»é™† VPSMacæˆ– Linux ä¸‹ç›´æ¥åœ¨ç»ˆç«¯ä¸­ssh root@your_vps_ip your_ssh_portå³å¯ã€‚åœ¨ windows ç³»ç»Ÿä¸‹éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æ¥ SSH ç™»å½• VPSã€‚åœ¨&nbsp;xShell å®˜ç½‘&nbsp;&nbsp;ä¸‹è½½ xShellã€‚å®¶åº­å’Œå­¦æ ¡ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨ï¼Œä¸‹è½½æ—¶é€‰æ‹© home&nbsp;and&nbsp;school&nbsp;use å³å¯ã€‚éœ€è¦ç”¨é‚®ç®±æ³¨å†Œä¸€ä¸‹ï¼Œä¸‹è½½é“¾æ¥ä¼šå‘é€åˆ°é‚®ç®±ä¸­ã€‚xShell ä¸­æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šè¦æ±‚è¾“å…¥ç›®æ ‡ IP åœ°å€å’Œç«¯å£ï¼Œä»¥åŠ root å¯†ç ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚å®‰è£… shadowsocksæœ€å¥½æ˜¯centos71.å®‰è£…pipç”±äºå®‰è£…çš„æ˜¯python ç‰ˆæœ¬çš„ shadowsocksï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…pip$ curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot; $ python get-pip.py 2.å®‰è£…shadowsocks$ pip install --upgrade pip $ pip install shadowsocks 3.åˆ›å»ºé…ç½®æ–‡ä»¶åˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•:/etc åˆ›å»ºæ–‡ä»¶å‘½ä»¤$ vi /etc/shadowsocks.json è‹¥è¿›å…¥äº†etcç›®å½•$ vi shadowsocks.json é…ç½®æ–‡ä»¶å†…å®¹ï¼šå•ç«¯å£ï¼š1234567891011121314151617&#123; \"server\":\"0.0.0.0\", --æœåŠ¡å™¨IPï¼Œç›´æ¥ç”¨0.0.0.0ä¹Ÿå¯ \"server_port\":8888, --ç«¯å£ç«¯å£ \"local_address\": \"127.0.0.1\", --æœ¬åœ°åœ°å€ï¼Œå¯çœç•¥ \"local_port\":1080,--æœ¬åœ°ç«¯å£ï¼Œå¯çœç•¥ \"password\":\"password\",--å¯†ç  \"timeout\":300, --è¶…æ—¶æ—¶é—´ï¼Œå¯çœç•¥ \"method\":\"aes-256-cfb\", --åŠ å¯†ç­–ç•¥ï¼Œæœ‰å¤šé‡ç­–ç•¥ï¼Œå…·ä½“è‡ªæŸ¥&#125;å¤šç«¯å£ï¼š12345678910111213141516171819202122232425&#123; \"server\":\"0.0.0.0\", \"local_address\":\"127.0.0.1\", \"local_port\":1080, \"port_password\":&#123;--æ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªå¯†ç  \"1111\":\"password1\", \"1112\":\"password2\", \"1113\":\"password3\" &#125;, \"timeout\":300, \"method\":\"aes-256-cfb\", \"fast_open\":false&#125;4.å¯åŠ¨shadowsockså¯åŠ¨ssserver -c /etc/shadowsocks.json -d start åœæ­¢ssserver -c /etc/shadowsocks.json -d stop é‡å¯ssserver -c /etc/shadowsocks.json -d restart å¯åŠ¨æˆåŠŸå³å¯é€šè¿‡sså®¢æˆ·ç«¯ä½¿ç”¨ã€‚åœ¨windowç«¯å¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€telnet {ip} {port} 5.é…ç½®è‡ªå¯åŠ¨æ–°å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶/etc/systemd/system/shadowsocks.serviceï¼Œå†…å®¹å¦‚ä¸‹ï¼š [Unit]Description=Shadowsocks [Service]TimeoutStartSec=0 ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json [Install]WantedBy=multi-user.target é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼Œå¯åŠ¨æœåŠ¡$ systemctl enable shadowsocks $ systemctl start shadowsocks å¯åŠ¨åå¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€$ systemctl status shadowsocks -l è‹¥å¯åŠ¨æˆåŠŸï¼šâ— shadowsocks.service - ShadowsocksLoaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)Active: active (running) since Sun 2017-08-13 18:03:41 CST; 1h 29min agoMain PID: 9567 (ssserver)CGroup: /system.slice/shadowsocks.serviceâ””â”€9567 /usr/bin/python2 /usr/bin/ssserver -c /etc/shadowsocks.jsonå¦‚æœï¼ŒæœåŠ¡å¤±è´¥ï¼Œé‡å¯æœåŠ¡å™¨è¯•ä¸€ä¸‹å®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯shadowsocks æ”¯æŒ windowsã€Mac&nbsp;OS&nbsp;Xã€Linuxã€Androidã€iOS ç­‰å¤šä¸ªå¹³å°ã€‚ä¸è¿‡ iOS ç”±äºç³»ç»Ÿå¯¹åº”ç”¨åå°è¿è¡Œçš„é™åˆ¶ï¼Œæ¨èä½¿ç”¨å®¢æˆ·ç«¯å†…åµŒçš„æµè§ˆå™¨ç§‘å­¦ä¸Šç½‘ï¼Œç»™å…¶ä»–åº”ç”¨ä»£ç†æ—¶éœ€è¦æ¯è¿‡å‡ åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€ä¸‹ appã€‚shadowsocks é¡¹ç›® Github ä¸»é¡µåœ¨è¿™é‡Œã€‚é‡Œé¢å¯ä»¥æ‰¾åˆ°å®¢æˆ·ç«¯ä¸‹è½½åœ°å€ã€‚ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯ä»¥åï¼Œåªéœ€æŒ‰æœåŠ¡å™¨çš„é…ç½®å¡«å†™ IP åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€æœ¬åœ°ç«¯å£ï¼ˆå¦‚æœæ²¡æœ‰æœ¬åœ°ç«¯å£é€‰é¡¹ï¼Œå°±æ˜¯é»˜è®¤çš„ 1080ï¼‰ã€å¯†ç ã€åŠ å¯†æ–¹å¼ç­‰å‚æ•°ï¼Œå¯åŠ¨å°±å¯ä»¥äº†ã€‚å®¢æˆ·ç«¯æ”¯æŒå…¨å±€ä»£ç†å’Œ PAC ä»£ç†ä¸¤ç§æ–¹å¼ï¼Œåè€…ä¼šä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨æ£€æŸ¥ä¸€ä¸ªç½‘ç«™æ˜¯å¦åœ¨éœ€è¦ä»£ç†çš„ç½‘ç«™åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©ç›´æ¥è¿æ¥æˆ–ä»£ç†è¿æ¥ã€‚PAC åˆ—è¡¨å¯ä»¥åœ¨çº¿æ›´æ–°ï¼Œä½†æ˜¯éš¾å…æœ‰æ”¶å½•ä¸å…¨çš„æƒ…å†µã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©å…³é—­ shadowsocks ä»£ç†ï¼ˆå®é™…ä¸Šæ˜¯å–æ¶ˆå¯¹ç³»ç»Ÿä»£ç†çš„é…ç½®ï¼Œshadowsocks å®¢æˆ·ç«¯ä»ç„¶ä¿æŒå·¥ä½œï¼‰ï¼Œç„¶åä½¿ç”¨æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„ä»£ç†ç®¡ç†æ’ä»¶æ¥å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†ï¼Œæ¯”å¦‚ switchyOmegaã€‚ä½¿ç”¨ switchyOmega å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†switchyOmega æ˜¯ chrome æµè§ˆå™¨ä¸Šä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä»£ç†ç®¡ç†æ’ä»¶ã€‚å®ƒçš„å‰èº« switchySharp æ›´æœ‰åã€‚ chrome åº”ç”¨å•†åº—æœ¬èº«éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œå› æ­¤éœ€è¦å…ˆåœ¨ shadowsocks å¯åŠ¨ä»£ç†æ¨¡å¼ä¸‹ä¸‹è½½å®‰è£…ï¼Œå†å…³é—­ shadowsocks ä»£ç†ã€‚ å®‰è£…å®Œæ¯•åï¼Œå³å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©é€‰é¡¹ï¼Œè¿›å…¥ switchOmega é…ç½®ç•Œé¢ã€‚ åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼æ–°å»ºä¸€ä¸ªæƒ…æ™¯æ¨¡å¼ï¼Œæ¯”å¦‚å« SSï¼Œä»£ç†åè®®é€‰æ‹© socks5ï¼Œä»£ç†åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ 1080ã€‚ ç°åœ¨åˆ‡æ¢åˆ° SS æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥é€šè¿‡ shadowsocks ç§‘å­¦ä¸Šç½‘äº†ã€‚åé¢è·å–è‡ªåŠ¨åˆ‡æ¢è§„åˆ™åˆ—è¡¨ è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåœ¨ â€œåˆ‡æ¢è§„åˆ™â€ ä¸­å‹¾é€‰â€œè§„åˆ™åˆ—è¡¨è§„åˆ™â€ï¼Œå¯¹åº”çš„æƒ…æ™¯æ¨¡å¼é€‰æ‹©åˆšåˆšæ–°å»ºçš„ SSã€‚ç„¶ååœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨åœ°å€ä¸­å¡«å†™https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txtè§„åˆ™åˆ—è¡¨æ ¼å¼é€‰æ‹© AutoProxyã€‚ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œ æ›´æ–°å®Œæˆåä¼šæœ‰æç¤ºã€‚ç‚¹å‡»å·¦ä¾§çš„ â€œåº”ç”¨é€‰é¡¹â€ã€‚ç„¶åå•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨è®¿é—®â€œä¸å­˜åœ¨çš„ç½‘ç«™â€ æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° shadowsocks ä»£ç†äº†ã€‚æ·»åŠ è‡ªå®šä¹‰è§„åˆ™å¦‚æœé‡åˆ°æŸä¸ªå›½å¤–ç½‘ç«™æ— æ³•ç›´æ¥è¿æ¥æˆ–é€Ÿåº¦å¤ªæ…¢æ—¶ï¼Œå¯ä»¥å•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹© â€œæ·»åŠ æ¡ä»¶â€ï¼Œæƒ…æ™¯æ¨¡å¼é€‰æ‹© SSï¼Œå°±å¯ä»¥äº†ã€‚è¿™æ—¶æ‰“å¼€ switchyOmega é€‰é¡¹ï¼Œåœ¨è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢è§„åˆ™ä¸­å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„è§„åˆ™ã€‚å¯ä»¥åœ¨è¿™é‡Œç®¡ç†è‡ªå®šä¹‰çš„è§„åˆ™ã€‚å¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®å¦‚æœæ¢äº†ä¸€å°ç”µè„‘ï¼Œé‡æ–°è®¾ç½®ä¸€é switchyOmega å°±å¤ªéº»çƒ¦äº†ã€‚å¯ä»¥åœ¨è®¾ç½®å¥½çš„ switchyOmega ä¸­å¯¼å‡ºè®¾ç½®æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ä¸ª chrome æµè§ˆå™¨ä¸­å¯¼å…¥ï¼Œå°±å¯ä»¥ç›´æ¥å¤åˆ¶åŸæ¥çš„è®¾ç½®äº†ã€‚åœ¨ switchyOmega é€‰é¡¹çš„å·¦ä¾§ç‚¹å‡» â€œå¯¼å…¥ / å¯¼å‡ºâ€ï¼Œç‚¹å‡»â€œç”Ÿæˆå¤‡ä»½æ–‡ä»¶â€ å³å¯ç”Ÿæˆ switchyOmega è®¾ç½®å¤‡ä»½ã€‚ç‚¹å‡» â€œä»å¤‡ä»½æ–‡ä»¶æ¢å¤â€ å¯ä»¥å¯¼å…¥å¤‡ä»½æ–‡ä»¶ã€‚","raw":"---\ntitle: ç§‘å­¦ä¸Šç½‘ï¼šç”¨ VPS æ­å»º shadowsocks æœåŠ¡å™¨\ncopyright: true\ntags:\n  - VPS\n  - shadowsocks\ncategories: Linux\nabbrlink: a067636e\ndate: 2019-05-15 14:38:46\ntype:\nkeyword:\ntop:\ncomments:\npassword:\n---\n\n## shadowsocks ç®€ä»‹\n\nshadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºå…¶æµé‡ç‰¹å¾ä¸æ˜æ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚\n\nshadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åå†å‘å›å®¢æˆ·ç«¯ã€‚\n\nå› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚\n\n<!-- more -->\n\n## è´­ä¹° VPS æœåŠ¡å™¨\n\n  ä¸»æµçš„ VPSï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æœåŠ¡å™¨æä¾›å•†æœ‰ä¸‰å®¶ï¼š\n\n*   linode\n*   digital ocean\n*   bandwagon\n\nä¸‹é¢çš„æ¯”ä¸Šé¢çš„ä¾¿å®œã€‚å¦‚æœåªæ˜¯è‡ªç”¨ï¼Œbandwagon è¶³å¤Ÿã€‚\n\nä¸€èˆ¬ä½¿ç”¨ paypal ç»‘å®šä¸€ä¸ª visa æˆ– mastercard ä¿¡ç”¨å¡æ¥ä»˜æ¬¾ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚\n\nåœ¨ bandwagon è´­ä¹° VPS ä»¥åä¼šè·å¾—ä¸€ä¸ªä¸»æœºåœ°å€å’Œç”¨äº ssh ç™»å½•çš„ root å¯†ç ã€‚\n\n## è¿œç¨‹ç™»é™† VPS\n\n  Macæˆ– Linux ä¸‹ç›´æ¥åœ¨ç»ˆç«¯ä¸­ssh root@your_vps_ip your_ssh_portå³å¯ã€‚\nåœ¨ windows ç³»ç»Ÿä¸‹éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æ¥ SSH ç™»å½• VPSã€‚åœ¨&nbsp;[xShell å®˜ç½‘](http://www.netsarang.com/download/down_form.html?code=522&amp;utm_source=textarea.com&amp;utm_medium=textarea.com&amp;utm_campaign=article)&nbsp;&nbsp;ä¸‹è½½ xShellã€‚\n\n  å®¶åº­å’Œå­¦æ ¡ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨ï¼Œä¸‹è½½æ—¶é€‰æ‹© home&nbsp;and&nbsp;school&nbsp;use å³å¯ã€‚éœ€è¦ç”¨é‚®ç®±æ³¨å†Œä¸€ä¸‹ï¼Œä¸‹è½½é“¾æ¥ä¼šå‘é€åˆ°é‚®ç®±ä¸­ã€‚\n\n  xShell ä¸­æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šè¦æ±‚è¾“å…¥ç›®æ ‡ IP åœ°å€å’Œç«¯å£ï¼Œä»¥åŠ root å¯†ç ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚\n\n## å®‰è£… shadowsocks\n\næœ€å¥½æ˜¯centos7\n\n1.å®‰è£…pip\n\nç”±äºå®‰è£…çš„æ˜¯python ç‰ˆæœ¬çš„ shadowsocksï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…pip\n\n\t$ curl \"https://bootstrap.pypa.io/get-pip.py\" -o \"get-pip.py\"\n\n\t$ python get-pip.py\n\n2.å®‰è£…shadowsocks\t\n\n\t$ pip install --upgrade pip\n\n\t$ pip install shadowsocks\n\n3.åˆ›å»ºé…ç½®æ–‡ä»¶\n\n\tåˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•:/etc\n\nåˆ›å»ºæ–‡ä»¶å‘½ä»¤\n\n\t$ vi /etc/shadowsocks.json\n\nè‹¥è¿›å…¥äº†etcç›®å½•\n\n\t$ vi shadowsocks.json\n\né…ç½®æ–‡ä»¶å†…å®¹ï¼š\n\nå•ç«¯å£ï¼š\n\n```\n{\n\n \"server\":\"0.0.0.0\", --æœåŠ¡å™¨IPï¼Œç›´æ¥ç”¨0.0.0.0ä¹Ÿå¯\n\n \"server_port\":8888, --ç«¯å£ç«¯å£\n\n \"local_address\": \"127.0.0.1\", --æœ¬åœ°åœ°å€ï¼Œå¯çœç•¥\n\n \"local_port\":1080,--æœ¬åœ°ç«¯å£ï¼Œå¯çœç•¥\n\n \"password\":\"password\",--å¯†ç \n\n \"timeout\":300, --è¶…æ—¶æ—¶é—´ï¼Œå¯çœç•¥\n\n \"method\":\"aes-256-cfb\", --åŠ å¯†ç­–ç•¥ï¼Œæœ‰å¤šé‡ç­–ç•¥ï¼Œå…·ä½“è‡ªæŸ¥\n\n}\n```\n\nå¤šç«¯å£ï¼š\n\n```\n{\n\n \"server\":\"0.0.0.0\",\n\n \"local_address\":\"127.0.0.1\",\n\n \"local_port\":1080,\n\n \"port_password\":{--æ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªå¯†ç \n\n \"1111\":\"password1\",\n\n \"1112\":\"password2\",\n\n \"1113\":\"password3\"\n\n },\n\n \"timeout\":300,\n\n \"method\":\"aes-256-cfb\",\n\n \"fast_open\":false\n\n}\n```\n\n4.å¯åŠ¨shadowsocks\n\nå¯åŠ¨\n\n\tssserver -c /etc/shadowsocks.json -d start\n\nåœæ­¢\n\n\tssserver -c /etc/shadowsocks.json -d stop\n\né‡å¯\n\n\tssserver -c /etc/shadowsocks.json -d restart\n\nå¯åŠ¨æˆåŠŸå³å¯é€šè¿‡sså®¢æˆ·ç«¯ä½¿ç”¨ã€‚\n\nåœ¨windowç«¯å¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€\n\n\ttelnet {ip} {port}\n\n5.é…ç½®è‡ªå¯åŠ¨\n\n\tæ–°å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶/etc/systemd/system/shadowsocks.serviceï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\n[Unit]\n\n\tDescription=Shadowsocks\n\n[Service]\n\n\tTimeoutStartSec=0\n\n\tExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json\n\n[Install]\n\n\tWantedBy=multi-user.target\n\né€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼Œå¯åŠ¨æœåŠ¡\n\n\t$ systemctl enable shadowsocks\n\n\t$ systemctl start shadowsocks\n\nå¯åŠ¨åå¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€\n\n\t$ systemctl status shadowsocks -l\n\nè‹¥å¯åŠ¨æˆåŠŸï¼š\n\nâ— shadowsocks.service - Shadowsocks\n\nLoaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)\n\nActive: active (running) since Sun 2017-08-13 18:03:41 CST; 1h 29min ago\n\nMain PID: 9567 (ssserver)\n\nCGroup: /system.slice/shadowsocks.service\n\nâ””â”€9567 /usr/bin/python2 /usr/bin/ssserver -c /etc/shadowsocks.json\nå¦‚æœï¼ŒæœåŠ¡å¤±è´¥ï¼Œé‡å¯æœåŠ¡å™¨è¯•ä¸€ä¸‹\n\n## å®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯\n\n  shadowsocks æ”¯æŒ windowsã€Mac&nbsp;OS&nbsp;Xã€Linuxã€Androidã€iOS ç­‰å¤šä¸ªå¹³å°ã€‚ä¸è¿‡ iOS ç”±äºç³»ç»Ÿå¯¹åº”ç”¨åå°è¿è¡Œçš„é™åˆ¶ï¼Œæ¨èä½¿ç”¨å®¢æˆ·ç«¯å†…åµŒçš„æµè§ˆå™¨ç§‘å­¦ä¸Šç½‘ï¼Œç»™å…¶ä»–åº”ç”¨ä»£ç†æ—¶éœ€è¦æ¯è¿‡å‡ åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€ä¸‹ appã€‚\n\n  shadowsocks é¡¹ç›® Github ä¸»é¡µåœ¨[è¿™é‡Œ](https://github.com/shadowsocks/shadowsocks?utm_source=textarea.com&amp;utm_medium=textarea.com&amp;utm_campaign=article)ã€‚\n\n  é‡Œé¢å¯ä»¥æ‰¾åˆ°å®¢æˆ·ç«¯ä¸‹è½½åœ°å€ã€‚\n\n  ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯ä»¥åï¼Œåªéœ€æŒ‰æœåŠ¡å™¨çš„é…ç½®å¡«å†™ IP åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€æœ¬åœ°ç«¯å£ï¼ˆå¦‚æœæ²¡æœ‰æœ¬åœ°ç«¯å£é€‰é¡¹ï¼Œå°±æ˜¯é»˜è®¤çš„ 1080ï¼‰ã€å¯†ç ã€åŠ å¯†æ–¹å¼ç­‰å‚æ•°ï¼Œå¯åŠ¨å°±å¯ä»¥äº†ã€‚\n\n  å®¢æˆ·ç«¯æ”¯æŒå…¨å±€ä»£ç†å’Œ PAC ä»£ç†ä¸¤ç§æ–¹å¼ï¼Œåè€…ä¼šä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨æ£€æŸ¥ä¸€ä¸ªç½‘ç«™æ˜¯å¦åœ¨éœ€è¦ä»£ç†çš„ç½‘ç«™åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©ç›´æ¥è¿æ¥æˆ–ä»£ç†è¿æ¥ã€‚\n\n  PAC åˆ—è¡¨å¯ä»¥åœ¨çº¿æ›´æ–°ï¼Œä½†æ˜¯éš¾å…æœ‰æ”¶å½•ä¸å…¨çš„æƒ…å†µã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©å…³é—­ shadowsocks ä»£ç†ï¼ˆå®é™…ä¸Šæ˜¯å–æ¶ˆå¯¹ç³»ç»Ÿä»£ç†çš„é…ç½®ï¼Œshadowsocks å®¢æˆ·ç«¯ä»ç„¶ä¿æŒå·¥ä½œï¼‰ï¼Œç„¶åä½¿ç”¨æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„ä»£ç†ç®¡ç†æ’ä»¶æ¥å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†ï¼Œæ¯”å¦‚ switchyOmegaã€‚\n\n## ä½¿ç”¨ switchyOmega å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†\n\n\tswitchyOmega æ˜¯ chrome æµè§ˆå™¨ä¸Šä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä»£ç†ç®¡ç†æ’ä»¶ã€‚å®ƒçš„å‰èº« switchySharp æ›´æœ‰åã€‚\n\n\tchrome åº”ç”¨å•†åº—æœ¬èº«éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œå› æ­¤éœ€è¦å…ˆåœ¨ shadowsocks å¯åŠ¨ä»£ç†æ¨¡å¼ä¸‹ä¸‹è½½å®‰è£…ï¼Œå†å…³é—­ shadowsocks ä»£ç†ã€‚\n\n\tå®‰è£…å®Œæ¯•åï¼Œå³å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©é€‰é¡¹ï¼Œè¿›å…¥ switchOmega é…ç½®ç•Œé¢ã€‚\n\n### åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼\n\n\tæ–°å»ºä¸€ä¸ªæƒ…æ™¯æ¨¡å¼ï¼Œæ¯”å¦‚å« SSï¼Œä»£ç†åè®®é€‰æ‹© socks5ï¼Œä»£ç†åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ 1080ã€‚\n\n\tç°åœ¨åˆ‡æ¢åˆ° SS æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥é€šè¿‡ shadowsocks ç§‘å­¦ä¸Šç½‘äº†ã€‚åé¢è·å–è‡ªåŠ¨åˆ‡æ¢è§„åˆ™åˆ—è¡¨\n\n### è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼\n\n  åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåœ¨ â€œåˆ‡æ¢è§„åˆ™â€ ä¸­å‹¾é€‰â€œè§„åˆ™åˆ—è¡¨è§„åˆ™â€ï¼Œå¯¹åº”çš„æƒ…æ™¯æ¨¡å¼é€‰æ‹©åˆšåˆšæ–°å»ºçš„ SSã€‚\n\n  ç„¶ååœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨åœ°å€ä¸­å¡«å†™\n\n  https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt\n\n  è§„åˆ™åˆ—è¡¨æ ¼å¼é€‰æ‹© AutoProxyã€‚\n\n  ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œ æ›´æ–°å®Œæˆåä¼šæœ‰æç¤ºã€‚\n\n  ç‚¹å‡»å·¦ä¾§çš„ â€œåº”ç”¨é€‰é¡¹â€ã€‚ç„¶åå•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨è®¿é—®â€œä¸å­˜åœ¨çš„ç½‘ç«™â€ æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° shadowsocks ä»£ç†äº†ã€‚\n\n### æ·»åŠ è‡ªå®šä¹‰è§„åˆ™\n\n  å¦‚æœé‡åˆ°æŸä¸ªå›½å¤–ç½‘ç«™æ— æ³•ç›´æ¥è¿æ¥æˆ–é€Ÿåº¦å¤ªæ…¢æ—¶ï¼Œå¯ä»¥å•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹© â€œæ·»åŠ æ¡ä»¶â€ï¼Œæƒ…æ™¯æ¨¡å¼é€‰æ‹© SSï¼Œå°±å¯ä»¥äº†ã€‚\n\n  è¿™æ—¶æ‰“å¼€ switchyOmega é€‰é¡¹ï¼Œåœ¨è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢è§„åˆ™ä¸­å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„è§„åˆ™ã€‚å¯ä»¥åœ¨è¿™é‡Œç®¡ç†è‡ªå®šä¹‰çš„è§„åˆ™ã€‚\n\n### å¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®\n\n  å¦‚æœæ¢äº†ä¸€å°ç”µè„‘ï¼Œé‡æ–°è®¾ç½®ä¸€é switchyOmega å°±å¤ªéº»çƒ¦äº†ã€‚å¯ä»¥åœ¨è®¾ç½®å¥½çš„ switchyOmega ä¸­å¯¼å‡ºè®¾ç½®æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ä¸ª chrome æµè§ˆå™¨ä¸­å¯¼å…¥ï¼Œå°±å¯ä»¥ç›´æ¥å¤åˆ¶åŸæ¥çš„è®¾ç½®äº†ã€‚\n\n  åœ¨ switchyOmega é€‰é¡¹çš„å·¦ä¾§ç‚¹å‡» â€œå¯¼å…¥ / å¯¼å‡ºâ€ï¼Œç‚¹å‡»â€œç”Ÿæˆå¤‡ä»½æ–‡ä»¶â€ å³å¯ç”Ÿæˆ switchyOmega è®¾ç½®å¤‡ä»½ã€‚ç‚¹å‡» â€œä»å¤‡ä»½æ–‡ä»¶æ¢å¤â€ å¯ä»¥å¯¼å…¥å¤‡ä»½æ–‡ä»¶ã€‚\n","content":"<h2 id=\"shadowsocks-ç®€ä»‹\"><a href=\"#shadowsocks-ç®€ä»‹\" class=\"headerlink\" title=\"shadowsocks ç®€ä»‹\"></a>shadowsocks ç®€ä»‹</h2><p>shadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºå…¶æµé‡ç‰¹å¾ä¸æ˜æ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚</p><p>shadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åå†å‘å›å®¢æˆ·ç«¯ã€‚</p><p>å› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚</p><a id=\"more\"></a><h2 id=\"è´­ä¹°-VPS-æœåŠ¡å™¨\"><a href=\"#è´­ä¹°-VPS-æœåŠ¡å™¨\" class=\"headerlink\" title=\"è´­ä¹° VPS æœåŠ¡å™¨\"></a>è´­ä¹° VPS æœåŠ¡å™¨</h2><p>ä¸»æµçš„ VPSï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æœåŠ¡å™¨æä¾›å•†æœ‰ä¸‰å®¶ï¼š</p><ul><li>linode</li><li>digital ocean</li><li>bandwagon</li></ul><p>ä¸‹é¢çš„æ¯”ä¸Šé¢çš„ä¾¿å®œã€‚å¦‚æœåªæ˜¯è‡ªç”¨ï¼Œbandwagon è¶³å¤Ÿã€‚</p><p>ä¸€èˆ¬ä½¿ç”¨ paypal ç»‘å®šä¸€ä¸ª visa æˆ– mastercard ä¿¡ç”¨å¡æ¥ä»˜æ¬¾ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚</p><p>åœ¨ bandwagon è´­ä¹° VPS ä»¥åä¼šè·å¾—ä¸€ä¸ªä¸»æœºåœ°å€å’Œç”¨äº ssh ç™»å½•çš„ root å¯†ç ã€‚</p><h2 id=\"è¿œç¨‹ç™»é™†-VPS\"><a href=\"#è¿œç¨‹ç™»é™†-VPS\" class=\"headerlink\" title=\"è¿œç¨‹ç™»é™† VPS\"></a>è¿œç¨‹ç™»é™† VPS</h2><p>Macæˆ– Linux ä¸‹ç›´æ¥åœ¨ç»ˆç«¯ä¸­ssh root@your_vps_ip your_ssh_portå³å¯ã€‚<br>åœ¨ windows ç³»ç»Ÿä¸‹éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æ¥ SSH ç™»å½• VPSã€‚åœ¨&nbsp;<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5uZXRzYXJhbmcuY29tL2Rvd25sb2FkL2Rvd25fZm9ybS5odG1sP2NvZGU9NTIyJmFtcDt1dG1fc291cmNlPXRleHRhcmVhLmNvbSZhbXA7dXRtX21lZGl1bT10ZXh0YXJlYS5jb20mYW1wO3V0bV9jYW1wYWlnbj1hcnRpY2xl\" title=\"http://www.netsarang.com/download/down_form.html?code=522&amp;utm_source=textarea.com&amp;utm_medium=textarea.com&amp;utm_campaign=article\">xShell å®˜ç½‘<i class=\"fa fa-external-link\"></i></span>&nbsp;&nbsp;ä¸‹è½½ xShellã€‚</p><p>å®¶åº­å’Œå­¦æ ¡ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨ï¼Œä¸‹è½½æ—¶é€‰æ‹© home&nbsp;and&nbsp;school&nbsp;use å³å¯ã€‚éœ€è¦ç”¨é‚®ç®±æ³¨å†Œä¸€ä¸‹ï¼Œä¸‹è½½é“¾æ¥ä¼šå‘é€åˆ°é‚®ç®±ä¸­ã€‚</p><p>xShell ä¸­æ–°å»ºä¸€ä¸ªè¿æ¥ï¼Œä¼šè¦æ±‚è¾“å…¥ç›®æ ‡ IP åœ°å€å’Œç«¯å£ï¼Œä»¥åŠ root å¯†ç ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚</p><h2 id=\"å®‰è£…-shadowsocks\"><a href=\"#å®‰è£…-shadowsocks\" class=\"headerlink\" title=\"å®‰è£… shadowsocks\"></a>å®‰è£… shadowsocks</h2><p>æœ€å¥½æ˜¯centos7</p><p>1.å®‰è£…pip</p><p>ç”±äºå®‰è£…çš„æ˜¯python ç‰ˆæœ¬çš„ shadowsocksï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…pip</p><pre><code>$ curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot;\n\n$ python get-pip.py\n</code></pre><p>2.å®‰è£…shadowsocks</p><pre><code>$ pip install --upgrade pip\n\n$ pip install shadowsocks\n</code></pre><p>3.åˆ›å»ºé…ç½®æ–‡ä»¶</p><pre><code>åˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•:/etc\n</code></pre><p>åˆ›å»ºæ–‡ä»¶å‘½ä»¤</p><pre><code>$ vi /etc/shadowsocks.json\n</code></pre><p>è‹¥è¿›å…¥äº†etcç›®å½•</p><pre><code>$ vi shadowsocks.json\n</code></pre><p>é…ç½®æ–‡ä»¶å†…å®¹ï¼š</p><p>å•ç«¯å£ï¼š</p><figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"server\"</span>:<span class=\"string\">\"0.0.0.0\"</span>, <span class=\"comment\">--æœåŠ¡å™¨IPï¼Œç›´æ¥ç”¨0.0.0.0ä¹Ÿå¯</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"server_port\"</span>:<span class=\"number\">8888</span>, <span class=\"comment\">--ç«¯å£ç«¯å£</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"local_address\"</span>: <span class=\"string\">\"127.0.0.1\"</span>, <span class=\"comment\">--æœ¬åœ°åœ°å€ï¼Œå¯çœç•¥</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"local_port\"</span>:<span class=\"number\">1080</span>,<span class=\"comment\">--æœ¬åœ°ç«¯å£ï¼Œå¯çœç•¥</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"password\"</span>:<span class=\"string\">\"password\"</span>,<span class=\"comment\">--å¯†ç </span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"timeout\"</span>:<span class=\"number\">300</span>, <span class=\"comment\">--è¶…æ—¶æ—¶é—´ï¼Œå¯çœç•¥</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"method\"</span>:<span class=\"string\">\"aes-256-cfb\"</span>, <span class=\"comment\">--åŠ å¯†ç­–ç•¥ï¼Œæœ‰å¤šé‡ç­–ç•¥ï¼Œå…·ä½“è‡ªæŸ¥</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>å¤šç«¯å£ï¼š</p><figure class=\"highlight clojure\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"server\"</span>:<span class=\"string\">\"0.0.0.0\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"local_address\"</span>:<span class=\"string\">\"127.0.0.1\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"local_port\"</span>:<span class=\"number\">1080</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"port_password\"</span>:&#123;--æ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªå¯†ç </span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"1111\"</span>:<span class=\"string\">\"password1\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"1112\"</span>:<span class=\"string\">\"password2\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"1113\"</span>:<span class=\"string\">\"password3\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"> &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"timeout\"</span>:<span class=\"number\">300</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"method\"</span>:<span class=\"string\">\"aes-256-cfb\"</span>,</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"string\">\"fast_open\"</span><span class=\"symbol\">:false</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p>4.å¯åŠ¨shadowsocks</p><p>å¯åŠ¨</p><pre><code>ssserver -c /etc/shadowsocks.json -d start\n</code></pre><p>åœæ­¢</p><pre><code>ssserver -c /etc/shadowsocks.json -d stop\n</code></pre><p>é‡å¯</p><pre><code>ssserver -c /etc/shadowsocks.json -d restart\n</code></pre><p>å¯åŠ¨æˆåŠŸå³å¯é€šè¿‡sså®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p><p>åœ¨windowç«¯å¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€</p><pre><code>telnet {ip} {port}\n</code></pre><p>5.é…ç½®è‡ªå¯åŠ¨</p><pre><code>æ–°å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶/etc/systemd/system/shadowsocks.serviceï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n</code></pre><p>[Unit]</p><pre><code>Description=Shadowsocks\n</code></pre><p>[Service]</p><pre><code>TimeoutStartSec=0\n\nExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json\n</code></pre><p>[Install]</p><pre><code>WantedBy=multi-user.target\n</code></pre><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼Œå¯åŠ¨æœåŠ¡</p><pre><code>$ systemctl enable shadowsocks\n\n$ systemctl start shadowsocks\n</code></pre><p>å¯åŠ¨åå¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p><pre><code>$ systemctl status shadowsocks -l\n</code></pre><p>è‹¥å¯åŠ¨æˆåŠŸï¼š</p><p>â— shadowsocks.service - Shadowsocks</p><p>Loaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)</p><p>Active: active (running) since Sun 2017-08-13 18:03:41 CST; 1h 29min ago</p><p>Main PID: 9567 (ssserver)</p><p>CGroup: /system.slice/shadowsocks.service</p><p>â””â”€9567 /usr/bin/python2 /usr/bin/ssserver -c /etc/shadowsocks.json<br>å¦‚æœï¼ŒæœåŠ¡å¤±è´¥ï¼Œé‡å¯æœåŠ¡å™¨è¯•ä¸€ä¸‹</p><h2 id=\"å®‰è£…å¹¶å¯åŠ¨-shadowsocks-å®¢æˆ·ç«¯\"><a href=\"#å®‰è£…å¹¶å¯åŠ¨-shadowsocks-å®¢æˆ·ç«¯\" class=\"headerlink\" title=\"å®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯\"></a>å®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯</h2><p>shadowsocks æ”¯æŒ windowsã€Mac&nbsp;OS&nbsp;Xã€Linuxã€Androidã€iOS ç­‰å¤šä¸ªå¹³å°ã€‚ä¸è¿‡ iOS ç”±äºç³»ç»Ÿå¯¹åº”ç”¨åå°è¿è¡Œçš„é™åˆ¶ï¼Œæ¨èä½¿ç”¨å®¢æˆ·ç«¯å†…åµŒçš„æµè§ˆå™¨ç§‘å­¦ä¸Šç½‘ï¼Œç»™å…¶ä»–åº”ç”¨ä»£ç†æ—¶éœ€è¦æ¯è¿‡å‡ åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€ä¸‹ appã€‚</p><p>shadowsocks é¡¹ç›® Github ä¸»é¡µåœ¨<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NoYWRvd3NvY2tzL3NoYWRvd3NvY2tzP3V0bV9zb3VyY2U9dGV4dGFyZWEuY29tJmFtcDt1dG1fbWVkaXVtPXRleHRhcmVhLmNvbSZhbXA7dXRtX2NhbXBhaWduPWFydGljbGU=\" title=\"https://github.com/shadowsocks/shadowsocks?utm_source=textarea.com&amp;utm_medium=textarea.com&amp;utm_campaign=article\">è¿™é‡Œ<i class=\"fa fa-external-link\"></i></span>ã€‚</p><p>é‡Œé¢å¯ä»¥æ‰¾åˆ°å®¢æˆ·ç«¯ä¸‹è½½åœ°å€ã€‚</p><p>ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯ä»¥åï¼Œåªéœ€æŒ‰æœåŠ¡å™¨çš„é…ç½®å¡«å†™ IP åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€æœ¬åœ°ç«¯å£ï¼ˆå¦‚æœæ²¡æœ‰æœ¬åœ°ç«¯å£é€‰é¡¹ï¼Œå°±æ˜¯é»˜è®¤çš„ 1080ï¼‰ã€å¯†ç ã€åŠ å¯†æ–¹å¼ç­‰å‚æ•°ï¼Œå¯åŠ¨å°±å¯ä»¥äº†ã€‚</p><p>å®¢æˆ·ç«¯æ”¯æŒå…¨å±€ä»£ç†å’Œ PAC ä»£ç†ä¸¤ç§æ–¹å¼ï¼Œåè€…ä¼šä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨æ£€æŸ¥ä¸€ä¸ªç½‘ç«™æ˜¯å¦åœ¨éœ€è¦ä»£ç†çš„ç½‘ç«™åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©ç›´æ¥è¿æ¥æˆ–ä»£ç†è¿æ¥ã€‚</p><p>PAC åˆ—è¡¨å¯ä»¥åœ¨çº¿æ›´æ–°ï¼Œä½†æ˜¯éš¾å…æœ‰æ”¶å½•ä¸å…¨çš„æƒ…å†µã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©å…³é—­ shadowsocks ä»£ç†ï¼ˆå®é™…ä¸Šæ˜¯å–æ¶ˆå¯¹ç³»ç»Ÿä»£ç†çš„é…ç½®ï¼Œshadowsocks å®¢æˆ·ç«¯ä»ç„¶ä¿æŒå·¥ä½œï¼‰ï¼Œç„¶åä½¿ç”¨æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„ä»£ç†ç®¡ç†æ’ä»¶æ¥å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†ï¼Œæ¯”å¦‚ switchyOmegaã€‚</p><h2 id=\"ä½¿ç”¨-switchyOmega-å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†\"><a href=\"#ä½¿ç”¨-switchyOmega-å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†\" class=\"headerlink\" title=\"ä½¿ç”¨ switchyOmega å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†\"></a>ä½¿ç”¨ switchyOmega å®ç°è‡ªåŠ¨åˆ‡æ¢ä»£ç†</h2><pre><code>switchyOmega æ˜¯ chrome æµè§ˆå™¨ä¸Šä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä»£ç†ç®¡ç†æ’ä»¶ã€‚å®ƒçš„å‰èº« switchySharp æ›´æœ‰åã€‚\n\nchrome åº”ç”¨å•†åº—æœ¬èº«éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œå› æ­¤éœ€è¦å…ˆåœ¨ shadowsocks å¯åŠ¨ä»£ç†æ¨¡å¼ä¸‹ä¸‹è½½å®‰è£…ï¼Œå†å…³é—­ shadowsocks ä»£ç†ã€‚\n\nå®‰è£…å®Œæ¯•åï¼Œå³å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©é€‰é¡¹ï¼Œè¿›å…¥ switchOmega é…ç½®ç•Œé¢ã€‚\n</code></pre><h3 id=\"åˆ›å»º-shadowsocks-æƒ…æ™¯æ¨¡å¼\"><a href=\"#åˆ›å»º-shadowsocks-æƒ…æ™¯æ¨¡å¼\" class=\"headerlink\" title=\"åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼\"></a>åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼</h3><pre><code>æ–°å»ºä¸€ä¸ªæƒ…æ™¯æ¨¡å¼ï¼Œæ¯”å¦‚å« SSï¼Œä»£ç†åè®®é€‰æ‹© socks5ï¼Œä»£ç†åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ 1080ã€‚\n\nç°åœ¨åˆ‡æ¢åˆ° SS æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥é€šè¿‡ shadowsocks ç§‘å­¦ä¸Šç½‘äº†ã€‚åé¢è·å–è‡ªåŠ¨åˆ‡æ¢è§„åˆ™åˆ—è¡¨\n</code></pre><h3 id=\"è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼\"><a href=\"#è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼\" class=\"headerlink\" title=\"è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼\"></a>è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼</h3><p>åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåœ¨ â€œåˆ‡æ¢è§„åˆ™â€ ä¸­å‹¾é€‰â€œè§„åˆ™åˆ—è¡¨è§„åˆ™â€ï¼Œå¯¹åº”çš„æƒ…æ™¯æ¨¡å¼é€‰æ‹©åˆšåˆšæ–°å»ºçš„ SSã€‚</p><p>ç„¶ååœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨åœ°å€ä¸­å¡«å†™</p><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9hdXRvcHJveHktZ2Z3bGlzdC5nb29nbGVjb2RlLmNvbS9zdm4vdHJ1bmsvZ2Z3bGlzdC50eHQ=\" title=\"https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt\">https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt<i class=\"fa fa-external-link\"></i></span></p><p>è§„åˆ™åˆ—è¡¨æ ¼å¼é€‰æ‹© AutoProxyã€‚</p><p>ç„¶åç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œ æ›´æ–°å®Œæˆåä¼šæœ‰æç¤ºã€‚</p><p>ç‚¹å‡»å·¦ä¾§çš„ â€œåº”ç”¨é€‰é¡¹â€ã€‚ç„¶åå•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨è®¿é—®â€œä¸å­˜åœ¨çš„ç½‘ç«™â€ æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° shadowsocks ä»£ç†äº†ã€‚</p><h3 id=\"æ·»åŠ è‡ªå®šä¹‰è§„åˆ™\"><a href=\"#æ·»åŠ è‡ªå®šä¹‰è§„åˆ™\" class=\"headerlink\" title=\"æ·»åŠ è‡ªå®šä¹‰è§„åˆ™\"></a>æ·»åŠ è‡ªå®šä¹‰è§„åˆ™</h3><p>å¦‚æœé‡åˆ°æŸä¸ªå›½å¤–ç½‘ç«™æ— æ³•ç›´æ¥è¿æ¥æˆ–é€Ÿåº¦å¤ªæ…¢æ—¶ï¼Œå¯ä»¥å•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹© â€œæ·»åŠ æ¡ä»¶â€ï¼Œæƒ…æ™¯æ¨¡å¼é€‰æ‹© SSï¼Œå°±å¯ä»¥äº†ã€‚</p><p>è¿™æ—¶æ‰“å¼€ switchyOmega é€‰é¡¹ï¼Œåœ¨è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢è§„åˆ™ä¸­å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„è§„åˆ™ã€‚å¯ä»¥åœ¨è¿™é‡Œç®¡ç†è‡ªå®šä¹‰çš„è§„åˆ™ã€‚</p><h3 id=\"å¯¼å…¥å’Œå¯¼å‡º-switchyOmega-è®¾ç½®\"><a href=\"#å¯¼å…¥å’Œå¯¼å‡º-switchyOmega-è®¾ç½®\" class=\"headerlink\" title=\"å¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®\"></a>å¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®</h3><p>å¦‚æœæ¢äº†ä¸€å°ç”µè„‘ï¼Œé‡æ–°è®¾ç½®ä¸€é switchyOmega å°±å¤ªéº»çƒ¦äº†ã€‚å¯ä»¥åœ¨è®¾ç½®å¥½çš„ switchyOmega ä¸­å¯¼å‡ºè®¾ç½®æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ä¸ª chrome æµè§ˆå™¨ä¸­å¯¼å…¥ï¼Œå°±å¯ä»¥ç›´æ¥å¤åˆ¶åŸæ¥çš„è®¾ç½®äº†ã€‚</p><p>åœ¨ switchyOmega é€‰é¡¹çš„å·¦ä¾§ç‚¹å‡» â€œå¯¼å…¥ / å¯¼å‡ºâ€ï¼Œç‚¹å‡»â€œç”Ÿæˆå¤‡ä»½æ–‡ä»¶â€ å³å¯ç”Ÿæˆ switchyOmega è®¾ç½®å¤‡ä»½ã€‚ç‚¹å‡» â€œä»å¤‡ä»½æ–‡ä»¶æ¢å¤â€ å¯ä»¥å¯¼å…¥å¤‡ä»½æ–‡ä»¶ã€‚</p>","slug":"shadowsocks","updated":"2019-05-23T12:33:08.378Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/a067636e/","excerpt":"shadowsocks ç®€ä»‹shadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºå…¶æµé‡ç‰¹å¾ä¸æ˜æ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚shadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åå†å‘å›å®¢æˆ·ç«¯ã€‚å› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://shuntan.github.io/categories/Linux/"}],"tags":[{"name":"VPS","slug":"VPS","permalink":"https://shuntan.github.io/tags/VPS/"},{"name":"shadowsocks","slug":"shadowsocks","permalink":"https://shuntan.github.io/tags/shadowsocks/"}]},{"title":"Tag Plugins","date":"2019-05-10T04:35:58.000Z","path":"posts/e2e5eeac/","text":"FAQWelcome to tag-pluginsTag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. Hexo has a lot of tags which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:Centered QuoteInclude RawButtonFull ImageGroup PicturesLabelMermaidNotePDFTabsVideoCentered QuoteThis tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote wonâ€™t be symmetrical, so itâ€™s recommended to use when only have single line text. For example before article all after article to make a summary.Usagecenter-quote.js123&#123;% centerquote %&#125;Something&#123;% endcenterquote %&#125;&lt;!-- Tag Alias --&gt;&#123;% cq %&#125;Something&#123;% endcq %&#125;Example1&#123;% cq %&#125;Elegant in code, simple in core&#123;% endcq %&#125;Elegant in code, simple in coreInclude RawThis tag include any raw content into your posts. Path is relative to your site source directory.Usageinclude-raw.js1&#123;% include_raw '_data/path/to/file.html' %&#125;ExampleLetâ€™s create include-raw.html file in _data directory under site root directory with following content:1Any &lt;strong&gt;raw content&lt;/strong&gt; may be included with this tag.Then in any post we can use this content with include_raw tag:1&#123;% include_raw '_data/path/to/include-raw.html' %&#125;","raw":"---\ntitle: Tag Plugins\ncopyright: true\ntags:\n  - Hexo\n  - Next\ncategories:\n  - Hexo\nabbrlink: e2e5eeac\ndate: 2019-05-10 12:35:58\ntype:\nkeyword:\ntop:\ncomments:\npassword:\n---\n\n{% note info %}\n### FAQ\n**Welcome** to [tag-plugins](https://theme-next.org/docs/tag-plugins/)\n{% endnote %}\n\nTag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. [Hexo has a lot of tags](https://hexo.io/docs/tag-plugins) which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:\n\n<!--more-->\n\n* [Centered Quote](#Centered-Quote)\n* [Include Raw](#Include-Raw)\n* [Button](/docs/tag-plugins/button)\n* [Full Image](/docs/tag-plugins/full-image)\n* [Group Pictures](/docs/tag-plugins/group-pictures)\n* [Label](/docs/tag-plugins/label)\n* [Mermaid](/docs/tag-plugins/mermaid)\n* [Note](/docs/tag-plugins/note)\n* [PDF](/docs/tag-plugins/pdf)\n* [Tabs](/docs/tag-plugins/tabs)\n* [Video](/docs/tag-plugins/video)\n\n### Centered Quote\n\nThis tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote won't be symmetrical, so it's recommended to use when only have single line text. For example before article all after article to make a summary.\n\n#### Usage\n\n```html center-quote.js\n{% centerquote %}Something{% endcenterquote %}\n<!-- Tag Alias -->\n{% cq %}Something{% endcq %}\n```\n\n#### Example\n\n```md\n{% cq %}Elegant in code, simple in core{% endcq %}\n```\n\n{% cq %}Elegant in code, simple in core{% endcq %}\n\n### Include Raw\n\nThis tag include any raw content into your posts. Path is relative to your site source directory.\n\n#### Usage\n\n```html include-raw.js\n{% include_raw '_data/path/to/file.html' %}\n```\n\n#### Example\n\nLet's create `include-raw.html` file in `_data` directory under {% label info@site root directory %} with following content:\n\n```html\nAny <strong>raw content</strong> may be included with this tag.\n```\n\nThen in any post we can use this content with `include_raw` tag:\n\n```md\n{% include_raw '_data/path/to/include-raw.html' %}\n```\n\n{% include_raw '_data/include-raw.html' %}","content":"<div class=\"note info\"><h3 id=\"FAQ\"><a href=\"#FAQ\" class=\"headerlink\" title=\"FAQ\"></a>FAQ</h3><p><strong>Welcome</strong> to <span class=\"exturl\" data-url=\"aHR0cHM6Ly90aGVtZS1uZXh0Lm9yZy9kb2NzL3RhZy1wbHVnaW5zLw==\" title=\"https://theme-next.org/docs/tag-plugins/\">tag-plugins<i class=\"fa fa-external-link\"></i></span></p></div><p>Tag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdGFnLXBsdWdpbnM=\" title=\"https://hexo.io/docs/tag-plugins\">Hexo has a lot of tags<i class=\"fa fa-external-link\"></i></span> which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:</p><a id=\"more\"></a><ul><li><a href=\"#Centered-Quote\">Centered Quote</a></li><li><a href=\"#Include-Raw\">Include Raw</a></li><li><a href=\"/docs/tag-plugins/button\">Button</a></li><li><a href=\"/docs/tag-plugins/full-image\">Full Image</a></li><li><a href=\"/docs/tag-plugins/group-pictures\">Group Pictures</a></li><li><a href=\"/docs/tag-plugins/label\">Label</a></li><li><a href=\"/docs/tag-plugins/mermaid\">Mermaid</a></li><li><a href=\"/docs/tag-plugins/note\">Note</a></li><li><a href=\"/docs/tag-plugins/pdf\">PDF</a></li><li><a href=\"/docs/tag-plugins/tabs\">Tabs</a></li><li><a href=\"/docs/tag-plugins/video\">Video</a></li></ul><h3 id=\"Centered-Quote\"><a href=\"#Centered-Quote\" class=\"headerlink\" title=\"Centered Quote\"></a>Centered Quote</h3><p>This tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote wonâ€™t be symmetrical, so itâ€™s recommended to use when only have single line text. For example before article all after article to make a summary.</p><h4 id=\"Usage\"><a href=\"#Usage\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><figure class=\"highlight html\"><figcaption><span>center-quote.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% centerquote %&#125;Something&#123;% endcenterquote %&#125;</span><br><span class=\"line\"><span class=\"comment\">&lt;!-- Tag Alias --&gt;</span></span><br><span class=\"line\">&#123;% cq %&#125;Something&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure><h4 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h4><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% cq %&#125;Elegant in code, simple in core&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure><blockquote class=\"blockquote-center\"><p>Elegant in code, simple in core</p></blockquote><h3 id=\"Include-Raw\"><a href=\"#Include-Raw\" class=\"headerlink\" title=\"Include Raw\"></a>Include Raw</h3><p>This tag include any raw content into your posts. Path is relative to your site source directory.</p><h4 id=\"Usage-1\"><a href=\"#Usage-1\" class=\"headerlink\" title=\"Usage\"></a>Usage</h4><figure class=\"highlight html\"><figcaption><span>include-raw.js</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% include_raw '_data/path/to/file.html' %&#125;</span><br></pre></td></tr></table></figure><h4 id=\"Example-1\"><a href=\"#Example-1\" class=\"headerlink\" title=\"Example\"></a>Example</h4><p>Letâ€™s create <code>include-raw.html</code> file in <code>_data</code> directory under <span class=\"label info\">site root directory</span> with following content:</p><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Any <span class=\"tag\">&lt;<span class=\"name\">strong</span>&gt;</span>raw content<span class=\"tag\">&lt;/<span class=\"name\">strong</span>&gt;</span> may be included with this tag.</span><br></pre></td></tr></table></figure><p>Then in any post we can use this content with <code>include_raw</code> tag:</p><figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;% include<span class=\"emphasis\">_raw '_</span>data/path/to/include-raw.html' %&#125;</span><br></pre></td></tr></table></figure>","slug":"Tag Plugins","updated":"2019-05-23T12:33:08.387Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/e2e5eeac/","excerpt":"FAQWelcome to tag-pluginsTag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. Hexo has a lot of tags which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:","categories":[{"name":"Hexo","slug":"Hexo","permalink":"https://shuntan.github.io/categories/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://shuntan.github.io/tags/Hexo/"},{"name":"Next","slug":"Next","permalink":"https://shuntan.github.io/tags/Next/"}]},{"title":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD","date":"2019-05-06T15:03:34.000Z","path":"posts/8c023e79/","text":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MODè¡¥ä¸ç±»å‹ï¼šæ¸¸æˆMODæ•´ç†æ—¶é—´ï¼š2019-05-05å¤§å°ï¼š18.73MBè¡¥ä¸åˆ¶ä½œï¼šhiyokomodè¡¥ä¸è¯­è¨€ï¼šå¤šå›½ç‰ˆæœ¬ï¼šv1.0downloadç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œäºŒæ¬¡å…ƒèŒå¦¹MODâ€ï¼Œå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼æˆªå›¾æ³¨æ„äº‹é¡¹éœ€è¦ä¸‹è½½â€œLooksMenuæè„¸èœå•==&gt;ç‚¹æˆ‘ä¸‹è½½â€ã€‚ä½¿ç”¨è¯´æ˜NMMè‡ªåŠ¨å®‰è£…æ–¹æ³•ï¼šç‚¹æˆ‘ä¸‹è½½NMM1ã€æ·»åŠ å‹ç¼©åŒ…åˆ°NMM(åˆ—è¡¨ä¸­å‡ºç°)ï¼› 2ã€åŒå‡»åˆ—è¡¨å®‰è£…ï¼› 3ã€è¿›å…¥æ¸¸æˆå³å¯ã€‚ **æ‰‹åŠ¨å®‰è£…æ–¹æ³•(ä¸æ¨è)ï¼š** 1ã€è§£å‹ç¼©ï¼› 2ã€å°†dataæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼› 3ã€ç”¨MODç®¡ç†å™¨åŠ è½½ESPï¼› 4ã€è¿›å…¥æ¸¸æˆä¸­å³å¯ã€‚ æ¼”ç¤ºè§†é¢‘åˆ†æµç™¾åº¦ç½‘ç›˜(æå–ç ï¼šbr93)æœ¬åœ°ç”µä¿¡ç½‘é€šé«˜é€Ÿä¸‹è½½ç”µä¿¡ä¸‹è½½è”é€šä¸‹è½½","raw":"---\ntitle: ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\ncopyright: true\ncategories:\n  - Mod\ntags:\n  - Games\n  - Pc\ntop: 100\ndescription: >-\n  ç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œ**äºŒæ¬¡å…ƒèŒå¦¹MOD**â€ï¼Œå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼\nabbrlink: 8c023e79\ndate: 2019-05-06 23:03:34\ntype:\n---\n\n![](https://img.3dmgame.com/uploads/images/thumbkwdfirst/20180828/1535458637_329538.jpg)\n![](https://img.3dmgame.com/uploads/images/thumbkwdfirst/20180522/1526978780_509292.png)\n\n# ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\n\n\n*   è¡¥ä¸ç±»å‹ï¼šæ¸¸æˆMOD\n*   æ•´ç†æ—¶é—´ï¼š2019-05-05\n*   å¤§å°ï¼š18.73MB\n*   è¡¥ä¸åˆ¶ä½œï¼šhiyokomod\n*   è¡¥ä¸è¯­è¨€ï¼šå¤šå›½\n*   ç‰ˆæœ¬ï¼šv1.0\n\n\n[download](http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id371@371_2138610)\n\n{% cq %}\nç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œ**äºŒæ¬¡å…ƒèŒå¦¹MOD**â€ï¼Œ\nå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œ\nå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼\n{% endcq %}\n\n<!-- more -->\n\n### æˆªå›¾\n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_376264.png) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_327571.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_903130.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_319499.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_929840.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_553987.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_557348.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_140245.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_907658.jpeg) \n\n![ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD](https://img.3dmgame.com/uploads/images/news/20190505/1557045450_261890.jpeg) \n\n### æ³¨æ„äº‹é¡¹\n\néœ€è¦ä¸‹è½½â€œ**<span style=\"color:#E53333;\">LooksMenuæè„¸èœå•</span>**==&gt;[ç‚¹æˆ‘ä¸‹è½½](https://dl.3dmgame.com/patch/138611.html)â€ã€‚\n\n### ä½¿ç”¨è¯´æ˜\n\n**NMMè‡ªåŠ¨å®‰è£…æ–¹æ³•ï¼š** \n[ç‚¹æˆ‘ä¸‹è½½NMM](https://dl.3dmgame.com/patch/128998.html)\n\n\t1ã€æ·»åŠ å‹ç¼©åŒ…åˆ°NMM(åˆ—è¡¨ä¸­å‡ºç°)ï¼›\n\n\t2ã€åŒå‡»åˆ—è¡¨å®‰è£…ï¼›\n\n\t3ã€è¿›å…¥æ¸¸æˆå³å¯ã€‚\n\n\t**æ‰‹åŠ¨å®‰è£…æ–¹æ³•(ä¸æ¨è)ï¼š** \n\n\t1ã€è§£å‹ç¼©ï¼›\n\n\t2ã€å°†dataæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼›\n\n\t3ã€ç”¨MODç®¡ç†å™¨åŠ è½½ESPï¼›\n\n\t4ã€è¿›å…¥æ¸¸æˆä¸­å³å¯ã€‚\n\n\n### æ¼”ç¤ºè§†é¢‘\n\n<iframe src=\"https://player.youku.com/embed/XNDE2Njc1OTM0MA==?client_id=5a73c0df8eb0d91d\" allowfullscreen=\"\" width=\"640\" height=\"480\" frameborder=\"0\">\n</iframe>\n\n<iframe src=\"https://player.youku.com/embed/XNDE2Njc2MjM2NA==?client_id=5a73c0df8eb0d91d\" allowfullscreen=\"\" width=\"640\" height=\"480\" frameborder=\"0\">\n</iframe>\n\n\nåˆ†æµ\n\n>[ç™¾åº¦ç½‘ç›˜(æå–ç ï¼šbr93)](https://pan.baidu.com/s/1hYTBEc2DQbmP2k98JLSwkA)\n\n\næœ¬åœ°\n\n>[ç”µä¿¡](http://dl1.cudown.com/buding/mod/3DMGAME-FO4AnimeRaceNanakochanmod.rar)\n[ç½‘é€š](http://dl1.cudown.com/buding/mod/3DMGAME-FO4AnimeRaceNanakochanmod.rar)\n\n>[é«˜é€Ÿä¸‹è½½](http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610)\n[ç”µä¿¡ä¸‹è½½](http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610)\n[è”é€šä¸‹è½½](http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610)\n\n","content":"<p><img src=\"https://img.3dmgame.com/uploads/images/thumbkwdfirst/20180828/1535458637_329538.jpg\" alt=\"\"><br><img src=\"https://img.3dmgame.com/uploads/images/thumbkwdfirst/20180522/1526978780_509292.png\" alt=\"\"></p><h1 id=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"><a href=\"#ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\" class=\"headerlink\" title=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></a>ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD</h1><ul><li>è¡¥ä¸ç±»å‹ï¼šæ¸¸æˆMOD</li><li>æ•´ç†æ—¶é—´ï¼š2019-05-05</li><li>å¤§å°ï¼š18.73MB</li><li>è¡¥ä¸åˆ¶ä½œï¼šhiyokomod</li><li>è¡¥ä¸è¯­è¨€ï¼šå¤šå›½</li><li>ç‰ˆæœ¬ï¼šv1.0</li></ul><p><span class=\"exturl\" data-url=\"aHR0cDovL2lkLnR0ejkuY24vdGhuLyVFMyU4MCU4QSVFOCVCRSU5MCVFNSVCMCU4NDQlRTMlODAlOEIlRTQlQkElOEMlRTYlQUMlQTElRTUlODUlODMlRTglOTAlOEMlRTUlQTYlQjlNT0RfaWQzNzFAMzcxXzIxMzg2MTA=\" title=\"http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id371@371_2138610\">download<i class=\"fa fa-external-link\"></i></span></p><blockquote class=\"blockquote-center\"><p>ç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œ<strong>äºŒæ¬¡å…ƒèŒå¦¹MOD</strong>â€ï¼Œ<br>å°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œ<br>å¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼</p></blockquote><a id=\"more\"></a><h3 id=\"æˆªå›¾\"><a href=\"#æˆªå›¾\" class=\"headerlink\" title=\"æˆªå›¾\"></a>æˆªå›¾</h3><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_376264.png\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_327571.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_903130.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_319499.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_929840.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_553987.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_557348.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_140245.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_907658.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><p><img src=\"https://img.3dmgame.com/uploads/images/news/20190505/1557045450_261890.jpeg\" alt=\"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD\"></p><h3 id=\"æ³¨æ„äº‹é¡¹\"><a href=\"#æ³¨æ„äº‹é¡¹\" class=\"headerlink\" title=\"æ³¨æ„äº‹é¡¹\"></a>æ³¨æ„äº‹é¡¹</h3><p>éœ€è¦ä¸‹è½½â€œ<strong><span style=\"color:#e53333\">LooksMenuæè„¸èœå•</span></strong>==&gt;<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kbC4zZG1nYW1lLmNvbS9wYXRjaC8xMzg2MTEuaHRtbA==\" title=\"https://dl.3dmgame.com/patch/138611.html\">ç‚¹æˆ‘ä¸‹è½½<i class=\"fa fa-external-link\"></i></span>â€ã€‚</p><h3 id=\"ä½¿ç”¨è¯´æ˜\"><a href=\"#ä½¿ç”¨è¯´æ˜\" class=\"headerlink\" title=\"ä½¿ç”¨è¯´æ˜\"></a>ä½¿ç”¨è¯´æ˜</h3><p><strong>NMMè‡ªåŠ¨å®‰è£…æ–¹æ³•ï¼š</strong><br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kbC4zZG1nYW1lLmNvbS9wYXRjaC8xMjg5OTguaHRtbA==\" title=\"https://dl.3dmgame.com/patch/128998.html\">ç‚¹æˆ‘ä¸‹è½½NMM<i class=\"fa fa-external-link\"></i></span></p><pre><code>1ã€æ·»åŠ å‹ç¼©åŒ…åˆ°NMM(åˆ—è¡¨ä¸­å‡ºç°)ï¼›\n\n2ã€åŒå‡»åˆ—è¡¨å®‰è£…ï¼›\n\n3ã€è¿›å…¥æ¸¸æˆå³å¯ã€‚\n\n**æ‰‹åŠ¨å®‰è£…æ–¹æ³•(ä¸æ¨è)ï¼š** \n\n1ã€è§£å‹ç¼©ï¼›\n\n2ã€å°†dataæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼›\n\n3ã€ç”¨MODç®¡ç†å™¨åŠ è½½ESPï¼›\n\n4ã€è¿›å…¥æ¸¸æˆä¸­å³å¯ã€‚\n</code></pre><h3 id=\"æ¼”ç¤ºè§†é¢‘\"><a href=\"#æ¼”ç¤ºè§†é¢‘\" class=\"headerlink\" title=\"æ¼”ç¤ºè§†é¢‘\"></a>æ¼”ç¤ºè§†é¢‘</h3><iframe src=\"https://player.youku.com/embed/XNDE2Njc1OTM0MA==?client_id=5a73c0df8eb0d91d\" allowfullscreen width=\"640\" height=\"480\" frameborder=\"0\"><br></iframe><iframe src=\"https://player.youku.com/embed/XNDE2Njc2MjM2NA==?client_id=5a73c0df8eb0d91d\" allowfullscreen width=\"640\" height=\"480\" frameborder=\"0\"><br></iframe><p>åˆ†æµ</p><blockquote><p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMWhZVEJFYzJEUWJtUDJrOThKTFN3a0E=\" title=\"https://pan.baidu.com/s/1hYTBEc2DQbmP2k98JLSwkA\">ç™¾åº¦ç½‘ç›˜(æå–ç ï¼šbr93)<i class=\"fa fa-external-link\"></i></span></p></blockquote><p>æœ¬åœ°</p><blockquote><p><span class=\"exturl\" data-url=\"aHR0cDovL2RsMS5jdWRvd24uY29tL2J1ZGluZy9tb2QvM0RNR0FNRS1GTzRBbmltZVJhY2VOYW5ha29jaGFubW9kLnJhcg==\" title=\"http://dl1.cudown.com/buding/mod/3DMGAME-FO4AnimeRaceNanakochanmod.rar\">ç”µä¿¡<i class=\"fa fa-external-link\"></i></span><br><span class=\"exturl\" data-url=\"aHR0cDovL2RsMS5jdWRvd24uY29tL2J1ZGluZy9tb2QvM0RNR0FNRS1GTzRBbmltZVJhY2VOYW5ha29jaGFubW9kLnJhcg==\" title=\"http://dl1.cudown.com/buding/mod/3DMGAME-FO4AnimeRaceNanakochanmod.rar\">ç½‘é€š<i class=\"fa fa-external-link\"></i></span></p></blockquote><blockquote><p><span class=\"exturl\" data-url=\"aHR0cDovL2lkLnR0ejkuY24vdGhuLyVFMyU4MCU4QSVFOCVCRSU5MCVFNSVCMCU4NDQlRTMlODAlOEIlRTQlQkElOEMlRTYlQUMlQTElRTUlODUlODMlRTglOTAlOEMlRTUlQTYlQjlNT0RfaWQzNzJAMzcyXzIxMzg2MTA=\" title=\"http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610\">é«˜é€Ÿä¸‹è½½<i class=\"fa fa-external-link\"></i></span><br><span class=\"exturl\" data-url=\"aHR0cDovL2lkLnR0ejkuY24vdGhuLyVFMyU4MCU4QSVFOCVCRSU5MCVFNSVCMCU4NDQlRTMlODAlOEIlRTQlQkElOEMlRTYlQUMlQTElRTUlODUlODMlRTglOTAlOEMlRTUlQTYlQjlNT0RfaWQzNzJAMzcyXzIxMzg2MTA=\" title=\"http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610\">ç”µä¿¡ä¸‹è½½<i class=\"fa fa-external-link\"></i></span><br><span class=\"exturl\" data-url=\"aHR0cDovL2lkLnR0ejkuY24vdGhuLyVFMyU4MCU4QSVFOCVCRSU5MCVFNSVCMCU4NDQlRTMlODAlOEIlRTQlQkElOEMlRTYlQUMlQTElRTUlODUlODMlRTglOTAlOEMlRTUlQTYlQjlNT0RfaWQzNzJAMzcyXzIxMzg2MTA=\" title=\"http://id.ttz9.cn/thn/%E3%80%8A%E8%BE%90%E5%B0%844%E3%80%8B%E4%BA%8C%E6%AC%A1%E5%85%83%E8%90%8C%E5%A6%B9MOD_id372@372_2138610\">è”é€šä¸‹è½½<i class=\"fa fa-external-link\"></i></span></p></blockquote>","slug":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD","updated":"2019-05-23T12:33:08.381Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/8c023e79/","excerpt":"ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MODè¡¥ä¸ç±»å‹ï¼šæ¸¸æˆMODæ•´ç†æ—¶é—´ï¼š2019-05-05å¤§å°ï¼š18.73MBè¡¥ä¸åˆ¶ä½œï¼šhiyokomodè¡¥ä¸è¯­è¨€ï¼šå¤šå›½ç‰ˆæœ¬ï¼šv1.0downloadç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾åŒ–modâ€œäºŒæ¬¡å…ƒèŒå¦¹MODâ€ï¼Œå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾å°‘å¥³ï¼Œéå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼","categories":[{"name":"Mod","slug":"Mod","permalink":"https://shuntan.github.io/categories/Mod/"}],"tags":[{"name":"Games","slug":"Games","permalink":"https://shuntan.github.io/tags/Games/"},{"name":"Pc","slug":"Pc","permalink":"https://shuntan.github.io/tags/Pc/"}]},{"title":"ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹","date":"2019-05-06T13:11:05.000Z","path":"posts/96f89d1/","text":"è¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ sourcodæˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚ä¿®æ”¹ themes/next/layout/_macro/sidebar.swig æ–‡ä»¶æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹åœ¨ themes/next/_config.yml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®background_music: //music.163.com/outchain/player?type=0&amp;amp;id=2120628564&amp;amp;auto=1&amp;amp;height=66æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹è‡ªå·±ç ”ç©¶åˆ›å»ºæ­Œå•è‡ªå·±ç ”ç©¶ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹çœ‹ä½ è‡ªå·±äº†åˆ†äº«æ­Œå•ä¸ä¼šè·å–å¤–é“¾çš„è¯·ä¸Šåº¦å¨˜: æ€ä¹ˆæŠŠè‡ªå·±çš„æ­Œå•åšæˆå¤–é“¾è·å–å¤–é“¾æ’­æ”¾å™¨æŠŠåœ°å€copyå‡ºæ¥height=90æ”¹æˆ 66è¿™æ ·ä»¥ååªéœ€è¦ä¿®æ”¹ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œå•ï¼Œåšå®¢çš„èƒŒæ™¯éŸ³ä¹å°±ä¼šè‡ªåŠ¨ä¿®æ”¹äº†ã€‚å¦‚æœå‡ºç°éŸ³ä¹ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œé‚£æ˜¯èµ„æºçš„é—®é¢˜ï¼Œè‡ªå·±ä¸Šç½‘æ˜“äº‘éŸ³ä¹ç”Ÿæˆå¤–é“¾çš„é¡µé¢çœ‹çœ‹ä¼šä¸ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚æŠŠåèµ„æºåˆ é™¤å°±OKäº†ã€‚ä¿®æ”¹å®Œæˆ‘çš„åšå®¢çš„æ•ˆæœ","raw":"---\ntitle: ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹\ncopyright: true\ncategories:\n  - Hexoæ•™ç¨‹\ntags:\n  - hexo\nabbrlink: 96f89d1\ndate: 2019-05-06 21:11:05\n---\n\n* è¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ [sourcod](//blog.sourcod.com)\n\n> æˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚\n\n### ä¿®æ”¹ `themes/next/layout/_macro/sidebar.swig` æ–‡ä»¶\n\næ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹ \n\n![sidebar](http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/91fc7624571cb9276c6338b1c9913fa3.png)\n\n<!-- more -->\n\n### åœ¨ `themes/next/_config.yml` é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®\n\n`background_music: //music.163.com/outchain/player?type=0&amp;id=2120628564&amp;auto=1&amp;height=66` \n\n![æ­Œå•åœ°å€é…ç½®](http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/676e3e18fa9bdc5af7621bc471cc2895.png)\n\n### <a name=\"t2\"></a>æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹\n\nè‡ªå·±ç ”ç©¶\n\n### <a name=\"t3\"></a>åˆ›å»ºæ­Œå•\n\nè‡ªå·±ç ”ç©¶\n\n### <a name=\"t4\"></a>ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹\n\nçœ‹ä½ è‡ªå·±äº†\n\n### <a name=\"t5\"></a>åˆ†äº«æ­Œå•\n\nä¸ä¼šè·å–å¤–é“¾çš„è¯·ä¸Šåº¦å¨˜: [æ€ä¹ˆæŠŠè‡ªå·±çš„æ­Œå•åšæˆå¤–é“¾](https://jingyan.baidu.com/article/d7130635dcdf6813fdf475c7.html)\n\n### <a name=\"t6\"></a>è·å–å¤–é“¾æ’­æ”¾å™¨\n\n![å¤–é“¾æ’­æ”¾å™¨](http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/3684d31ccbbb950e018b16113068a967.png)\n\n### <a name=\"t7\"></a>æŠŠåœ°å€copyå‡ºæ¥`height=90`æ”¹æˆ `66`\n\n![å¤–é“¾](http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/47f61ed64adaa3db93c0eceec989978e.png)\n\n> è¿™æ ·ä»¥ååªéœ€è¦ä¿®æ”¹ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œå•ï¼Œåšå®¢çš„èƒŒæ™¯éŸ³ä¹å°±ä¼šè‡ªåŠ¨ä¿®æ”¹äº†ã€‚\n> \n> å¦‚æœå‡ºç°éŸ³ä¹ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œé‚£æ˜¯èµ„æºçš„é—®é¢˜ï¼Œè‡ªå·±ä¸Šç½‘æ˜“äº‘éŸ³ä¹ç”Ÿæˆå¤–é“¾çš„é¡µé¢çœ‹çœ‹ä¼šä¸ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚æŠŠåèµ„æºåˆ é™¤å°±OKäº†ã€‚\n\n* * *\n\n_ä¿®æ”¹å®Œæˆ‘çš„åšå®¢çš„æ•ˆæœ_\n\n![åšå®¢æ•ˆæœ](http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/e10246452ccbc9a5eb5e2f2b8c5c70e7.png)","content":"<ul><li>è¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ <a href=\"//blog.sourcod.com\">sourcod</a></li></ul><blockquote><p>æˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚</p></blockquote><h3 id=\"ä¿®æ”¹-themes-next-layout-macro-sidebar-swig-æ–‡ä»¶\"><a href=\"#ä¿®æ”¹-themes-next-layout-macro-sidebar-swig-æ–‡ä»¶\" class=\"headerlink\" title=\"ä¿®æ”¹ themes/next/layout/_macro/sidebar.swig æ–‡ä»¶\"></a>ä¿®æ”¹ <code>themes/next/layout/_macro/sidebar.swig</code> æ–‡ä»¶</h3><p>æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹</p><p><img src=\"http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/91fc7624571cb9276c6338b1c9913fa3.png\" alt=\"sidebar\"></p><a id=\"more\"></a><h3 id=\"åœ¨-themes-next-config-yml-é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®\"><a href=\"#åœ¨-themes-next-config-yml-é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®\" class=\"headerlink\" title=\"åœ¨ themes/next/_config.yml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®\"></a>åœ¨ <code>themes/next/_config.yml</code> é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®</h3><p><code>background_music: //music.163.com/outchain/player?type=0&amp;amp;id=2120628564&amp;amp;auto=1&amp;amp;height=66</code></p><p><img src=\"http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/676e3e18fa9bdc5af7621bc471cc2895.png\" alt=\"æ­Œå•åœ°å€é…ç½®\"></p><h3 id=\"æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹\"><a href=\"#æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹\" class=\"headerlink\" title=\"æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹\"></a><a name=\"t2\"></a>æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹</h3><p>è‡ªå·±ç ”ç©¶</p><h3 id=\"åˆ›å»ºæ­Œå•\"><a href=\"#åˆ›å»ºæ­Œå•\" class=\"headerlink\" title=\"åˆ›å»ºæ­Œå•\"></a><a name=\"t3\"></a>åˆ›å»ºæ­Œå•</h3><p>è‡ªå·±ç ”ç©¶</p><h3 id=\"ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹\"><a href=\"#ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹\" class=\"headerlink\" title=\"ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹\"></a><a name=\"t4\"></a>ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹</h3><p>çœ‹ä½ è‡ªå·±äº†</p><h3 id=\"åˆ†äº«æ­Œå•\"><a href=\"#åˆ†äº«æ­Œå•\" class=\"headerlink\" title=\"åˆ†äº«æ­Œå•\"></a><a name=\"t5\"></a>åˆ†äº«æ­Œå•</h3><p>ä¸ä¼šè·å–å¤–é“¾çš„è¯·ä¸Šåº¦å¨˜: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qaW5neWFuLmJhaWR1LmNvbS9hcnRpY2xlL2Q3MTMwNjM1ZGNkZjY4MTNmZGY0NzVjNy5odG1s\" title=\"https://jingyan.baidu.com/article/d7130635dcdf6813fdf475c7.html\">æ€ä¹ˆæŠŠè‡ªå·±çš„æ­Œå•åšæˆå¤–é“¾<i class=\"fa fa-external-link\"></i></span></p><h3 id=\"è·å–å¤–é“¾æ’­æ”¾å™¨\"><a href=\"#è·å–å¤–é“¾æ’­æ”¾å™¨\" class=\"headerlink\" title=\"è·å–å¤–é“¾æ’­æ”¾å™¨\"></a><a name=\"t6\"></a>è·å–å¤–é“¾æ’­æ”¾å™¨</h3><p><img src=\"http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/3684d31ccbbb950e018b16113068a967.png\" alt=\"å¤–é“¾æ’­æ”¾å™¨\"></p><h3 id=\"æŠŠåœ°å€copyå‡ºæ¥height-90æ”¹æˆ-66\"><a href=\"#æŠŠåœ°å€copyå‡ºæ¥height-90æ”¹æˆ-66\" class=\"headerlink\" title=\"æŠŠåœ°å€copyå‡ºæ¥height=90æ”¹æˆ 66\"></a><a name=\"t7\"></a>æŠŠåœ°å€copyå‡ºæ¥<code>height=90</code>æ”¹æˆ <code>66</code></h3><p><img src=\"http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/47f61ed64adaa3db93c0eceec989978e.png\" alt=\"å¤–é“¾\"></p><blockquote><p>è¿™æ ·ä»¥ååªéœ€è¦ä¿®æ”¹ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œå•ï¼Œåšå®¢çš„èƒŒæ™¯éŸ³ä¹å°±ä¼šè‡ªåŠ¨ä¿®æ”¹äº†ã€‚</p><p>å¦‚æœå‡ºç°éŸ³ä¹ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œé‚£æ˜¯èµ„æºçš„é—®é¢˜ï¼Œè‡ªå·±ä¸Šç½‘æ˜“äº‘éŸ³ä¹ç”Ÿæˆå¤–é“¾çš„é¡µé¢çœ‹çœ‹ä¼šä¸ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚æŠŠåèµ„æºåˆ é™¤å°±OKäº†ã€‚</p></blockquote><hr><p><em>ä¿®æ”¹å®Œæˆ‘çš„åšå®¢çš„æ•ˆæœ</em></p><p><img src=\"http://sourcod.oss-cn-beijing.aliyuncs.com/hexo/e10246452ccbc9a5eb5e2f2b8c5c70e7.png\" alt=\"åšå®¢æ•ˆæœ\"></p>","slug":"ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹","updated":"2019-05-23T12:33:08.390Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/96f89d1/","excerpt":"è¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ sourcodæˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚ä¿®æ”¹ themes/next/layout/_macro/sidebar.swig æ–‡ä»¶æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹","categories":[{"name":"Hexoæ•™ç¨‹","slug":"Hexoæ•™ç¨‹","permalink":"https://shuntan.github.io/categories/Hexoæ•™ç¨‹/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://shuntan.github.io/tags/hexo/"}]},{"title":"é—®é“","date":"2019-04-11T11:12:20.000Z","path":"posts/a3b6fe04/","text":"æ¸¸æˆèƒŒæ™¯ä»‹ç»é¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·å¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚ä¸‰æ•™ä¸»ç§‰æ‰¿å¸ˆçˆ¶é¸¿é’§ä¸Šäººæ•™è¯²ï¼Œå¹¿æ”¶é—¨å¾’å°†é“æ•™æµä¼ äºä¸–ã€‚åªå› å…¥é“é—¨ä¸­å³å¯ä¿®ä»™ï¼Œä½¿äººè·³å‡ºä¸‰ç•Œä¹‹å¤–ï¼Œä¸åœ¨äº”è¡Œä¹‹ä¸­ï¼Œå…é™¤ç”Ÿæ­»è½®å›ä¹‹è‹¦ï¼Œä½¿å¾—å…¥é“ä¿®è¡Œä¹‹äººå¤šä¸èƒœæ•°ã€‚ä½†ä¿®ä»™ä¹‹é“å¹¶éè‹¦å¿ƒä¿®ç‚¼ä¾¿å¯è¾¾æˆï¼Œä¿®è¡Œè·¯ä¸Šï¼Œå‡è¦ç»å†ä¸‰ç™¾å¹´ä¸€å°åŠ«ï¼Œä¸€åƒäº”ç™¾å¹´ä¸€å¤§åŠ«çš„åŠ«æ•°ã€‚ä¿®è¡Œä¹‹äººå‡æ— æ³•é¿å¼€åŠ«æ•°ï¼Œåªèƒ½æ ¹æ®è‡ªèº«é“è¡Œçš„æ·±æµ…å»ç»å†åŠ«æ•°ã€‚å€¼å•†å‘¨ä¸¤æœäº¤æ›¿ä¹‹æ—¶ï¼Œæ°é€¢ä¿®ä»™ä¸€åƒäº”ç™¾å¹´ä»™åŠ«ï¼Œäºæ˜¯ä¸‰æ•™ä¸»å…±è®®å°ç¥æ¦œï¼Œä»¥è§‚ä¼—ä»™æ ¹è¡Œæµ…æ·±ã€‚ç„¶åŠ«æ•°éš¾é€ƒï¼Œå°ç¥ä¸€å½¹ï¼Œè‡´ä½¿é“é—¨å†…éƒ¨é˜æ•™å’Œæˆªæ•™ä¸å’Œï¼Œä¿®ä»™ä¼—äººä¿±é­å± æˆ®ï¼Œæ›´å¼•æ¥è¥¿æ–¹æ•™æ´¾å‚ä¸çº·äº‰ï¼Œåå› é¸¿é’§ä¸Šäººäº²è‡ªå‡ºé¢è°ƒåœï¼Œç»ˆå¾—ä»¥å¹³æ¯ã€‚é€šå¤©æ•™ä¸»è¢«é¸¿é’§ä¸Šäººç¦åˆ¶åœ¨ç´«éœ„å®«æ˜†ä»‘ä¹‹é¢ ä¿®è¡Œæ€è¿‡ã€‚æ—¶å…‰å¦‚æ¢­ï¼Œè½¬çœ¼å·²è¿‡åƒå¹´ï¼Œå¸ˆå°Šé¸¿é’§ä¸Šäººå¤–å‡ºäº‘æ¸¸ï¼Œä¸çŸ¥æ‰€è¸ªã€‚è€Œé€šå¤©ä»¿ä½›å·²ç»ä¹ æƒ¯äº†è¿™ç§è¢«ç¦å›ºçš„ç”Ÿæ´»ï¼Œé™¤äº†æ¯æ—¥çš„å¿…åšçš„ä¿®çœŸç‚¼æ°”å’Œé™è¯µã€Šé»„åº­ã€‹ï¼Œä»–æ›´å¤šçš„æ—¶é—´æ€»æ˜¯åœ¨æ–­å´–è¾¹é™é™åç€ã€‚ä¹Ÿè®¸åªæœ‰è¿™ä¸ªæ—¶åˆ»ï¼Œä»–æ‰èƒ½çœŸçœŸå®å®åœ°æ„Ÿè§‰åˆ°è‡ªå·±çš„å­˜åœ¨ï¼Œåƒå¹´çš„è‹¦è¡Œä½¿ä»–çš„ä¿®ä¸ºå€å¢ï¼ŒåŒæ—¶ä¹Ÿè®©ä»–é¥±å—äº†å­¤å•å’Œå¯‚å¯ï¼Œä»–å·²ç»å¾ˆä¹…æ²¡æœ‰è¯´è¿‡ä¸€å¥è¯äº†ï¼Œå¾ˆä¹…æ˜¯å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–åªçŸ¥é“ä»–åœ¨ç­‰ï¼Œä»–ä»¬éƒ½åœ¨ç­‰ã€‚.ç©ºæ—·çš„æ–­å´–è¾¹ï¼Œä¸€ä¸ªäººå½±ä¼«ç«‹ï¼Œè‰¯ä¹…ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚å±±é£åŠ²è¢­ï¼ŒäººçŠ¹å¦‚ä¸å±±æµ‘ç„¶ä¸€ä½“ï¼Œä»æ˜¯ä¸€åŠ¨ä¸åŠ¨ï¼Œåšæ¯…çš„é¢å®¹æ¯«æ— è¡¨æƒ…ï¼Œåªæœ‰æ˜äº®çš„åŒçœ¸åœ¨é»‘å¤œå°è¡¬ä¸‹å¯’å…‰é—ªç°ï¼Œçœºæœ›ç€è¿œæ–¹ã€‚è¿œå¤„ï¼Œéª·é«…å±±é¡¶ï¼Œä¸€å—é¡½çŸ³å¥½è±¡åŠ¨äº†ä¸€åŠ¨ï¼ŒåˆåŠ¨äº†ä¸€åŠ¨ï¼Œä»¿ä½›æœ‰äº†å‘¼å¸ã€‚æ…¢æ…¢åœ°ï¼Œé¡½çŸ³å‘¨å›´ç«Ÿç„¶å¿½éšå¿½ç°å‡ºç€ç„é»„è‰²çš„å…‰èŠ’ï¼Œæœ€ç»ˆå¹»åŒ–ä¸ºä¸€ä¸ªäººå½¢çš„å…‰å›¢ï¼Œç¼“ç¼“é£˜å‘å±±åçš„å¹½å†¥æ¶§ã€‚æ­¤æ—¶ï¼Œäººå½±çš„è‹ç™½é¢å®¹ä¸Šæµ®ç°å‡ºå¥‡æ€ªçš„ç¬‘æ„ï¼Œä»¤äººä¸å¯’è€Œæ —ï¼Œä»–æ˜¯é€šå¤©ã€‚äº”ç™¾å¹´åçš„ä¸­æ´²å¤§é™†ã€‚åœ¨ä¸œæµ·æ¸”æ‘ï¼Œä¸–ä¸–ä»£ä»£ä»¥æ•é±¼ä¸ºç”Ÿçš„æ¸”æ°‘æœ‰ä¸€å¤©çªç„¶å‘ç°ç¦»ä»–ä»¬æ‘å­ä¸è¿œçš„æµ·é¢ä¸Šï¼Œç«Ÿç„¶å‡ºç°ä¸€ä¸ªå¼‚å¸¸ç¾ä¸½çš„ä»™å²›ã€‚åœ¨å¤©å¢‰åŸï¼Œç†™ç†™æ”˜æ”˜åœ°è¡—é“ä¸Šçªç„¶å¤šäº†ä¸€äº›èº«ç€å¥‡è£…å¥‡æœï¼Œè¡Œä¸ºä¸¾æ­¢ååˆ†å¯ç–‘ä¹‹äººã€‚åœ¨æ½ä»™é•‡ï¼Œä¸€ä¸ªå¹³å‡¡å†·æ¸…çš„å°é•‡ä¸Šçªç„¶é—´çƒ­é—¹äº†èµ·æ¥ï¼Œä»å››é¢å…«æ–¹èµ¶æ¥çš„ä¿Šç”·ç¾å¥³ç»œç»ä¸ç»ã€‚æœ¬æ¥å¹³é™çš„ã€Šé—®é“ã€‹ä¸–ç•Œä¸­å‡ºç°å„ç§å¼‚è±¡å’Œå¾å…†ï¼Œè€Œæ­¤æ—¶ï¼Œå‡†å¤‡ä¸€æ¢ç©¶ç«Ÿçš„ç©å®¶ï¼Œæ­£èµ¶å¾€æ½ä»™é•‡çš„é€”ä¸­ã€‚ [1]æˆªå›¾ä¸‹è½½å®¢æˆ·ç«¯ä¸‹è½½ç™»å½•å™¨ä¸‹è½½ç›®å‰åªæä¾›1.60.0905ç‰ˆæœ¬å®¢æˆ·ç«¯ç™¾åº¦äº‘ä¸‹è½½é“¾æ¥ğŸ”—ç™¾åº¦äº‘å¯†ç (kq7m)ä¸ç‰ˆæœ¬å¯¹åº”çš„ç™»å½•å™¨ï¼ŒæœåŠ¡å™¨ä¸ºå…¬ç›Šæœï¼Œä¸åšä»»ä½•ç›ˆåˆ©å’Œä¸å…·å¤‡å•†ä¸šæ€§è´¨ï¼é“¾æ¥ï¼šhttps://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMwæå–ç ï¼š**å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦æ›´å¤šèµ„è®¯: Deployment","raw":"---\ntitle: é—®é“\ncopyright: true\npassword: 123\ncategories:\n  - PC\ntags:\n  - online\n  - game\nabbrlink: a3b6fe04\ndate: 2019-04-11 19:12:20\n---\n\n### æ¸¸æˆèƒŒæ™¯ä»‹ç»\n\né¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·å¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚\n<!-- more -->\nä¸‰æ•™ä¸»ç§‰æ‰¿å¸ˆçˆ¶é¸¿é’§ä¸Šäººæ•™è¯²ï¼Œå¹¿æ”¶é—¨å¾’å°†é“æ•™æµä¼ äºä¸–ã€‚åªå› å…¥é“é—¨ä¸­å³å¯ä¿®ä»™ï¼Œä½¿äººè·³å‡ºä¸‰ç•Œä¹‹å¤–ï¼Œä¸åœ¨äº”è¡Œä¹‹ä¸­ï¼Œå…é™¤ç”Ÿæ­»è½®å›ä¹‹è‹¦ï¼Œä½¿å¾—å…¥é“ä¿®è¡Œä¹‹äººå¤šä¸èƒœæ•°ã€‚ä½†ä¿®ä»™ä¹‹é“å¹¶éè‹¦å¿ƒä¿®ç‚¼ä¾¿å¯è¾¾æˆï¼Œä¿®è¡Œè·¯ä¸Šï¼Œå‡è¦ç»å†ä¸‰ç™¾å¹´ä¸€å°åŠ«ï¼Œä¸€åƒäº”ç™¾å¹´ä¸€å¤§åŠ«çš„åŠ«æ•°ã€‚ä¿®è¡Œä¹‹äººå‡æ— æ³•é¿å¼€åŠ«æ•°ï¼Œåªèƒ½æ ¹æ®è‡ªèº«é“è¡Œçš„æ·±æµ…å»ç»å†åŠ«æ•°ã€‚å€¼å•†å‘¨ä¸¤æœäº¤æ›¿ä¹‹æ—¶ï¼Œæ°é€¢ä¿®ä»™ä¸€åƒäº”ç™¾å¹´ä»™åŠ«ï¼Œäºæ˜¯ä¸‰æ•™ä¸»å…±è®®å°ç¥æ¦œï¼Œä»¥è§‚ä¼—ä»™æ ¹è¡Œæµ…æ·±ã€‚ç„¶åŠ«æ•°éš¾é€ƒï¼Œå°ç¥ä¸€å½¹ï¼Œè‡´ä½¿é“é—¨å†…éƒ¨é˜æ•™å’Œæˆªæ•™ä¸å’Œï¼Œä¿®ä»™ä¼—äººä¿±é­å± æˆ®ï¼Œæ›´å¼•æ¥è¥¿æ–¹æ•™æ´¾å‚ä¸çº·äº‰ï¼Œåå› é¸¿é’§ä¸Šäººäº²è‡ªå‡ºé¢è°ƒåœï¼Œç»ˆå¾—ä»¥å¹³æ¯ã€‚é€šå¤©æ•™ä¸»è¢«é¸¿é’§ä¸Šäººç¦åˆ¶åœ¨ç´«éœ„å®«æ˜†ä»‘ä¹‹é¢ ä¿®è¡Œæ€è¿‡ã€‚\næ—¶å…‰å¦‚æ¢­ï¼Œè½¬çœ¼å·²è¿‡åƒå¹´ï¼Œå¸ˆå°Šé¸¿é’§ä¸Šäººå¤–å‡ºäº‘æ¸¸ï¼Œä¸çŸ¥æ‰€è¸ªã€‚è€Œé€šå¤©ä»¿ä½›å·²ç»ä¹ æƒ¯äº†è¿™ç§è¢«ç¦å›ºçš„ç”Ÿæ´»ï¼Œé™¤äº†æ¯æ—¥çš„å¿…åšçš„ä¿®çœŸç‚¼æ°”å’Œé™è¯µã€Šé»„åº­ã€‹ï¼Œä»–æ›´å¤šçš„æ—¶é—´æ€»æ˜¯åœ¨æ–­å´–è¾¹é™é™åç€ã€‚ä¹Ÿè®¸åªæœ‰è¿™ä¸ªæ—¶åˆ»ï¼Œä»–æ‰èƒ½çœŸçœŸå®å®åœ°æ„Ÿè§‰åˆ°è‡ªå·±çš„å­˜åœ¨ï¼Œåƒå¹´çš„è‹¦è¡Œä½¿ä»–çš„ä¿®ä¸ºå€å¢ï¼ŒåŒæ—¶ä¹Ÿè®©ä»–é¥±å—äº†å­¤å•å’Œå¯‚å¯ï¼Œä»–å·²ç»å¾ˆä¹…æ²¡æœ‰è¯´è¿‡ä¸€å¥è¯äº†ï¼Œå¾ˆä¹…æ˜¯å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–åªçŸ¥é“ä»–åœ¨ç­‰ï¼Œä»–ä»¬éƒ½åœ¨ç­‰ã€‚.\nç©ºæ—·çš„æ–­å´–è¾¹ï¼Œä¸€ä¸ªäººå½±ä¼«ç«‹ï¼Œè‰¯ä¹…ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚å±±é£åŠ²è¢­ï¼ŒäººçŠ¹å¦‚ä¸å±±æµ‘ç„¶ä¸€ä½“ï¼Œä»æ˜¯ä¸€åŠ¨ä¸åŠ¨ï¼Œåšæ¯…çš„é¢å®¹æ¯«æ— è¡¨æƒ…ï¼Œåªæœ‰æ˜äº®çš„åŒçœ¸åœ¨é»‘å¤œå°è¡¬ä¸‹å¯’å…‰é—ªç°ï¼Œçœºæœ›ç€è¿œæ–¹ã€‚è¿œå¤„ï¼Œéª·é«…å±±é¡¶ï¼Œä¸€å—é¡½çŸ³å¥½è±¡åŠ¨äº†ä¸€åŠ¨ï¼ŒåˆåŠ¨äº†ä¸€åŠ¨ï¼Œä»¿ä½›æœ‰äº†å‘¼å¸ã€‚æ…¢æ…¢åœ°ï¼Œé¡½çŸ³å‘¨å›´ç«Ÿç„¶å¿½éšå¿½ç°å‡ºç€ç„é»„è‰²çš„å…‰èŠ’ï¼Œæœ€ç»ˆå¹»åŒ–ä¸ºä¸€ä¸ªäººå½¢çš„å…‰å›¢ï¼Œç¼“ç¼“é£˜å‘å±±åçš„å¹½å†¥æ¶§ã€‚æ­¤æ—¶ï¼Œäººå½±çš„è‹ç™½é¢å®¹ä¸Šæµ®ç°å‡ºå¥‡æ€ªçš„ç¬‘æ„ï¼Œä»¤äººä¸å¯’è€Œæ —ï¼Œä»–æ˜¯é€šå¤©ã€‚\näº”ç™¾å¹´åçš„ä¸­æ´²å¤§é™†ã€‚\nåœ¨ä¸œæµ·æ¸”æ‘ï¼Œä¸–ä¸–ä»£ä»£ä»¥æ•é±¼ä¸ºç”Ÿçš„æ¸”æ°‘æœ‰ä¸€å¤©çªç„¶å‘ç°ç¦»ä»–ä»¬æ‘å­ä¸è¿œçš„æµ·é¢ä¸Šï¼Œç«Ÿç„¶å‡ºç°ä¸€ä¸ªå¼‚å¸¸ç¾ä¸½çš„ä»™å²›ã€‚\nåœ¨å¤©å¢‰åŸï¼Œç†™ç†™æ”˜æ”˜åœ°è¡—é“ä¸Šçªç„¶å¤šäº†ä¸€äº›èº«ç€å¥‡è£…å¥‡æœï¼Œè¡Œä¸ºä¸¾æ­¢ååˆ†å¯ç–‘ä¹‹äººã€‚\nåœ¨æ½ä»™é•‡ï¼Œä¸€ä¸ªå¹³å‡¡å†·æ¸…çš„å°é•‡ä¸Šçªç„¶é—´çƒ­é—¹äº†èµ·æ¥ï¼Œä»å››é¢å…«æ–¹èµ¶æ¥çš„ä¿Šç”·ç¾å¥³ç»œç»ä¸ç»ã€‚\næœ¬æ¥å¹³é™çš„ã€Šé—®é“ã€‹ä¸–ç•Œä¸­å‡ºç°å„ç§å¼‚è±¡å’Œå¾å…†ï¼Œè€Œæ­¤æ—¶ï¼Œå‡†å¤‡ä¸€æ¢ç©¶ç«Ÿçš„ç©å®¶ï¼Œæ­£èµ¶å¾€æ½ä»™é•‡çš„é€”ä¸­ã€‚ [1] \n\n### æˆªå›¾\n![](é—®é“/../261557566768_.pic_hd.jpg)\n\n### ä¸‹è½½\n{% tabs Fourth unique name %}\n<!-- tab å®¢æˆ·ç«¯ä¸‹è½½ -->\n{% note success %}\nç›®å‰åªæä¾›1.60.0905ç‰ˆæœ¬å®¢æˆ·ç«¯ç™¾åº¦äº‘ä¸‹è½½é“¾æ¥ğŸ”—\n{% btn https://pan.baidu.com/s/1rsdS6oiuAxoYr5wXeZr22A, ç™¾åº¦äº‘, edge, kq7m %}\n{% button #, å¯†ç (kq7m) %}\n{% endnote %}\n<!-- endtab -->\n\n<!-- tab ç™»å½•å™¨ä¸‹è½½ -->\n{% note warning %}\nä¸ç‰ˆæœ¬å¯¹åº”çš„ç™»å½•å™¨ï¼ŒæœåŠ¡å™¨ä¸ºå…¬ç›Šæœï¼Œä¸åšä»»ä½•ç›ˆåˆ©å’Œä¸å…·å¤‡å•†ä¸šæ€§è´¨ï¼\né“¾æ¥ï¼šhttps://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMw \næå–ç ï¼š**** \nå¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦\n\n<img src=\"é—®é“/../281557578598_.pic_hd.jpg\" width = \"100px\" height = \"100px\" />\n{% endnote %}\n\n<!-- endtab -->\n{% endtabs %}\n\n\næ›´å¤šèµ„è®¯: [Deployment](https://hexo.io/docs/deployment.html)\n","content":"<h3 id=\"æ¸¸æˆèƒŒæ™¯ä»‹ç»\"><a href=\"#æ¸¸æˆèƒŒæ™¯ä»‹ç»\" class=\"headerlink\" title=\"æ¸¸æˆèƒŒæ™¯ä»‹ç»\"></a>æ¸¸æˆèƒŒæ™¯ä»‹ç»</h3><p>é¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·å¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚<br><a id=\"more\"></a><br>ä¸‰æ•™ä¸»ç§‰æ‰¿å¸ˆçˆ¶é¸¿é’§ä¸Šäººæ•™è¯²ï¼Œå¹¿æ”¶é—¨å¾’å°†é“æ•™æµä¼ äºä¸–ã€‚åªå› å…¥é“é—¨ä¸­å³å¯ä¿®ä»™ï¼Œä½¿äººè·³å‡ºä¸‰ç•Œä¹‹å¤–ï¼Œä¸åœ¨äº”è¡Œä¹‹ä¸­ï¼Œå…é™¤ç”Ÿæ­»è½®å›ä¹‹è‹¦ï¼Œä½¿å¾—å…¥é“ä¿®è¡Œä¹‹äººå¤šä¸èƒœæ•°ã€‚ä½†ä¿®ä»™ä¹‹é“å¹¶éè‹¦å¿ƒä¿®ç‚¼ä¾¿å¯è¾¾æˆï¼Œä¿®è¡Œè·¯ä¸Šï¼Œå‡è¦ç»å†ä¸‰ç™¾å¹´ä¸€å°åŠ«ï¼Œä¸€åƒäº”ç™¾å¹´ä¸€å¤§åŠ«çš„åŠ«æ•°ã€‚ä¿®è¡Œä¹‹äººå‡æ— æ³•é¿å¼€åŠ«æ•°ï¼Œåªèƒ½æ ¹æ®è‡ªèº«é“è¡Œçš„æ·±æµ…å»ç»å†åŠ«æ•°ã€‚å€¼å•†å‘¨ä¸¤æœäº¤æ›¿ä¹‹æ—¶ï¼Œæ°é€¢ä¿®ä»™ä¸€åƒäº”ç™¾å¹´ä»™åŠ«ï¼Œäºæ˜¯ä¸‰æ•™ä¸»å…±è®®å°ç¥æ¦œï¼Œä»¥è§‚ä¼—ä»™æ ¹è¡Œæµ…æ·±ã€‚ç„¶åŠ«æ•°éš¾é€ƒï¼Œå°ç¥ä¸€å½¹ï¼Œè‡´ä½¿é“é—¨å†…éƒ¨é˜æ•™å’Œæˆªæ•™ä¸å’Œï¼Œä¿®ä»™ä¼—äººä¿±é­å± æˆ®ï¼Œæ›´å¼•æ¥è¥¿æ–¹æ•™æ´¾å‚ä¸çº·äº‰ï¼Œåå› é¸¿é’§ä¸Šäººäº²è‡ªå‡ºé¢è°ƒåœï¼Œç»ˆå¾—ä»¥å¹³æ¯ã€‚é€šå¤©æ•™ä¸»è¢«é¸¿é’§ä¸Šäººç¦åˆ¶åœ¨ç´«éœ„å®«æ˜†ä»‘ä¹‹é¢ ä¿®è¡Œæ€è¿‡ã€‚<br>æ—¶å…‰å¦‚æ¢­ï¼Œè½¬çœ¼å·²è¿‡åƒå¹´ï¼Œå¸ˆå°Šé¸¿é’§ä¸Šäººå¤–å‡ºäº‘æ¸¸ï¼Œä¸çŸ¥æ‰€è¸ªã€‚è€Œé€šå¤©ä»¿ä½›å·²ç»ä¹ æƒ¯äº†è¿™ç§è¢«ç¦å›ºçš„ç”Ÿæ´»ï¼Œé™¤äº†æ¯æ—¥çš„å¿…åšçš„ä¿®çœŸç‚¼æ°”å’Œé™è¯µã€Šé»„åº­ã€‹ï¼Œä»–æ›´å¤šçš„æ—¶é—´æ€»æ˜¯åœ¨æ–­å´–è¾¹é™é™åç€ã€‚ä¹Ÿè®¸åªæœ‰è¿™ä¸ªæ—¶åˆ»ï¼Œä»–æ‰èƒ½çœŸçœŸå®å®åœ°æ„Ÿè§‰åˆ°è‡ªå·±çš„å­˜åœ¨ï¼Œåƒå¹´çš„è‹¦è¡Œä½¿ä»–çš„ä¿®ä¸ºå€å¢ï¼ŒåŒæ—¶ä¹Ÿè®©ä»–é¥±å—äº†å­¤å•å’Œå¯‚å¯ï¼Œä»–å·²ç»å¾ˆä¹…æ²¡æœ‰è¯´è¿‡ä¸€å¥è¯äº†ï¼Œå¾ˆä¹…æ˜¯å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–åªçŸ¥é“ä»–åœ¨ç­‰ï¼Œä»–ä»¬éƒ½åœ¨ç­‰ã€‚.<br>ç©ºæ—·çš„æ–­å´–è¾¹ï¼Œä¸€ä¸ªäººå½±ä¼«ç«‹ï¼Œè‰¯ä¹…ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚å±±é£åŠ²è¢­ï¼ŒäººçŠ¹å¦‚ä¸å±±æµ‘ç„¶ä¸€ä½“ï¼Œä»æ˜¯ä¸€åŠ¨ä¸åŠ¨ï¼Œåšæ¯…çš„é¢å®¹æ¯«æ— è¡¨æƒ…ï¼Œåªæœ‰æ˜äº®çš„åŒçœ¸åœ¨é»‘å¤œå°è¡¬ä¸‹å¯’å…‰é—ªç°ï¼Œçœºæœ›ç€è¿œæ–¹ã€‚è¿œå¤„ï¼Œéª·é«…å±±é¡¶ï¼Œä¸€å—é¡½çŸ³å¥½è±¡åŠ¨äº†ä¸€åŠ¨ï¼ŒåˆåŠ¨äº†ä¸€åŠ¨ï¼Œä»¿ä½›æœ‰äº†å‘¼å¸ã€‚æ…¢æ…¢åœ°ï¼Œé¡½çŸ³å‘¨å›´ç«Ÿç„¶å¿½éšå¿½ç°å‡ºç€ç„é»„è‰²çš„å…‰èŠ’ï¼Œæœ€ç»ˆå¹»åŒ–ä¸ºä¸€ä¸ªäººå½¢çš„å…‰å›¢ï¼Œç¼“ç¼“é£˜å‘å±±åçš„å¹½å†¥æ¶§ã€‚æ­¤æ—¶ï¼Œäººå½±çš„è‹ç™½é¢å®¹ä¸Šæµ®ç°å‡ºå¥‡æ€ªçš„ç¬‘æ„ï¼Œä»¤äººä¸å¯’è€Œæ —ï¼Œä»–æ˜¯é€šå¤©ã€‚<br>äº”ç™¾å¹´åçš„ä¸­æ´²å¤§é™†ã€‚<br>åœ¨ä¸œæµ·æ¸”æ‘ï¼Œä¸–ä¸–ä»£ä»£ä»¥æ•é±¼ä¸ºç”Ÿçš„æ¸”æ°‘æœ‰ä¸€å¤©çªç„¶å‘ç°ç¦»ä»–ä»¬æ‘å­ä¸è¿œçš„æµ·é¢ä¸Šï¼Œç«Ÿç„¶å‡ºç°ä¸€ä¸ªå¼‚å¸¸ç¾ä¸½çš„ä»™å²›ã€‚<br>åœ¨å¤©å¢‰åŸï¼Œç†™ç†™æ”˜æ”˜åœ°è¡—é“ä¸Šçªç„¶å¤šäº†ä¸€äº›èº«ç€å¥‡è£…å¥‡æœï¼Œè¡Œä¸ºä¸¾æ­¢ååˆ†å¯ç–‘ä¹‹äººã€‚<br>åœ¨æ½ä»™é•‡ï¼Œä¸€ä¸ªå¹³å‡¡å†·æ¸…çš„å°é•‡ä¸Šçªç„¶é—´çƒ­é—¹äº†èµ·æ¥ï¼Œä»å››é¢å…«æ–¹èµ¶æ¥çš„ä¿Šç”·ç¾å¥³ç»œç»ä¸ç»ã€‚<br>æœ¬æ¥å¹³é™çš„ã€Šé—®é“ã€‹ä¸–ç•Œä¸­å‡ºç°å„ç§å¼‚è±¡å’Œå¾å…†ï¼Œè€Œæ­¤æ—¶ï¼Œå‡†å¤‡ä¸€æ¢ç©¶ç«Ÿçš„ç©å®¶ï¼Œæ­£èµ¶å¾€æ½ä»™é•‡çš„é€”ä¸­ã€‚ [1]</p><h3 id=\"æˆªå›¾\"><a href=\"#æˆªå›¾\" class=\"headerlink\" title=\"æˆªå›¾\"></a>æˆªå›¾</h3><p><img src=\"é—®é“/../261557566768_.pic_hd.jpg\" alt=\"\"></p><h3 id=\"ä¸‹è½½\"><a href=\"#ä¸‹è½½\" class=\"headerlink\" title=\"ä¸‹è½½\"></a>ä¸‹è½½</h3><div class=\"tabs\" id=\"fourth-unique-name\"><ul class=\"nav-tabs\"><li class=\"tab active\"><a href=\"#fourth-unique-name-1\">å®¢æˆ·ç«¯ä¸‹è½½</a></li><li class=\"tab\"><a href=\"#fourth-unique-name-2\">ç™»å½•å™¨ä¸‹è½½</a></li></ul><div class=\"tab-content\"><div class=\"tab-pane active\" id=\"fourth-unique-name-1\"><div class=\"note success\"><br><p>ç›®å‰åªæä¾›1.60.0905ç‰ˆæœ¬å®¢æˆ·ç«¯ç™¾åº¦äº‘ä¸‹è½½é“¾æ¥ğŸ”—<br><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMXJzZFM2b2l1QXhvWXI1d1hlWnIyMkE=\" title=\"kq7m\"><i class=\"fa fa-edge\"></i>ç™¾åº¦äº‘<i class=\"fa fa-external-link\"></i></span><br><a class=\"btn\" href=\"#\">å¯†ç (kq7m)</a></p><br></div></div><div class=\"tab-pane\" id=\"fourth-unique-name-2\"><div class=\"note warning\"><br><p>ä¸ç‰ˆæœ¬å¯¹åº”çš„ç™»å½•å™¨ï¼ŒæœåŠ¡å™¨ä¸ºå…¬ç›Šæœï¼Œä¸åšä»»ä½•ç›ˆåˆ©å’Œä¸å…·å¤‡å•†ä¸šæ€§è´¨ï¼<br>é“¾æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMVJONFZYM2JPd0g2MXhDNzB0ODJkTXc=\" title=\"https://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMw\">https://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMw<i class=\"fa fa-external-link\"></i></span><br>æå–ç ï¼š<em>**</em><br>å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p><p><img src=\"é—®é“/../281557578598_.pic_hd.jpg\" width=\"100px\" height=\"100px\"></p><br></div></div></div></div><p>æ›´å¤šèµ„è®¯: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZGVwbG95bWVudC5odG1s\" title=\"https://hexo.io/docs/deployment.html\">Deployment<i class=\"fa fa-external-link\"></i></span></p>","slug":"é—®é“","updated":"2019-05-23T12:33:08.384Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/a3b6fe04/","excerpt":"æ¸¸æˆèƒŒæ™¯ä»‹ç»é¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·å¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚","categories":[{"name":"PC","slug":"PC","permalink":"https://shuntan.github.io/categories/PC/"}],"tags":[{"name":"online","slug":"online","permalink":"https://shuntan.github.io/tags/online/"},{"name":"game","slug":"game","permalink":"https://shuntan.github.io/tags/game/"}]},{"title":"Hello World","date":"2018-10-24T14:19:55.904Z","path":"posts/4a17b156/","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.Quick StartCreate a new post1$ hexo new \"My New Post\"More info: WritingRun server1$ hexo serverMore info: ServerGenerate static files1$ hexo generateMore info: GeneratingDeploy to remote sites1$ hexo deployæ›´å¤šèµ„è®¯: Deployment","raw":"---\ntitle: Hello World\ncategories:\n  - Diary\ntags:\n  - Diary\nabbrlink: 4a17b156\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n<!--more-->\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\næ›´å¤šèµ„è®¯: [Deployment](https://hexo.io/docs/deployment.html)\n","content":"<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\" title=\"https://hexo.io/\">Hexo<i class=\"fa fa-external-link\"></i></span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\" title=\"https://hexo.io/docs/\">documentation<i class=\"fa fa-external-link\"></i></span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\" title=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting<i class=\"fa fa-external-link\"></i></span> or you can ask me on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==\" title=\"https://github.com/hexojs/hexo/issues\">GitHub<i class=\"fa fa-external-link\"></i></span>.</p><a id=\"more\"></a><h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">\"My New Post\"</span></span><br></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\" title=\"https://hexo.io/docs/writing.html\">Writing<i class=\"fa fa-external-link\"></i></span></p><h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\" title=\"https://hexo.io/docs/server.html\">Server<i class=\"fa fa-external-link\"></i></span></p><h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\" title=\"https://hexo.io/docs/generating.html\">Generating<i class=\"fa fa-external-link\"></i></span></p><h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure><p>æ›´å¤šèµ„è®¯: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZGVwbG95bWVudC5odG1s\" title=\"https://hexo.io/docs/deployment.html\">Deployment<i class=\"fa fa-external-link\"></i></span></p>","slug":"hello-world","updated":"2019-05-23T12:33:08.388Z","comments":true,"link":"","permalink":"https://shuntan.github.io/posts/4a17b156/","excerpt":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.","categories":[{"name":"Diary","slug":"Diary","permalink":"https://shuntan.github.io/categories/Diary/"}],"tags":[{"name":"Diary","slug":"Diary","permalink":"https://shuntan.github.io/tags/Diary/"}]}]}
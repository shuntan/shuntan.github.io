<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æ¨¡ç‰ˆå…ƒç¼–ç¨‹åº”ç”¨]]></title>
    <url>%2Fposts%2F5f8019f8%2F</url>
    <content type="text"><![CDATA[1.æ¦‚è¿° å…³äºŽC++11æ¨¡æ¿å…ƒçš„åŸºæœ¬ç”¨æ³•å’Œå¸¸ç”¨æŠ€å·§ï¼Œåœ¨å¸¸è§„ç¼–ç¨‹ä¸­å¯èƒ½å¾ˆå°‘é‡åˆ°ï¼Œé‚£ä¹ˆC++11æ¨¡ç‰ˆå…ƒç¼–ç¨‹ç”¨æ¥è§£å†³ä»€ä¹ˆå®žé™…é—®é¢˜å‘¢ï¼Œåœ¨å®žé™…å·¥ç¨‹ä¸­åˆè¯¥å¦‚ä½•åº”ç”¨å‘¢ï¼Ÿæœ¬æ–‡å°†ä¾§é‡ä»‹ç»C++11æ¨¡æ¿çš„ä¸€äº›å…·ä½“åº”ç”¨ï¼Œå‘è¯»è€…å±•ç¤ºæ¨¡ç‰ˆå…ƒç¼–ç¨‹çš„å…·ä½“åº”ç”¨ã€‚ æˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•é€šè¿‡C++11æ¨¡ç‰ˆå…ƒæ¥å®žçŽ°function_traitsã€Vairantç±»åž‹å’Œæ³›åž‹bindç»‘å®šå™¨ã€‚function_traitsä¾§é‡äºŽå¦‚ä½•èƒå–å¯è°ƒç”¨å¯¹è±¡çš„ä¸€äº›å…ƒä¿¡æ¯ï¼ŒVariantåˆ™æ˜¯ä¸€ç§èƒ½æŽ¥å—å¤šç§ç±»åž‹æ•°æ®çš„â€œä¸‡èƒ½â€ç±»åž‹ï¼Œbindåˆ™æ˜¯ä¸€ä¸ªæ³›åŒ–çš„ç»‘å®šå™¨ï¼Œä¸‹é¢æ¥çœ‹çœ‹è¿™äº›å…·ä½“çš„ä¾‹å­ã€‚ç±»åž‹èƒå– C++æ¨¡æ¿ä¸­çš„ç±»åž‹å‚æ•°Tæ˜¯æŠ½è±¡çš„ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½åœ¨æ¨¡æ¿å†…éƒ¨ç›´æŽ¥èŽ·å¾—å®ƒçš„å…·ä½“ç‰¹å¾ã€‚ç±»åž‹èƒå–ï¼ˆæŠ½å–ï¼‰æŠ€æœ¯å°±æ˜¯è¦æŠ½å–ç±»åž‹çš„ä¸€äº›å…·ä½“ç‰¹å¾(trait)ï¼Œæ¯”å¦‚å®ƒæ˜¯å“ªç§å…·ä½“ç±»åž‹ï¼Œå®ƒæ˜¯å¼•ç”¨ç±»åž‹ï¼Œå†…å»ºç±»åž‹ï¼Œè¿˜æ˜¯ç±»ç±»åž‹ç­‰ã€‚å¯è§ï¼Œç±»åž‹èƒå–æŠ€æœ¯å…¶å®žå°±æ˜¯traitæ¨¡æ¿æŠ€æœ¯çš„å…·ä½“ä½“çŽ°ã€‚èŽ·å–ç±»åž‹çš„å…·ä½“ç‰¹å¾åœ¨Javaã€C#ç­‰è¯­è¨€ä¸­ä¹Ÿç§°ä¸ºåå°„(reflection)ï¼ŒC++ä¸­é€šè¿‡æ¨¡æ¿æŠ€æœ¯ä¹Ÿå¯ä»¥å®žçŽ°ä¸€å®šçš„åå°„è¡Œä¸ºã€‚ ç±»åž‹ä¿¡æ¯æ˜¯ç¼–è¯‘æœŸçš„å®žä½“ï¼ŒçŽ°åœ¨è¦é’ˆå¯¹ç±»åž‹æ¥è¿›è¡Œç¼–ç¨‹ï¼Œè¿™å…¶å®žå°±æ˜¯æ¨¡æ¿å…ƒç¼–ç¨‹çš„ä¸€ä¸ªæ–¹é¢ã€‚æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„if/elseï¼Œwhileï¼Œforç­‰åŸºæœ¬çš„é€»è¾‘ç»“æž„éƒ½æ˜¯è¿è¡ŒæœŸçš„è¡Œä¸ºï¼Œåœ¨é¢å‘ç±»åž‹çš„ç¼–ç¨‹ä¸­å¹¶ä¸èƒ½ä½¿ç”¨ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°ä¸€äº›ç‰¹æ®Šçš„æ¨¡æ¿æŠ€æœ¯ã€‚å®žçŽ°ç±»åž‹èƒå–è¦ç”¨åˆ°çš„åŸºæœ¬æ€æƒ³ä¸€ä¸ªæ˜¯ç‰¹åŒ–ï¼Œä¸€ä¸ªå°±æ˜¯ç”¨typedefæ¥æºå¸¦ç±»åž‹ä¿¡æ¯ã€‚å®žé™…ä¸Šï¼Œæˆ‘ä»¬åœ¨ç”¨æ¨¡æ¿åšè®¾è®¡æ—¶ï¼Œä¸€èˆ¬å»ºè®®åœ¨æ¨¡æ¿å®šä¹‰å†…éƒ¨ï¼Œä¸ºæ¨¡æ¿çš„æ¯ä¸ªç±»åž‹å‚æ•°æä¾›typedefå®šä¹‰ï¼Œè¿™æ ·åœ¨æ³›åž‹ä»£ç ä¸­å¯ä»¥å¾ˆå®¹æ˜“åœ°è®¿é—®æˆ–æŠ½å–è¿™äº›ç±»åž‹ã€‚ åœ¨Cå’ŒC++ä¸­ï¼Œæ™®é€šçš„å‡½æ•°å¯ä»¥ç§°ä¸ºå€¼å‡½æ•°ï¼Œå®ƒä»¬æŽ¥å—çš„å‚æ•°æ˜¯æŸäº›å€¼ï¼Œè¿”å›žçš„ç»“æžœä¹Ÿæ˜¯å€¼ã€‚è€Œæ‰€è°“çš„ç±»åž‹å‡½æ•°æŽ¥å—çš„å®žå‚æ˜¯ç±»åž‹ï¼Œè¿”å›žçš„æ˜¯è¢«æŠ½å–å‡ºæ¥çš„ç±»åž‹æˆ–å¸¸é‡å€¼ç­‰ï¼ˆå³ç”¨typedefå®šä¹‰çš„ç±»åž‹åˆ«åï¼Œä¸€èˆ¬ä¸åŒçš„å…·ä½“ç±»åž‹éƒ½å®šä¹‰ç»Ÿä¸€çš„åˆ«åï¼‰ã€‚å¦‚ç±»æ¨¡æ¿å°±æ˜¯ç±»åž‹å‡½æ•°ï¼Œsizeofæ˜¯å†…å»ºçš„ç±»åž‹å‡½æ•°ï¼Œè¿”å›žç»™å®šç±»åž‹å®žå‚çš„å¤§å°ã€‚åœ¨ç±»åž‹ç¼–ç¨‹ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½è¦ç”¨åˆ°sizeofã€‚//ä¸‹é¢æ¼”ç¤ºä¸€äº›æœ‰ç”¨çš„ç±»åž‹èƒå–å®žçŽ°ï¼Œè¿™äº›éƒ½æ˜¯ç±»åž‹å‡½æ•°ã€‚2.function_traits function_traitsç”¨æ¥èŽ·å–å‡½æ•°è¯­ä¹‰çš„å¯è°ƒç”¨å¯¹è±¡çš„ä¸€äº›å±žæ€§ï¼Œæ¯”å¦‚å‡½æ•°ç±»åž‹ã€è¿”å›žç±»åž‹ã€å‡½æ•°æŒ‡é’ˆç±»åž‹å’Œå‚æ•°ç±»åž‹ç­‰ã€‚ä¸‹é¢æ¥çœ‹çœ‹å¦‚ä½•å®žçŽ°function_traitsã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960#include &lt;iostream&gt;#include &lt;functional&gt;template&lt;typename T&gt;struct function_traits;//æ™®é€šå‡½æ•°èƒå–template&lt;typename Ret, typename... Args&gt;struct function_traits&lt;Ret(Args...)&gt;&#123;public: enum &#123; arity = sizeof...(Args) &#125;; typedef Ret function_type(Args...); typedef Ret return_type; using stl_function_type = std::function&lt;function_type&gt;; typedef Ret(*pointer)(Args...); template&lt;size_t I&gt; struct args &#123; static_assert(I &lt; arity, "index is out of range, index must less than sizeof Args"); using type = typename std::tuple_element&lt;I, std::tuple&lt;Args...&gt;&gt;::type; &#125;;&#125;;//ç±»å‡½æ•°èƒå–template&lt;typename Ret, typename Class, typename... Args&gt;struct function_traits&lt;Ret(Class::*) (Args...)&gt;&#123;public: enum &#123; arity = sizeof...(Args) &#125;; typedef Ret function_type(Args...); typedef Ret return_type; using stl_function_type = std::function&lt;function_type&gt;; typedef Ret(Class::* pointer)(Args...); typedef Class class_type; template&lt;size_t I&gt; struct args &#123; static_assert(I &lt; arity, "index is out of range, index must less than sizeof Args"); using type = typename std::tuple_element&lt;I, std::tuple&lt;Args...&gt;&gt;::type; &#125;;&#125;;//å‡½æ•°æŒ‡é’ˆtemplate&lt;typename Ret, typename... Args&gt;struct function_traits&lt;Ret(*)(Args...)&gt; : function_traits&lt;Ret(Args...)&gt; &#123;&#125;;//std::functiontemplate &lt;typename Ret, typename... Args&gt;struct function_traits&lt;std::function&lt;Ret(Args...)&gt;&gt; : function_traits&lt;Ret(Args...)&gt; &#123;&#125;;//member functiontemplate &lt;typename ReturnType, typename ClassType, typename... Args&gt;struct function_traits&lt;ReturnType(ClassType::*)(Args...) const&gt; : function_traits&lt;ReturnType(ClassType::*)(Args...)&gt; &#123;&#125;;//å‡½æ•°å¯¹è±¡template&lt;typename Callable&gt;struct function_traits : function_traits&lt;decltype(&amp;Callable::operator())&gt; &#123;&#125;;ç”±äºŽå¯è°ƒç”¨å¯¹è±¡å¯èƒ½æ˜¯æ™®é€šçš„å‡½æ•°ã€å‡½æ•°æŒ‡é’ˆã€lambdaã€std::functionå’Œæˆå‘˜å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹è¿™äº›ç±»åž‹åˆ†åˆ«åšåç‰¹åŒ–ï¼Œç„¶åŽèƒå–å‡ºå¯è°ƒç”¨å¯¹è±¡çš„å…ƒä¿¡æ¯ã€‚å…¶ä¸­ï¼Œæˆå‘˜å‡½æ•°çš„åç‰¹åŒ–ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºæ¶‰åŠåˆ°cvç¬¦çš„å¤„ç†ï¼Œè¿™é‡Œé€šè¿‡å®šä¹‰ä¸€ä¸ªå®æ¥æ¶ˆé™¤é‡å¤çš„æ¨¡æ¿ç±»å®šä¹‰ã€‚å‚æ•°ç±»åž‹çš„èŽ·å–æˆ‘ä»¬æ˜¯å€ŸåŠ©äºŽtupleï¼Œå°†å‚æ•°è½¬æ¢ä¸ºtupleç±»åž‹ï¼Œç„¶åŽæ ¹æ®ç´¢å¼•æ¥èŽ·å–å¯¹åº”ç±»åž‹ã€‚å®ƒçš„ç”¨æ³•æ¯”è¾ƒç®€å•ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344//ç±»å‡½æ•°struct S&#123; inline void fun(const char*) &#123;&#125;;&#125;;//æ™®é€šå‡½æ•°double fun() &#123; return 0.1; &#125;;template&lt;typename T&gt;void PrintType()&#123; std::cout &lt;&lt; typeid(T).name() &lt;&lt; std::endl;&#125;int main()&#123; void (S::* cfptr)(const char*) = &amp;S::fun; // class fnptr double (*fptr)() = fun; //fnptr std::function&lt;int(int)&gt; f = [](int a) &#123;return a; &#125;; //function auto lambda = [](int a) &#123;return a; &#125;; // lambda //æ‰“å°å‡½æ•°ç±»åž‹ PrintType&lt;function_traits&lt;decltype(fptr)&gt;::function_type&gt;(); //å°†è¾“å‡ºdouble __cdecl&lt;void&gt; //æ‰“å°ç±»å‡½æ•°æŒ‡é’ˆç±»åž‹ PrintType&lt;function_traits&lt;decltype(&amp;cfptr)&gt;::pointer&gt;(); //å°†è¾“å‡ºvoid &lt;__thiscall S::*&gt;&lt;char const *&gt; //æ‰“å°å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç±»åž‹ PrintType&lt;function_traits&lt;std::function&lt;int(bool)&gt;&gt;::args&lt;0&gt;::type&gt;();//å°†è¾“å‡ºbool //æ‰“å°å‡½æ•°çš„è¿”å›žç±»åž‹ PrintType&lt;function_traits&lt;decltype(f)&gt;::return_type&gt;(); //å°†è¾“å‡ºint //æ‰“å°å‡½æ•°æŒ‡é’ˆç±»åž‹ PrintType&lt;function_traits&lt;decltype(f)&gt;::pointer&gt;(); //å°†è¾“å‡ºint &lt;__cdecl*&gt;&lt;int&gt; //æ‰“å°functionå‡½æ•°ç±»åž‹ PrintType&lt;function_traits&lt;decltype(f)&gt;::stl_function_type&gt;(); //å°†è¾“å‡ºclass std::function&lt;int __cdecl&lt;int&gt;&gt; //lambda =&gt; éšå¼è½¬åŒ–ä¸ºäº†åŒ¿åç±»å¯¹è±¡ PrintType&lt;function_traits&lt;decltype(lambda)&gt;::class_type&gt;(); //å°†è¾“å‡ºclass &lt;lambda_13vr3tgewf32rt23rfgt435g41239da&gt;&#125;gun gccä¸‹ï¼š1234567FdvEbiPFiiESt8functionIFiiEEZ4mainEUliE0_M1SFvPKcEVisual studioä¸‹ï¼š1234567double __cdecl(void)void (__thiscall S::*)(char const *)boolintint (__cdecl*)(int)class std::function&lt;int __cdecl(int)&gt;class &lt;lambda_173ed6f42b6e4df55bf9ec2e4778d93a&gt;å…¶å®žç»“æžœæ˜¯ä¸€æ ·çš„ï¼Œè‡³äºŽä¸ºä»€ä¹ˆå¯ä»¥å‚è€ƒè¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªfunction_traitsé€šè¿‡ç±»åž‹èƒå–ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°èŽ·å–å¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ã€std::functionå’Œlambdaè¡¨è¾¾å¼ï¼‰çš„ä¸€äº›å…ƒä¿¡æ¯ï¼ŒåŠŸèƒ½éžå¸¸å¼ºå¤§ï¼Œè¿™ä¸ªfunction_traitsç»å¸¸ä¼šç”¨åˆ°æ˜¯æ›´é«˜å±‚æ¨¡ç‰ˆå…ƒç¨‹åºçš„åŸºç¡€ã€‚æ¯”å¦‚Variantç±»åž‹çš„å®žçŽ°å°±è¦ç”¨åˆ°è¿™ä¸ªfunction_traitsï¼Œä¸‹é¢æ¥çœ‹çœ‹Variantçš„å®žçŽ°ã€‚3.Variant å€ŸåŠ©ä¸Šé¢çš„function_traitså’Œå‰æ–‡å®žçŽ°çš„ä¸€äº›å…ƒå‡½æ•°ï¼Œæˆ‘ä»¬å°±èƒ½æ–¹ä¾¿çš„å®žçŽ°ä¸€ä¸ªâ€œä¸‡èƒ½ç±»åž‹â€â€”Variantï¼ŒVariantå®žé™…ä¸Šä¸€ä¸ªæ³›åŒ–çš„ç±»åž‹ï¼Œè¿™ä¸ªVariantå’Œboost.variantçš„ç”¨æ³•ç±»ä¼¼ï¼Œéœ€è¦é¢„å®šä¹‰ä¸€äº›ç±»åž‹ä½œä¸ºå¯æŽ¥å—çš„ç±»åž‹ã€‚boost.variantçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š1234typedef variant&lt;int,char, double&gt; vt;vt v = 1;v = 'a';v = 12.32; è¿™ä¸ªvariantå¯ä»¥æŽ¥å—å·²ç»å®šä¹‰çš„é‚£äº›ç±»åž‹ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹ç±»ä¼¼äºŽc#å’Œjavaä¸­çš„objectç±»åž‹ï¼Œå®žé™…ä¸Švariantæ˜¯æ“¦é™¤äº†ç±»åž‹ï¼Œè¦èŽ·å–å®ƒçš„å®žé™…ç±»åž‹çš„æ—¶å€™å°±ç¨æ˜¾éº»çƒ¦ï¼Œéœ€è¦é€šè¿‡boost.visitoræ¥è®¿é—®ï¼š12345678910111213141516171819202122232425struct VariantVisitor : public boost::static_visitor&lt;void&gt;&#123; void operator() (int a) &#123; cout &lt;&lt; "int" &lt;&lt; endl; &#125; void operator() (short val) &#123; cout &lt;&lt; "short" &lt;&lt; endl; &#125; void operator() (double val) &#123; cout &lt;&lt; "double" &lt;&lt; endl; &#125; void operator() (std::string val) &#123; cout &lt;&lt; "string" &lt;&lt; endl; &#125;&#125;;boost::variant&lt;int,short,double,std::string&gt; v = 1;boost::apply_visitor(visitor, v); //å°†è¾“å‡ºintâ€‹ é€šè¿‡C++11æ¨¡ç‰ˆå…ƒå®žçŽ°çš„Variantå°†æ”¹è¿›å€¼çš„èŽ·å–ï¼Œå°†èŽ·å–å®žé™…å€¼çš„æ–¹å¼æ”¹ä¸ºå†…ç½®çš„ï¼Œå³é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥è®¿é—®ï¼š123typedef Variant&lt;int, double, string, int&gt; cv;cv v = 10;v.Visit([&amp;](double i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;, [](short i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;, [=](int i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;,[](const string&amp; i)&#123;cout &lt;&lt; i &lt;&lt; endl; &#125;);//ç»“æžœå°†è¾“å‡º10 è¿™ç§æ–¹å¼æ›´æ–¹ä¾¿ç›´è§‚ã€‚Variantçš„å®žçŽ°éœ€è¦å€ŸåŠ©å‰æ–‡ä¸­å®žçŽ°çš„ä¸€äº›å…ƒå‡½æ•°MaxIntegerã€MaxAlignã€Containså’ŒAtç­‰ç­‰ã€‚å¯ä»¥åœ¨ä¸‹é¢çš„tabä¸­å±•å¼€è§‚çœ‹ï¼Œä¸‹é¢æ¥çœ‹çœ‹Variantå®žçŽ°çš„å…³é”®ä»£ç ã€‚IntegerMaxä»£ç ï¼š1234567891011121314/** èŽ·å–æ•´æ•°åˆ—è¡¨ä¸­æœ€å¤§çš„æ•´æ•° */template &lt;std::size_t arg, std::size_t... rest&gt;struct IntegerMax;template &lt;std::size_t arg&gt;struct IntegerMax&lt;arg&gt; : std::integral_constant&lt;std::size_t, arg&gt;&#123;&#125;;template &lt;std::size_t arg1, std::size_t arg2, std::size_t... rest&gt;struct IntegerMax&lt;arg1, arg2, rest...&gt; : std::integral_constant&lt;std::size_t, arg1 &gt;= arg2 ? IntegerMax&lt;arg1, rest...&gt;::value : IntegerMax&lt;arg2, rest...&gt;::value&gt;&#123;&#125;;MaxAlignä»£ç ï¼š12345/** èŽ·å–æœ€å¤§çš„align */template&lt;typename... Args&gt;struct MaxAlign : std::integral_constant&lt;int, IntegerMax&lt;std::alignment_of&lt;Args&gt;::value...&gt;::value&gt;&#123;&#125;;Containsä»£ç ï¼š1234567891011121314/** æ˜¯å¦åŒ…å«æŸä¸ªç±»åž‹ */template &lt;typename T, typename... List&gt;struct Contains;template &lt;typename T, typename Head, typename... Rest&gt;struct Contains&lt;T, Head, Rest...&gt; : std::conditional&lt;std::is_same&lt;T, Head&gt;::value, std::true_type, Contains&lt;T, Rest... &gt;&gt; ::type&#123;&#125;;template &lt;typename T&gt;struct Contains&lt;T&gt; : std::false_type&#123;&#125;;IndexOfä»£ç ï¼š1234567891011121314151617181920template &lt;typename T, typename... List&gt;struct IndexOf;template &lt;typename T, typename Head, typename... Rest&gt;struct IndexOf&lt;T, Head, Rest...&gt;&#123; enum &#123; value = IndexOf&lt;T, Rest...&gt;::value + 1 &#125;;&#125;;template &lt;typename T, typename... Rest&gt;struct IndexOf&lt;T, T, Rest...&gt;&#123; enum &#123; value = 0 &#125;;&#125;;template &lt;typename T&gt;struct IndexOf&lt;T&gt;&#123; enum&#123;value = -1&#125;;&#125;;Atä»£ç ï¼š1234567891011121314template&lt;int index, typename... Types&gt;struct At;template&lt;int index, typename First, typename... Types&gt;struct At&lt;index, First, Types...&gt;&#123; using type = typename At&lt;index - 1, Types...&gt;::type;&#125;;template&lt;typename T, typename... Types&gt;struct At&lt;0, T, Types...&gt;&#123; using type = T;&#125;;Variantå…³é”®ä»£ç ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697template&lt;typename... Types&gt;class Variant&#123; enum&#123; data_size = IntegerMax&lt;sizeof(Types)...&gt;::value, //å‚æ•°ä¸ªæ•° align_size = MaxAlign&lt;Types...&gt;::value //å‚æ•°æœ€å¤§å­—èŠ‚æ•° &#125;; using data_t = typename std::aligned_storage&lt;data_size, align_size&gt;::type;public: template&lt;int index&gt; using IndexType = typename At&lt;index, Types...&gt;::type; Variant(void) :m_typeIndex(typeid(void))&#123;&#125; ~Variant()&#123; Destroy(m_typeIndex, &amp;m_data); &#125; Variant(Variant&lt;Types...&gt;&amp;&amp; old) : m_typeIndex(old.m_typeIndex)&#123; Move(old.m_typeIndex, &amp;old.m_data, &amp;m_data); &#125; Variant(const Variant&lt;Types...&gt;&amp; old) : m_typeIndex(old.m_typeIndex)&#123; Copy(old.m_typeIndex, &amp;old.m_data, &amp;m_data); &#125; template &lt;class T, class = typename std::enable_if&lt;Contains&lt;typename std::remove_reference&lt;T&gt;::type, Types...&gt;::value&gt;::type&gt; Variant(T&amp;&amp; value) : m_typeIndex(typeid(void))&#123; Destroy(m_typeIndex, &amp;m_data); typedef typename std::remove_reference&lt;T&gt;::type U; new(&amp;m_data) U(std::forward&lt;T&gt;(value)); m_typeIndex = type_index(typeid(U)); &#125; template&lt;typename T&gt; bool Is() const&#123; return (m_typeIndex == type_index(typeid(T))); &#125; template&lt;typename T&gt; typename std::decay&lt;T&gt;::type&amp; Get()&#123; using U = typename std::decay&lt;T&gt;::type; if (!Is&lt;U&gt;()) &#123; cout &lt;&lt; typeid(U).name() &lt;&lt; " is not defined. " &lt;&lt; "current type is " &lt;&lt; m_typeIndex.name() &lt;&lt; endl; throw std::bad_cast(); &#125; return *(U*)(&amp;m_data); &#125; template&lt;typename F&gt; void Visit(F&amp;&amp; f)&#123; using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type; if (Is&lt;T&gt;()) f(Get&lt;T&gt;()); &#125; template&lt;typename F, typename... Rest&gt; void Visit(F&amp;&amp; f, Rest&amp;&amp;... rest)&#123; using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type; if (Is&lt;T&gt;()) Visit(std::forward&lt;F&gt;(f)); else Visit(std::forward&lt;Rest&gt;(rest)...); &#125;private: void Destroy(const type_index&amp; index, void * buf)&#123; std::initializer_list&lt;int&gt;&#123;(Destroy0&lt;Types&gt;(index, buf), 0)...&#125;; &#125; template&lt;typename T&gt; void Destroy0(const type_index&amp; id, void* data)&#123; if (id == type_index(typeid(T))) reinterpret_cast&lt;T*&gt;(data)-&gt;~T(); &#125; void Move(const type_index&amp; old_t, void* old_v, void* new_v) &#123; std::initializer_list&lt;int&gt;&#123;(Move0&lt;Types&gt;(old_t, old_v, new_v), 0)...&#125;; &#125; template&lt;typename T&gt; void Move0(const type_index&amp; old_t, void* old_v, void* new_v)&#123; if (old_t == type_index(typeid(T))) new (new_v)T(std::move(*reinterpret_cast&lt;T*&gt;(old_v))); &#125; void Copy(const type_index&amp; old_t, void* old_v, void* new_v)&#123; std::initializer_list&lt;int&gt;&#123;(Copy0&lt;Types&gt;(old_t, old_v, new_v), 0)...&#125;; &#125; template&lt;typename T&gt; void Copy0(const type_index&amp; old_t, void* old_v, void* new_v)&#123; if (old_t == type_index(typeid(T))) new (new_v)T(*reinterpret_cast&lt;const T*&gt;(old_v)); &#125;private: data_t m_data; std::type_index m_typeIndex;//ç±»åž‹ID&#125;; å®žçŽ°Varianté¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å†²åŒºç”¨æ¥å­˜æ”¾ä¸åŒçš„ç±»åž‹çš„å€¼ï¼Œè¿™ä¸ªç¼“ç±»åž‹å†²åŒºå®žé™…ä¸Šå°±æ˜¯ç”¨æ¥æ“¦é™¤ç±»åž‹ï¼Œä¸åŒçš„ç±»åž‹éƒ½é€šè¿‡placement newåœ¨è¿™ä¸ªç¼“å†²åŒºä¸Šåˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºç±»åž‹é•¿åº¦ä¸åŒï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘å†…å­˜å¯¹é½ï¼ŒC++11åˆšå¥½æä¾›äº†å†…å­˜å¯¹é½çš„ç¼“å†²åŒºaligned_storageï¼š12template&lt; std::size_t Len, std::size_t Align = /*default-alignment*/ &gt;struct aligned_storage;å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºçš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¼“å†²åŒºå†…å­˜å¯¹é½çš„å¤§å°ï¼Œç”±äºŽVaraintå¯ä»¥æŽ¥å—å¤šç§ç±»åž‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦èŽ·å–æœ€å¤§çš„ç±»åž‹é•¿åº¦ï¼Œä¿è¯ç¼“å†²åŒºè¶³å¤Ÿå¤§ï¼Œç„¶åŽè¿˜è¦èŽ·å–æœ€å¤§çš„å†…å­˜å¯¹é½å¤§å°ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡å‰é¢å®žçŽ°çš„MaxIntegerå’ŒMaxAlignå°±å¯ä»¥äº†ï¼ŒVaraintä¸­å†…å­˜å¯¹é½çš„ç¼“å†²åŒºå®šä¹‰å¦‚ä¸‹ï¼š1234567enum&#123; data_size = IntegerMax&lt;sizeof(Types)...&gt;::value, align_size = MaxAlign&lt;Types...&gt;::value&#125;;using data_t = typename std::aligned_storage&lt;data_size, align_size&gt;::type; //å†…å­˜å¯¹é½çš„ç¼“å†²åŒºç±»åž‹å…¶æ¬¡ï¼Œæˆ‘ä»¬è¿˜è¦å®žçŽ°å¯¹ç¼“å†²åŒºçš„æž„é€ ã€æ‹·è´ã€æžæž„å’Œç§»åŠ¨ï¼Œå› ä¸ºVarianté‡æ–°èµ‹å€¼çš„æ—¶å€™éœ€è¦å°†ç¼“å†²åŒºä¸­åŽŸæ¥çš„ç±»åž‹æžæž„æŽ‰ï¼Œæ‹·è´æž„é€ å’Œç§»åŠ¨æž„é€ æ—¶åˆ™éœ€è¦æ‹·è´å’Œç§»åŠ¨ã€‚è¿™é‡Œä»¥æžæž„ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å½“å‰çš„type_indexæ¥éåŽ†Variantçš„æ‰€æœ‰ç±»åž‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç±»åž‹ç„¶åŽè°ƒç”¨è¯¥ç±»åž‹çš„æžæž„å‡½æ•°ã€‚123456789101112 void Destroy(const type_index&amp; index, void * buf)&#123; std::initializer_list&lt;int&gt;&#123;(Destroy0&lt;Types&gt;(index, buf), 0)...&#125;; //è¿™é‡Œé€šè¿‡ä¸€ä¸ªåˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–ä¸€ä¸ªå˜é•¿æ•°ç»„ï¼Œintæ•°ç»„çš„ç›®çš„å°±æ˜¯ä¸ºäº†åœ¨æ•°ç»„æž„é€ çš„è¿‡ç¨‹å±•å¼€å‚æ•°åŒ…&#125;template&lt;typename T&gt;void Destroy0(const type_index&amp; id, void* data)&#123; if (id == type_index(typeid(T))) reinterpret_cast&lt;T*&gt;(data)-&gt;~T();&#125;è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨å’Œé€—å·è¡¨è¾¾å¼æ¥å±•å¼€å¯å˜æ¨¡æ¿å‚æ•°ï¼Œåœ¨å±•å¼€çš„è¿‡ç¨‹ä¸­æŸ¥æ‰¾å¯¹åº”çš„ç±»åž‹ï¼Œå¦‚æžœæ‰¾åˆ°äº†åˆ™æžæž„ã€‚åœ¨Variantæž„é€ æ—¶è¿˜éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼ŒVariantä¸èƒ½æŽ¥å—æ²¡æœ‰é¢„å…ˆå®šä¹‰çš„ç±»åž‹ï¼Œæ‰€ä»¥åœ¨æž„é€ Variantæ—¶ï¼Œéœ€è¦é™å®šç±»åž‹å¿…é¡»åœ¨é¢„å®šä¹‰çš„ç±»åž‹èŒƒå›´å½“ä¸­ï¼Œè¿™é‡Œé€šè¿‡type_traitsçš„enable_ifæ¥é™å®šæ¨¡æ¿å‚æ•°çš„ç±»åž‹ã€‚1234567template &lt;class T, class = typename std::enable_if&lt;Contains&lt;typename std::remove_reference&lt;T&gt;::type, Types...&gt;::value&gt;::type&gt; Variant(T&amp;&amp; value) : m_typeIndex(typeid(void))&#123; Destroy(m_typeIndex, &amp;m_data); typedef typename std::remove_reference&lt;T&gt;::type U; new(&amp;m_data) U(std::forward&lt;T&gt;(value)); m_typeIndex = type_index(typeid(U)); &#125;è¿™é‡Œenbale_ifçš„æ¡ä»¶å°±æ˜¯å‰é¢å®žçŽ°çš„å…ƒå‡½æ•°Containsçš„å€¼ï¼Œå½“æ²¡æœ‰åœ¨é¢„å®šä¹‰çš„ç±»åž‹ä¸­æ‰¾åˆ°å¯¹åº”çš„ç±»åž‹æ—¶ï¼Œå³Containsè¿”å›žfalseæ—¶ï¼Œç¼–è¯‘æœŸä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚æœ€åŽè¿˜éœ€è¦å®žçŽ°å†…ç½®çš„VistitåŠŸèƒ½ï¼ŒVisitçš„å®žçŽ°éœ€è¦å…ˆé€šè¿‡å®šä¹‰ä¸€ç³»åˆ—çš„è®¿é—®å‡½æ•°ï¼Œç„¶åŽå†éåŽ†è¿™äº›å‡½æ•°ï¼ŒéåŽ†è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ç±»åž‹çš„type_indexæ˜¯å¦ä¸Žå½“å‰çš„type_indexç›¸åŒï¼Œå¦‚æžœç›¸åŒåˆ™èŽ·å–å½“å‰ç±»åž‹çš„å€¼ã€‚123456789101112131415template&lt;typename F&gt; void Visit(F&amp;&amp; f)&#123; using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type; if (Is&lt;T&gt;()) f(Get&lt;T&gt;()); &#125; template&lt;typename F, typename... Rest&gt; void Visit(F&amp;&amp; f, Rest&amp;&amp;... rest)&#123; using T = typename Function_Traits&lt;F&gt;::template arg&lt;0&gt;::type; if (Is&lt;T&gt;()) Visit(std::forward&lt;F&gt;(f)); else Visit(std::forward&lt;Rest&gt;(rest)...); &#125; VisitåŠŸèƒ½çš„å®žçŽ°åˆ©ç”¨äº†å¯å˜æ¨¡æ¿å‚æ•°å’Œfunction_traitsï¼Œé€šè¿‡å¯å˜æ¨¡æ¿å‚æ•°æ¥éåŽ†ä¸€ç³»åˆ—çš„è®¿é—®å‡½æ•°ï¼ŒéåŽ†è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡function_traitsæ¥èŽ·å–ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»åž‹ï¼Œå’ŒVariantå½“å‰çš„type_indexç›¸åŒæ—¶åˆ™å–å€¼ã€‚ä¸ºä»€ä¹ˆè¦èŽ·å–è®¿é—®å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»åž‹å‘¢ï¼Ÿå› ä¸ºVariantçš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œåªæœ‰ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥èŽ·å–çš„è®¿é—®å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»åž‹å°±æ˜¯Variantä¸­å­˜å‚¨çš„å¯¹è±¡çš„å®žé™…ç±»åž‹ã€‚æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++ä¸­ä¼˜é›…çš„å¼‚æ­¥æ“ä½œ]]></title>
    <url>%2Fposts%2Fc02967a6%2F</url>
    <content type="text"><![CDATA[c++11ä¸­å¢žåŠ äº†çº¿ç¨‹ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥éžå¸¸æ–¹ä¾¿çš„åˆ›å»ºçº¿ç¨‹ï¼Œå®ƒçš„åŸºæœ¬ç”¨æ³•æ˜¯è¿™æ ·çš„ï¼š123void f(int n);std::thread t(f, n + 1);t.join(); ä½†æ˜¯çº¿ç¨‹æ¯•ç«Ÿæ˜¯å±žäºŽæ¯”è¾ƒä½Žå±‚æ¬¡çš„ä¸œè¥¿ï¼Œæœ‰æ—¶å€™ä½¿ç”¨æœ‰äº›ä¸ä¾¿ï¼Œæ¯”å¦‚æˆ‘å¸Œæœ›èŽ·å–çº¿ç¨‹å‡½æ•°çš„è¿”å›žç»“æžœçš„æ—¶å€™ï¼Œæˆ‘å°±ä¸èƒ½ç›´æŽ¥é€šè¿‡thread.join()å¾—åˆ°ç»“æžœï¼Œè¿™æ—¶å°±å¿…é¡»å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œåœ¨çº¿ç¨‹å‡½æ•°ä¸­åŽ»ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ï¼Œç„¶åŽjoin,æœ€åŽå¾—åˆ°ç»“æžœï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒç¹ççš„ã€‚c++11è¿˜æä¾›äº†å¼‚æ­¥æŽ¥å£std::asyncï¼Œé€šè¿‡è¿™ä¸ªå¼‚æ­¥æŽ¥å£å¯ä»¥å¾ˆæ–¹ä¾¿çš„èŽ·å–çº¿ç¨‹å‡½æ•°çš„æ‰§è¡Œç»“æžœã€‚std::asyncä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªçº¿ç¨‹åŽ»è°ƒç”¨çº¿ç¨‹å‡½æ•°ï¼Œå®ƒè¿”å›žä¸€ä¸ªstd::futureï¼Œè¿™ä¸ªfutureä¸­å­˜å‚¨äº†çº¿ç¨‹å‡½æ•°è¿”å›žçš„ç»“æžœï¼Œå½“æˆ‘ä»¬éœ€è¦çº¿ç¨‹å‡½æ•°çš„ç»“æžœæ—¶ï¼Œç›´æŽ¥ä»Žfutureä¸­èŽ·å–ï¼Œéžå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå…¶å®žstd::asyncç»™æˆ‘ä»¬æä¾›çš„ä¾¿åˆ©å¯ä¸ä»…ä»…æ˜¯è¿™ä¸€ç‚¹ï¼Œå®ƒé¦–å…ˆè§£è€¦äº†çº¿ç¨‹çš„åˆ›å»ºå’Œæ‰§è¡Œï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™èŽ·å–å¼‚æ­¥æ“ä½œçš„ç»“æžœï¼›å…¶æ¬¡å®ƒè¿˜æä¾›äº†çº¿ç¨‹çš„åˆ›å»ºç­–ç•¥ï¼ˆæ¯”å¦‚å¯ä»¥é€šè¿‡å»¶è¿ŸåŠ è½½çš„æ–¹å¼åŽ»åˆ›å»ºçº¿ç¨‹ï¼‰ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»¥å¤šç§æ–¹å¼åŽ»åˆ›å»ºçº¿ç¨‹ã€‚åœ¨ä»‹ç»asyncå…·ä½“ç”¨æ³•ä»¥åŠä¸ºä»€ä¹ˆè¦ç”¨std::asyncä»£æ›¿çº¿ç¨‹çš„åˆ›å»ºä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯´ä¸€è¯´std::futureã€std::promiseå’Œstd::packaged_taskã€‚std::futur std::futureæ˜¯ä¸€ä¸ªéžå¸¸æœ‰ç”¨ä¹Ÿå¾ˆæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œç®€å•è¯´std::futureæä¾›äº†ä¸€ç§è®¿é—®å¼‚æ­¥æ“ä½œç»“æžœçš„æœºåˆ¶ã€‚ä»Žå­—é¢æ„æ€æ¥ç†è§£ï¼Œå®ƒè¡¨ç¤ºæœªæ¥ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªåå­—éžå¸¸è´´åˆ‡ï¼Œå› ä¸ºä¸€ä¸ªå¼‚æ­¥æ“ä½œæˆ‘ä»¬æ˜¯ä¸å¯èƒ½é©¬ä¸Šå°±èŽ·å–æ“ä½œç»“æžœçš„ï¼Œåªèƒ½åœ¨æœªæ¥æŸä¸ªæ—¶å€™èŽ·å–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»¥åŒæ­¥ç­‰å¾…çš„æ–¹å¼æ¥èŽ·å–ç»“æžœï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢futureçš„çŠ¶æ€ï¼ˆfuture_statusï¼‰æ¥èŽ·å–å¼‚æ­¥æ“ä½œçš„ç»“æžœã€‚future_statusæœ‰ä¸‰ç§çŠ¶æ€ï¼šdeferredï¼šå¼‚æ­¥æ“ä½œè¿˜æ²¡å¼€å§‹readyï¼šå¼‚æ­¥æ“ä½œå·²ç»å®Œæˆtimeoutï¼šå¼‚æ­¥æ“ä½œè¶…æ—¶123456789101112//æŸ¥è¯¢futureçš„çŠ¶æ€std::future_status status; do &#123; status = future.wait_for(std::chrono::seconds(1)); if (status == std::future_status::deferred) &#123; std::cout &lt;&lt; "deferred\n"; //ä»£è¡¨å»¶è¿Ÿæ‰§è¡Œ &#125; else if (status == std::future_status::timeout) &#123; std::cout &lt;&lt; "timeout\n"; //ä»£è¡¨æ‰§è¡Œä¸­ &#125; else if (status == std::future_status::ready) &#123; std::cout &lt;&lt; "ready!\n"; //ä»£è¡¨å·²ç»æ‰§è¡Œå®Œæˆ &#125; &#125; while (status != std::future_status::ready); èŽ·å–futureç»“æžœæœ‰ä¸‰ç§æ–¹å¼ï¼šgetã€waitã€wait_forï¼Œå…¶ä¸­getç­‰å¾…å¼‚æ­¥æ“ä½œç»“æŸå¹¶è¿”å›žç»“æžœï¼Œwaitåªæ˜¯ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆï¼Œæ²¡æœ‰è¿”å›žå€¼ï¼Œwait_foræ˜¯è¶…æ—¶ç­‰å¾…è¿”å›žç»“æžœã€‚std::promise std::promiseä¸ºèŽ·å–çº¿ç¨‹å‡½æ•°ä¸­çš„æŸä¸ªå€¼æä¾›ä¾¿åˆ©ï¼Œåœ¨çº¿ç¨‹å‡½æ•°ä¸­ç»™å¤–é¢ä¼ è¿›æ¥çš„promiseèµ‹å€¼ï¼Œå½“çº¿ç¨‹å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åŽå°±å¯ä»¥é€šè¿‡promisèŽ·å–è¯¥å€¼äº†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å–å€¼æ˜¯é—´æŽ¥çš„é€šè¿‡promiseå†…éƒ¨æä¾›çš„futureæ¥èŽ·å–çš„ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼š1234std::promise&lt;int&gt; pr;std::thread t([](std::promise&lt;int&gt;&amp; p)&#123; p.set_value_at_thread_exit(9); &#125;,std::ref(pr));std::future&lt;int&gt; f = pr.get_future();auto r = f.get();std::packaged_task std::packaged_taskå®ƒåŒ…è£…äº†ä¸€ä¸ªå¯è°ƒç”¨çš„ç›®æ ‡ï¼ˆå¦‚function, lambda expression, bind expression, or another function objectï¼‰,ä»¥ä¾¿å¼‚æ­¥è°ƒç”¨ï¼Œå®ƒå’Œpromiseåœ¨æŸç§ç¨‹åº¦ä¸Šæœ‰ç‚¹åƒï¼Œpromiseä¿å­˜äº†ä¸€ä¸ªå…±äº«çŠ¶æ€çš„å€¼ï¼Œè€Œpackaged_taskä¿å­˜çš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼š1234std::packaged_task&lt;int()&gt; task([]()&#123; return 7; &#125;);std::thread t1(std::ref(task)); std::future&lt;int&gt; f1 = task.get_future(); auto r1 = f1.get();std::promiseã€std::packaged_taskå’Œstd::futureçš„å…³ç³» è‡³æ­¤, æˆ‘ä»¬ä»‹ç»äº†std::asyncç›¸å…³çš„å‡ ä¸ªå¯¹è±¡std::futureã€std::promiseå’Œstd::packaged_taskï¼Œå…¶ä¸­std::promiseå’Œstd::packaged_taskçš„ç»“æžœæœ€ç»ˆéƒ½æ˜¯é€šè¿‡å…¶å†…éƒ¨çš„futureè¿”å›žå‡ºæ¥çš„ï¼Œä¸çŸ¥é“è¯»è€…æœ‰æ²¡æœ‰æžç³Šæ¶‚ï¼Œä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šä¸œè¥¿å‡ºæ¥ï¼Œä»–ä»¬ä¹‹é—´çš„å…³ç³»åˆ°åº•æ˜¯æ€Žæ ·çš„ï¼Ÿä¸”å¬æˆ‘æ…¢æ…¢é“æ¥ï¼Œstd::futureæä¾›äº†ä¸€ä¸ªè®¿é—®å¼‚æ­¥æ“ä½œç»“æžœçš„æœºåˆ¶ï¼Œå®ƒå’Œçº¿ç¨‹æ˜¯ä¸€ä¸ªçº§åˆ«çš„å±žäºŽä½Žå±‚æ¬¡çš„å¯¹è±¡ï¼Œåœ¨å®ƒä¹‹ä¸Šé«˜ä¸€å±‚çš„æ˜¯std::packaged_taskå’Œstd::promiseï¼Œä»–ä»¬å†…éƒ¨éƒ½æœ‰futureä»¥ä¾¿è®¿é—®å¼‚æ­¥æ“ä½œç»“æžœï¼Œstd::packaged_taskåŒ…è£…çš„æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè€Œstd::promiseåŒ…è£…çš„æ˜¯ä¸€ä¸ªå€¼ï¼Œéƒ½æ˜¯ä¸ºäº†æ–¹ä¾¿å¼‚æ­¥æ“ä½œçš„ï¼Œå› ä¸ºæœ‰æ—¶æˆ‘éœ€è¦èŽ·å–çº¿ç¨‹ä¸­çš„æŸä¸ªå€¼ï¼Œè¿™æ—¶å°±ç”¨std::promiseï¼Œè€Œæœ‰æ—¶æˆ‘éœ€è¦èŽ·ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„è¿”å›žå€¼ï¼Œè¿™æ—¶å°±ç”¨std::packaged_taskã€‚é‚£std::promiseå’Œstd::packaged_taskä¹‹é—´åˆæ˜¯ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿè¯´ä»–ä»¬æ²¡å…³ç³»ä¹Ÿå…³ç³»ï¼Œè¯´ä»–ä»¬æœ‰å…³ç³»ä¹Ÿæœ‰å…³ç³»ï¼Œéƒ½å–å†³äºŽä½ äº†ï¼Œå› ä¸ºæˆ‘å¯ä»¥å°†ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æžœä¿å­˜åˆ°std::promiseä¸­ã€‚å¦‚æžœè¯»è€…è¿˜æ²¡æžæ¸…æ¥šä»–ä»¬çš„å…³ç³»çš„è¯ï¼Œæˆ‘å°±ç”¨æ›´é€šä¿—çš„è¯æ¥è§£é‡Šä¸€ä¸‹ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå°ä¼™å­ç»™ä¸€ä¸ªå§‘å¨˜è¡¨ç™½çœŸå¿ƒçš„æ—¶å€™ä¹Ÿè®¸ä¼šè¯´ï¼šâ€æˆ‘è®¸è¯ºä¼šç»™ä½ ä¸€ä¸ªç¾Žå¥½çš„æœªæ¥â€œæˆ–è€…â€æˆ‘ä¼šåŠªåŠ›å¥‹æ–—ä¸ºä½ åˆ›é€ ä¸€ä¸ªç¾Žå¥½çš„æœªæ¥â€œã€‚å§‘å¨˜å¾€å¾€ä¼šè¯´ï¼šâ€æˆ‘ç­‰ç€â€œã€‚çŽ°åœ¨æˆ‘æ¥å°†è¿™ä¸‰å¥è¯ç”¨c++11æ¥ç¿»è¯‘ä¸€ä¸‹ï¼šå°ä¼™å­è¯´ï¼šæˆ‘è®¸è¯ºä¼šç»™ä½ ä¸€ä¸ªç¾Žå¥½çš„æœªæ¥ç­‰äºŽc++11ä¸­â€std::promise a std::futureâ€;å°ä¼™å­è¯´ï¼šæˆ‘ä¼šåŠªåŠ›å¥‹æ–—ä¸ºä½ åˆ›é€ ä¸€ä¸ªç¾Žå¥½çš„æœªæ¥ç­‰äºŽc++11ä¸­â€std::packaged_task a futureâ€;å§‘å¨˜è¯´ï¼šæˆ‘ç­‰ç€ç­‰äºŽc++11ä¸­â€future.get()/wait()â€; å°ä¼™å­ä¸¤å¥è¯çš„ä¸ªä¸­å·®å¼‚ï¼Œè‡ªå·±ç¢ç£¨ä¸€ä¸‹ï¼Œè¿™ç‚¹å·®å¼‚ä¹Ÿæ˜¯std::promiseå’Œstd::packaged_taskçš„å·®å¼‚ã€‚çŽ°å®žä¸­çš„å±±ç›Ÿæµ·èª“é ä¸é å¾—ä½æˆ‘ä¸çŸ¥é“ï¼Œä½†æ˜¯c++11ä¸­çš„è®¸è¯ºå’Œæœªæ¥æ˜¯ä¸€å®šå¯é çš„ï¼Œå‘èµ·æ¥äº†è®¸è¯ºå°±ä¸€å®šæœ‰æœªæ¥ã€‚ç»†æƒ³èµ·æ¥c++11æ ‡å‡†çš„åˆ¶å®šè€…é€‰å®šçš„å…³é”®å­—çœŸæ˜¯è´´åˆ‡è€Œæœ‰æ„æ€ï¼å¥½äº†ï¼Œæ’ç§‘æ‰“è¯¨åˆ°æ­¤äº†ï¼ŒçŽ°åœ¨è¨€å½’æ­£ä¼ ï¼Œå›žè¿‡å¤´æ¥è¯´è¯´std::asyncã€‚ä¸ºä»€ä¹ˆè¦ç”¨std::asyncä»£æ›¿çº¿ç¨‹çš„åˆ›å»º std::asyncåˆæ˜¯å¹²å•¥çš„ï¼Œå·²ç»æœ‰äº†td::futureã€std::promiseå’Œstd::packaged_taskï¼Œå¤Ÿå¤šçš„äº†ï¼ŒçœŸçš„è¿˜è¦ä¸€ä¸ªstd::asyncæ¥å‡‘çƒ­é—¹å—ï¼Œstd::asyncè¡¨ç¤ºå¾ˆå§”å±ˆï¼šæˆ‘ä¸æ˜¯æ¥å‡‘çƒ­é—¹çš„ï¼Œæˆ‘æ˜¯æ¥å¸®å¿™çš„ã€‚æ˜¯çš„ï¼Œstd::asyncæ˜¯ä¸ºäº†è®©ç”¨æˆ·çš„å°‘è´¹ç‚¹è„‘å­çš„ï¼Œå®ƒè®©è¿™ä¸‰ä¸ªå¯¹è±¡é»˜å¥‘çš„å·¥ä½œã€‚å¤§æ¦‚çš„å·¥ä½œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼šstd::asyncå…ˆå°†å¼‚æ­¥æ“ä½œç”¨std::packaged_taskåŒ…è£…èµ·æ¥ï¼Œç„¶åŽå°†å¼‚æ­¥æ“ä½œçš„ç»“æžœæ”¾åˆ°std::promiseä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ›é€ æœªæ¥çš„è¿‡ç¨‹ã€‚å¤–é¢å†é€šè¿‡future.get/waitæ¥èŽ·å–è¿™ä¸ªæœªæ¥çš„ç»“æžœï¼Œæ€Žä¹ˆæ ·ï¼Œstd::asyncçœŸçš„æ˜¯æ¥å¸®å¿™çš„å§ï¼Œä½ ä¸ç”¨å†æƒ³åˆ°åº•è¯¥æ€Žä¹ˆç”¨std::futureã€std::promiseå’Œstd::packaged_taskäº†ï¼Œstd::asyncå·²ç»å¸®ä½ æžå®šä¸€åˆ‡äº†ï¼ çŽ°åœ¨æ¥çœ‹çœ‹std::asyncçš„åŽŸåž‹async(std::launch::async | std::launch::deferred, f, argsâ€¦)ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çº¿ç¨‹çš„åˆ›å»ºç­–ç•¥ï¼Œæœ‰ä¸¤ç§ç­–ç•¥ï¼Œé»˜è®¤çš„ç­–ç•¥æ˜¯ç«‹å³åˆ›å»ºçº¿ç¨‹ï¼šstd::launch::asyncï¼šåœ¨è°ƒç”¨asyncå°±å¼€å§‹åˆ›å»ºçº¿ç¨‹ã€‚std::launch::deferredï¼šå»¶è¿ŸåŠ è½½æ–¹å¼åˆ›å»ºçº¿ç¨‹ã€‚è°ƒç”¨asyncæ—¶ä¸åˆ›å»ºçº¿ç¨‹ï¼Œç›´åˆ°è°ƒç”¨äº†futureçš„getæˆ–è€…waitæ—¶æ‰åˆ›å»ºçº¿ç¨‹ã€‚å¯èƒ½åœ¨è¿™é‡Œä¼šé˜»å¡žä½ä¸»çº¿ç¨‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯çº¿ç¨‹å‡½æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯çº¿ç¨‹å‡½æ•°çš„å‚æ•°ã€‚std::asyncåŸºæœ¬ç”¨æ³•ï¼š12345678910111213141516171819202122232425262728293031323334353637std::future&lt;int&gt; f1 = std::async(std::launch::async, []()&#123; return 8; &#125;); cout&lt;&lt;f1.get()&lt;&lt;endl; //output: 8std::future&lt;int&gt; f2 = std::async(std::launch::async, []()&#123; cout&lt;&lt;8&lt;&lt;endl; &#125;); f2.wait(); //output: 8std::future&lt;int&gt; future = std::async(std::launch::async, []()&#123; std::this_thread::sleep_for(std::chrono::seconds(3)); return 8; &#125;); std::cout &lt;&lt; "waiting...\n"; std::future_status status; do &#123; status = future.wait_for(std::chrono::seconds(1)); if (status == std::future_status::deferred) &#123; std::cout &lt;&lt; "deferred\n"; &#125; else if (status == std::future_status::timeout) &#123; std::cout &lt;&lt; "timeout\n"; &#125; else if (status == std::future_status::ready) &#123; std::cout &lt;&lt; "ready!\n"; &#125; &#125; while (status != std::future_status::ready); std::cout &lt;&lt; "result is " &lt;&lt; future.get() &lt;&lt; '\n';å¯èƒ½çš„ç»“æžœï¼šwaiting...timeouttimeoutready!result is 8æ€»ç»“ï¼š std::asyncæ˜¯æ›´é«˜å±‚æ¬¡ä¸Šçš„å¼‚æ­¥æ“ä½œï¼Œä½¿æˆ‘ä»¬ä¸ç”¨å…³æ³¨çº¿ç¨‹åˆ›å»ºå†…éƒ¨ç»†èŠ‚ï¼Œå°±èƒ½æ–¹ä¾¿çš„èŽ·å–å¼‚æ­¥æ‰§è¡ŒçŠ¶æ€å’Œç»“æžœï¼Œè¿˜å¯ä»¥æŒ‡å®šçº¿ç¨‹åˆ›å»ºç­–ç•¥ï¼Œåº”è¯¥ç”¨std::asyncæ›¿ä»£çº¿ç¨‹çš„åˆ›å»ºï¼Œè®©å®ƒæˆä¸ºæˆ‘ä»¬åšå¼‚æ­¥æ“ä½œçš„é¦–é€‰ã€‚]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[mutexå¤´æ–‡ä»¶ä»‹ç»]]></title>
    <url>%2Fposts%2F58aac72e%2F</url>
    <content type="text"><![CDATA[Mutex åˆç§°äº’æ–¥é‡ï¼ŒC++ 11ä¸­ä¸Ž Mutex ç›¸å…³çš„ç±»ï¼ˆåŒ…æ‹¬é”ç±»åž‹ï¼‰å’Œå‡½æ•°éƒ½å£°æ˜Žåœ¨å¤´æ–‡ä»¶ä¸­ï¼Œæ‰€ä»¥å¦‚æžœä½ éœ€è¦ä½¿ç”¨ std::mutexï¼Œå°±å¿…é¡»åŒ…å«å¤´æ–‡ä»¶ã€‚å¤´æ–‡ä»¶ä»‹ç»Mutex ç³»åˆ—ç±»(å››ç§)std::mutexï¼Œæœ€åŸºæœ¬çš„ Mutex ç±»ã€‚std::recursive_mutexï¼Œé€’å½’ Mutex ç±»ã€‚std::time_mutexï¼Œå®šæ—¶ Mutex ç±»ã€‚std::recursive_timed_mutexï¼Œå®šæ—¶é€’å½’ Mutex ç±»ã€‚Lock ç±»ï¼ˆä¸¤ç§ï¼‰std::lock_guardï¼Œä¸Ž Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚std::unique_lockï¼Œä¸Ž Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æŽ§åˆ¶ã€‚å…¶ä»–ç±»åž‹std::once_flagstd::adopt_lock_tstd::defer_lock_tstd::try_to_lock_tå‡½æ•°std::try_lockï¼Œå°è¯•åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚std::lockï¼Œå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªäº’æ–¥é‡ä¸Šé”ã€‚std::call_onceï¼Œå¦‚æžœå¤šä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶è°ƒç”¨æŸä¸ªå‡½æ•°ï¼Œcall_once å¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹è¯¥å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ã€‚std::mutex ä»‹ç»ä¸‹é¢ä»¥ std::mutex ä¸ºä¾‹ä»‹ç» C++11 ä¸­çš„äº’æ–¥é‡ç”¨æ³•ã€‚std::mutex æ˜¯C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ï¼Œstd::mutex å¯¹è±¡æä¾›äº†ç‹¬å æ‰€æœ‰æƒçš„ç‰¹æ€§â€”â€”å³ä¸æ”¯æŒé€’å½’åœ°å¯¹ std::mutex å¯¹è±¡ä¸Šé”ï¼Œè€Œ std::recursive_lock åˆ™å¯ä»¥é€’å½’åœ°å¯¹äº’æ–¥é‡å¯¹è±¡ä¸Šé”ã€‚std::mutex çš„æˆå‘˜å‡½æ•°æž„é€ å‡½æ•°ï¼Œstd::mutexä¸å…è®¸æ‹·è´æž„é€ ï¼Œä¹Ÿä¸å…è®¸ move æ‹·è´ï¼Œæœ€åˆäº§ç”Ÿçš„ mutex å¯¹è±¡æ˜¯å¤„äºŽ unlocked çŠ¶æ€çš„ã€‚lock()ï¼Œè°ƒç”¨çº¿ç¨‹å°†é”ä½è¯¥äº’æ–¥é‡ã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¼šå‘ç”Ÿä¸‹é¢ 3 ç§æƒ…å†µï¼š(1). å¦‚æžœè¯¥äº’æ–¥é‡å½“å‰æ²¡æœ‰è¢«é”ä½ï¼Œåˆ™è°ƒç”¨çº¿ç¨‹å°†è¯¥äº’æ–¥é‡é”ä½ï¼Œç›´åˆ°è°ƒç”¨ unlockä¹‹å‰ï¼Œè¯¥çº¿ç¨‹ä¸€ç›´æ‹¥æœ‰è¯¥é”ã€‚(2). å¦‚æžœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰çš„è°ƒç”¨çº¿ç¨‹è¢«é˜»å¡žä½ã€‚(3). å¦‚æžœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚unlock()ï¼Œ è§£é”ï¼Œé‡Šæ”¾å¯¹äº’æ–¥é‡çš„æ‰€æœ‰æƒã€‚try_lock()ï¼Œå°è¯•é”ä½äº’æ–¥é‡ï¼Œå¦‚æžœäº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é˜»å¡žã€‚çº¿ç¨‹è°ƒç”¨è¯¥å‡½æ•°ä¹Ÿä¼šå‡ºçŽ°ä¸‹é¢ 3 ç§æƒ…å†µï¼Œ(1). å¦‚æžœå½“å‰äº’æ–¥é‡æ²¡æœ‰è¢«å…¶ä»–çº¿ç¨‹å æœ‰ï¼Œåˆ™è¯¥çº¿ç¨‹é”ä½äº’æ–¥é‡ï¼Œç›´åˆ°è¯¥çº¿ç¨‹è°ƒç”¨ unlock é‡Šæ”¾äº’æ–¥é‡ã€‚(2). å¦‚æžœå½“å‰äº’æ–¥é‡è¢«å…¶ä»–çº¿ç¨‹é”ä½ï¼Œåˆ™å½“å‰è°ƒç”¨çº¿ç¨‹è¿”å›ž falseï¼Œè€Œå¹¶ä¸ä¼šè¢«é˜»å¡žæŽ‰ã€‚(3). å¦‚æžœå½“å‰äº’æ–¥é‡è¢«å½“å‰è°ƒç”¨çº¿ç¨‹é”ä½ï¼Œåˆ™ä¼šäº§ç”Ÿæ­»é”(deadlock)ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸Ž std::mutex çš„å°ä¾‹å­ï¼ˆå‚è€ƒï¼‰1234567891011121314151617181920212223242526#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutexvolatile int counter(0); // non-atomic counterstd::mutex mtx; // locks access to countervoid attempt_10k_increases() &#123; for (int i=0; i&lt;10000; ++i) &#123; if (mtx.try_lock()) &#123; // only increase if currently not locked: ++counter; mtx.unlock(); &#125; &#125;&#125;int main (int argc, const char* argv[]) &#123; std::thread threads[10]; for (int i=0; i&lt;10; ++i) threads[i] = std::thread(attempt_10k_increases); for (auto&amp; th : threads) th.join(); std::cout &lt;&lt; counter &lt;&lt; " successful increases of the counter.\n"; return 0;&#125;è¾“å‡ºç»“æžœï¼š123$g++ -lpthread -std=c++11 -o main *.cpp$main9012 successful increases of the counter.å¯ä»¥çœ‹å‡ºæœ‰å¾ˆå¤šæ¬¡mtx.try_lock()è¿”å›žäº†falseï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œ++counteræ“ä½œã€‚å¦‚æžœæŠŠmtx.try_lock()æ”¹æˆmtx.lock()ï¼Œåˆ™å¿…å®šä¼šé˜»å¡žå…¶ä»–çº¿ç¨‹ã€‚è¾“å‡ºç»“æžœ2:123$g++ -lpthread -std=c++11 -o main *.cpp$main100000 successful increases of the counter.std::recursive_mutex ä»‹ç»std::recursive_mutex ä¸Ž std::mutex ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯ä»¥è¢«ä¸Šé”çš„å¯¹è±¡ï¼Œä½†æ˜¯å’Œ std::mutex ä¸åŒçš„æ˜¯ï¼Œstd::recursive_mutex å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥èŽ·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œstd::recursive_mutex é‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸Žè¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()ï¼Œå¯ç†è§£ä¸º lock() æ¬¡æ•°å’Œ unlock() æ¬¡æ•°ç›¸åŒï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œstd::recursive_mutex çš„ç‰¹æ€§å’Œ std::mutex å¤§è‡´ç›¸åŒã€‚12345678910111213141516171819202122232425#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutexvolatile int counter(0); // non-atomic counterstd::recursive_mutex rmtx; // locks access to countervoid attempt_1k_increases() &#123; for (int i=0; i&lt;10000; ++i) &#123; rmtx.lock(); ++counter; &#125; for (int i=0; i&lt;10000; ++i) &#123; counter-=2; rmtx.unlock(); &#125;&#125;int main (int argc, const char* argv[]) &#123; auto th = std::thread(attempt_1k_increases); th.join(); std::cout &lt;&lt; counter &lt;&lt; " successful increases of the counter.\n"; return 0;&#125;è¾“å‡ºç»“æžœï¼š123$g++ -lpthread -o main *.cpp$main-10000 successful increases of the counter.std::time_mutex ä»‹ç»std::time_mutex æ¯” std::mutex å¤šäº†ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œtry_lock_for()ï¼Œtry_lock_until()ã€‚try_lock_for å‡½æ•°æŽ¥å—ä¸€ä¸ªæ—¶é—´èŒƒå›´ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸€æ®µæ—¶é—´èŒƒå›´ä¹‹å†…çº¿ç¨‹å¦‚æžœæ²¡æœ‰èŽ·å¾—é”åˆ™è¢«é˜»å¡žä½ï¼ˆä¸Ž std::mutex çš„ try_lock() ä¸åŒï¼Œtry_lock å¦‚æžœè¢«è°ƒç”¨æ—¶æ²¡æœ‰èŽ·å¾—é”åˆ™ç›´æŽ¥è¿”å›ž falseï¼‰ï¼Œå¦‚æžœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥èŽ·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æžœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰èŽ·å¾—é”ï¼‰ï¼Œåˆ™è¿”å›ž falseã€‚try_lock_until å‡½æ•°åˆ™æŽ¥å—ä¸€ä¸ªæ—¶é—´ç‚¹ä½œä¸ºå‚æ•°ï¼Œåœ¨æŒ‡å®šæ—¶é—´ç‚¹æœªåˆ°æ¥ä¹‹å‰çº¿ç¨‹å¦‚æžœæ²¡æœ‰èŽ·å¾—é”åˆ™è¢«é˜»å¡žä½ï¼Œå¦‚æžœåœ¨æ­¤æœŸé—´å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†é”ï¼Œåˆ™è¯¥çº¿ç¨‹å¯ä»¥èŽ·å¾—å¯¹äº’æ–¥é‡çš„é”ï¼Œå¦‚æžœè¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…è¿˜æ˜¯æ²¡æœ‰èŽ·å¾—é”ï¼‰ï¼Œåˆ™è¿”å›ž falseã€‚ä¸‹é¢çš„å°ä¾‹å­è¯´æ˜Žäº† std::time_mutex çš„ç”¨æ³•ï¼ˆå‚è€ƒï¼‰ã€‚1234567891011121314151617181920212223242526272829#include &lt;iostream&gt; // std::cout#include &lt;chrono&gt; // std::chrono::milliseconds#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::timed_mutexstd::timed_mutex mtx;void fireworks() &#123; // waiting to get a lock: each thread prints "-" every 200ms: while (!mtx.try_lock_for(std::chrono::milliseconds(200))) &#123; std::cout &lt;&lt; "-"; &#125; // got a lock! - wait for 1s, then this thread prints "*" std::this_thread::sleep_for(std::chrono::milliseconds(1000)); std::cout &lt;&lt; "*\n"; mtx.unlock();&#125;int main ()&#123; std::thread threads[10]; // spawn 10 threads: for (int i=0; i&lt;10; ++i) threads[i] = std::thread(fireworks); for (auto&amp; th : threads) th.join(); return 0;&#125;è¾“å‡ºç»“æžœï¼šçº¿ç¨‹è¾“å‡º*è¡¨ç¤ºè¯¥çº¿ç¨‹å·²ç»æ­£å¸¸é€€å‡ºï¼Œå¹¶ä¸”é‡Šæ”¾è¯¥é”ã€‚å¦åˆ™å°†æ¯200mså°è¯•èŽ·å–mutexðŸ”’ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚std::recursive_timed_mutex ä»‹ç»å’Œ std:recursive_mutex ä¸Ž std::mutex çš„å…³ç³»ä¸€æ ·ï¼Œstd::recursive_timed_mutex çš„ç‰¹æ€§ä¹Ÿå¯ä»¥ä»Ž std::timed_mutex æŽ¨å¯¼å‡ºæ¥ï¼Œæ„Ÿå…´è¶£çš„åŒéž‹å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ã€‚ ;-)std::lock_guard ä»‹ç»ä¸Ž Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰:1.std::lock_guard åœ¨æž„é€ å‡½æ•°ä¸­è¿›è¡ŒåŠ é”ï¼Œæžæž„å‡½æ•°ä¸­è¿›è¡Œè§£é”ã€‚2.é”åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä½¿ç”¨è¾ƒå¤šï¼Œå› æ­¤c++11æä¾›äº†lock_guardæ¨¡æ¿ç±»ï¼›åœ¨å®žé™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„åœºæ™¯ç¼–å†™resource_guard RAIIç±»ï¼Œé¿å…å¿˜æŽ‰é‡Šæ”¾èµ„æºã€‚12345678910111213141516171819202122232425262728293031323334#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutex, std::lock_guard#include &lt;stdexcept&gt; // std::logic_errorstd::mutex mtx;void print_even (int x) &#123; if (x%2==0) std::cout &lt;&lt; x &lt;&lt; " is even\n"; else throw (std::logic_error("not even"));&#125;void print_thread_id (int id) &#123; try &#123; // using a local lock_guard to lock mtx guarantees unlocking on destruction / exception: std::lock_guard&lt;std::mutex&gt; lck (mtx); print_even(id); &#125; catch (std::logic_error&amp;) &#123; std::cout &lt;&lt; "[exception caught]\n"; &#125;&#125;int main ()&#123; std::thread threads[10]; // spawn 10 threads: for (int i=0; i&lt;10; ++i) threads[i] = std::thread(print_thread_id,i+1); for (auto&amp; th : threads) th.join(); return 0;&#125;è¾“å‡ºç»“æžœï¼š123456789101112$g++ -lpthread -o main *.cpp$main[exception caught]4 is even[exception caught]2 is even[exception caught]6 is even8 is even[exception caught][exception caught]10 is evenstd::unique_lock ä»‹ç»ä¸Ž Mutex RAII ç›¸å…³ï¼Œæ–¹ä¾¿çº¿ç¨‹å¯¹äº’æ–¥é‡ä¸Šé”ï¼Œä½†æä¾›äº†æ›´å¥½çš„ä¸Šé”å’Œè§£é”æŽ§åˆ¶ã€‚ä¾‹å­ï¼ˆå‚è€ƒï¼‰ï¼š1.ç±» unique_lock æ˜¯é€šç”¨äº’æ–¥åŒ…è£…å™¨ï¼Œå…è®¸å»¶è¿Ÿé”å®šã€é”å®šçš„æœ‰æ—¶é™å°è¯•ã€é€’å½’é”å®šã€æ‰€æœ‰æƒè½¬ç§»å’Œä¸Žæ¡ä»¶å˜é‡ä¸€åŒä½¿ç”¨ã€‚2.unique_lockæ¯”lock_guardä½¿ç”¨æ›´åŠ çµæ´»ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ä½¿ç”¨unique_lockéœ€è¦ä»˜å‡ºæ›´å¤šçš„æ—¶é—´ã€æ€§èƒ½æˆæœ¬ã€‚12345678910111213141516171819202122232425#include &lt;iostream&gt; // std::cout#include &lt;thread&gt; // std::thread#include &lt;mutex&gt; // std::mutex, std::unique_lockstd::mutex mtx; // mutex for critical sectionvoid print_block (int n, char c) &#123; // critical section (exclusive access to std::cout signaled by lifetime of lck): std::unique_lock&lt;std::mutex&gt; lck (mtx); for (int i=0; i&lt;n; ++i) &#123; std::cout &lt;&lt; c; &#125; std::cout &lt;&lt; '\n';&#125;int main ()&#123; std::thread th1 (print_block,50,'*'); std::thread th2 (print_block,50,'$'); th1.join(); th2.join(); return 0;&#125;è¾“å‡ºç»“æžœï¼š1234$g++ -lpthread -o main *.cpp$main**************************************************$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$å¥½äº†ï¼Œæœ¬æ–‡æš‚æ—¶è®²åˆ°è¿™é‡Œï¼Œè¿˜å‰©ä¸‹ std::try_lockï¼Œstd::lockï¼Œstd::call_once ä¸‰ä¸ªå‡½æ•°æ²¡æœ‰è®²åˆ°ï¼Œç•™åœ¨ä¸‹ä¸€ç¯‡åšå®¢ä¸­è®²å§ ;-)]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++ä¹‹Lambdaç ”ç©¶]]></title>
    <url>%2Fposts%2F95b963ee%2F</url>
    <content type="text"><![CDATA[1. å‰è¨€æœ¬æ–‡ä»£ç æµ‹è¯•çŽ¯å¢ƒä¸ºâ€œGCC-9.1.0â€ï¼Œæœ‰å…³ç¼–è¯‘å™¨çš„å®‰è£…è¯·å‚è€ƒã€Šå®‰è£…GCC-8.3.0åŠå…¶ä¾èµ–ã€‹ï¼Œé€‚ç”¨äºŽâ€œGCC-9.1.0â€ã€‚æœ¬æ–‡è¯•å›¾æ­éœ²LambdaèƒŒåŽä¸€é¢ï¼Œä»¥æ–¹ä¾¿æ›´å¥½çš„ç†è§£å’ŒæŽŒæ¡Lambdaã€‚Lambdaä»£ç æ®µå®žé™…ä¸ºä¸€ä¸ªç¼–è¯‘å™¨ç”Ÿæˆçš„ç±»çš„â€œoperator ()â€å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸€ä¸ªLambdaå‡½æ•°ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆåœ¨C++ä¸­ï¼Œç±»å’Œç»“æž„ä½“å®žé™…ä¸€æ ·ï¼Œæ— æœ¬è´¨åŒºåˆ«ï¼Œé™¤äº†é»˜è®¤çš„è®¿é—®æŽ§åˆ¶ï¼‰ã€‚å¯¹Lambdaçš„æœ€ç®€å•ç†è§£ï¼Œæ˜¯å°†å®ƒçœ‹ä½œä¸€ä¸ªåŒ¿åç±»ï¼ˆæˆ–ç»“æž„ä½“ï¼‰ï¼Œå®žé™…ä¸Šä¹Ÿç¡®å®žå¦‚æ­¤ï¼Œç¼–è¯‘å™¨æŠŠLambdaç¼–è¯‘æˆäº†åŒ¿åç±»ã€‚2. ç¤ºä¾‹1å…ˆçœ‹ä¸€æ®µå‡ ä¹Žæœ€ç®€å•çš„Lambdaä»£ç ï¼š123456// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; auto f = [] &#123; printf("f\n"); &#125;; // æ³¨æ„â€œ&#125;â€åŽçš„â€œ;â€å¿…ä¸å¯å°‘ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™ return 0;&#125;å¦‚æžœLambdaè¡¨è¾¾å¼ï¼ˆæˆ–å‡½æ•°ï¼‰æ²¡æœ‰ä»¥â€œ;â€ç»“å°¾ï¼Œåˆ™ç¼–è¯‘æ—¶å°†æŠ¥å¦‚ä¸‹é”™è¯¯ï¼š1234a3.cpp: In function 'int main()':a3.cpp:4:3: error: expected ',' or ';' before 'return' 4 | return 0; | ^~~~~~Lambdaä¹‹æ‰€ä»¥ç¥žå¥‡ï¼Œè¿™å¾—ç›ŠäºŽC++ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä¸Šè¿°â€œfâ€å®žé™…é•¿è¿™æ ·ï¼š12type = struct &lt;lambda()&gt; &#123;&#125;ä¸€ä¸ªåŒ¿åçš„ç±»ï¼ˆæˆ–ç»“æž„ä½“ï¼‰ï¼Œå®žé™…ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆå‘˜å‡½æ•°â€œoperator () constâ€ã€‚æ³¨æ„è¿™é‡Œæˆå‘˜å‡½æ•°æ˜¯â€constâ€ç±»åž‹ï¼Œè¿™æ˜¯é»˜è®¤çš„ã€‚å¦‚æžœéœ€éžâ€constâ€æˆå‘˜å‡½æ•°ï¼Œéœ€è¦åŠ â€mutableâ€ä¿®é¥°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š1auto f = [n]() mutable &#123; printf("%d\n", n); &#125;;ä¸Šé¢ä¾‹å­å¯¹åº”çš„åŒ¿åç±»æ²¡æœ‰ä»»ä½•ç±»æ•°æ®æˆå‘˜ï¼ŒçŽ°åœ¨æ¥ä¸ªæœ‰ç±»æ•°æ®æˆå‘˜çš„ä»£ç ï¼š12345678// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [n] &#123; printf("%d\n", n); &#125;; f(); // è¿™é‡Œå®žé™…è°ƒç”¨çš„æ˜¯åŒ¿åç±»çš„æˆå‘˜å‡½æ•°â€œoperator ()â€ return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®žé™…é•¿è¿™æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå«æœ‰ç±»æ•°æ®æˆå‘˜çš„åŒ¿åç±»ï¼Œè€Œä¸å†æ˜¯ç©ºæ— ä¸€ç‰¹çš„ç±»ï¼š123type = struct &lt;lambda()&gt; &#123; int __n;&#125;3. ç¤ºä¾‹2ç»§ç»­æ¥ä¸ªå˜ç§ï¼š12345678910// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [&amp;n]() mutable &#123; printf("%d\n", n); &#125;; f(); return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®žé™…é•¿è¿™æ ·ï¼Œä¸€ä¸ªåŒ…å«äº†å¼•ç”¨ç±»åž‹çš„åŒ¿åç±»ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;4. ç¤ºä¾‹3ç»§ç»­å˜ç§ï¼Œâ€œ&amp;â€çš„ä½œç”¨è®©Lambdaå‡½æ•°å¯ä½¿ç”¨Lambdaæ‰€åœ¨ä½œç”¨åŸŸå†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬Lambdaæ‰€åœ¨ç±»çš„thisï¼‰ï¼Œå¹¶ä¸”æ˜¯ä»¥å¼•ç”¨ä¼ é€’æ–¹å¼ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; auto f = [&amp;]() mutable &#123; printf("%d\n", n); &#125;; f(); return 0;&#125;â€œfâ€å®žé™…é•¿è¿™æ ·ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;å˜ç¨å¤æ‚ä¸€ç‚¹ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; int m = 5; auto f = [&amp;]() mutable &#123; printf("%d\n", n); &#125;; f(); return 0;&#125;å¯ä»¥çœ‹åˆ°ï¼Œâ€œfâ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼š123type = struct &lt;lambda()&gt; &#123; int &amp;__n;&#125;5. ç¤ºä¾‹4ç»§ç»­å¢žåŠ å¤æ‚åº¦ï¼š123456789// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;int main() &#123; int n = 3; int m = 5; auto f = [&amp;]() mutable &#123; printf("%d,%d\n", n, m); &#125;; f(); return 0;&#125;å¯ä»¥çœ‹åˆ°â€œfâ€å˜äº†ï¼š1234type = struct &lt;lambda()&gt; &#123; int &amp;__n; int &amp;__m;&#125;ä»Žä¸Šé¢ä¸éš¾çœ‹å‡ºï¼Œç¼–è¯‘å™¨åªä¼šæŠŠLambdaå‡½æ•°ç”¨åˆ°çš„å˜é‡æ‰“åŒ…è¿›å¯¹åº”çš„åŒ¿åç±»ã€‚ç»§ç»­ä¸€ä¸ªç¨å¤æ‚ç‚¹çš„ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf("foo\n"); &#125; void xoo() &#123; auto f = [&amp;] &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;è¿™æ—¶ï¼Œâ€œfâ€å®žé™…é•¿è¿™æ ·ï¼š123type = struct X::&lt;lambda()&gt; &#123; X * const __this; // Xç±»åž‹çš„æŒ‡é’ˆï¼ˆéžå¯¹è±¡ï¼‰&#125;å¦‚æžœå°†â€œauto f = [&amp;] { foo(); };â€ä¸­çš„â€œ&amp;â€åŽ»æŽ‰ï¼Œåˆ™ä¼šé‡åˆ°ç¼–è¯‘é”™è¯¯ï¼Œæç¤ºâ€œthisâ€æ²¡æœ‰è¢«Lambdaå‡½æ•°æ•èŽ·ï¼š12345a2.cpp: In lambda function:a2.cpp:5:23: error: 'this' was not captured for this lambda function 5 | auto f = [] &#123; foo(); &#125;; | ^a2.cpp:5:23: error: cannot call member function 'void X::foo()' without objectæ”¹æˆä¸‹åˆ—æ–¹å¼æ•èŽ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf("foo\n"); &#125; void xoo() &#123; auto f = [this] &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;å¦‚æžœæ˜¯C++17ï¼Œè¿˜å¯ä»¥è¿™æ ·ï¼š1234567891011121314// g++ -g -o a1 a1.cpp -std=c++17#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf("foo\n"); &#125; void xoo() &#123; auto f = [*this]() mutable &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;æ³¨æ„å¾—æœ‰â€œmutableâ€ä¿®é¥°ï¼Œä¸ç„¶æŠ¥å¦‚ä¸‹ç¼–è¯‘é”™è¯¯ï¼š1234567a2.cpp: In lambda function:a2.cpp:5:30: error: passing 'const X' as 'this' argument discards qualifiers [-fpermissive] 5 | auto f = [*this]() &#123; foo(); &#125;; | ^a2.cpp:3:8: note: in call to 'void X::foo()' 3 | void foo() &#123; printf("foo\n"); &#125; | ^~~ä¹Ÿå¯ä»¥è¿™æ ·ï¼š123456789101112131415// g++ -g -o a1 a1.cpp -std=c++17#include &lt;stdio.h&gt;struct X &#123; void foo() &#123; printf("foo\n"); &#125; void xoo() &#123; auto f = [&amp;,*this]() mutable &#123; foo(); &#125;; f(); &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;ä½¿ç”¨â€œ*thisâ€æ—¶çš„â€œfâ€æ ·å­å¦‚ä¸‹ï¼š123type = struct X::&lt;lambda()&gt; &#123; X __this; // Xç±»åž‹çš„å¯¹è±¡ï¼ˆéžæŒ‡é’ˆï¼‰&#125;6. ç¤ºä¾‹5ç»§ç»­ç ”ç©¶ï¼Œä½¿ç”¨C++ RTTIï¼ˆRun-Time Type Identificationï¼Œè¿è¡Œæ—¶ç±»åž‹è¯†åˆ«ï¼‰è®¾æ–½â€œtypeidâ€æŸ¥çœ‹Lambdaå‡½æ•°ï¼š123456789101112131415// g++ -g -o a1 a1.cpp -std=c++11#include &lt;stdio.h&gt;#include &lt;typeinfo&gt;struct X &#123; void xoo() &#123; auto f = [] &#123; printf("f\n"); &#125;; printf("%s\n", typeid(f).name()); // æ³¨ï¼štypeidè¿”å›žå€¼ç±»åž‹ä¸ºâ€œstd::type_infoâ€ &#125;&#125;;int main() &#123; X().xoo(); return 0;&#125;è¿è¡Œè¾“å‡ºï¼šZN1X3xooEvEUlvE_7. åŒ¿åç±»è§„åˆ™ç¼–è¯‘å™¨ä¸ºLambdaç”Ÿæˆçš„åŒ¿åç±»è§„åˆ™ï¼ˆä¸åŒæ ‡å‡†æœ‰åŒºåˆ«ï¼‰ï¼šæž„é€ å‡½æ•°æ‹·è´æž„é€ å‡½æ•°ClosureType()&nbsp;=&nbsp;delete;C++14å‰ClosureType()&nbsp;=&nbsp;default;C++20èµ·ï¼Œä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜èŽ·æ—¶ClosureType(const&nbsp;ClosureType&amp;&nbsp;)&nbsp;=&nbsp;default;C++14èµ·ClosureType(ClosureType&amp;&amp;&nbsp;)&nbsp;=&nbsp;default;C++14èµ·æ‹·è´å¤åˆ¶å‡½æ•°ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;C++20å‰ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;default;ClosureType&amp;&nbsp;operator=(ClosureType&amp;&amp;)&nbsp;=&nbsp;default;C++20èµ·ï¼Œä»…å½“æœªæŒ‡å®šä»»ä½•ä¿˜èŽ·æ—¶ClosureType&amp;&nbsp;operator=(const&nbsp;ClosureType&amp;)&nbsp;=&nbsp;delete;C++20èµ·ï¼Œå…¶ä»–æƒ…å†µæžæž„å‡½æ•°~ClosureType()&nbsp;=&nbsp;default;æžæž„å‡½æ•°æ˜¯éšå¼å£°æ˜Žçš„å¯¹äºŽæ ‡è®°ä¸ºâ€œdeleteâ€çš„å‡½æ•°æ˜¯ä¸èƒ½è°ƒç”¨çš„ï¼Œå¦‚ä¸‹åˆ—ä»£ç ä¸­çš„â€œf2 = f1;â€å°†è§¦å‘ç¼–è¯‘é”™è¯¯ï¼š1234567891011int main() &#123; auto f1 = []&#123;&#125;; auto f2 = f1; f2 = f1; return 0;&#125;ä¸Šåˆ—ä»£ç åœ¨C++11ã€C++14å’ŒC++17å‡ä¼šæŠ¥é”™ã€‚ä¸è¿‡å¦‚è§„åˆ™æ‰€ç¤ºï¼ŒC++20ï¼ˆå«C++2aï¼‰ä¸Šåˆ™å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼š1234567a3.cpp: In function 'int main()':a3.cpp:4:8: error: use of deleted function 'main()::&lt;lambda()&gt;&amp; main()::&lt;lambda()&gt;::operator=(const main()::&lt;lambda()&gt;&amp;)' 4 | f2 = f1; | ^~a3.cpp:2:14: note: a lambda closure type has a deleted copy assignment operator 2 | auto f1 = []&#123;&#125;; | ^å¸Œæœ›é€šè¿‡æœ¬æ–‡ï¼Œå¯¹ç†è§£Lambdaæœ‰æ‰€å¸®åŠ©ã€‚8. å‚è€ƒèµ„æ–™1) https://zh.cppreference.com/w/cpp/language/lambda2) https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=vs-20193) https://en.cpprefeence.com/w/cpp/language/lambda4) https://stackoverflow.com/questions/7627098/what-is-a-lambda-expression-in-c115) https://www.cprogramming.com/c++11/c++11-lambda-closures.htmlä½œè€…ï¼šä¸€è§æ¥æºï¼šCSDNåŽŸæ–‡ï¼šhttps://blog.csdn.net/Aquester/article/details/90691479]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++ æ¨¡æ¿åç‰¹åŒ–ï¼æ¥è‡ªSTLçš„æ€è€ƒ]]></title>
    <url>%2Fposts%2F2a215b70%2F</url>
    <content type="text"><![CDATA[ä¹‹å‰å­¦ä¹ STLæ—¶æŽ¥è§¦è¿‡ä¸€æ®µæ—¶é—´çš„æ¨¡æ¿ï¼Œæ¨¡æ¿æ˜¯C++æ³›åž‹ç¼–ç¨‹ç¼–ç¨‹çš„åŸºç¡€STLä»Žå¤´åˆ°å°¾éƒ½æ˜¯æ¨¡æ¿æ³›åž‹ç¼–ç¨‹ï¼Œæˆ‘è§‰å¾—ç”¨çš„æœ€å·§å¦™çš„å°±æ˜¯åœ¨traitsèƒå–æŠ€å·§æ—¶ç”¨åˆ°çš„æ¨¡æ¿åç‰¹åŒ–å…ˆç®€è¦å›žé¡¾ä¸€ä¸‹æ¨¡æ¿å§ï¼Œæ¨¡æ¿ä¸»è¦åˆ†ä¸ºå‡½æ•°æ¨¡æ¿ä¸Žç±»æ¨¡æ¿å‡½æ•°æ¨¡æ¿12345678910template&lt;class T&gt;T add(T a, T b) &#123; return a + b;&#125;int main()&#123; int a = 1, b = 2; std::cout &lt;&lt; add(a + b) &lt;&lt; std::endl; return 0;&#125;å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„å‡½æ•°æ¨¡æ¿ï¼Œå½“å®žä¾‹åŒ–å‡½æ•°æ¨¡æ¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è¿›è¡Œå®žå‚ç±»åž‹æŽ¨å¯¼ä¸Šé¢ç±»åž‹Tå°±è¢«è‡ªåŠ¨æŽ¨å¯¼ä¸ºintç±»åž‹ç±»æ¨¡æ¿12345678910111213141516templete&lt;class T&gt;class A&#123;public: explicit A(T val) : t(val) &#123; &#125; T add(T x) &#123; return t + y; &#125; privete: T t;&#125;;int main()&#123; A&lt;int&gt; a(10); std::cout &lt;&lt; a.add(5) &lt;&lt; std::endl; return 0;&#125;å¦‚ä¸Šå°±æ˜¯æœ€ç®€å•çš„ç±»æ¨¡æ¿ï¼Œå®žä¾‹åŒ–ç±»æ¨¡æ¿å¿…é¡»è¦æŒ‡å®šç±»åž‹ï¼Œç¼–è¯‘å™¨æ— æ³•ä¸ºç±»æ¨¡æ¿è‡ªåŠ¨æŽ¨å¯¼ç±»åž‹å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼‘ï¼Žç±»æ¨¡æ¿çš„å’Œå‡½æ•°æ¨¡æ¿éƒ½å¿…é¡»å®šä¹‰åœ¨.hå¤´æ–‡ä»¶ä¸­ï¼’ï¼Žæ¨¡æ¿çš„å®žä¾‹åŒ–ç±»åž‹ç¡®å®šæ˜¯åœ¨ç¼–è¯‘æœŸé—´ï¼“ï¼Žåªæ˜¯æ¨¡æ¿å†™å¥½äº†ï¼Œç¼–è¯‘ä¸€èˆ¬ä¸ä¼šå¾ˆå¤šå‡ºé”™ï¼Œå‡ºé”™ä¸€èˆ¬ä¼šåœ¨å®žä¾‹åŒ–ç¼–è¯‘ä¹‹åŽï¼”ï¼Žæ¨¡æ¿å®žä¾‹åŒ–åªä¼šå®žä¾‹åŒ–ç”¨åˆ°çš„éƒ¨åˆ†ï¼Œæ²¡æœ‰ç”¨åˆ°çš„éƒ¨åˆ†å°†ä¸ä¼šè¢«å®žä¾‹åŒ–æˆ‘è§‰å¾—æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–æ˜¯æ¨¡æ¿ä¸­æ¯”è¾ƒç²¾é«“çš„ä¸œè¥¿æœ‰å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ï¼Œå…¶ä¸­åˆåˆ†ä¸ºå…¨ç‰¹åŒ–ä¸Žåç‰¹åŒ–ä¸»è¦çš„ç”¨é€”éƒ½æ˜¯å¯¹äºŽç‰¹å®šçš„ç±»åž‹ï¼ŒæŒ‡å®šç‰¹å®šçš„å¤„ç†æ–¹å¼å°±ç›¸å½“äºŽæ™®é€šç¼–ç¨‹ä¸­if-else if - elseè¿™æ ·çš„æ–¹å¼ç¼–è¯‘é˜¶æ®µç¡®å®šå¦‚æžœæ˜¯æŸä¸ªç‰¹åŒ–ç±»åž‹ï¼Œå°±ç”¨ç‰¹åŒ–çš„æ¨¡æ¿å¦‚æžœéƒ½ä¸æ˜¯ï¼Œå°±ç”¨æœ€ä¸€èˆ¬çš„æ¨¡æ¿å‡½æ•°æ¨¡æ¿ç‰¹ä¾‹åŒ–å‡½æ•°æ¨¡æ¿åªèƒ½å…¨ç‰¹åŒ–ï¼Œä¸èƒ½åç‰¹åŒ–ï¼Œå¦‚æžœè¦åç‰¹åŒ–çš„è¯åªèƒ½é‡è½½å‡½æ•°æ¨¡æ¿å…¨ç‰¹åŒ–1234567891011template&lt; &gt; // å…¨ç‰¹åŒ– æ³¨æ„è¯­æ³•double add(double a, double b) &#123; return a + b; &#125;int main()&#123; int x = 10, y = 20; double z = 1.1, w = 2.2; std::cout &lt;&lt; add(x, y) &lt;&lt; std::endl; // è°ƒç”¨æ™®é€šç‰ˆæœ¬ std::cout &lt;&lt; add(z, w) &lt;&lt; std::endl; // è°ƒç”¨å…¨ç‰¹åŒ–ç‰ˆæœ¬ return 0;&#125;å¦‚æžœæœ‰ä¸Žå®žå‚æ›´åŠ åŒ¹é…çš„ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç¼–è¯‘å™¨å°†ä¼šé€‰æ‹©ç‰¹ä¾‹åŒ–ç‰ˆæœ¬å‡½æ•°æ¨¡æ¿é‡è½½ï¼ˆä¸å­˜åœ¨åç‰¹åŒ–ï¼‰å› ä¸ºåç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šä»ç„¶æ˜¯æ¨¡æ¿ï¼Œæ‰€ä»¥å¦‚æžœéœ€è¦çš„è¯ï¼Œå¯ä»¥é‡è½½ä¸€ä¸ªå‡½æ•°æ¨¡æ¿12345678910template&lt;class T1&gt; // é‡è½½ç‰ˆæœ¬ï¼ŒæŽ¥æ”¶å‚æ•°ä¸ºæŒ‡é’ˆT1 add(T1* a, T1* b) &#123; return *a + *b; &#125; int main()&#123; int a = 10, b = 20; int *x = &amp;a, *y = &amp;b; add(a, b); // è°ƒç”¨æ™®é€šæ¨¡æ¿ add(x, y); // è°ƒç”¨é‡è½½çš„æ¨¡æ¿ return 0;&#125;å¦‚ä¸Šï¼Œå¦‚æžœéœ€è¦ä¸€ä¸ªæŽ¥æ”¶æŒ‡é’ˆçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨é‡è½½æ¨¡æ¿å®žçŽ°å‡½æ•°æ¨¡æ¿ä¸å­˜åœ¨åç‰¹åŒ–ç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿æ—¢æœ‰å…¨ç‰¹åŒ–ï¼Œåˆæœ‰åç‰¹åŒ–è¿™é‡Œé‡æ–°å†™ä¸€ä¸ªæ›´ä¸€èˆ¬çš„æ¨¡æ¿ç±»æ¥è¯´æ˜Žç±»æ¨¡æ¿çš„ç‰¹ä¾‹åŒ–ç±»æ¨¡æ¿å…¨ç‰¹åŒ–æ¯”è¾ƒå¥½ç†è§£ï¼Œè·Ÿå‡½æ•°æ¨¡æ¿ä¸€æ ·ï¼Œå…¨ç‰¹åŒ–æ˜¯ä¸€ä¸ªå®žä¾‹ï¼Œå½“ç¼–è¯‘å™¨åŒ¹é…æ—¶ä¼šä¼˜å…ˆåŒ¹é…å‚æ•°ä¸€è‡´çš„å®žä¾‹123456789template&lt; &gt; // æ³¨æ„è¯­æ³•class A&lt;char*&gt; // ä¸€ä¸ªå…¨ç‰¹åŒ–çš„æ¨¡æ¿ç±»A&#123; // å½“ç”¨char*ç±»åž‹æ¥å®žä¾‹åŒ–ç±»æ¨¡æ¿Aæ—¶ï¼Œå°†ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªå…¨ç‰¹åŒ–å®žä¾‹public: explicit A(char* val) : t(val) &#123; &#125; char* add(char* a, char* b) &#123; return strcat(a, b); &#125;private: char* t;&#125;;ç±»æ¨¡æ¿çš„åç‰¹åŒ–ç±»æ¨¡æ¿çš„åç‰¹åŒ–ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå®ƒæœ‰å¤šç§å½¢å¼ç±»æ¨¡æ¿åç‰¹åŒ–æœ¬è´¨ä¸Šéƒ½æ˜¯æŒ‡å®šéƒ¨åˆ†ç±»åž‹ï¼Œè®©åç‰¹åŒ–ç‰ˆæœ¬ç§°ä¸ºæ™®é€šç‰ˆæœ¬çš„å­é›†ï¼Œè‹¥å®žä¾‹åŒ–æ—¶å‚æ•°ç±»åž‹ä¸ºæŒ‡å®šçš„ç±»åž‹ï¼Œåˆ™ä¼˜å…ˆè°ƒç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ç¬¬ä¸€ç§å½¢å¼12345template&lt;class T1, class T2&gt; // æ™®é€šç‰ˆæœ¬ï¼Œæœ‰ä¸¤ä¸ªæ¨¡æ¿å‚æ•°class B &#123; ..... &#125;;template&lt;class T2&gt; // åç‰¹åŒ–ç‰ˆæœ¬ï¼ŒæŒ‡å®šå…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œå³æŒ‡å®šäº†éƒ¨åˆ†ç±»åž‹class B&lt;int , T2&gt; &#123; ..... &#125;; // å½“å®žä¾‹åŒ–æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºint åˆ™ä¼šä¼˜å…ˆè°ƒç”¨è¿™ä¸ªç‰ˆæœ¬ç¬¬äºŒç§å½¢å¼ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ç‰ˆæœ¬12345678template&lt;class T&gt; // æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt; //è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæŽ¥æ”¶æŒ‡é’ˆç±»åž‹çš„æ¨¡æ¿å®žå‚ class B&lt;T*&gt; &#123; ..... &#125;; template&lt;class T&gt;class B&lt;T&amp;&gt; &#123; ..... &#125;; // è¿™ä¸ªåç‰¹åŒ–ç‰ˆæœ¬åªæŽ¥å—å¼•ç”¨ç±»åž‹çš„æ¨¡æ¿å®žå‚ç¬¬ä¸‰ç§å½¢å¼12345template&lt;class T&gt; //æ™®é€šç‰ˆæœ¬class B &#123; ..... &#125;;template&lt;class T&gt; // è¿™ç§åªæŽ¥å—ç”¨Tå®žä¾‹åŒ–çš„vectorçš„æ¨¡æ¿å®žå‚ï¼Žä¹Ÿæ˜¯ä¸€ç§åç‰¹åŒ–class B&lt;vector&lt;T&gt;&gt; &#123; ...... &#125;;å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼‘ï¼Žç‰¹ä¾‹åŒ–æœ¬è´¨ä¸Šæ˜¯æˆ‘ä»¬é¡¶æ›¿äº†ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸®ç¼–è¯‘å™¨åšäº†ç±»åž‹æŽ¨å¯¼ï¼’ï¼Žå…¨ç‰¹åŒ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå®žä¾‹ï¼Œè€Œåç‰¹åŒ–æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œåªæ˜¯åŽŸæ¥æ¨¡æ¿çš„ä¸€ä¸ªå­é›†ï¼“ï¼Žæ‰€ä»¥å…¨ç‰¹åŒ–çš„å‡½æ•°æ¨¡æ¿ï¼Œæœ¬è´¨ä¸Šæ˜¯å®žä¾‹ï¼Œä»Žè€Œä¸ä¼šä¸Žå‡½æ•°æ¨¡æ¿äº§ç”ŸäºŒä¹‰æ€§ï¼”ï¼Žè‹¥æƒ³è®©ç”¨æˆ·èƒ½ä½¿ç”¨ç‰¹ä¾‹åŒ–ç‰ˆæœ¬ï¼Œç‰¹ä¾‹åŒ–ç‰ˆæœ¬å¿…é¡»ä¸Žæ¨¡æ¿å®šä¹‰åœ¨åŒä¸€ä¸ª.hå¤´æ–‡ä»¶ä¸­STLä¸­çš„è¿­ä»£å™¨å®žçŽ°ä¸Žé«˜æ•ˆå®žçŽ°ä¸Žæ¨¡æ¿åç‰¹åŒ–æ¯æ¯ç›¸å…³ï¼Žç±»æ¨¡æ¿åç‰¹åŒ–ä¸ŽSTLåç‰¹åŒ–åœ¨STLä¸­æœ€é‡è¦çš„ä¸¤ä¸ªåº”ç”¨ï¼‘ï¼Žåº”ç”¨åœ¨è¿­ä»£å™¨è®¾è®¡ä¸­ï¼Œä¸ºäº†ä½¿è¿­ä»£å™¨æ—¢å¯ä»¥èƒå–å‡ºå€¼ç±»åž‹ï¼Œåˆå¯ä»¥åŒ…å®¹åŽŸç”ŸæŒ‡é’ˆå¦‚æžœè¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å°±èƒ½çŸ¥é“å®ƒçš„å€¼ç±»åž‹ï¼Œé‚£ä¹ˆä¸€èˆ¬ä¼šä½¿ç”¨iterator_traitsè¿­ä»£å™¨èƒå–æŠ€æœ¯çš„ä¸¤ä¸ªæ ¸å¿ƒæ˜¯ï¼šï¼‘ï¼‰åœ¨æ¯ä¸ªè¿­ä»£å™¨ç±»ä¸­å®šä¹‰value_typeå€¼ç±»åž‹çš„ç±»åž‹æˆå‘˜ï¼Œè¿™æ ·ç›´æŽ¥é€šè¿‡è¿­ä»£å™¨çš„value_typeç±»åž‹æˆå‘˜å°±å¯ä»¥çŸ¥é“å€¼ç±»åž‹ï¼’ï¼‰é—®é¢˜å°±åœ¨äºŽï¼Œè¿­ä»£å™¨å¿…é¡»å…¼å®¹åŽŸç”ŸæŒ‡é’ˆï¼Œè€ŒåŽŸç”ŸæŒ‡é’ˆå¾ˆéš¾è¢«é‡æ–°å®šä¹‰ï¼Œå³è¦åœ¨åŽŸç”ŸæŒ‡é’ˆçš„ç±»ä¸­æ·»åŠ value_typeçš„å€¼ç±»åž‹çš„ç±»åž‹æˆå‘˜ï¼Žè¿™æ—¶å€™ï¼Œé çš„å°±æ˜¯ç±»æ¨¡æ¿çš„åç‰¹åŒ–äº†ï¼Žæ–°æ·»åŠ ä¸€å±‚iterator_traitsç±»ï¼Œä¸“é—¨èƒå–è¿­ä»£å™¨çš„å±žæ€§ï¼Œç„¶åŽå†å¯¹iterator_traitsç±»è®¾è®¡åŽŸç”ŸæŒ‡é’ˆä¸ŽåŽŸç”Ÿå¼•ç”¨çš„åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå°±è§£å†³äº†è¿™ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼’ï¼Ž type_traitsç±»åž‹èƒå–ï¼Œå¯¹å¾…ç‰¹æ®Šç±»åž‹ï¼Œç‰¹æ®Šå¤„ç†ï¼Œæé«˜æ•ˆçŽ‡å¯¹äºŽæ²¡æœ‰æž„é€ å‡½æ•°ï¼Œæžæž„å‡½æ•°ç­‰çš„å†…ç½®ç±»åž‹ï¼Œå¦‚æžœä¸Žå¤æ‚ç±»åž‹ä¸€æ ·ï¼Œæ‰§è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¾ç„¶æ˜¯æ•ˆçŽ‡ä¸é«˜çš„å…ˆå®žçŽ°ä¸€ä¸ªå¯¹æ‰€æœ‰ç±»åž‹éƒ½è®¾ç½®ä¸€ä¸ªæœ€ä¿å®ˆå€¼çš„type_traitsæ¨¡æ¿ç±»ï¼Œç„¶åŽå†å¯¹æ¯ä¸ªå†…ç½®ç±»åž‹è®¾ç½®åç‰¹åŒ–ç‰ˆæœ¬ï¼Œå†…ç½®ç±»åž‹è®¾ç½®ä¸€ä¸ªæ›´ä¸ºæ¿€è¿›çš„å€¼ï¼Œè¡¨æ˜Žå¯ä»¥é‡‡å–æ›´ä¸ºé«˜æ•ˆçš„æ“ä½œæ¥æé«˜æ•ˆçŽ‡æ¯”å¦‚copyå‡½æ•°ï¼Œå¦‚æžœä¼ é€’çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚ç±»åž‹ï¼Œé‚£ä¹ˆå¯èƒ½åªèƒ½é‡‡å–æœ€ä¿å®ˆçš„å¤„ç†æ–¹å¼ï¼Œä¸€ä¸ªä¸€ä¸ªçš„æž„é€ ï¼›å¦‚æžœæ˜¯å†…ç½®ç±»åž‹ï¼Œè¿™æ ·æ˜¾ç„¶å¤ªä½Žæ•ˆï¼Œä½¿ç”¨memcpy()å¯èƒ½ä¼šå¥½ä¸€äº›å…¶å®žiterator_traitsä¹Ÿä¸æ­¢æ˜¯å¤„ç†å…¼å®¹åŽŸç”ŸæŒ‡é’ˆçš„é—®é¢˜ï¼Œå®ƒä¹Ÿå¯ä»¥æé«˜æ•ˆçŽ‡ï¼Žè¿­ä»£å™¨åˆ†ä¸ºå¾ˆå¤šç§ï¼Œæœ‰å¯ä»¥éšæœºè®¿é—®çš„ï¼ˆvectorï¼‰ï¼Œæœ‰åªèƒ½å‰åŽä¸€ä¸ªä¸€ä¸ªç§»åŠ¨çš„ï¼ˆlistï¼‰,ä¹Ÿæœ‰åªèƒ½å•å‘ç§»åŠ¨çš„ï¼ˆslistï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬æŠŠè¿­ä»£å™¨åˆ†ä¸ºäº”ç§ï¼šInputIterator è¾“å…¥è¿­ä»£å™¨OutputIterator è¾“å‡ºè¿­ä»£å™¨ForwardIterator å•å‘è¿­ä»£å™¨BidirectionIterator åŒå‘è¿­ä»£å™¨RandomAccessIterator éšæœºè®¿é—®è¿­ä»£å™¨æ¯”å¦‚ä¸€ä¸ªadvance(n)å‡½æ•°ï¼Œå¯¹äºŽå•å‘è¿­ä»£å™¨åªèƒ½ä¸€ä¸ªä¸€ä¸ªç§»åŠ¨è¿‡åŽ»ï¼Œä½†æ˜¯è¿™ç§å®žçŽ°å¯¹äºŽéšæœºè®¿é—®è¿­ä»£å™¨æ˜¾ç„¶ä¸æ˜¯ç†æƒ³çš„å¤„ç†æ–¹å¼å¤„ç†çš„æ–¹å¼å°±æ˜¯å…ˆå®žçŽ°è¿™äº”ä¸ªç±»ï¼Œç”¨ä½œæ ‡è®°ç”¨ï¼Œåœ¨æ¯ä¸ªè¿­ä»£å™¨é‡Œé¢éƒ½å®šä¹‰è¿­ä»£å™¨ç±»åž‹çš„ç±»åž‹æˆå‘˜iterator_catagoryï¼Œå†å¯¹ä¸åŒç‰ˆæœ¬çš„è¿­ä»£å™¨å®žçŽ°ä¸åŒçš„advance(n)å¤„ç†æ–¹å¼æ¯”å¦‚stlä¸­æ·»åŠ å³å€¼å¼•ç”¨å…ƒæ¨¡æ¿çš„å®žçŽ°ï¼š1234567891011121314template&lt;typename _Tp, bool = __and_&lt;__not_&lt;is_reference&lt;_Tp&gt;&gt;, __not_&lt;is_void&lt;_Tp&gt;&gt;&gt;::value&gt; struct __add_rvalue_reference_helper &#123;typedef __Tp type; &#125;;template&lt;typename _Tp&gt; struct __add_rvalue_reference_helper&lt;__Tp, true&gt; &#123;typedef __Tp&amp;&amp; type; &#125;; template&lt;typename _Tp&gt;struct add_rvalue_reference: public __add_rvalue_reference_helper&lt;_Tp&gt;&#123; &#125;;å¯ä»¥å‘çŽ°è°ƒç”¨æ—¶ä¸€èˆ¬ä¸ºstatic_cast&lt;typenameadd_rvalue_reference&lt;T&gt;::type&gt;(__t),é¦–å…ˆä¼šåŒ¹é…æ³›åŒ–ç‰ˆæœ¬çš„å…ƒæ¨¡æ¿ç±»ï¼Œç¬¬äºŒä¸ªæ¨¡ç‰ˆå‚æ•°boolä¼šåŒ¹é…_Tpçš„ç±»åž‹ï¼Œå¦‚æžœåŽŸæ¥ä¸æ˜¯å¼•ç”¨ç±»åž‹çš„è¯å°±ç›´æŽ¥åŒ¹é…trueçš„åç‰¹åŒ–ç‰ˆæœ¬ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰ï¼Œå¦åˆ™falseä¸ºåŽŸæ³›åŒ–ç‰ˆæœ¬ã€‚çŸ­çŸ­å‡ è¡Œä»£ç å·²ç»å±•ç¤ºå‡ºäº†æ¨¡æ¿å/å…¨ç‰¹åŒ–çš„å¼ºå¤§åŒ¹é…åŠŸèƒ½ï¼]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾Žè½¬å‘]]></title>
    <url>%2Fposts%2Fdc484a2e%2F</url>
    <content type="text"><![CDATA[C++ä¸­çš„ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾Žè½¬å‘é˜…è¯»è¿™ç¯‡åšæ–‡éœ€è¦äº†è§£C++ä¸­çš„å·¦å€¼ï¼ˆlvalueï¼‰å’Œå³å€¼ï¼ˆrvalueï¼‰çš„æ¦‚å¿µï¼Œè¯¦æƒ…å‚è§æˆ‘çš„å¦å¤–ä¸€ç¯‡åšæ–‡ï¼šC++ç§»åŠ¨è¯­ä¹‰åŠæ‹·è´ä¼˜åŒ–ä¸‡èƒ½å¼•ç”¨å’Œå®Œç¾Žè½¬å‘å¤šæ¶‰åŠåˆ°æ¨¡æ¿çš„ä½¿ç”¨ï¼Œå¦‚è‹¥ä¸æ˜¯è‡ªå·±å†™æ¨¡æ¿ï¼Œåˆ™å¯ä¸ç”¨å…³å¿ƒä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š1234567891011121314151617#include &lt;iostream&gt;using std::cout;using std::endl;template&lt;typename T&gt;void func(T&amp; param) &#123; cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); return 0;&#125;è¿™æ ·ä¾‹å­çš„ç¼–è¯‘è¾“å‡ºéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æžœæˆ‘ä»¬ä¿®æ”¹æˆä¸‹é¢çš„è°ƒç”¨æ–¹å¼å‘¢ï¼Ÿ1234int main() &#123; func(2019); return 0;&#125;åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªå¤§å¤§çš„ç¼–è¯‘é”™è¯¯ã€‚å› ä¸ºä¸Šé¢çš„æ¨¡æ¿å‡½æ•°åªèƒ½æŽ¥å—å·¦å€¼æˆ–è€…å·¦å€¼å¼•ç”¨ï¼ˆå·¦å€¼ä¸€èˆ¬æ˜¯æœ‰åå­—çš„å˜é‡ï¼Œå¯ä»¥å–åˆ°åœ°å€çš„ï¼‰ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥é‡è½½ä¸€ä¸ªæŽ¥å—å³å€¼çš„æ¨¡æ¿å‡½æ•°ï¼Œå¦‚ä¸‹ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæžœã€‚1234567891011121314151617template&lt;typename T&gt;void func(T&amp; param) &#123; cout &lt;&lt; "ä¼ å…¥çš„æ˜¯å·¦å€¼" &lt;&lt; endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; cout &lt;&lt; "ä¼ å…¥çš„æ˜¯å³å€¼" &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); func(2019); return 0;&#125;è¾“å‡ºç»“æžœï¼š12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å³å€¼ç¬¬ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å·¦å€¼å¾—ç‰ˆæœ¬ï¼Œç¬¬äºŒæ¬¡å‡½æ•°è°ƒç”¨çš„æ˜¯å³å€¼ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼Œæœ‰æ²¡æœ‰åŠžæ³•åªå†™ä¸€ä¸ªæ¨¡æ¿å‡½æ•°å³å¯ä»¥æŽ¥æ”¶å·¦å€¼åˆå¯ä»¥æŽ¥æ”¶å³å€¼å‘¢ï¼ŸC++ 11ä¸­æœ‰ä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰çš„æ¦‚å¿µï¼šä½¿ç”¨T&amp;&amp;ç±»åž‹çš„å½¢å‚æ—¢èƒ½ç»‘å®šå³å€¼ï¼Œåˆèƒ½ç»‘å®šå·¦å€¼ã€‚ä½†æ˜¯æ³¨æ„äº†ï¼šåªæœ‰å‘ç”Ÿç±»åž‹æŽ¨å¯¼çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰è¡¨ç¤ºä¸‡èƒ½å¼•ç”¨ï¼› å¦åˆ™ï¼Œè¡¨ç¤ºå³å€¼å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œä¸Šé¢çš„æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸ºï¼š123456789101112template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; cout &lt;&lt; param &lt;&lt; endl;&#125;int main() &#123; int num = 2019; func(num); func(2019); return 0;&#125;å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰ä¸‡èƒ½å¼•ç”¨è¯´å®Œäº†ï¼ŒæŽ¥ç€æ¥èŠå¼•ç”¨æŠ˜å ï¼ˆUnivers Collapseï¼‰ï¼Œå› ä¸ºå®Œç¾Žè½¬å‘ï¼ˆPerfect Forwardingï¼‰çš„æ¦‚å¿µæ¶‰åŠå¼•ç”¨æŠ˜å ã€‚ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œæ ¹æ®å®šä¹‰çš„å½¢å‚å’Œä¼ å…¥çš„å®žå‚çš„ç±»åž‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸‹é¢å››ä¸­ç»„åˆï¼šå·¦å€¼-å·¦å€¼ T&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»åž‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®žå‚æ˜¯å·¦å€¼å¼•ç”¨å·¦å€¼-å³å€¼ T&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»åž‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®žå‚æ˜¯å³å€¼å¼•ç”¨å³å€¼-å·¦å€¼ T&amp;&amp; &amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»åž‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®žå‚æ˜¯å·¦å€¼å¼•ç”¨å³å€¼-å³å€¼ T&amp;&amp; &amp;&amp; # å‡½æ•°å®šä¹‰çš„å½¢å‚ç±»åž‹æ˜¯å³å€¼å¼•ç”¨ï¼Œä¼ å…¥çš„å®žå‚æ˜¯å³å€¼å¼•ç”¨ä½†æ˜¯C++ä¸­ä¸å…è®¸å¯¹å¼•ç”¨å†è¿›è¡Œå¼•ç”¨ï¼Œå¯¹äºŽä¸Šè¿°æƒ…å†µçš„å¤„ç†æœ‰å¦‚ä¸‹çš„è§„åˆ™ï¼šæ‰€æœ‰çš„æŠ˜å å¼•ç”¨æœ€ç»ˆéƒ½ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å·¦å€¼å¼•ç”¨ï¼Œè¦ä¹ˆæ˜¯å³å€¼å¼•ç”¨ã€‚è§„åˆ™æ˜¯ï¼šå¦‚æžœä»»ä¸€å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ï¼Œåˆ™ç»“æžœä¸ºå·¦å€¼å¼•ç”¨ã€‚å¦åˆ™ï¼ˆå³ä¸¤ä¸ªéƒ½æ˜¯å³å€¼å¼•ç”¨ï¼‰ï¼Œç»“æžœä¸ºå³å€¼å¼•ç”¨ã€‚å³å°±æ˜¯å‰é¢ä¸‰ç§æƒ…å†µä»£è¡¨çš„éƒ½æ˜¯å·¦å€¼å¼•ç”¨ï¼Œè€Œç¬¬å››ç§ä»£è¡¨çš„å³å€¼å¼•ç”¨ã€‚å®Œç¾Žè½¬å‘ï¼ˆPerfect Forwardingï¼‰ä¸‹é¢æŽ¥ç€è¯´å®Œç¾Žè½¬å‘ï¼ˆPerfect Forwardingï¼‰ï¼Œé¦–å…ˆï¼Œçœ‹2ä¸ªä¾‹å­ï¼šðŸŒ°æ —å­[1]è¦äº†è§£å®Œç¾Žè½¬å‘ï¼Œå…ˆå¾—æ¸…æ¥šæ¨¡æ¿Tçš„æŽ¨å¯¼è¿‡ç¨‹ï¼Œåœ¨æ²¡æœ‰åç‰¹åŒ–çš„æ¨¡ç‰ˆå‰æä¸‹ï¼Œæ¨¡æ¿æ€»æ˜¯æ ¹æ®æœ€åŒ¹é…çš„è§„åˆ™æ¥æŽ¨å¯¼å‚æ•°ï¼Œå¯ä»¥æ ¹æ®ä¸‹é¢çš„ä¾‹å­æ¥çœ‹å‡ºæŽ¨å¯¼è¿‡ç¨‹ã€‚12345678910111213141516171819202122232425262728template &lt;typename T&gt;void func(T&amp;&amp; arg) &#123; auto is_lval = std::is_lvalue_reference&lt;T&gt;::value; auto is_rval = std::is_rvalue_reference&lt;T&gt;::value; if(std::is_same&lt;T, int&gt;::value) &#123; std::cout &lt;&lt; "'T' is type[int]" &lt;&lt; " ?is lvalue reference:" &lt;&lt; is_lval &lt;&lt; " ?is rvalue reference:" &lt;&lt; is_rval &lt;&lt; " arg:" &lt;&lt; arg &lt;&lt; std::endl; &#125; else if(std::is_same&lt;T, int&amp;&gt;::value) &#123; std::cout &lt;&lt; "'T' is type[int&amp;]" &lt;&lt; " ?is lvalue reference:" &lt;&lt; is_lval &lt;&lt; " ?is rvalue reference:" &lt;&lt; is_rval &lt;&lt; " arg:" &lt;&lt; arg &lt;&lt; std::endl; &#125; else if(std::is_same&lt;T, int&amp;&amp;&gt;::value) &#123; std::cout &lt;&lt; "'T' is type[int&amp;&amp;]" &lt;&lt; " ?is lvalue reference:" &lt;&lt; is_lval &lt;&lt; " ?is rvalue reference:" &lt;&lt; is_rval &lt;&lt; " arg:" &lt;&lt; arg &lt;&lt; std::endl; &#125; std::cout &lt;&lt; "-----------------" &lt;&lt; std::endl;&#125;int main() &#123; int a = 1; func(a); func(2); func(static_cast&lt;int&amp;&gt;(a)); func(static_cast&lt;int&amp;&amp;&gt;(a));&#125;è¾“å‡ºç»“æžœä¸ºï¼š12345678'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:2-----------------'T' is type[int&amp;] ?is lvalue reference:1 ?is rvalue reference:0 arg:1-----------------'T' is type[int] ?is lvalue reference:0 ?is rvalue reference:0 arg:1-----------------å¯ä»¥å‘çŽ°ï¼Œå½“å®žå‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„æ–¹å¼æŽ¨å¯¼æ—¶ï¼Œå·¦å€¼ä¼ é€’Tä¸ºint&amp;ï¼Œå³å€¼ä¼ é€’Tä¸ºintã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå¦‚æžœå°†æ¨¡ç‰ˆå‚æ•°æ˜¾ç¤ºç»‘å®šï¼š1234567int main() &#123; int a = 1; func&lt;int&gt;(a); //é”™è¯¯âŒ func&lt;int&gt;(2); func&lt;int&amp;&gt;(static_cast&lt;int&amp;&gt;(a)); func&lt;int&amp;&amp;&gt;(static_cast&lt;int&amp;&amp;&gt;(a));&#125;ä¼šå‘çŽ°æ— æ³•ç¼–è¯‘é€šè¿‡ï¼š1234In function 'int main()'error: no matching for call to 'func(int&amp;)' func&lt;int&gt;(a); ...æ ¹æ®C++ Primerä¸­æ–‡ç‰ˆ(ç¬¬äº”ç‰ˆ) 18ç« ç¬¬2èŠ‚æ¨¡æ¿å®žå‚æŽ¨æ–­Note:å¦‚æžœä¸€ä¸ªå‡½æ•°å‚æ•°æ˜¯æŒ‡å‘æ¨¡ç‰ˆæ¿å‚æ•°ç±»åž‹çš„å³å€¼å¼•ç”¨(å¦‚ï¼ŒT&amp;&amp;)ï¼Œåˆ™å¯ä»¥ä¼ é€’ç»™å®ƒä»»æ„ç±»åž‹çš„å®žå‚ã€‚å¦‚æžœå°†ä¸€ä¸ªå·¦å€¼ä¼ é€’ç»™è¿™æ ·çš„å‚æ•°ï¼Œåˆ™å‡½æ•°å‚æ•°è¢«å®žä¾‹åŒ–ä¸ºä¸€ä¸ªæ™®é€šçš„å·¦å€¼å¼•ç”¨(T&amp;)ã€‚ï¼Œä¼°è®¡æ˜¯ç¼–è¯‘å™¨åšäº†ç‰¹æ®Šçš„å¤„ç†ã€‚ç”±äºŽintæ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥åªèƒ½æ ¹æ®å¼•ç”¨æŠ˜å ï¼ˆUniversal Collapseï¼‰è§„åˆ™ï¼Œint&amp; &amp;&amp;=int&amp;ï¼Œint &amp;&amp;= int&amp;&amp;ã€‚ä¿ç•™äº†å‚æ•°çš„å·¦å€¼å³å€¼ç‰¹æ€§ã€‚è¿™ä¹Ÿç¬¦åˆå¼•ç”¨æŠ˜å è§„åˆ™ã€‚å½“å®žå‚æ•°ä»¥å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„æ–¹å¼æŽ¨å¯¼æ—¶ï¼Œint&amp;è¿˜æ˜¯æ— æ³•åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥T=int&amp;ï¼Œè€Œint&amp;&amp;åˆšå¥½åŒ¹é…T&amp;&amp;ï¼Œæ‰€ä»¥Tå°±æ˜¯intã€‚ðŸŒ°æ —å­[2]ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿè°ƒç”¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬åœ¨std::forwardå‡½æ•°copyå‡ºæ¥ï¼Œå¢žåŠ è¾“å‡ºä¸€æ¡å†…å®¹ï¼Œæ”¹ä¸ºtest::forwardï¼Œå…¶ä»–ä¿æŒä¸å˜ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445#include &lt;iostream&gt;#include &lt;bits/move.h&gt;// add print contentnamespace test&#123;template&lt;typename _Tp&gt; constexpr _Tp&amp;&amp; forward(typename std::remove_reference&lt;_Tp&gt;::type&amp; __t) noexcept &#123; std::cout &lt;&lt; "Forward an l-value." &lt;&lt; std::endl; return static_cast&lt;_Tp&amp;&amp;&gt;(__t); &#125;template&lt;typename _Tp&gt; constexpr _Tp&amp;&amp; forward(typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp; __t) noexcept &#123; std::cout &lt;&lt; "Forward an r-value." &lt;&lt; std::endl; static_assert(!std::is_lvalue_reference&lt;_Tp&gt;::value, "template argument" " substituting _Tp is an lvalue reference type"); return static_cast&lt;_Tp&amp;&amp;&gt;(__t); &#125;&#125;// my template functionstemplate&lt;typename T&gt;void func(T&amp; param) &#123; std::cout &lt;&lt; "ä¼ å…¥çš„æ˜¯å·¦å€¼" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void func(T&amp;&amp; param) &#123; std::cout &lt;&lt; "ä¼ å…¥çš„æ˜¯å³å€¼" &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(param);&#125;extern "C" &#123;int main(int argc, char* argv[]) &#123; int num = 2019; warp(num); warp(2019); return 0;&#125;&#125;è¾“å‡ºç»“æžœä¸ºï¼š12ä¼ å…¥çš„æ˜¯å·¦å€¼ä¼ å…¥çš„æ˜¯å·¦å€¼æ˜¯ä¸æ˜¯å’Œæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€æ ·ï¼Œä¸‹é¢æˆ‘ä»¬æ¥åˆ†æžä¸€ä¸‹åŽŸå› ï¼šwarp()å‡½æ•°æœ¬èº«çš„å½¢å‚æ˜¯ä¸€ä¸ªä¸‡èƒ½å¼•ç”¨ï¼Œå³å¯ä»¥æŽ¥å—å·¦å€¼åˆå¯ä»¥æŽ¥å—å³å€¼ï¼›ç¬¬ä¸€ä¸ªwarp()å‡½æ•°è°ƒç”¨å®žå‚æ˜¯å·¦å€¼ï¼Œæ‰€ä»¥ï¼Œwarp()å‡½æ•°ä¸­è°ƒç”¨func()ä¸­ä¼ å…¥çš„å‚æ•°ä¹Ÿåº”è¯¥æ˜¯å·¦å€¼ï¼›ç¬¬äºŒä¸ªwarp()å‡½æ•°è°ƒç”¨å®žå‚æ˜¯å³å€¼ï¼Œæ ¹æ®ä¸Šé¢æ‰€è¯´çš„å¼•ç”¨æŠ˜å è§„åˆ™ï¼Œwarp()å‡½æ•°æŽ¥æ”¶çš„å‚æ•°ç±»åž‹æ˜¯å³å€¼å¼•ç”¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå´è°ƒç”¨äº†è°ƒç”¨func()çš„å·¦å€¼ç‰ˆæœ¬äº†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨warp()å‡½æ•°å†…éƒ¨ï¼Œå³å€¼å¼•ç”¨ç±»åž‹å˜ä¸ºäº†å·¦å€¼ï¼Œå› ä¸ºå‚æ•°æœ‰äº†åç§°ï¼Œæˆ‘ä»¬ä¹Ÿé€šè¿‡å˜é‡åå–å¾—å˜é‡åœ°å€ã€‚ç»“è®ºï¼šæ— è®ºä¼ å…¥wrap()çš„å‚æ•°æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œåˆ°äº†å‡½æ•°å†…éƒ¨éƒ½å˜æˆäº†å·¦å€¼ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ€Žä¹ˆä¿æŒå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå˜é‡ç±»åž‹çš„ä¸å˜å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„â€œå®Œç¾Žè½¬å‘â€æŠ€æœ¯ï¼Œåœ¨C++11ä¸­é€šè¿‡std::forward()å‡½æ•°æ¥å®žçŽ°ã€‚æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„warp()å‡½æ•°å¦‚ä¸‹ï¼š1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(test::forward&lt;T&gt;(param));&#125;è¾“å‡ºç»“æžœä¸ºï¼š1234Forward an l-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an l-value.ä¼ å…¥çš„æ˜¯å³å€¼çŽ°åœ¨è·Ÿæˆ‘ä»¬çš„é¢„æœŸä¸€è‡´äº†ï¼Œä½†æ˜¯åŽŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè§‚å¯Ÿforward()å‡½æ•°å†…éƒ¨ä¸éš¾å‘çŽ°ï¼Œä¼ å…¥çš„å‚æ•°åšäº†ç§»é™¤å¼•ç”¨çš„æ“ä½œï¼Œä½¿å…¶éƒ½ä¸º&amp;&amp; æˆ– &amp;ï¼Œæ‰€ä»¥æœ‰2ä¸ªå‡½æ•°ç‰ˆæœ¬ï¼Œé‡ç‚¹åœ¨äºŽæ¨¡ç‰ˆè¿”å›žçš„æ—¶å€™return static_cast&lt;_Tp&amp;&amp;&gt;(__t);å¼ºåˆ¶å°†å®žå‚è½¬æ¢æˆTåŽŸæœ‰çš„å¼•ç”¨ç±»åž‹ï¼Œæ ¹æ®å¼•ç”¨æŠ˜å åŽŸåˆ™ï¼ŒT&amp;&amp; &amp;è¿˜æ˜¯&amp;ï¼ŒT&amp;&amp; &amp;&amp;è¿˜æ˜¯&amp;&amp;ã€‚æ‰€ä»¥å®žçŽ°äº†â€œå®Œç¾Žè½¬å‘â€ã€‚å¦‚æžœå°†wrap()å‡½æ•°æ”¹ä¸ºè¿™æ ·å‘¢ï¼Ÿ1234template&lt;typename T&gt;void warp(T&amp;&amp; param) &#123; func(test::forward&lt;T&gt;(std::move(param)));&#125;ç¼–è¯‘ç»“æžœï¼š12Errorï¼šstatic_assert(template argument substituting _Tp is an lvalue reference type");å¯ä»¥å‘çŽ°æˆåŠŸèµ°åˆ°äº†ç¬¬äºŒä¸ªforward()å‡½æ•°ç‰ˆæœ¬ã€‚å°†static_assert&lt;&gt;æ³¨é‡ŠæŽ‰ï¼Œç¼–è¯‘é€šè¿‡ã€‚è¾“å‡ºç»“æžœä¸ºï¼š1234Forward an r-value.ä¼ å…¥çš„æ˜¯å·¦å€¼Forward an r-value.ä¼ å…¥çš„æ˜¯å³å€¼å¯¹æ¯”std::move()çš„è¿”å›žå€¼å°±å¯ä»¥å‘çŽ°ï¼Œå®ƒçš„è¿”å›žå€¼æ˜¯return static_cast&lt;typename std::remove_reference&lt;_Tp&gt;::type&amp;&amp;&gt;(__t);ä¸éš¾çœ‹å‡ºï¼Œå¿…æ˜¯å³å€¼å¼•ç”¨ã€‚è€Œstd::forward()å‡½æ•°åˆ™å°†å…¶æŒ‰Tçš„å¼•ç”¨ç±»åž‹ä¿æŒä¸å˜åŽŸæ ·è¿”å›žã€‚]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Ž4è¡Œä»£ç çœ‹å³å€¼å¼•ç”¨]]></title>
    <url>%2Fposts%2F9d2f4ec8%2F</url>
    <content type="text"><![CDATA[æ¦‚è¿° å³å€¼å¼•ç”¨çš„æ¦‚å¿µæœ‰äº›è¯»è€…å¯èƒ½ä¼šæ„Ÿåˆ°é™Œç”Ÿï¼Œå…¶å®žä»–å’ŒC++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æœ‰äº›ç±»ä¼¼ï¼Œä¾‹å¦‚ï¼Œc++98/03ä¸­çš„å·¦å€¼å¼•ç”¨æ˜¯è¿™æ ·çš„ï¼š12int i = 0;int&amp; j = i; è¿™é‡Œçš„int&amp;æ˜¯å¯¹å·¦å€¼è¿›è¡Œç»‘å®šï¼ˆä½†æ˜¯int&amp;å´ä¸èƒ½ç»‘å®šå³å€¼ï¼‰ï¼Œç›¸åº”çš„ï¼Œå¯¹å³å€¼è¿›è¡Œç»‘å®šçš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œä»–çš„è¯­æ³•æ˜¯è¿™æ ·çš„A&amp;&amp;ï¼Œé€šè¿‡åŒå¼•å·æ¥è¡¨ç¤ºç»‘å®šç±»åž‹ä¸ºAçš„å³å€¼ã€‚é€šè¿‡&amp;&amp;æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šå³å€¼äº†ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç»‘å®šä¸€ä¸ªå³å€¼ï¼š 1int&amp;&amp; i = 0; è¿™é‡Œæˆ‘ä»¬ç»‘å®šäº†ä¸€ä¸ªå³å€¼0ï¼Œå…³äºŽå³å€¼çš„æ¦‚å¿µä¼šåœ¨åŽé¢ä»‹ç»ã€‚å³å€¼å¼•ç”¨æ˜¯C++11ä¸­æ–°å¢žåŠ çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä»–ä¸»æ˜¯è¦ç”¨æ¥è§£å†³C++98/03ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸´æ—¶å¯¹è±¡éžå¿…è¦çš„æ˜‚è´µçš„æ‹·è´æ“ä½œï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨æ¨¡æ¿å‡½æ•°ä¸­å¦‚ä½•æŒ‰ç…§å‚æ•°çš„å®žé™…ç±»åž‹è¿›è¡Œè½¬å‘ã€‚é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨ï¼Œå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ”¹è¿›äº†ç¨‹åºæ€§èƒ½ï¼ŒåŽé¢å°†ä¼šè¯¦ç»†ä»‹ç»å³å€¼å¼•ç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„ã€‚ å’Œå³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼Œæ¯”å¦‚ï¼šå³å€¼ã€çº¯å³å€¼ã€å°†äº¡å€¼ã€universal referencesã€å¼•ç”¨æŠ˜å ã€ç§»åŠ¨è¯­ä¹‰ã€moveè¯­ä¹‰å’Œå®Œç¾Žè½¬å‘ç­‰ç­‰ã€‚å¾ˆå¤šéƒ½æ˜¯æ–°æ¦‚å¿µï¼Œå¯¹äºŽåˆšå­¦ä¹ C++11å³å€¼å¼•ç”¨çš„åˆå­¦è€…æ¥è¯´ï¼Œå¯èƒ½ä¼šè§‰å¾—å³å€¼å¼•ç”¨è¿‡äºŽå¤æ‚ï¼Œæ¦‚å¿µä¹‹é—´çš„å…³ç³»éš¾ä»¥ç†æ¸…ã€‚å³å€¼å¼•ç”¨å®žé™…ä¸Šå¹¶æ²¡æœ‰é‚£ä¹ˆå¤æ‚ï¼Œå…¶å®žæ˜¯å…³äºŽ4è¡Œä»£ç çš„æ•…äº‹ï¼Œé€šè¿‡ç®€å•çš„4è¡Œä»£ç æˆ‘ä»¬å°±èƒ½æ¸…æ™°çš„ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µäº†ã€‚æœ¬æ–‡å¸Œæœ›å¸¦é¢†è¯»è€…é€šè¿‡4è¡Œä»£ç æ¥ç†è§£å³å€¼å¼•ç”¨ç›¸å…³çš„æ¦‚å¿µï¼Œç†æ¸…ä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æœ€ç»ˆèƒ½é€å½»åœ°æŽŒæ¡C++11çš„æ–°ç‰¹æ€§â€“å³å€¼å¼•ç”¨ã€‚å››è¡Œä»£ç çš„æ•…äº‹ç¬¬1è¡Œä»£ç çš„æ•…äº‹1int i = getVar(); ä¸Šé¢çš„è¿™è¡Œä»£ç å¾ˆç®€å•ï¼Œä»ŽgetVar()å‡½æ•°èŽ·å–ä¸€ä¸ªæ•´å½¢å€¼ï¼Œç„¶è€Œï¼Œè¿™è¡Œä»£ç ä¼šäº§ç”Ÿå‡ ç§ç±»åž‹çš„å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¼šäº§ç”Ÿä¸¤ç§ç±»åž‹çš„å€¼ï¼Œä¸€ç§æ˜¯å·¦å€¼iï¼Œä¸€ç§æ˜¯å‡½æ•°getVar()è¿”å›žçš„ä¸´æ—¶å€¼ï¼Œè¿™ä¸ªä¸´æ—¶å€¼åœ¨è¡¨è¾¾å¼ç»“æŸåŽå°±é”€æ¯äº†ï¼Œè€Œå·¦å€¼iåœ¨è¡¨è¾¾å¼ç»“æŸåŽä»ç„¶å­˜åœ¨ï¼Œè¿™ä¸ªä¸´æ—¶å€¼å°±æ˜¯å³å€¼ï¼Œå…·ä½“æ¥è¯´æ˜¯ä¸€ä¸ªçº¯å³å€¼ï¼Œå³å€¼æ˜¯ä¸å…·åçš„ã€‚åŒºåˆ†å·¦å€¼å’Œå³å€¼çš„ä¸€ä¸ªç®€å•åŠžæ³•æ˜¯ï¼šçœ‹èƒ½ä¸èƒ½å¯¹è¡¨è¾¾å¼å–åœ°å€ï¼Œå¦‚æžœèƒ½ï¼Œåˆ™ä¸ºå·¦å€¼ï¼Œå¦åˆ™ä¸ºå³å€¼ã€‚ æ‰€æœ‰çš„å…·åå˜é‡æˆ–å¯¹è±¡éƒ½æ˜¯å·¦å€¼ï¼Œè€ŒåŒ¿åå˜é‡åˆ™æ˜¯å³å€¼ï¼Œæ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼è¯­å¥ï¼š1int i = 0; åœ¨è¿™æ¡è¯­å¥ä¸­ï¼Œi æ˜¯å·¦å€¼ï¼Œ0 æ˜¯å­—é¢é‡ï¼Œå°±æ˜¯å³å€¼ã€‚åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œi å¯ä»¥è¢«å¼•ç”¨ï¼Œ0 å°±ä¸å¯ä»¥äº†ã€‚å…·ä½“æ¥è¯´ä¸Šé¢çš„è¡¨è¾¾å¼ä¸­ç­‰å·å³è¾¹çš„0æ˜¯çº¯å³å€¼ï¼ˆprvalueï¼‰ï¼Œåœ¨C++11ä¸­æ‰€æœ‰çš„å€¼å¿…å±žäºŽå·¦å€¼ã€å°†äº¡å€¼ã€çº¯å³å€¼ä¸‰è€…ä¹‹ä¸€ã€‚æ¯”å¦‚ï¼Œéžå¼•ç”¨è¿”å›žçš„ä¸´æ—¶å˜é‡ã€è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ã€åŽŸå§‹å­—é¢é‡å’Œlambdaè¡¨è¾¾å¼ç­‰éƒ½æ˜¯çº¯å³å€¼ã€‚è€Œå°†äº¡å€¼æ˜¯C++11æ–°å¢žçš„ã€ä¸Žå³å€¼å¼•ç”¨ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ï¼Œå°†è¦è¢«ç§»åŠ¨çš„å¯¹è±¡ã€T&amp;&amp;å‡½æ•°è¿”å›žå€¼ã€std::moveè¿”å›žå€¼å’Œè½¬æ¢ä¸ºT&amp;&amp;çš„ç±»åž‹çš„è½¬æ¢å‡½æ•°çš„è¿”å›žå€¼ç­‰ã€‚å…³äºŽå°†äº¡å€¼æˆ‘ä»¬ä¼šåœ¨åŽé¢ä»‹ç»ï¼Œå…ˆçœ‹ä¸‹é¢çš„ä»£ç ï¼š123int j = 5;auto f = []&#123;return 5;&#125;; ä¸Šé¢çš„ä»£ç ä¸­5æ˜¯ä¸€ä¸ªåŽŸå§‹å­—é¢é‡ï¼Œ []{return 5;}æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œéƒ½æ˜¯å±žäºŽçº¯å³å€¼ï¼Œä»–ä»¬çš„ç‰¹ç‚¹æ˜¯åœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åŽå°±é”€æ¯äº†ã€‚ é€šè¿‡åœ°è¡Œä»£ç æˆ‘ä»¬å¯¹å³å€¼æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ï¼ŒçŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼ï¼ŒæŽ¥ä¸‹æ¥å†æ¥çœ‹çœ‹ç¬¬äºŒè¡Œä»£ç ã€‚ç¬¬2è¡Œä»£ç çš„æ•…äº‹1T&amp;&amp; k = getVar(); ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç å¾ˆåƒï¼Œåªæ˜¯ç›¸æ¯”ç¬¬ä¸€è¡Œä»£ç å¤šäº†â€œ&amp;&amp;â€ï¼Œä»–å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œæˆ‘ä»¬çŸ¥é“å·¦å€¼å¼•ç”¨æ˜¯å¯¹å·¦å€¼çš„å¼•ç”¨ï¼Œé‚£ä¹ˆï¼Œå¯¹åº”çš„ï¼Œå¯¹å³å€¼çš„å¼•ç”¨å°±æ˜¯å³å€¼å¼•ç”¨ï¼Œè€Œä¸”å³å€¼æ˜¯åŒ¿åå˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥èŽ·å–å³å€¼ã€‚è™½ç„¶ç¬¬äºŒè¡Œä»£ç å’Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥å·®åˆ«ä¸å¤§ï¼Œä½†æ˜¯å®žé™…ä¸Šè¯­ä¹‰çš„å·®åˆ«å¾ˆå¤§ï¼Œè¿™é‡Œï¼ŒgetVar()äº§ç”Ÿçš„ä¸´æ—¶å€¼ä¸ä¼šåƒç¬¬ä¸€è¡Œä»£ç é‚£æ ·ï¼Œåœ¨è¡¨è¾¾å¼ç»“æŸä¹‹åŽå°±é”€æ¯äº†ï¼Œè€Œæ˜¯ä¼šè¢«â€œç»­å‘½â€ï¼Œä»–çš„ç”Ÿå‘½å‘¨æœŸå°†ä¼šé€šè¿‡å³å€¼å¼•ç”¨å¾—ä»¥å»¶ç»­ï¼Œå’Œå˜é‡kçš„å£°æ˜Žå‘¨æœŸä¸€æ ·é•¿ã€‚å³å€¼å¼•ç”¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹ é€šè¿‡å³å€¼å¼•ç”¨çš„å£°æ˜Žï¼Œå³å€¼åˆâ€œé‡èŽ·æ–°ç”Ÿâ€ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸Žå³å€¼å¼•ç”¨ç±»åž‹å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·é•¿ï¼Œåªè¦è¯¥å˜é‡è¿˜æ´»ç€ï¼Œè¯¥å³å€¼ä¸´æ—¶é‡å°†ä¼šä¸€ç›´å­˜æ´»ä¸‹åŽ»ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹å³å€¼çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚ä»£ç æ¸…å•1-1æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-112345678910111213141516171819202122232425262728293031#include &lt;iostream&gt;using namespace std;int g_constructCount=0;int g_copyConstructCount=0;int g_destructCount=0;struct A&#123; A()&#123; cout&lt;&lt;"construct: "&lt;&lt;++g_constructCount&lt;&lt;endl; &#125; A(const A&amp; a) &#123; cout&lt;&lt;"copy construct: "&lt;&lt;++g_copyConstructCount &lt;&lt;endl; &#125; ~A() &#123; cout&lt;&lt;"destruct: "&lt;&lt;++g_destructCount&lt;&lt;endl; &#125;&#125;;A GetA()&#123; return A();&#125;int main() &#123; A a = GetA(); return 0;&#125; ä¸ºäº†æ¸…æ¥šçš„è§‚å¯Ÿä¸´æ—¶å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsç”¨æ¥å…³é—­è¿”å›žå€¼ä¼˜åŒ–æ•ˆæžœã€‚ è¾“å‡ºç»“æžœï¼š123456construct: 1copy construct: 1destruct: 1copy construct: 2destruct: 2destruct: 3 ä»Žä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰è¿”å›žå€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œæ‹·è´æž„é€ å‡½æ•°è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯GetA()å‡½æ•°å†…éƒ¨åˆ›å»ºçš„å¯¹è±¡è¿”å›žå‡ºæ¥æž„é€ ä¸€ä¸ªä¸´æ—¶å¯¹è±¡äº§ç”Ÿçš„ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨mainå‡½æ•°ä¸­æž„é€ aå¯¹è±¡äº§ç”Ÿçš„ã€‚ç¬¬äºŒæ¬¡çš„destructæ˜¯å› ä¸ºä¸´æ—¶å¯¹è±¡åœ¨æž„é€ aå¯¹è±¡ä¹‹åŽå°±é”€æ¯äº†ã€‚å¦‚æžœå¼€å¯è¿”å›žå€¼ä¼˜åŒ–çš„è¯ï¼Œè¾“å‡ºç»“æžœå°†æ˜¯ï¼šconstruct: 1destruct: 1 å¯ä»¥çœ‹åˆ°è¿”å›žå€¼ä¼˜åŒ–å°†ä¼šæŠŠä¸´æ—¶å¯¹è±¡ä¼˜åŒ–æŽ‰ï¼Œä½†è¿™ä¸æ˜¯c++æ ‡å‡†ï¼Œæ˜¯å„ç¼–è¯‘å™¨çš„ä¼˜åŒ–è§„åˆ™ã€‚æˆ‘ä»¬åœ¨å›žåˆ°ä¹‹å‰æåˆ°çš„å¯ä»¥é€šè¿‡å³å€¼å¼•ç”¨æ¥å»¶é•¿ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æžœä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬é€šè¿‡å³å€¼å¼•ç”¨æ¥ç»‘å®šå‡½æ•°è¿”å›žå€¼çš„è¯ï¼Œç»“æžœåˆä¼šæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿåœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹-fno-elide-constructorsã€‚123456789int main() &#123; A&amp;&amp; a = GetA(); return 0;&#125;è¾“å‡ºç»“æžœï¼šconstruct: 1copy construct: 1destruct: 1destruct: 2 é€šè¿‡å³å€¼å¼•ç”¨ï¼Œæ¯”ä¹‹å‰å°‘äº†ä¸€æ¬¡æ‹·è´æž„é€ å’Œä¸€æ¬¡æžæž„ï¼ŒåŽŸå› åœ¨äºŽå³å€¼å¼•ç”¨ç»‘å®šäº†å³å€¼ï¼Œè®©ä¸´æ—¶å³å€¼çš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿äº†ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹åšä¸€äº›æ€§èƒ½ä¼˜åŒ–ï¼Œå³é¿å…ä¸´æ—¶å¯¹è±¡çš„æ‹·è´æž„é€ å’Œæžæž„ï¼Œäº‹å®žä¸Šï¼Œåœ¨c++98/03ä¸­ï¼Œé€šè¿‡å¸¸é‡å·¦å€¼å¼•ç”¨ä¹Ÿç»å¸¸ç”¨æ¥åšæ€§èƒ½ä¼˜åŒ–ã€‚ä¸Šé¢çš„ä»£ç æ”¹æˆï¼š const A&amp; a = GetA(); è¾“å‡ºçš„ç»“æžœå’Œå³å€¼å¼•ç”¨ä¸€æ ·ï¼Œå› ä¸ºå¸¸é‡å·¦å€¼å¼•ç”¨æ˜¯ä¸€ä¸ªâ€œä¸‡èƒ½â€çš„å¼•ç”¨ç±»åž‹ï¼Œå¯ä»¥æŽ¥å—å·¦å€¼ã€å³å€¼ã€å¸¸é‡å·¦å€¼å’Œå¸¸é‡å³å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æ™®é€šçš„å·¦å€¼å¼•ç”¨ä¸èƒ½æŽ¥å—å³å€¼ï¼Œæ¯”å¦‚è¿™æ ·çš„å†™æ³•æ˜¯ä¸å¯¹çš„ï¼š A&amp; a = GetA(); ä¸Šé¢çš„ä»£ç ä¼šæŠ¥ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºéžå¸¸é‡å·¦å€¼å¼•ç”¨åªèƒ½æŽ¥å—å·¦å€¼ã€‚å³å€¼å¼•ç”¨çš„ç¬¬äºŒä¸ªç‰¹ç‚¹ å³å€¼å¼•ç”¨ç‹¬ç«‹äºŽå·¦å€¼å’Œå³å€¼ã€‚æ„æ€æ˜¯å³å€¼å¼•ç”¨ç±»åž‹çš„å˜é‡å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š1int&amp;&amp; var1 = 1; var1ç±»åž‹ä¸ºå³å€¼å¼•ç”¨ï¼Œä½†var1æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå…·åå˜é‡éƒ½æ˜¯å·¦å€¼ã€‚ å…³äºŽå³å€¼å¼•ç”¨ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜æ˜¯ï¼šT&amp;&amp;æ˜¯ä»€ä¹ˆï¼Œä¸€å®šæ˜¯å³å€¼å—ï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š12345template&lt;typename T&gt;void f(T&amp;&amp; t)&#123;&#125;f(10); //tæ˜¯å³å€¼int x = 10;f(x); //tæ˜¯å·¦å€¼ ä»Žä¸Šé¢çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒT&amp;&amp;è¡¨ç¤ºçš„å€¼ç±»åž‹ä¸ç¡®å®šï¼Œå¯èƒ½æ˜¯å·¦å€¼åˆå¯èƒ½æ˜¯å³å€¼ï¼Œè¿™ä¸€ç‚¹çœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œè¿™å°±æ˜¯å³å€¼å¼•ç”¨çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚å³å€¼å¼•ç”¨çš„ç¬¬ä¸‰ä¸ªç‰¹ç‚¹ T&amp;&amp; tåœ¨å‘ç”Ÿè‡ªåŠ¨ç±»åž‹æŽ¨æ–­çš„æ—¶å€™ï¼Œå®ƒæ˜¯æœªå®šçš„å¼•ç”¨ç±»åž‹ï¼ˆuniversal referencesï¼‰ï¼Œå¦‚æžœè¢«ä¸€ä¸ªå·¦å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå·¦å€¼ï¼›å¦‚æžœå®ƒè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œå®ƒæ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼å–å†³äºŽå®ƒçš„åˆå§‹åŒ–ã€‚æˆ‘ä»¬å†å›žè¿‡å¤´çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹äºŽå‡½æ•°templatevoid f(T&amp;&amp; t)ï¼Œå½“å‚æ•°ä¸ºå³å€¼10çš„æ—¶å€™ï¼Œæ ¹æ®universal referencesçš„ç‰¹ç‚¹ï¼Œtè¢«ä¸€ä¸ªå³å€¼åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯å³å€¼ï¼›å½“å‚æ•°ä¸ºå·¦å€¼xæ—¶ï¼Œtè¢«ä¸€ä¸ªå·¦å€¼å¼•ç”¨åˆå§‹åŒ–ï¼Œé‚£ä¹ˆtå°±æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»…ä»…æ˜¯å½“å‘ç”Ÿè‡ªåŠ¨ç±»åž‹æŽ¨å¯¼ï¼ˆå¦‚å‡½æ•°æ¨¡æ¿çš„ç±»åž‹è‡ªåŠ¨æŽ¨å¯¼ï¼Œæˆ–autoå…³é”®å­—ï¼‰çš„æ—¶å€™ï¼ŒT&amp;&amp;æ‰æ˜¯universal referencesã€‚å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š1234567template&lt;typename T&gt;void f(T&amp;&amp; param); template&lt;typename T&gt;class Test &#123; Test(Test&amp;&amp; rhs); &#125;; ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œparamæ˜¯universal referenceï¼Œrhsæ˜¯Test&amp;&amp;å³å€¼å¼•ç”¨ï¼Œå› ä¸ºæ¨¡ç‰ˆå‡½æ•°få‘ç”Ÿäº†ç±»åž‹æŽ¨æ–­ï¼Œè€ŒTest&amp;&amp;å¹¶æ²¡æœ‰å‘ç”Ÿç±»åž‹æŽ¨å¯¼ï¼Œå› ä¸ºTest&amp;&amp;æ˜¯ç¡®å®šçš„ç±»åž‹äº†ã€‚ æ­£æ˜¯å› ä¸ºå³å€¼å¼•ç”¨å¯èƒ½æ˜¯å·¦å€¼ä¹Ÿå¯èƒ½æ˜¯å³å€¼ï¼Œä¾èµ–äºŽåˆå§‹åŒ–ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸‹å­å°±ç¡®å®šçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šæ–‡ç« ï¼Œæ¯”å¦‚åŽé¢è¦ä»‹ç»çš„ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾Žè½¬å‘ã€‚ è¿™é‡Œå†æä¸€ä¸‹å¼•ç”¨æŠ˜å ï¼Œæ­£æ˜¯å› ä¸ºå¼•å…¥äº†å³å€¼å¼•ç”¨ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨å·¦å€¼å¼•ç”¨ä¸Žå³å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨ä¸Žå³å€¼å¼•ç”¨çš„æŠ˜å ï¼ŒC++11ç¡®å®šäº†å¼•ç”¨æŠ˜å çš„è§„åˆ™ï¼Œè§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæ‰€æœ‰çš„å³å€¼å¼•ç”¨å åŠ åˆ°å³å€¼å¼•ç”¨ä¸Šä»ç„¶è¿˜æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼›æ‰€æœ‰çš„å…¶ä»–å¼•ç”¨ç±»åž‹ä¹‹é—´çš„å åŠ éƒ½å°†å˜æˆå·¦å€¼å¼•ç”¨ã€‚ç¬¬3è¡Œä»£ç çš„æ•…äº‹1T(T&amp;&amp; a) : m_val(val)&#123; a.m_val=nullptr; &#125; è¿™è¡Œä»£ç å®žé™…ä¸Šæ¥è‡ªäºŽä¸€ä¸ªç±»çš„æž„é€ å‡½æ•°ï¼Œæž„é€ å‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ï¼Œä¸ºä»€ä¹ˆå°†å³å€¼å¼•ç”¨ä½œä¸ºæž„é€ å‡½æ•°çš„å‚æ•°å‘¢ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªä¾‹å­ã€‚å¦‚ä»£ç æ¸…å•1-2æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-21234567891011121314151617181920class A&#123;public: A():m_ptr(new int(0))&#123;cout &lt;&lt; "construct" &lt;&lt; endl;&#125; A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æž„é€ å‡½æ•° &#123; cout &lt;&lt; "copy construct" &lt;&lt; endl; &#125; ~A()&#123; delete m_ptr;&#125;private: int* m_ptr;&#125;;int main() &#123; A a = GetA(); return 0;&#125; è¾“å‡ºï¼šconstructcopy constructcopy construct è¿™ä¸ªä¾‹å­å¾ˆç®€å•ï¼Œä¸€ä¸ªå¸¦æœ‰å †å†…å­˜çš„ç±»ï¼Œå¿…é¡»æä¾›ä¸€ä¸ªæ·±æ‹·è´æ‹·è´æž„é€ å‡½æ•°ï¼Œå› ä¸ºé»˜è®¤çš„æ‹·è´æž„é€ å‡½æ•°æ˜¯æµ…æ‹·è´ï¼Œä¼šå‘ç”Ÿâ€œæŒ‡é’ˆæ‚¬æŒ‚â€çš„é—®é¢˜ã€‚å¦‚æžœä¸æä¾›æ·±æ‹·è´çš„æ‹·è´æž„é€ å‡½æ•°ï¼Œä¸Šé¢çš„æµ‹è¯•ä»£ç å°†ä¼šå‘ç”Ÿé”™è¯¯ï¼ˆç¼–è¯‘é€‰é¡¹-fno-elide-constructorsï¼‰ï¼Œå†…éƒ¨çš„m_ptrå°†ä¼šè¢«åˆ é™¤ä¸¤æ¬¡ï¼Œä¸€æ¬¡æ˜¯ä¸´æ—¶å³å€¼æžæž„çš„æ—¶å€™åˆ é™¤ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡å¤–é¢æž„é€ çš„aå¯¹è±¡é‡Šæ”¾æ—¶åˆ é™¤ä¸€æ¬¡ï¼Œè€Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„m_ptræ˜¯åŒä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æŒ‡é’ˆæ‚¬æŒ‚é—®é¢˜ã€‚æä¾›æ·±æ‹·è´çš„æ‹·è´æž„é€ å‡½æ•°è™½ç„¶å¯ä»¥ä¿è¯æ­£ç¡®ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ä¼šé€ æˆé¢å¤–çš„æ€§èƒ½æŸè€—ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™ç§æ·±æ‹·è´æ˜¯ä¸å¿…è¦çš„ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š ä¸Šé¢ä»£ç ä¸­çš„GetAå‡½æ•°ä¼šè¿”å›žä¸´æ—¶å˜é‡ï¼Œç„¶åŽé€šè¿‡è¿™ä¸ªä¸´æ—¶å˜é‡æ‹·è´æž„é€ äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡aï¼Œä¸´æ—¶å˜é‡åœ¨æ‹·è´æž„é€ å®Œæˆä¹‹åŽå°±é”€æ¯äº†ï¼Œå¦‚æžœå †å†…å­˜å¾ˆå¤§çš„è¯ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ‹·è´æž„é€ çš„ä»£ä»·ä¼šå¾ˆå¤§ï¼Œå¸¦æ¥äº†é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚æ¯æ¬¡éƒ½ä¼šäº§ç”Ÿä¸´æ—¶å˜é‡å¹¶é€ æˆé¢å¤–çš„æ€§èƒ½æŸå¤±ï¼Œæœ‰æ²¡æœ‰åŠžæ³•é¿å…ä¸´æ—¶å˜é‡é€ æˆçš„æ€§èƒ½æŸå¤±å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼ŒC++11å·²ç»æœ‰äº†è§£å†³æ–¹æ³•ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚å¦‚ä»£ç æ¸…å•1-3æ‰€ç¤ºã€‚ä»£ç æ¸…å•1-3123456789101112131415161718192021222324class A&#123;public: A() :m_ptr(new int(0))&#123;&#125; A(const A&amp; a):m_ptr(new int(*a.m_ptr)) //æ·±æ‹·è´çš„æ‹·è´æž„é€ å‡½æ•° &#123; cout &lt;&lt; "copy construct" &lt;&lt; endl; &#125; A(A&amp;&amp; a) :m_ptr(a.m_ptr) &#123; a.m_ptr = nullptr; cout &lt;&lt; "move construct" &lt;&lt; endl; &#125; ~A()&#123; delete m_ptr;&#125;private: int* m_ptr;&#125;;int main()&#123; A a = Get(false); &#125; è¾“å‡ºï¼šconstructmove constructmove construct ä»£ç æ¸…å•1-3å’Œ1-2ç›¸æ¯”åªå¤šäº†ä¸€ä¸ªæž„é€ å‡½æ•°ï¼Œè¾“å‡ºç»“æžœè¡¨æ˜Žï¼Œå¹¶æ²¡æœ‰è°ƒç”¨æ‹·è´æž„é€ å‡½æ•°ï¼Œåªè°ƒç”¨äº†move constructå‡½æ•°ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªmove constructå‡½æ•°ï¼š12345A(A&amp;&amp; a) :m_ptr(a.m_ptr)&#123; a.m_ptr = nullptr; cout &lt;&lt; "move construct" &lt;&lt; endl;&#125; è¿™ä¸ªæž„é€ å‡½æ•°å¹¶æ²¡æœ‰åšæ·±æ‹·è´ï¼Œä»…ä»…æ˜¯å°†æŒ‡é’ˆçš„æ‰€æœ‰è€…è½¬ç§»åˆ°äº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå°†å‚æ•°å¯¹è±¡açš„æŒ‡é’ˆç½®ä¸ºç©ºï¼Œè¿™é‡Œä»…ä»…æ˜¯åšäº†æµ…æ‹·è´ï¼Œå› æ­¤ï¼Œè¿™ä¸ªæž„é€ å‡½æ•°é¿å…äº†ä¸´æ—¶å˜é‡çš„æ·±æ‹·è´é—®é¢˜ã€‚ ä¸Šé¢è¿™ä¸ªå‡½æ•°å…¶å®žå°±æ˜¯ç§»åŠ¨æž„é€ å‡½æ•°ï¼Œä»–çš„å‚æ•°æ˜¯ä¸€ä¸ªå³å€¼å¼•ç”¨ç±»åž‹ï¼Œè¿™é‡Œçš„A&amp;&amp;è¡¨ç¤ºå³å€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿå‰é¢å·²ç»æåˆ°ï¼Œè¿™é‡Œæ²¡æœ‰å‘ç”Ÿç±»åž‹æŽ¨æ–­ï¼Œæ˜¯ç¡®å®šçš„å³å€¼å¼•ç”¨ç±»åž‹ã€‚ä¸ºä»€ä¹ˆä¼šåŒ¹é…åˆ°è¿™ä¸ªæž„é€ å‡½æ•°ï¼Ÿå› ä¸ºè¿™ä¸ªæž„é€ å‡½æ•°åªèƒ½æŽ¥å—å³å€¼å‚æ•°ï¼Œè€Œå‡½æ•°è¿”å›žå€¼æ˜¯å³å€¼ï¼Œæ‰€ä»¥å°±ä¼šåŒ¹é…åˆ°è¿™ä¸ªæž„é€ å‡½æ•°ã€‚è¿™é‡Œçš„A&amp;&amp;å¯ä»¥çœ‹ä½œæ˜¯ä¸´æ—¶å€¼çš„æ ‡è¯†ï¼Œå¯¹äºŽä¸´æ—¶å€¼æˆ‘ä»¬ä»…ä»…éœ€è¦åšæµ…æ‹·è´å³å¯ï¼Œæ— éœ€å†åšæ·±æ‹·è´ï¼Œä»Žè€Œè§£å†³äº†å‰é¢æåˆ°çš„ä¸´æ—¶å˜é‡æ‹·è´æž„é€ äº§ç”Ÿçš„æ€§èƒ½æŸå¤±çš„é—®é¢˜ã€‚è¿™å°±æ˜¯æ‰€è°“çš„ç§»åŠ¨è¯­ä¹‰ï¼Œå³å€¼å¼•ç”¨çš„ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ç”¨æ¥æ”¯æŒç§»åŠ¨è¯­ä¹‰çš„ã€‚ éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯ï¼Œæˆ‘ä»¬æä¾›ç§»åŠ¨æž„é€ å‡½æ•°çš„åŒæ—¶ä¹Ÿä¼šæä¾›ä¸€ä¸ªæ‹·è´æž„é€ å‡½æ•°ï¼Œä»¥é˜²æ­¢ç§»åŠ¨ä¸æˆåŠŸçš„æ—¶å€™è¿˜èƒ½æ‹·è´æž„é€ ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´å®‰å…¨ã€‚ æˆ‘ä»¬çŸ¥é“ç§»åŠ¨è¯­ä¹‰æ˜¯é€šè¿‡å³å€¼å¼•ç”¨æ¥åŒ¹é…ä¸´æ—¶å€¼çš„ï¼Œé‚£ä¹ˆï¼Œæ™®é€šçš„å·¦å€¼æ˜¯å¦ä¹Ÿèƒ½å€ŸåŠ©ç§»åŠ¨è¯­ä¹‰æ¥ä¼˜åŒ–æ€§èƒ½å‘¢ï¼Œé‚£è¯¥æ€Žä¹ˆåšå‘¢ï¼Ÿäº‹å®žä¸ŠC++11ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæä¾›äº†std::moveæ–¹æ³•æ¥å°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼ï¼Œä»Žè€Œæ–¹ä¾¿åº”ç”¨ç§»åŠ¨è¯­ä¹‰ã€‚moveæ˜¯å°†å¯¹è±¡èµ„æºçš„æ‰€æœ‰æƒä»Žä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåªæ˜¯è½¬ç§»ï¼Œæ²¡æœ‰å†…å­˜çš„æ‹·è´ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„moveè¯­ä¹‰ã€‚å¦‚å›¾1-1æ‰€ç¤ºæ˜¯æ·±æ‹·è´å’Œmoveçš„åŒºåˆ«ã€‚å›¾1-1 æ·±æ‹·è´å’Œmoveçš„åŒºåˆ« å†çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š1234567&#123; std::list&lt; std::string&gt; tokens; //çœç•¥åˆå§‹åŒ–... std::list&lt; std::string&gt; t = tokens; //è¿™é‡Œå­˜åœ¨æ‹·è´ &#125;std::list&lt; std::string&gt; tokens;std::list&lt; std::string&gt; t = std::move(tokens); //è¿™é‡Œæ²¡æœ‰æ‹·è´ å¦‚æžœä¸ç”¨std::moveï¼Œæ‹·è´çš„ä»£ä»·å¾ˆå¤§ï¼Œæ€§èƒ½è¾ƒä½Žã€‚ä½¿ç”¨moveå‡ ä¹Žæ²¡æœ‰ä»»ä½•ä»£ä»·ï¼Œåªæ˜¯è½¬æ¢äº†èµ„æºçš„æ‰€æœ‰æƒã€‚ä»–å®žé™…ä¸Šå°†å·¦å€¼å˜æˆå³å€¼å¼•ç”¨ï¼Œç„¶åŽåº”ç”¨ç§»åŠ¨è¯­ä¹‰ï¼Œè°ƒç”¨ç§»åŠ¨æž„é€ å‡½æ•°ï¼Œå°±é¿å…äº†æ‹·è´ï¼Œæé«˜äº†ç¨‹åºæ€§èƒ½ã€‚å¦‚æžœä¸€ä¸ªå¯¹è±¡å†…éƒ¨æœ‰è¾ƒå¤§çš„å¯¹å†…å­˜æˆ–è€…åŠ¨æ€æ•°ç»„æ—¶ï¼Œå¾ˆæœ‰å¿…è¦å†™moveè¯­ä¹‰çš„æ‹·è´æž„é€ å‡½æ•°å’Œèµ‹å€¼å‡½æ•°ï¼Œé¿å…æ— è°“çš„æ·±æ‹·è´ï¼Œä»¥æé«˜æ€§èƒ½ã€‚äº‹å®žä¸Šï¼ŒC++11ä¸­æ‰€æœ‰çš„å®¹å™¨éƒ½å®žçŽ°äº†ç§»åŠ¨è¯­ä¹‰ï¼Œæ–¹ä¾¿æˆ‘ä»¬åšæ€§èƒ½ä¼˜åŒ–ã€‚ è¿™é‡Œä¹Ÿè¦æ³¨æ„å¯¹moveè¯­ä¹‰çš„è¯¯è§£ï¼Œmoveå®žé™…ä¸Šå®ƒå¹¶ä¸èƒ½ç§»åŠ¨ä»»ä½•ä¸œè¥¿ï¼Œå®ƒå”¯ä¸€çš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªå·¦å€¼å¼ºåˆ¶è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨ã€‚å¦‚æžœæ˜¯ä¸€äº›åŸºæœ¬ç±»åž‹æ¯”å¦‚intå’Œchar[10]å®šé•¿æ•°ç»„ç­‰ç±»åž‹ï¼Œä½¿ç”¨moveçš„è¯ä»ç„¶ä¼šå‘ç”Ÿæ‹·è´ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹åº”çš„ç§»åŠ¨æž„é€ å‡½æ•°ï¼‰ã€‚æ‰€ä»¥ï¼Œmoveå¯¹äºŽå«èµ„æºï¼ˆå †å†…å­˜æˆ–å¥æŸ„ï¼‰çš„å¯¹è±¡æ¥è¯´æ›´æœ‰æ„ä¹‰ã€‚ç¬¬4è¡Œä»£ç æ•…äº‹1template &lt;typename T&gt;void f(T&amp;&amp; val)&#123; foo(std::forward&lt;T&gt;(val)); &#125; C++11ä¹‹å‰è°ƒç”¨æ¨¡æ¿å‡½æ•°æ—¶ï¼Œå­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚ä½•æ­£ç¡®çš„ä¼ é€’å‚æ•°ã€‚æ¯”å¦‚ï¼š12345678910template &lt;typename T&gt;void forwardValue(T&amp; val)&#123; processValue(val); //å³å€¼å‚æ•°ä¼šå˜æˆå·¦å€¼ &#125;template &lt;typename T&gt;void forwardValue(const T&amp; val)&#123; processValue(val); //å‚æ•°éƒ½å˜æˆå¸¸é‡å·¦å€¼å¼•ç”¨äº† &#125;éƒ½ä¸èƒ½æŒ‰ç…§å‚æ•°çš„æœ¬æ¥çš„ç±»åž‹è¿›è¡Œè½¬å‘ã€‚ C++11å¼•å…¥äº†å®Œç¾Žè½¬å‘ï¼šåœ¨å‡½æ•°æ¨¡æ¿ä¸­ï¼Œå®Œå…¨ä¾ç…§æ¨¡æ¿çš„å‚æ•°çš„ç±»åž‹ï¼ˆå³ä¿æŒå‚æ•°çš„å·¦å€¼ã€å³å€¼ç‰¹å¾ï¼‰ï¼Œå°†å‚æ•°ä¼ é€’ç»™å‡½æ•°æ¨¡æ¿ä¸­è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚C++11ä¸­çš„std::forwardæ­£æ˜¯åšè¿™ä¸ªäº‹æƒ…çš„ï¼Œä»–ä¼šæŒ‰ç…§å‚æ•°çš„å®žé™…ç±»åž‹è¿›è¡Œè½¬å‘ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š12345678910111213141516void processValue(int&amp; a)&#123; cout &lt;&lt; "lvalue" &lt;&lt; endl; &#125;void processValue(int&amp;&amp; a)&#123; cout &lt;&lt; "rvalue" &lt;&lt; endl; &#125;template &lt;typename T&gt;void forwardValue(T&amp;&amp; val)&#123; processValue(std::forward&lt;T&gt;(val)); //ç…§å‚æ•°æœ¬æ¥çš„ç±»åž‹è¿›è¡Œè½¬å‘ã€‚&#125;void Testdelcl()&#123; int i = 0; forwardValue(i); //ä¼ å…¥å·¦å€¼ forwardValue(0);//ä¼ å…¥å³å€¼ &#125;è¾“å‡ºï¼šlvaue rvalue å³å€¼å¼•ç”¨T&amp;&amp;æ˜¯ä¸€ä¸ªuniversal referencesï¼Œå¯ä»¥æŽ¥å—å·¦å€¼æˆ–è€…å³å€¼ï¼Œæ­£æ˜¯è¿™ä¸ªç‰¹æ€§è®©ä»–é€‚åˆä½œä¸ºä¸€ä¸ªå‚æ•°çš„è·¯ç”±ï¼Œç„¶åŽå†é€šè¿‡std::forwardæŒ‰ç…§å‚æ•°çš„å®žé™…ç±»åž‹åŽ»åŒ¹é…å¯¹åº”çš„é‡è½½å‡½æ•°ï¼Œæœ€ç»ˆå®žçŽ°å®Œç¾Žè½¬å‘ã€‚ æˆ‘ä»¬å¯ä»¥ç»“åˆå®Œç¾Žè½¬å‘å’Œç§»åŠ¨è¯­ä¹‰æ¥å®žçŽ°ä¸€ä¸ªæ³›åž‹çš„å·¥åŽ‚å‡½æ•°ï¼Œè¿™ä¸ªå·¥åŽ‚å‡½æ•°å¯ä»¥åˆ›å»ºæ‰€æœ‰ç±»åž‹çš„å¯¹è±¡ã€‚å…·ä½“å®žçŽ°å¦‚ä¸‹ï¼š12345template&lt;typenameâ€¦ Args&gt;T* Instance(Args&amp;&amp;â€¦ args)&#123; return new T(std::forward&lt;Args &gt;(args)â€¦);&#125; è¿™ä¸ªå·¥åŽ‚å‡½æ•°çš„å‚æ•°æ˜¯å³å€¼å¼•ç”¨ç±»åž‹ï¼Œå†…éƒ¨ä½¿ç”¨std::forwardæŒ‰ç…§å‚æ•°çš„å®žé™…ç±»åž‹è¿›è¡Œè½¬å‘ï¼Œå¦‚æžœå‚æ•°çš„å®žé™…ç±»åž‹æ˜¯å³å€¼ï¼Œé‚£ä¹ˆåˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨åŒ¹é…ç§»åŠ¨æž„é€ ï¼Œå¦‚æžœæ˜¯å·¦å€¼åˆ™ä¼šåŒ¹é…æ‹·è´æž„é€ ã€‚æ€»ç»“ é€šè¿‡4è¡Œä»£ç æˆ‘ä»¬çŸ¥é“äº†ä»€ä¹ˆæ˜¯å³å€¼å’Œå³å€¼å¼•ç”¨ï¼Œä»¥åŠå³å€¼å¼•ç”¨çš„ä¸€äº›ç‰¹ç‚¹ï¼Œåˆ©ç”¨è¿™äº›ç‰¹ç‚¹æˆ‘ä»¬æ‰æ–¹ä¾¿å®žçŽ°ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾Žè½¬å‘ã€‚C++11æ­£æ˜¯é€šè¿‡å¼•å…¥å³å€¼å¼•ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯é€šè¿‡ç§»åŠ¨è¯­ä¹‰æ¥é¿å…æ— è°“æ‹·è´çš„é—®é¢˜ï¼Œé€šè¿‡moveè¯­ä¹‰æ¥å°†ä¸´æ—¶ç”Ÿæˆçš„å·¦å€¼ä¸­çš„èµ„æºæ— ä»£ä»·çš„è½¬ç§»åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¸­åŽ»ï¼Œé€šè¿‡å®Œç¾Žè½¬å‘æ¥è§£å†³ä¸èƒ½æŒ‰ç…§å‚æ•°å®žé™…ç±»åž‹æ¥è½¬å‘çš„é—®é¢˜ï¼ˆåŒæ—¶ï¼Œå®Œç¾Žè½¬å‘èŽ·å¾—çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥å®žçŽ°ç§»åŠ¨è¯­ä¹‰ï¼‰ã€‚æœ¬æ–‡æ›¾å‘è¡¨äºŽã€Šç¨‹åºå‘˜ã€‹2015å¹´1æœˆåˆŠã€‚è½¬è½½è¯·æ³¨æ˜Žå‡ºå¤„ã€‚åŽè®°ï¼šæœ¬æ–‡çš„å†…å®¹ä¸»è¦æ¥è‡ªäºŽæˆ‘åœ¨å…¬å¸å†…éƒ¨åŸ¹è®­çš„ä¸€æ¬¡è¯¾ç¨‹ï¼Œå› ä¸ºå¾ˆå¤šäººå¯¹C++11å³å€¼å¼•ç”¨æžä¸æ¸…æˆ–è€…ç†è§£å¾—ä¸æ·±å…¥ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦æ‹¿å‡ºæ¥åˆ†äº«ä¸€ä¸‹ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ°ï¼Œå°±æ•´ç†äº†ä¸€ä¸‹å‘åˆ°ç¨‹åºå‘˜æ‚å¿—äº†ï¼Œæˆ‘ç›¸ä¿¡è¯»è€…çœ‹å®Œä¹‹åŽå¯¹å³å€¼å¼•ç”¨ä¼šæœ‰å…¨é¢æ·±å…¥çš„äº†è§£ã€‚ä¸€ç‚¹æ¢¦æƒ³ï¼šå°½è‡ªå·±ä¸€ä»½åŠ›ï¼Œè®©c++çš„ä¸–ç•Œå˜å¾—æ›´ç¾Žå¥½ï¼]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[squidä»‹ç»åŠå…¶ç®€å•é…ç½®]]></title>
    <url>%2Fposts%2F55e3d16d%2F</url>
    <content type="text"><![CDATA[squidçš„æ¦‚å¿µsquidæ˜¯ä¸€ç§ç”¨æ¥ç¼“å­˜Internetæ•°æ®çš„è½¯ä»¶ã€‚æŽ¥å—æ¥è‡ªäººä»¬éœ€è¦ä¸‹è½½çš„ç›®æ ‡ï¼ˆobjectï¼‰çš„è¯·æ±‚å¹¶é€‚å½“çš„å¤„ç†è¿™äº›è¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä¸€ä¸ªäººæƒ³ä¸‹è½½ä¸€webç•Œé¢ï¼Œä»–è¯·æ±‚squidä¸ºä»–å–å¾—è¿™ä¸ªé¡µé¢ã€‚squidéšä¹‹è¿žæŽ¥åˆ°è¿œç¨‹æœåŠ¡å™¨å¹¶å‘è¿™ä¸ªé¡µé¢å‘å‡ºè¯·æ±‚ã€‚ç„¶åŽï¼Œsquidæ˜¾å¼åœ°èšé›†æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼Œè€Œä¸”åŒæ—¶å¤åˆ¶ä¸€ä»½ã€‚å½“ä¸‹ä¸€æ¬¡æœ‰äººéœ€è¦åŒä¸€é¡µé¢æ—¶ï¼Œ squidå¯ä»¥ç®€å•çš„ä»Žç£ç›˜ä¸­è¯»åˆ°å®ƒï¼Œé‚£æ ·æ•°æ®ä¼šç«‹å³ä¼ è¾“åˆ°å®¢æˆ·æœºä¸Šã€‚ä¸‹è½½åœ°å€squid-cache å®˜ç½‘ http://www.squid-cache.orgsquidä»‹ç»åŠå…¶ç®€å•é…ç½® https://www.cnblogs.com/cherishry/p/5706736.htmlCentOS 7å®‰è£…squidä»£ç†æœåŠ¡å™¨ https://blog.csdn.net/ithomer/article/details/78136993squidä»£ç†çš„ä½œç”¨é€šè¿‡ç¼“å­˜çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›Webè®¿é—®åŠ é€Ÿå¯¹ç”¨æˆ·çš„Webè®¿é—®è¿›è¡Œè¿‡æ»¤æŽ§åˆ¶å·¥ä½œæµç¨‹å½“ä»£ç†æœåŠ¡å™¨ä¸­æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶ï¼ša.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›b.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›c.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼Œå–å‡ºæ•°æ®ï¼›d.ä»£ç†æœåŠ¡å™¨å°†ä»Žç¼“å­˜ä¸­å–å¾—çš„æ•°æ®è¿”å›žç»™å®¢æˆ·ç«¯ã€‚å½“ä»£ç†æœåŠ¡å™¨ä¸­æ²¡æœ‰å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®æ—¶äº†ï¼š1.å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›2.ä»£ç†æœåŠ¡å™¨æ£€æŸ¥è‡ªå·±çš„æ•°æ®ç¼“å­˜ï¼›3.ä»£ç†æœåŠ¡å™¨åœ¨ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æƒ³è¦çš„æ•°æ®ï¼›4.ä»£ç†æœåŠ¡å™¨å‘Internet ä¸Šçš„è¿œç«¯æœåŠ¡å™¨å‘é€æ•°æ®è¯·æ±‚ï¼›5.è¿œç«¯æœåŠ¡å™¨å“åº”ï¼Œè¿”å›žç›¸åº”çš„æ•°æ®ï¼›6.ä»£ç†æœåŠ¡å™¨å–å¾—è¿œç«¯æœåŠ¡å™¨çš„æ•°æ®ï¼Œè¿”å›žç»™å®¢æˆ·ç«¯ï¼Œå¹¶ä¿ç•™ä¸€ä»½åˆ°è‡ªå·±çš„æ•°æ®ç¼“å­˜ä¸­ã€‚Squidä»£ç†æœåŠ¡å™¨å·¥ä½œåœ¨TCP/IPåº”ç”¨å±‚Squidå„ç§ä»£ç†çš„å®šä¹‰æ­£å‘ä»£ç†æ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡å™¨ä¸€ä¸ªæ ‡å‡†çš„ä»£ç†ç¼“å†²æœåŠ¡è¢«ç”¨äºŽç¼“å­˜é™æ€çš„ç½‘é¡µåˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸€å°ä¸»æœºä¸Šï¼ˆå³ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚å½“è¢«ç¼“å­˜çš„é¡µé¢è¢«ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†ç›´æŽ¥ä»Žæœ¬åœ°ä»£ç†æœåŠ¡å™¨é‚£é‡ŒèŽ·å–è¯·æ±‚æ•°æ®è€Œä¸å†å‘åŽŸwebç«™ç‚¹è¯·æ±‚æ•°æ®ã€‚è¿™æ ·å°±èŠ‚çœäº†å®è´µçš„ç½‘ç»œå¸¦å®½ï¼Œè€Œä¸”æé«˜äº†è®¿é—®é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œè¦æƒ³å®žçŽ°è¿™ç§æ–¹å¼ï¼Œå¿…é¡»åœ¨æ¯ä¸€ä¸ªå†…éƒ¨ä¸»æœºçš„æµè§ˆå™¨ä¸Šæ˜Žç¡®æŒ‡åä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£å·ã€‚å®¢æˆ·ç«¯ä¸Šç½‘æ—¶ï¼Œæ¯æ¬¡éƒ½æŠŠè¯·æ±‚å‘é€ç»™ä»£ç†æœåŠ¡å™¨å¤„ç†,ä»£ç†æœåŠ¡å™¨æ ¹æ®è¯·æ±‚ç¡®å®šæ˜¯å¦è¿žæŽ¥åˆ°è¿œç¨‹webæœåŠ¡å™¨èŽ·å–æ•°æ®ã€‚å¦‚æžœåœ¨æœ¬åœ°ç¼“å†²åŒºæœ‰ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™ç›´æŽ¥å°†æ–‡ä»¶ä¼ ç»™ç”¨æˆ·å³å¯ã€‚å¦‚æžœæ²¡æœ‰çš„è¯åˆ™å…ˆå–å›žæ–‡ä»¶ï¼Œå…ˆåœ¨æœ¬åœ°ä¿å­˜ä¸€ä»½ç¼“å†²ï¼Œç„¶åŽå°†æ–‡ä»¶å‘é€ç»™å®¢æˆ·ç«¯æµè§ˆå™¨ã€‚é€æ˜Žä»£ç†ç¼“å†²æœåŠ¡å™¨é€æ˜Žä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œä»£ç†æ“ä½œå¯¹å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ˜¯é€æ˜Žçš„ï¼ˆå³ä¸éœ€æŒ‡æ˜Žä»£ç†æœåŠ¡å™¨çš„IPå’Œç«¯å£ï¼‰ã€‚é€æ˜Žä»£ç†æœåŠ¡å™¨é˜»æ–­ç½‘ç»œé€šä¿¡ï¼Œå¹¶ä¸”è¿‡æ»¤å‡ºè®¿é—®å¤–éƒ¨çš„HTTPï¼ˆ80ç«¯å£ï¼‰æµé‡ã€‚å¦‚æžœå®¢æˆ·ç«¯çš„è¯·æ±‚åœ¨æœ¬åœ°æœ‰ç¼“å†²åˆ™å°†ç¼“å†²çš„æ•°æ®ç›´æŽ¥å‘ç»™ç”¨æˆ·ï¼Œå¦‚æžœåœ¨æœ¬åœ°æ²¡æœ‰ç¼“å†²åˆ™å‘è¿œç¨‹webæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå…¶ä½™æ“ä½œå’Œæ ‡å‡†çš„ä»£ç†æœåŠ¡å™¨å®Œå…¨ç›¸åŒã€‚å¯¹äºŽlinuxæ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œé€æ˜Žä»£ç†ä½¿ç”¨Iptablesæˆ–è€…Ipchainså®žçŽ°ã€‚å› æ­¤ä¸éœ€è¦å¯¹æµè§ˆå™¨ä½œä»»ä½•è®¾ç½®ï¼Œæ‰€ä»¥ï¼Œé€æ˜Žä»£ç†å¯¹äºŽISPï¼ˆInternetæœåŠ¡å™¨æä¾›å•†ï¼‰ç‰¹åˆ«æœ‰ç”¨ã€‚åå‘ä»£ç†åå‘ä»£ç†ç¼“å†²å™¨åå‘ä»£ç†æ˜¯å’Œå‰ä¸¤ç§ä»£ç†å®Œå…¨ä¸åŒçš„ä¸€ç§ä»£ç†æœåŠ¡ã€‚ä½¿ç”¨å®ƒå¯ä»¥é™ä½ŽåŽŸå§‹WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚åå‘ä»£ç†æœåŠ¡å™¨æ‰¿æ‹…äº†å¯¹åŽŸå§‹WEBæœåŠ¡å™¨çš„é™æ€é¡µé¢çš„è¯·æ±‚ï¼Œé˜²æ­¢åŽŸå§‹æœåŠ¡å™¨è¿‡è½½ã€‚å®ƒä½äºŽWEBæœåŠ¡å™¨å’ŒInternetä¹‹é—´ï¼Œå¤„ç†æ‰€æœ‰å¯¹WEBæœåŠ¡å™¨çš„è¯·æ±‚ï¼Œç»„ç»‡äº†WEBæœåŠ¡å™¨å’ŒInternetçš„ç›´æŽ¥é€šä¿¡ã€‚å¦‚æžœäº’è”ç½‘ç”¨æˆ·è¯·æ±‚çš„é¡µé¢åœ¨ä»£ç†æœåŠ¡å™¨ä¸Šæœ‰ç¼“å†²çš„è¯ï¼Œä»£ç†æœåŠ¡å™¨ç›´æŽ¥å°†ç¼“å†²å†…å®¹å‘é€ç»™ç”¨æˆ·ã€‚å¦‚æžœæ²¡æœ‰ç¼“å†²åˆ™å…ˆå‘WEBæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå–å›žæ•°æ®ï¼Œæœ¬åœ°ç¼“å­˜åŽå†å‘ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹å¼é€šè¿‡é™ä½Žäº†WEBæœåŠ¡å™¨çš„è¯·æ±‚æ•°ä»Žè€Œé™ä½Žäº†WEBæœåŠ¡å™¨çš„è´Ÿè½½ã€‚æ­£å‘ä»£ç†ä¸Žåå‘ä»£ç†çš„åŒºåˆ«æ¦‚å¿µæ­£å‘ä»£ç†ï¼šå¯¹äºŽåŽŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äººåå‘ä»£ç†ï¼šå¯¹äºŽå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŽŸå§‹æœåŠ¡å™¨ç”¨é€”æ­£å‘ä»£ç†çš„å…¸åž‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨çŽ‡ã€‚åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåŽç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåŽç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»Žè€Œä½¿å¤„äºŽä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºŽåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚å®‰å…¨æ€§æ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æŽªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æŽˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚åå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜Žçš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚Squidä¸»è¦ç»„æˆéƒ¨åˆ†æœåŠ¡åï¼šsquidä¸»ç¨‹åºï¼š/usr/sbin/squidé…ç½®ç›®å½•ï¼š/etc/squidä¸»é…ç½®æ–‡ä»¶ï¼š/etc/squid/squid.confç›‘å¬tcpç«¯å£å·ï¼š3128é»˜è®¤è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼š/var/log/squid/access.logsquidå¸¸ç”¨é…ç½®é€‰é¡¹/etc/squid/squid.conf123456789101112131415http_port 3128 (è¿˜å¯ä»¥åªç›‘å¬ä¸€ä¸ªIP http_port 192.168.0.1:3128)cache_mem 64MB #ç¼“å­˜å å†…å­˜å¤§å°maximum_object_size 4096KB #æœ€å¤§ç¼“å­˜å—reply_body_max_size 1024000 allow all #é™å®šä¸‹è½½æ–‡ä»¶å¤§å°access_log /var/log/squid/access.log #è®¿é—®æ—¥å¿—å­˜æ”¾çš„åœ°æ–¹visible_hostname proxy.test.xom #å¯è§çš„ä¸»æœºåcache_dir ufs /var/spool/squid 100 16 256 #ufs:ç¼“å­˜æ•°æ®çš„å­˜å‚¨æ ¼å¼#/var/spool/squid ç¼“å­˜ç›®å½•#100ï¼šç¼“å­˜ç›®å½•å ç£ç›˜ç©ºé—´å¤§å°ï¼ˆMï¼‰#16ï¼šç¼“å­˜ç©ºé—´ä¸€çº§å­ç›®å½•ä¸ªæ•°#256ï¼šç¼“å­˜ç©ºé—´äºŒçº§å­ç›®å½•ä¸ªæ•°cache_mgr webmaster@test.com #å®šä¹‰ç®¡ç†å‘˜é‚®ç®±http_access deny all #è®¿é—®æŽ§åˆ¶squidä¸­çš„è®¿é—®æŽ§åˆ¶ä½¿ç”¨è®¿é—®æŽ§åˆ¶ç‰¹æ€§ï¼Œå¯ä»¥æŽ§åˆ¶åœ¨è®¿é—®æ—¶æ ¹æ®ç‰¹å®šçš„æ—¶é—´é—´éš”è¿›è¡Œç¼“å­˜ã€è®¿é—®ç‰¹å®šç«™ç‚¹æˆ–ä¸€ç»„ç«™ç‚¹ç­‰ç­‰ã€‚squidè®¿é—®æŽ§åˆ¶æœ‰ä¸¤ä¸ªè¦ç´ ï¼šACLå…ƒç´ å’Œè®¿é—®åˆ—è¡¨ã€‚è®¿é—®åˆ—è¡¨å¯ä»¥å…è®¸æˆ–æ‹’ç»æŸäº›ç”¨æˆ·å¯¹æ­¤æœåŠ¡çš„è®¿é—®ã€‚ACLå…ƒç´ ç±»åž‹srcï¼šæºåœ°å€ï¼ˆå³å®¢æˆ·æœºIPåœ°å€ï¼‰dstï¼šç›®æ ‡åœ°å€ï¼ˆå³æœåŠ¡å™¨IPåœ°å€ï¼‰srcdomainï¼šæºåç§°ï¼ˆå³å®¢æˆ·æœºåç§°ï¼‰dstdomainï¼šç›®æ ‡åç§°ï¼ˆå³æœåŠ¡å™¨åç§°ï¼‰timeï¼šä¸€å¤©ä¸­çš„æ—¶åˆ»å’Œä¸€å‘¨å†…çš„ä¸€å¤©url_regexï¼šURLè§„åˆ™è¡¨è¾¾å¼åŒ¹é…urlpath_regexï¼šURL-pathè§„åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œç•¥åŽ»åè®®å’Œä¸»æœºåproxy_authï¼šé€šè¿‡å¤–éƒ¨ç¨‹åºè¿›è¡Œç”¨æˆ·éªŒè¯maxconnï¼šå•ä¸€IPçš„æœ€å¤§è¿žæŽ¥æ•°ACLæ ¼å¼ä¸ºäº†ä½¿ç”¨æŽ§åˆ¶åŠŸèƒ½ï¼Œå¿…é¡»å…ˆè®¾ç½®ACLè§„åˆ™å¹¶åº”ç”¨ã€‚ACLå£°æ˜Žçš„æ ¼å¼å¦‚ä¸‹ï¼š æ³¨ï¼šacl_element_name å¯ä»¥æ˜¯ä»»ä¸€ä¸ªåœ¨ACLä¸­å®šä¹‰çš„åç§°ä»»ä½•ä¸¤ä¸ªACLå…ƒç´ ä¸èƒ½ç”¨ç›¸åŒçš„åå­—æ¯ä¸ªACLç”±åˆ—è¡¨å€¼ç»„æˆã€‚å½“è¿›è¡ŒåŒ¹é…æ£€æµ‹çš„æ—¶å€™ï¼Œå¤šä¸ªå€¼ç”±é€»è¾‘æˆ–è¿ç®—è¿žæŽ¥ï¼›æ¢è¨€ä¹‹ï¼Œå³ä»»ä¸€ACLå…ƒç´ çš„å€¼è¢«åŒ¹é…ï¼Œåˆ™è¿™ä¸ªACLå…ƒç´ å³è¢«åŒ¹é…ã€‚å¹¶ä¸æ˜¯æ‰€æœ‰ACLå…ƒç´ éƒ½èƒ½ä½¿ç”¨è®¿é—®åˆ—è¡¨ä¸­çš„å…¨éƒ¨ç±»åž‹ä¸åŒçš„ACLå…ƒç´ å†™åœ¨ä¸åŒè¡Œä¸­ï¼Œsquidå°†æŠŠä»–ä»¬ç»„åˆåœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­è®¿é—®æ¡ç›®æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¸å¤šä¸åŒçš„è®¿é—®æ¡ç›®ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å‡ ä¸ªï¼šhttp_access:å…è®¸HTTPè®¿é—®no_cache:å®šä¹‰å¯¹ç¼“å­˜è¯·æ±‚çš„å“åº”ã€‚è®¿é—®åˆ—è¡¨çš„è§„åˆ™ç”±ä¸€äº›ç±»ä¼¼â€™allowâ€™æˆ–â€˜denyâ€™çš„å…³é”®å­—æž„æˆï¼Œç”¨ä»¥å…è®¸æˆ–æ‹’ç»å‘ç‰¹å®šæˆ–ä¸€ç»„ACLå…ƒç´ æä¾›æœåŠ¡ã€‚ä¸€ä¸ªè®¿é—®åˆ—è¡¨å¯ä»¥ç”±å¤šæ¡è§„åˆ™ç»„æˆå¦‚æžœæ²¡æœ‰ä»»ä½•è§„åˆ™ä¸Žè®¿é—®è¯·æ±‚åŒ¹é…ï¼Œé»˜è®¤åŠ¨ä½œå°†ä¸Žåˆ—è¡¨ä¸­æœ€åŽä¸€æ¡è§„åˆ™å¯¹åº”ã€‚ä¸€ä¸ªè®¿é—®æ¡ç›®ä¸­æ‰€æœ‰å…ƒç´ å°†ç”¨é€»è¾‘ä¸Žè¿ç®—è¿žæŽ¥http_access Action å£°æ˜Ž1 AND å£°æ˜Ž2 AND å£°æ˜Ž OR.http_access Action å£°æ˜Ž3å¤šä¸ªhttp_accessså£°æ˜Žé—´ç”¨æˆ–è¿ç®—è¿žæŽ¥ï¼Œä½†æ¯ä¸ªè®¿é—®æ¡ç›®çš„å…ƒç´ é—´ç”¨ä¸Žè¿ç®—è¿žæŽ¥ã€‚åˆ—è¡¨ä¸­çš„è§„åˆ™æ€»æ˜¯éµå¾ªç”±ä¸Šè€Œä¸‹çš„é¡ºåºè¿™äº›è§„åˆ™æŒ‰ç…§ä»–ä»¬çš„æŽ’åˆ—é¡ºåºè¿›è¡ŒåŒ¹é…æ£€æµ‹ï¼Œä¸€æ—¦æ£€æµ‹åˆ°åŒ¹é…çš„è§„åˆ™ï¼ŒåŒ¹é…å°±ç«‹å³ç»“æŸã€‚Squid.confé…ç½®æ–‡ä»¶è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156#acl all src 0.0.0.0/0.0.0.0 and http_access allow allé€‰é¡¹å®šä¹‰äº†ä¸€ä¸ªè®¿é—®æŽ§åˆ¶åˆ—è¡¨ã€‚è¯¦ç»†æƒ…å†µå‚è§å’ŒSquidè½¯ä»¶#æºå¸¦çš„æ–‡æ¡£ã€‚è¿™é‡Œçš„è®¿é—®æŽ§åˆ¶åˆ—è¡¨å…è®¸æ‰€æœ‰å¯¹ä»£ç†æœåŠ¡çš„è®¿é—®ï¼Œå› ä¸ºè¿™é‡Œè¯¥ä»£ç†æ˜¯åŠ é€ŸwebæœåŠ¡å™¨ã€‚acl all src 0.0.0.0/0.0.0.0 #å…è®¸æ‰€æœ‰IPè®¿é—®acl manager proto http #manager urlåè®®ä¸ºhttpacl localhost src 127.0.0.1/255.255.255.255 #å…åˆæœ¬æœºIPacl to_localhost dst 127.0.0.1 #å…åˆç›®çš„åœ°å€ä¸ºæœ¬æœºIPacl Safe_ports port 80 # å…è®¸å®‰å…¨æ›´æ–°çš„ç«¯å£ä¸º80acl CONNECT method CONNECT #è¯·æ±‚æ–¹æ³•ä»¥CONNECThttp_access allow all #å…è®¸æ‰€æœ‰äººä½¿ç”¨è¯¥ä»£ç†.å› ä¸ºè¿™é‡Œæ˜¯ä»£ç†åŠ é€ŸwebæœåŠ¡å™¨http_reply_access allow all #å…è®¸æ‰€æœ‰å®¢æˆ·ç«¯ä½¿ç”¨è¯¥ä»£ç†acl OverConnLimit maxconn 16 #é™åˆ¶æ¯ä¸ªIPæœ€å¤§å…è®¸16ä¸ªè¿žæŽ¥ï¼Œé˜²æ­¢æ”»å‡»http_access deny OverConnLimiticp_access deny all #ç¦æ­¢ä»Žé‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’ŒæŽ¥æ”¶ICPè¯·æ±‚.miss_access allow all #å…è®¸ç›´æŽ¥æ›´æ–°è¯·æ±‚ident_lookup_access deny all #ç¦æ­¢lookupæ£€æŸ¥DNShttp_port 8080 transparent #æŒ‡å®šSquidç›‘å¬æµè§ˆå™¨å®¢æˆ·è¯·æ±‚çš„ç«¯å£å·ã€‚hierarchy_stoplist cgi-bin ? #ç”¨æ¥å¼ºåˆ¶æŸäº›ç‰¹å®šçš„å¯¹è±¡ä¸è¢«ç¼“å­˜ï¼Œä¸»è¦æ˜¯å¤„äºŽå®‰å…¨çš„ç›®çš„ã€‚acl QUERY urlpath_regex cgi-bin \?cache deny QUERYcache_mem 1 GB #è¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œå¢žåŠ è¯¥å†…å­˜å€¼æœ‰åˆ©äºŽç¼“å­˜ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼š #ä¸€èˆ¬æ¥è¯´å¦‚æžœç³»ç»Ÿæœ‰å†…å­˜ï¼Œè®¾ç½®è¯¥å€¼ä¸º(n/)3Mã€‚çŽ°åœ¨æ˜¯3G æ‰€ä»¥è¿™é‡Œ1Gfqdncache_size 1024 #FQDN é«˜é€Ÿç¼“å­˜å¤§å°maximum_object_size_in_memory 2 MB #å…è®¸æœ€å¤§çš„æ–‡ä»¶è½½å…¥å†…å­˜memory_replacement_policy heap LFUDA #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºå†…å­˜cachecache_replacement_policy heap LFUDA #åŠ¨æ€ä½¿ç”¨æœ€å°çš„ï¼Œç§»å‡ºç¡¬ç›˜cachecache_dir ufs /home/cache 5000 32 512 #é«˜é€Ÿç¼“å­˜ç›®å½• ufs ç±»åž‹ ä½¿ç”¨çš„ç¼“å†²å€¼æœ€å¤§å…åˆ1000MBç©ºé—´ï¼Œ#32ä¸ªä¸€çº§ç›®å½•ï¼Œ512ä¸ªäºŒçº§ç›®å½•max_open_disk_fds 0 #å…è®¸æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é‡,0 æ— é™åˆ¶minimum_object_size 1 KB #å…åˆæœ€å°æ–‡ä»¶è¯·æ±‚ä½“å¤§å°maximum_object_size 20 MB #å…åˆæœ€å¤§æ–‡ä»¶è¯·æ±‚ä½“å¤§å°cache_swap_low 90 #æœ€å°å…è®¸ä½¿ç”¨swap 90%cache_swap_high 95 #æœ€å¤šå…è®¸ä½¿ç”¨swap 95%ipcache_size 2048 # IP åœ°å€é«˜é€Ÿç¼“å­˜å¤§å° 2Mipcache_low 90 #æœ€å°å…è®¸ipcacheä½¿ç”¨swap 90%ipcache_high 95 #æœ€å¤§å…è®¸ipcacheä½¿ç”¨swap 90%access_log /var/log/squid/access.log squid #å®šä¹‰æ—¥å¿—å­˜æ”¾è®°å½•cache_log /var/log/squid/cache.log squidcache_store_log none #ç¦æ­¢storeæ—¥å¿—emulate_httpd_log on #å°†ä½¿Squidä»¿ç…§WebæœåŠ¡å™¨çš„æ ¼å¼åˆ›å»ºè®¿é—®è®°å½•ã€‚å¦‚æžœå¸Œæœ›ä½¿ç”¨ #Webè®¿é—®è®°å½•åˆ†æžç¨‹åºï¼Œå°±éœ€è¦è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚refresh_pattern . 0 20% 4320 override-expire override-lastmod reload-into-ims ignore-reload #æ›´æ–°cacheè§„åˆ™acl buggy_server url_regex ^http://.... http:// #åªå…è®¸httpçš„è¯·æ±‚broken_posts allow buggy_serveracl apache rep_header Server ^Apache #å…è®¸apacheçš„ç¼–ç broken_vary_encoding allow apacherequest_entities off #ç¦æ­¢éžhttpçš„æ ‡åˆ†å‡†è¯·æ±‚ï¼Œé˜²æ­¢æ”»å‡»header_access header allow all #å…è®¸æ‰€æœ‰çš„httpæŠ¥å¤´relaxed_header_parser on #ä¸ä¸¥æ ¼åˆ†æžhttpæŠ¥å¤´.client_lifetime 120 minute #æœ€å¤§å®¢æˆ·è¿žæŽ¥æ—¶é—´ 120åˆ†é’Ÿcache_mgr sky@test.com #æŒ‡å®šå½“ç¼“å†²å‡ºçŽ°é—®é¢˜æ—¶å‘ç¼“å†²ç®¡ç†è€…å‘é€å‘Šè­¦ä¿¡æ¯çš„åœ°å€ä¿¡æ¯ã€‚cache_effective_user squid #è¿™é‡Œä»¥ç”¨æˆ·squidçš„èº«ä»½SquidæœåŠ¡å™¨cache_effective_group squidicp_port 0 #æŒ‡å®šSquidä»Žé‚»å±…æœåŠ¡å™¨ç¼“å†²å†…å‘é€å’ŒæŽ¥æ”¶ICPè¯·æ±‚çš„ç«¯å£å·ã€‚ #è¿™é‡Œè®¾ç½®ä¸º0æ˜¯å› ä¸ºè¿™é‡Œé…ç½®Squidä¸ºå†…éƒ¨WebæœåŠ¡å™¨çš„åŠ é€Ÿå™¨ï¼Œ #æ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨é‚»å±…æœåŠ¡å™¨çš„ç¼“å†²ã€‚0æ˜¯ç¦ç”¨# cache_peer è®¾ç½®å…è®¸æ›´æ–°ç¼“å­˜çš„ä¸»æœºï¼Œå› æ˜¯æœ¬æœºæ‰€ä»¥127.0.0.1cache_peer 127.0.0.1 parent 80 0 no-query default multicast-responder no-netdb-exchangecache_peer_domain 127.0.0.1 hostname_aliases 127.0.0.1error_directory /usr/share/squid/errors/Simplify_Chinese #å®šä¹‰é”™è¯¯è·¯å¾„always_direct allow all # cacheä¸¢å¤±æˆ–ä¸å­˜åœ¨æ˜¯å…è®¸æ‰€æœ‰è¯·æ±‚ç›´æŽ¥è½¬å‘åˆ°åŽŸå§‹æœåŠ¡å™¨ignore_unknown_nameservers on #å¼€åDNSæŸ¥è¯¢ï¼Œå½“åŸŸååœ°å€ä¸ç›¸åŒæ—¶å€™ï¼Œç¦æ­¢è®¿é—®coredump_dir /var/log/squid #å®šä¹‰dumpçš„ç›®å½•max_filedesc 2048 #æœ€å¤§æ‰“å¼€çš„æ–‡ä»¶æè¿°half_closed_clients off #ä½¿Squidåœ¨å½“readä¸å†è¿”å›žæ•°æ®æ—¶ç«‹å³å…³é—­å®¢æˆ·ç«¯çš„è¿žæŽ¥ã€‚ #æœ‰æ—¶readä¸å†è¿”å›žæ•°æ®æ˜¯ç”±äºŽæŸäº›å®¢æˆ·å…³é—­TCPçš„å‘é€æ•°æ® #è€Œä»ç„¶ä¿æŒæŽ¥æ”¶æ•°æ®ã€‚è€ŒSquidåˆ†è¾¨ä¸å‡ºTCPåŠå…³é—­å’Œå®Œå…¨å…³é—­ã€‚buffered_logs on #è‹¥æ‰“å¼€é€‰é¡¹â€œbuffered_logsâ€å¯ä»¥ç¨ç¨æé«˜åŠ é€ŸæŸäº›å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™å…¥ï¼Œè¯¥é€‰é¡¹ä¸»è¦æ˜¯å®žçŽ°ä¼˜åŒ–ç‰¹æ€§ã€‚#é˜²æ­¢å¤©æ¶¯ç›—é“¾ï¼Œè½¬å«ç»™ç™¾åº¦acl tianya referer_regex -i tianyahttp_access deny tianyadeny_info tianya#é˜»æ­¢baiduèœ˜è››acl baidu req_header User-Agent Baiduspiderhttp_access deny baidu#é™åˆ¶åŒä¸€IPå®¢æˆ·ç«¯çš„æœ€å¤§è¿žæŽ¥æ•°acl OverConnLimit maxconn 128http_access deny OverConnLimit#é˜²æ­¢è¢«äººåˆ©ç”¨ä¸ºHTTPä»£ç†ï¼Œè®¾ç½®å…è®¸è®¿é—®çš„IPåœ°å€acl myip dst 222.18.63.37http_access deny !myip#å…è®¸æœ¬åœ°ç®¡ç†acl Manager proto cache_objectacl Localhost src 127.0.0.1 222.18.63.37http_access allow Manager Localhostcachemgr_passwd 53034338 allhttp_access deny Manager#ä»…ä»…å…è®¸80ç«¯å£çš„ä»£ç†acl all src 0.0.0.0/0.0.0.0acl Safe_ports port 80 # httphttp_access deny !Safe_portshttp_access allow all#Squidä¿¡æ¯è®¾ç½®visible_hostname happy.swjtu.edu.cncache_mgr ooopic2008@qq.com#åŸºæœ¬è®¾ç½®cache_effective_user squidcache_effective_group squidtcp_recv_bufsize 65535 bytes#2.6çš„åå‘ä»£ç†åŠ é€Ÿé…ç½®cache_peer 127.0.0.1 parent 80 0 no-query originserver#é”™è¯¯æ–‡æ¡£error_directory /usr/local/squid/share/errors/Simplify_Chinese#å•å°ä½¿ç”¨ï¼Œä¸ä½¿ç”¨è¯¥åŠŸèƒ½icp_port 0hierarchy_stoplist cgi-bin ?acl QUERY urlpath_regex cgi-bin \? .php .cgi .avi .wmv .rm .ram .mpg .mpeg .zip .execache deny QUERYacl apache rep_header Server ^Apachebroken_vary_encoding allow apacherefresh_pattern ^ftp: 1440 20% 10080refresh_pattern ^gopher: 1440 0% 1440refresh_pattern . 0 20% 4320cache_store_log nonepid_filename /usr/local/squid/var/logs/squid.pidemulate_httpd_log onSquidå¸¸ç”¨å‘½ä»¤åˆå§‹åŒ–åœ¨squid.confé‡Œé…ç½®çš„cacheç›®å½•squid -zå¦‚æžœæœ‰é”™è¯¯æç¤ºï¼Œè¯·æ£€æŸ¥cacheç›®å½•çš„æƒé™ï¼Œå¯ä»¥æ›´æ”¹ç›®å½•æƒé™chown -R squid:squid /cacheç›®å½•å¯¹squid.confæŽ’é”™ï¼Œå³éªŒè¯squid.confçš„è¯­æ³•å’Œé…ç½®squid -k parseå¦‚æžœåœ¨squid.confä¸­æœ‰è¯­æ³•æˆ–é…ç½®é”™è¯¯ï¼Œè¿™é‡Œä¼šè¿”å›žæç¤ºï¼Œè‹¥æ— è¿”å›žï¼Œå°è¯•å¯åŠ¨squidå‰å°å¯åŠ¨squidï¼Œå¹¶è¾“å‡ºå¯åŠ¨è¿‡ç¨‹/usr/local/squid/sbin/squid -N -d1å¦‚æžœæœ‰ready to server requesç›¸å…³ä¿¡æ¯ï¼Œè¯´æ˜Žsquidå¯åŠ¨æˆåŠŸç„¶åŽctrl+c ,åœæ­¢squid,å¹¶ä»¥åŽå°è¿è¡Œçš„æ–¹å¼å¯åŠ¨å®ƒå¯åŠ¨squidåœ¨åŽå°è¿è¡Œsquid -så¯ä»¥ä½¿ç”¨ps -ax | grep squid æ¥æŸ¥çœ‹squidè¿›ç¨‹æ˜¯å¦å­˜åœ¨åœæ­¢squidsquid -k shutdowné‡æ–°å¼•å¯¼ä¿®æ”¹è¿‡çš„squid.confsquid -k reconfigure -f /XXX/squid.confå½“squidè¿›è¡Œé…ç½®æ›´æ”¹åŽï¼Œå¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œsquidé…ç½®é‡è½½æŠŠsquidæ·»åŠ åˆ°ç³»ç»Ÿå¯åŠ¨é¡¹vim /etc/rc.local/usr/local/squid/sbin/squid -sä¿®æ”¹cacheç¼“å­˜ç›®å½•çš„æƒé™chown -R squid.squid /cacheç›®å½•cacheç¼“å­˜ç›®å½•æ ¹æ®è‡ªå·±çš„é…ç½®æ›´æ”¹ï¼Œsquidç”¨æˆ·å’Œç»„æ˜¯squidï¼Œsquidä¿®æ”¹squidæ—¥å¿—ç›®å½•çš„æƒé™chown -R squid.squid å®šä¹‰çš„æ—¥å¿—æ–‡ä»¶æ‰€åœ¨ç›®å½•è¿™ä¸€æ­¥å¹¶ä¸æ˜¯é€‚åˆæ¯ä¸€ä¸ªä½¿ç”¨squidçš„ç”¨æˆ·ï¼Œæ„ä¸ºè®©squidæœ‰æƒé™åœ¨è¯¥ç›®å½•é‡Œè¿›è¡Œå†™æ“ä½œæŸ¥çœ‹ä½ çš„æ—¥å¿—æ–‡æ¡£more /usr/local/squid/var/logs/access.log | grep TCP_MEM_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°å†…å­˜ä¸­ï¼Œå¹¶è¿”å›žç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_HITè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶è¢«squidç¼“å­˜åˆ°cacheç›®å½•ä¸­ï¼Œå¹¶è¿”å›žç»™è®¿é—®ç”¨æˆ·ã€‚more /usr/local/squid/var/logs/access.log | grep TCP_MISSè¯¥æŒ‡ä»¤å¯ä»¥çœ‹åˆ°åœ¨squidè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰é‚£äº›æ–‡ä»¶æ²¡æœ‰è¢«squidç¼“å­˜ï¼Œè€Œæ˜¯ä»ŽåŽŸå§‹æœåŠ¡å™¨èŽ·å–å¹¶è¿”å›žç»™è®¿é—®ç”¨æˆ·ã€‚Squidå‘½ä¸­çŽ‡åˆ†æž12/usr/local/squid/bin/squidclient -p 80 mgr:info/usr/local/squid/bin/squidclient -p 80 mgr:5minå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ€§èƒ½æƒ…å†µ,å…¶ä¸­PORTæ˜¯ä½ çš„proxyçš„ç«¯å£ï¼Œ5minå¯ä»¥æ˜¯60minå–å¾—squidè¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼š1squidclient -p 80 mgr:infoå–å¾—squidå†…å­˜ä½¿ç”¨æƒ…å†µï¼š1squidclient -p 80 mgr:memå–å¾—squidå·²ç»ç¼“å­˜çš„åˆ—è¡¨ï¼š1squidclient -p 80 mgr:bjects. use it carefully,it may crashå–å¾—squidçš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼š1squidclient -p 80 mgr:diskdå¼ºåˆ¶æ›´æ–°æŸä¸ªurlï¼š1squidclient -p 80 -m PURGE http://www.xxx.com/xxx.phpæ›´å¤šçš„è¯·æŸ¥çœ‹ï¼šsquidclient-h æˆ–è€… squidclient -p 80 mgr:æŸ¥å‘½ä¸­çŽ‡ï¼š1squidclient -h IP(å…·ä½“ä¾¦å¬IP) -p 80(å…·ä½“ä¾¦å¬ç«¯å£) mgr:infoå®šæœŸæ¸…ç†swap.stateå†…æ— æ•ˆæ•°æ®123/path/to/squid/sbin/squid -k rotate -f /path/to/squid/conf_filevi /etc/crontab0 0 * * * root /usr/local/sbin/squid -k rotate -f /usr/local/etc/squid/squid1.confå½“squidåº”ç”¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åŽï¼Œcache_dirå¯¹åº”çš„swap.stateæ–‡ä»¶å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œé‡Œé¢çš„æ— æ•ˆæŽ¥å£æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œè¿™å¯èƒ½å½±å“squidçš„å“åº”æ—¶é—´ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨squidæ¸…ç†swap.stateé‡Œé¢çš„æ— æ•ˆæ•°æ®ï¼Œå‡å°‘swap.stateçš„å¤§å°ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>squid</tag>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç§‘å­¦ä¸Šç½‘ï¼šç”¨ VPS æ­å»º shadowsocks æœåŠ¡å™¨]]></title>
    <url>%2Fposts%2Fa067636e%2F</url>
    <content type="text"><![CDATA[shadowsocks ç®€ä»‹shadowsocks æ˜¯ä¸€æ¬¾è‡ªå®šä¹‰åè®®çš„ä»£ç†è½¯ä»¶ï¼Œç”±äºŽå…¶æµé‡ç‰¹å¾ä¸æ˜Žæ˜¾ï¼Œï¼ˆç›´åˆ°ä¸ä¹…å‰ï¼‰ä¸€ç›´å¯ä»¥ç¨³å®šæä¾›ä¸Šç½‘ä»£ç†ã€‚shadowsocks å®¢æˆ·ç«¯ä¼šåœ¨æœ¬åœ°å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡æ­¤ä»£ç†çš„ç½‘ç»œè®¿é—®è¯·æ±‚ç”±å®¢æˆ·ç«¯å‘é€è‡³æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å‘å‡ºè¯·æ±‚ï¼Œæ”¶åˆ°å“åº”æ•°æ®åŽå†å‘å›žå®¢æˆ·ç«¯ã€‚å› æ­¤ä½¿ç”¨ shadowsocks éœ€è¦ä¸€å°å¢™å¤–çš„æœåŠ¡å™¨æ¥éƒ¨ç½² shadowsocks æœåŠ¡ç«¯ã€‚è´­ä¹° VPS æœåŠ¡å™¨ä¸»æµçš„ VPSï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æœåŠ¡å™¨æä¾›å•†æœ‰ä¸‰å®¶ï¼šlinodedigital oceanbandwagonä¸‹é¢çš„æ¯”ä¸Šé¢çš„ä¾¿å®œã€‚å¦‚æžœåªæ˜¯è‡ªç”¨ï¼Œbandwagon è¶³å¤Ÿã€‚ä¸€èˆ¬ä½¿ç”¨ paypal ç»‘å®šä¸€ä¸ª visa æˆ– mastercard ä¿¡ç”¨å¡æ¥ä»˜æ¬¾ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚åœ¨ bandwagon è´­ä¹° VPS ä»¥åŽä¼šèŽ·å¾—ä¸€ä¸ªä¸»æœºåœ°å€å’Œç”¨äºŽ ssh ç™»å½•çš„ root å¯†ç ã€‚è¿œç¨‹ç™»é™† VPSMacæˆ– Linux ä¸‹ç›´æŽ¥åœ¨ç»ˆç«¯ä¸­ssh root@your_vps_ip your_ssh_portå³å¯ã€‚åœ¨ windows ç³»ç»Ÿä¸‹éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æ¥ SSH ç™»å½• VPSã€‚åœ¨&nbsp;xShell å®˜ç½‘&nbsp;&nbsp;ä¸‹è½½ xShellã€‚å®¶åº­å’Œå­¦æ ¡ç”¨æˆ·å¯ä»¥å…è´¹è¯•ç”¨ï¼Œä¸‹è½½æ—¶é€‰æ‹© home&nbsp;and&nbsp;school&nbsp;use å³å¯ã€‚éœ€è¦ç”¨é‚®ç®±æ³¨å†Œä¸€ä¸‹ï¼Œä¸‹è½½é“¾æŽ¥ä¼šå‘é€åˆ°é‚®ç®±ä¸­ã€‚xShell ä¸­æ–°å»ºä¸€ä¸ªè¿žæŽ¥ï¼Œä¼šè¦æ±‚è¾“å…¥ç›®æ ‡ IP åœ°å€å’Œç«¯å£ï¼Œä»¥åŠ root å¯†ç ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚å®‰è£… shadowsocksæœ€å¥½æ˜¯centos71.å®‰è£…pipç”±äºŽå®‰è£…çš„æ˜¯python ç‰ˆæœ¬çš„ shadowsocksï¼Œæ‰€ä»¥é¦–å…ˆå®‰è£…pip$ curl &quot;https://bootstrap.pypa.io/get-pip.py&quot; -o &quot;get-pip.py&quot; $ python get-pip.py 2.å®‰è£…shadowsocks$ pip install --upgrade pip $ pip install shadowsocks 3.åˆ›å»ºé…ç½®æ–‡ä»¶åˆ›å»ºæ–‡ä»¶æ‰€åœ¨ç›®å½•:/etc åˆ›å»ºæ–‡ä»¶å‘½ä»¤$ vi /etc/shadowsocks.json è‹¥è¿›å…¥äº†etcç›®å½•$ vi shadowsocks.json é…ç½®æ–‡ä»¶å†…å®¹ï¼šå•ç«¯å£ï¼š1234567891011121314151617&#123; "server":"0.0.0.0", --æœåŠ¡å™¨IPï¼Œç›´æŽ¥ç”¨0.0.0.0ä¹Ÿå¯ "server_port":8888, --ç«¯å£ç«¯å£ "local_address": "127.0.0.1", --æœ¬åœ°åœ°å€ï¼Œå¯çœç•¥ "local_port":1080,--æœ¬åœ°ç«¯å£ï¼Œå¯çœç•¥ "password":"password",--å¯†ç  "timeout":300, --è¶…æ—¶æ—¶é—´ï¼Œå¯çœç•¥ "method":"aes-256-cfb", --åŠ å¯†ç­–ç•¥ï¼Œæœ‰å¤šé‡ç­–ç•¥ï¼Œå…·ä½“è‡ªæŸ¥&#125;å¤šç«¯å£ï¼š12345678910111213141516171819202122232425&#123; "server":"0.0.0.0", "local_address":"127.0.0.1", "local_port":1080, "port_password":&#123;--æ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªå¯†ç  "1111":"password1", "1112":"password2", "1113":"password3" &#125;, "timeout":300, "method":"aes-256-cfb", "fast_open":false&#125;4.å¯åŠ¨shadowsockså¯åŠ¨ssserver -c /etc/shadowsocks.json -d start åœæ­¢ssserver -c /etc/shadowsocks.json -d stop é‡å¯ssserver -c /etc/shadowsocks.json -d restart å¯åŠ¨æˆåŠŸå³å¯é€šè¿‡sså®¢æˆ·ç«¯ä½¿ç”¨ã€‚åœ¨windowç«¯å¯ä»¥åœ¨æŽ§åˆ¶å°é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç«¯å£æ˜¯å¦æ‰“å¼€telnet {ip} {port} 5.é…ç½®è‡ªå¯åŠ¨æ–°å»ºå¯åŠ¨è„šæœ¬æ–‡ä»¶/etc/systemd/system/shadowsocks.serviceï¼Œå†…å®¹å¦‚ä¸‹ï¼š [Unit]Description=Shadowsocks [Service]TimeoutStartSec=0 ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json [Install]WantedBy=multi-user.target é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ³¨å†Œï¼Œå¯åŠ¨æœåŠ¡$ systemctl enable shadowsocks $ systemctl start shadowsocks å¯åŠ¨åŽå¯ä»¥æŸ¥çœ‹æœåŠ¡çŠ¶æ€$ systemctl status shadowsocks -l è‹¥å¯åŠ¨æˆåŠŸï¼šâ— shadowsocks.service - ShadowsocksLoaded: loaded (/etc/systemd/system/shadowsocks.service; enabled; vendor preset: disabled)Active: active (running) since Sun 2017-08-13 18:03:41 CST; 1h 29min agoMain PID: 9567 (ssserver)CGroup: /system.slice/shadowsocks.serviceâ””â”€9567 /usr/bin/python2 /usr/bin/ssserver -c /etc/shadowsocks.jsonå¦‚æžœï¼ŒæœåŠ¡å¤±è´¥ï¼Œé‡å¯æœåŠ¡å™¨è¯•ä¸€ä¸‹å®‰è£…å¹¶å¯åŠ¨ shadowsocks å®¢æˆ·ç«¯shadowsocks æ”¯æŒ windowsã€Mac&nbsp;OS&nbsp;Xã€Linuxã€Androidã€iOS ç­‰å¤šä¸ªå¹³å°ã€‚ä¸è¿‡ iOS ç”±äºŽç³»ç»Ÿå¯¹åº”ç”¨åŽå°è¿è¡Œçš„é™åˆ¶ï¼ŒæŽ¨èä½¿ç”¨å®¢æˆ·ç«¯å†…åµŒçš„æµè§ˆå™¨ç§‘å­¦ä¸Šç½‘ï¼Œç»™å…¶ä»–åº”ç”¨ä»£ç†æ—¶éœ€è¦æ¯è¿‡å‡ åˆ†é’Ÿé‡æ–°å¯åŠ¨ä¸€ä¸‹ appã€‚shadowsocks é¡¹ç›® Github ä¸»é¡µåœ¨è¿™é‡Œã€‚é‡Œé¢å¯ä»¥æ‰¾åˆ°å®¢æˆ·ç«¯ä¸‹è½½åœ°å€ã€‚ä¸‹è½½å®‰è£…å®¢æˆ·ç«¯ä»¥åŽï¼Œåªéœ€æŒ‰æœåŠ¡å™¨çš„é…ç½®å¡«å†™ IP åœ°å€ã€æœåŠ¡å™¨ç«¯å£ã€æœ¬åœ°ç«¯å£ï¼ˆå¦‚æžœæ²¡æœ‰æœ¬åœ°ç«¯å£é€‰é¡¹ï¼Œå°±æ˜¯é»˜è®¤çš„ 1080ï¼‰ã€å¯†ç ã€åŠ å¯†æ–¹å¼ç­‰å‚æ•°ï¼Œå¯åŠ¨å°±å¯ä»¥äº†ã€‚å®¢æˆ·ç«¯æ”¯æŒå…¨å±€ä»£ç†å’Œ PAC ä»£ç†ä¸¤ç§æ–¹å¼ï¼ŒåŽè€…ä¼šä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥è‡ªåŠ¨æ£€æŸ¥ä¸€ä¸ªç½‘ç«™æ˜¯å¦åœ¨éœ€è¦ä»£ç†çš„ç½‘ç«™åˆ—è¡¨ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©ç›´æŽ¥è¿žæŽ¥æˆ–ä»£ç†è¿žæŽ¥ã€‚PAC åˆ—è¡¨å¯ä»¥åœ¨çº¿æ›´æ–°ï¼Œä½†æ˜¯éš¾å…æœ‰æ”¶å½•ä¸å…¨çš„æƒ…å†µã€‚è¿™æ—¶å¯ä»¥é€‰æ‹©å…³é—­ shadowsocks ä»£ç†ï¼ˆå®žé™…ä¸Šæ˜¯å–æ¶ˆå¯¹ç³»ç»Ÿä»£ç†çš„é…ç½®ï¼Œshadowsocks å®¢æˆ·ç«¯ä»ç„¶ä¿æŒå·¥ä½œï¼‰ï¼Œç„¶åŽä½¿ç”¨æ”¯æŒè‡ªå®šä¹‰è§„åˆ™çš„ä»£ç†ç®¡ç†æ’ä»¶æ¥å®žçŽ°è‡ªåŠ¨åˆ‡æ¢ä»£ç†ï¼Œæ¯”å¦‚ switchyOmegaã€‚ä½¿ç”¨ switchyOmega å®žçŽ°è‡ªåŠ¨åˆ‡æ¢ä»£ç†switchyOmega æ˜¯ chrome æµè§ˆå™¨ä¸Šä¸€ä¸ªå¾ˆå¥½ç”¨çš„ä»£ç†ç®¡ç†æ’ä»¶ã€‚å®ƒçš„å‰èº« switchySharp æ›´æœ‰åã€‚ chrome åº”ç”¨å•†åº—æœ¬èº«éœ€è¦ç¿»å¢™æ‰èƒ½è®¿é—®ï¼Œå› æ­¤éœ€è¦å…ˆåœ¨ shadowsocks å¯åŠ¨ä»£ç†æ¨¡å¼ä¸‹ä¸‹è½½å®‰è£…ï¼Œå†å…³é—­ shadowsocks ä»£ç†ã€‚ å®‰è£…å®Œæ¯•åŽï¼Œå³å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©é€‰é¡¹ï¼Œè¿›å…¥ switchOmega é…ç½®ç•Œé¢ã€‚ åˆ›å»º shadowsocks æƒ…æ™¯æ¨¡å¼æ–°å»ºä¸€ä¸ªæƒ…æ™¯æ¨¡å¼ï¼Œæ¯”å¦‚å« SSï¼Œä»£ç†åè®®é€‰æ‹© socks5ï¼Œä»£ç†åœ°å€ä¸º 127.0.0.1ï¼Œç«¯å£ 1080ã€‚ çŽ°åœ¨åˆ‡æ¢åˆ° SS æƒ…æ™¯æ¨¡å¼å°±å¯ä»¥é€šè¿‡ shadowsocks ç§‘å­¦ä¸Šç½‘äº†ã€‚åŽé¢èŽ·å–è‡ªåŠ¨åˆ‡æ¢è§„åˆ™åˆ—è¡¨ è®¾ç½®è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼åœ¨è®¾ç½®ç•Œé¢é€‰æ‹©è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼ï¼Œåœ¨ â€œåˆ‡æ¢è§„åˆ™â€ ä¸­å‹¾é€‰â€œè§„åˆ™åˆ—è¡¨è§„åˆ™â€ï¼Œå¯¹åº”çš„æƒ…æ™¯æ¨¡å¼é€‰æ‹©åˆšåˆšæ–°å»ºçš„ SSã€‚ç„¶åŽåœ¨ä¸‹é¢çš„è§„åˆ™åˆ—è¡¨åœ°å€ä¸­å¡«å†™https://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txtè§„åˆ™åˆ—è¡¨æ ¼å¼é€‰æ‹© AutoProxyã€‚ç„¶åŽç‚¹å‡»ç«‹å³æ›´æ–°æƒ…æ™¯æ¨¡å¼ï¼Œ æ›´æ–°å®ŒæˆåŽä¼šæœ‰æç¤ºã€‚ç‚¹å‡»å·¦ä¾§çš„ â€œåº”ç”¨é€‰é¡¹â€ã€‚ç„¶åŽå•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹©è‡ªåŠ¨åˆ‡æ¢ï¼Œå°±å¯ä»¥åœ¨è®¿é—®â€œä¸å­˜åœ¨çš„ç½‘ç«™â€ æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° shadowsocks ä»£ç†äº†ã€‚æ·»åŠ è‡ªå®šä¹‰è§„åˆ™å¦‚æžœé‡åˆ°æŸä¸ªå›½å¤–ç½‘ç«™æ— æ³•ç›´æŽ¥è¿žæŽ¥æˆ–é€Ÿåº¦å¤ªæ…¢æ—¶ï¼Œå¯ä»¥å•å‡» switchyOmega å›¾æ ‡ï¼Œé€‰æ‹© â€œæ·»åŠ æ¡ä»¶â€ï¼Œæƒ…æ™¯æ¨¡å¼é€‰æ‹© SSï¼Œå°±å¯ä»¥äº†ã€‚è¿™æ—¶æ‰“å¼€ switchyOmega é€‰é¡¹ï¼Œåœ¨è‡ªåŠ¨åˆ‡æ¢æ¨¡å¼çš„åˆ‡æ¢è§„åˆ™ä¸­å°±å¯ä»¥çœ‹åˆ°åˆšåˆšæ·»åŠ çš„è§„åˆ™ã€‚å¯ä»¥åœ¨è¿™é‡Œç®¡ç†è‡ªå®šä¹‰çš„è§„åˆ™ã€‚å¯¼å…¥å’Œå¯¼å‡º switchyOmega è®¾ç½®å¦‚æžœæ¢äº†ä¸€å°ç”µè„‘ï¼Œé‡æ–°è®¾ç½®ä¸€é switchyOmega å°±å¤ªéº»çƒ¦äº†ã€‚å¯ä»¥åœ¨è®¾ç½®å¥½çš„ switchyOmega ä¸­å¯¼å‡ºè®¾ç½®æ–‡ä»¶ï¼Œåœ¨å¦ä¸€ä¸ª chrome æµè§ˆå™¨ä¸­å¯¼å…¥ï¼Œå°±å¯ä»¥ç›´æŽ¥å¤åˆ¶åŽŸæ¥çš„è®¾ç½®äº†ã€‚åœ¨ switchyOmega é€‰é¡¹çš„å·¦ä¾§ç‚¹å‡» â€œå¯¼å…¥ / å¯¼å‡ºâ€ï¼Œç‚¹å‡»â€œç”Ÿæˆå¤‡ä»½æ–‡ä»¶â€ å³å¯ç”Ÿæˆ switchyOmega è®¾ç½®å¤‡ä»½ã€‚ç‚¹å‡» â€œä»Žå¤‡ä»½æ–‡ä»¶æ¢å¤â€ å¯ä»¥å¯¼å…¥å¤‡ä»½æ–‡ä»¶ã€‚]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>VPS</tag>
        <tag>shadowsocks</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Tag Plugins]]></title>
    <url>%2Fposts%2Fe2e5eeac%2F</url>
    <content type="text"><![CDATA[FAQWelcome to tag-pluginsTag Plugin is a way to make special style contents supported by Hexo. For example, we cannot show a image with custom size in standard Markdown. And then we can use tag plugins to solve it. Hexo has a lot of tags which can help user. And Hexo also have interfaces to themes which make themes able to create their own tags. Following tags is provided by NexT:Centered QuoteInclude RawButtonFull ImageGroup PicturesLabelMermaidNotePDFTabsVideoCentered QuoteThis tag will make a quote with two lines before and after it, and text quoted will be centered. When using centered quote, if we have multi-line text, and each line has a different length, the quote wonâ€™t be symmetrical, so itâ€™s recommended to use when only have single line text. For example before article all after article to make a summary.Usagecenter-quote.js123&#123;% centerquote %&#125;Something&#123;% endcenterquote %&#125;&lt;!-- Tag Alias --&gt;&#123;% cq %&#125;Something&#123;% endcq %&#125;Example1&#123;% cq %&#125;Elegant in code, simple in core&#123;% endcq %&#125;Elegant in code, simple in coreInclude RawThis tag include any raw content into your posts. Path is relative to your site source directory.Usageinclude-raw.js1&#123;% include_raw '_data/path/to/file.html' %&#125;ExampleLetâ€™s create include-raw.html file in _data directory under site root directory with following content:1Any &lt;strong&gt;raw content&lt;/strong&gt; may be included with this tag.Then in any post we can use this content with include_raw tag:1&#123;% include_raw '_data/path/to/include-raw.html' %&#125;]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Next</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MOD]]></title>
    <url>%2Fposts%2F8c023e79%2F</url>
    <content type="text"><![CDATA[ã€Šè¾å°„4ã€‹äºŒæ¬¡å…ƒèŒå¦¹MODè¡¥ä¸ç±»åž‹ï¼šæ¸¸æˆMODæ•´ç†æ—¶é—´ï¼š2019-05-05å¤§å°ï¼š18.73MBè¡¥ä¸åˆ¶ä½œï¼šhiyokomodè¡¥ä¸è¯­è¨€ï¼šå¤šå›½ç‰ˆæœ¬ï¼šv1.0downloadç”±Nç½‘ä½œè€…â€œhiyokomodâ€åˆ¶ä½œçš„ä¸€æ¬¾äººç‰©å¤–è§‚æ›¿æ¢ç¾ŽåŒ–modâ€œäºŒæ¬¡å…ƒèŒå¦¹MODâ€ï¼Œå°†æ¸¸æˆä¸­å°†æ¸¸æˆä¸­å¤šä½å¥³æ€§NPCå¤–è§‚ä¿®æ”¹ä¸ºäºŒæ¬¡å…ƒç¾Žå°‘å¥³ï¼Œéžå¸¸ç²¾è‡´çš„é¢éƒ¨å»ºæ¨¡å’Œå¯ä¿®æ”¹é¡¹ï¼Œå¸¦ç»™æ¯ä¸€ä¸ªè€å†°æ£ï¼å–œæ¬¢è¿™äº›èŒå¦¹å­å°±æ¥3DMä¸‹è½½ä½“éªŒå§ï¼æˆªå›¾æ³¨æ„äº‹é¡¹éœ€è¦ä¸‹è½½â€œLooksMenuæè„¸èœå•==&gt;ç‚¹æˆ‘ä¸‹è½½â€ã€‚ä½¿ç”¨è¯´æ˜ŽNMMè‡ªåŠ¨å®‰è£…æ–¹æ³•ï¼šç‚¹æˆ‘ä¸‹è½½NMM1ã€æ·»åŠ åŽ‹ç¼©åŒ…åˆ°NMM(åˆ—è¡¨ä¸­å‡ºçŽ°)ï¼› 2ã€åŒå‡»åˆ—è¡¨å®‰è£…ï¼› 3ã€è¿›å…¥æ¸¸æˆå³å¯ã€‚ **æ‰‹åŠ¨å®‰è£…æ–¹æ³•(ä¸æŽ¨è)ï¼š** 1ã€è§£åŽ‹ç¼©ï¼› 2ã€å°†dataæ–‡ä»¶å¤¹å¤åˆ¶åˆ°æ¸¸æˆæ ¹ç›®å½•ï¼› 3ã€ç”¨MODç®¡ç†å™¨åŠ è½½ESPï¼› 4ã€è¿›å…¥æ¸¸æˆä¸­å³å¯ã€‚ æ¼”ç¤ºè§†é¢‘åˆ†æµç™¾åº¦ç½‘ç›˜(æå–ç ï¼šbr93)æœ¬åœ°ç”µä¿¡ç½‘é€šé«˜é€Ÿä¸‹è½½ç”µä¿¡ä¸‹è½½è”é€šä¸‹è½½]]></content>
      <categories>
        <category>Mod</category>
      </categories>
      <tags>
        <tag>Games</tag>
        <tag>Pc</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç»™hexoåšå®¢nextä¸»é¢˜æ·»åŠ èƒŒæ™¯éŸ³ä¹]]></title>
    <url>%2Fposts%2F96f89d1%2F</url>
    <content type="text"><![CDATA[è¯·è®¿é—®æˆ‘çš„ä¸ªäººåšå®¢ sourcodæˆ‘çš„hexoåšå®¢ä½¿ç”¨çš„æ˜¯nextä¸»é¢˜æ‰€æœ‰æ¬¡æ•™ç¨‹åœ¨nextä¸»é¢˜ä¸Šä¿®æ”¹ã€‚ä¿®æ”¹ themes/next/layout/_macro/sidebar.swig æ–‡ä»¶æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨å†…å®¹åœ¨ themes/next/_config.yml é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ­Œå•åœ°å€é…ç½®background_music: //music.163.com/outchain/player?type=0&amp;amp;id=2120628564&amp;amp;auto=1&amp;amp;height=66æ³¨å†Œç½‘æ˜“äº‘éŸ³ä¹è‡ªå·±ç ”ç©¶åˆ›å»ºæ­Œå•è‡ªå·±ç ”ç©¶ç»™æ­Œå•æ·»åŠ è‡ªå·±å–œæ¬¢çš„éŸ³ä¹çœ‹ä½ è‡ªå·±äº†åˆ†äº«æ­Œå•ä¸ä¼šèŽ·å–å¤–é“¾çš„è¯·ä¸Šåº¦å¨˜: æ€Žä¹ˆæŠŠè‡ªå·±çš„æ­Œå•åšæˆå¤–é“¾èŽ·å–å¤–é“¾æ’­æ”¾å™¨æŠŠåœ°å€copyå‡ºæ¥height=90æ”¹æˆ 66è¿™æ ·ä»¥åŽåªéœ€è¦ä¿®æ”¹ç½‘æ˜“äº‘éŸ³ä¹çš„æ­Œå•ï¼Œåšå®¢çš„èƒŒæ™¯éŸ³ä¹å°±ä¼šè‡ªåŠ¨ä¿®æ”¹äº†ã€‚å¦‚æžœå‡ºçŽ°éŸ³ä¹ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œé‚£æ˜¯èµ„æºçš„é—®é¢˜ï¼Œè‡ªå·±ä¸Šç½‘æ˜“äº‘éŸ³ä¹ç”Ÿæˆå¤–é“¾çš„é¡µé¢çœ‹çœ‹ä¼šä¸ä¼šè‡ªåŠ¨æ’­æ”¾ã€‚æŠŠåèµ„æºåˆ é™¤å°±OKäº†ã€‚ä¿®æ”¹å®Œæˆ‘çš„åšå®¢çš„æ•ˆæžœ]]></content>
      <categories>
        <category>Hexoæ•™ç¨‹</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é—®é“]]></title>
    <url>%2Fposts%2Fa3b6fe04%2F</url>
    <content type="text"><![CDATA[æ¸¸æˆèƒŒæ™¯ä»‹ç»é¸¿è’™å¼€åŒ–ä¹‹åˆï¼Œä¸­å·žå¤§é™†æ˜†ä»‘ä¹‹é¢ çš„é¸¿é’§ä¸Šäººåˆ›ç«‹é“æ•™ï¼Œå¹¶æ”¶å¾’ä¸‰äººï¼Œå„æŽˆä»¥é“é—¨ç»æŠ€ï¼Œä¸‰å¾’çš†ä¿®æˆæ··å…ƒå¤§ç½—é‡‘ä»™ä¸‡åŠ«ä¸åä¹‹ä½“ï¼Œåˆ†åˆ«å‘å±•å‡ºé“æ•™çš„äººé“ã€é˜æ•™å’Œæˆªæ•™ä¸‰ä¸ªåˆ†æ”¯ã€‚æ­¤ä¸‰å¾’æ­£æ˜¯äººé“æ•™ä¸»å¤ªä¸Šè€å›ã€é˜æ•™æ•™ä¸»å…ƒå§‹å¤©å°Šå’Œæˆªæ•™çš„é€šå¤©æ•™ä¸»ã€‚ä¸‰æ•™ä¸»ç§‰æ‰¿å¸ˆçˆ¶é¸¿é’§ä¸Šäººæ•™è¯²ï¼Œå¹¿æ”¶é—¨å¾’å°†é“æ•™æµä¼ äºŽä¸–ã€‚åªå› å…¥é“é—¨ä¸­å³å¯ä¿®ä»™ï¼Œä½¿äººè·³å‡ºä¸‰ç•Œä¹‹å¤–ï¼Œä¸åœ¨äº”è¡Œä¹‹ä¸­ï¼Œå…é™¤ç”Ÿæ­»è½®å›žä¹‹è‹¦ï¼Œä½¿å¾—å…¥é“ä¿®è¡Œä¹‹äººå¤šä¸èƒœæ•°ã€‚ä½†ä¿®ä»™ä¹‹é“å¹¶éžè‹¦å¿ƒä¿®ç‚¼ä¾¿å¯è¾¾æˆï¼Œä¿®è¡Œè·¯ä¸Šï¼Œå‡è¦ç»åŽ†ä¸‰ç™¾å¹´ä¸€å°åŠ«ï¼Œä¸€åƒäº”ç™¾å¹´ä¸€å¤§åŠ«çš„åŠ«æ•°ã€‚ä¿®è¡Œä¹‹äººå‡æ— æ³•é¿å¼€åŠ«æ•°ï¼Œåªèƒ½æ ¹æ®è‡ªèº«é“è¡Œçš„æ·±æµ…åŽ»ç»åŽ†åŠ«æ•°ã€‚å€¼å•†å‘¨ä¸¤æœäº¤æ›¿ä¹‹æ—¶ï¼Œæ°é€¢ä¿®ä»™ä¸€åƒäº”ç™¾å¹´ä»™åŠ«ï¼ŒäºŽæ˜¯ä¸‰æ•™ä¸»å…±è®®å°ç¥žæ¦œï¼Œä»¥è§‚ä¼—ä»™æ ¹è¡Œæµ…æ·±ã€‚ç„¶åŠ«æ•°éš¾é€ƒï¼Œå°ç¥žä¸€å½¹ï¼Œè‡´ä½¿é“é—¨å†…éƒ¨é˜æ•™å’Œæˆªæ•™ä¸å’Œï¼Œä¿®ä»™ä¼—äººä¿±é­å± æˆ®ï¼Œæ›´å¼•æ¥è¥¿æ–¹æ•™æ´¾å‚ä¸Žçº·äº‰ï¼ŒåŽå› é¸¿é’§ä¸Šäººäº²è‡ªå‡ºé¢è°ƒåœï¼Œç»ˆå¾—ä»¥å¹³æ¯ã€‚é€šå¤©æ•™ä¸»è¢«é¸¿é’§ä¸Šäººç¦åˆ¶åœ¨ç´«éœ„å®«æ˜†ä»‘ä¹‹é¢ ä¿®è¡Œæ€è¿‡ã€‚æ—¶å…‰å¦‚æ¢­ï¼Œè½¬çœ¼å·²è¿‡åƒå¹´ï¼Œå¸ˆå°Šé¸¿é’§ä¸Šäººå¤–å‡ºäº‘æ¸¸ï¼Œä¸çŸ¥æ‰€è¸ªã€‚è€Œé€šå¤©ä»¿ä½›å·²ç»ä¹ æƒ¯äº†è¿™ç§è¢«ç¦å›ºçš„ç”Ÿæ´»ï¼Œé™¤äº†æ¯æ—¥çš„å¿…åšçš„ä¿®çœŸç‚¼æ°”å’Œé™è¯µã€Šé»„åº­ã€‹ï¼Œä»–æ›´å¤šçš„æ—¶é—´æ€»æ˜¯åœ¨æ–­å´–è¾¹é™é™åç€ã€‚ä¹Ÿè®¸åªæœ‰è¿™ä¸ªæ—¶åˆ»ï¼Œä»–æ‰èƒ½çœŸçœŸå®žå®žåœ°æ„Ÿè§‰åˆ°è‡ªå·±çš„å­˜åœ¨ï¼Œåƒå¹´çš„è‹¦è¡Œä½¿ä»–çš„ä¿®ä¸ºå€å¢žï¼ŒåŒæ—¶ä¹Ÿè®©ä»–é¥±å—äº†å­¤å•å’Œå¯‚å¯žï¼Œä»–å·²ç»å¾ˆä¹…æ²¡æœ‰è¯´è¿‡ä¸€å¥è¯äº†ï¼Œå¾ˆä¹…æ˜¯å¤šä¹…ï¼Œä»–è‡ªå·±ä¹Ÿä¸çŸ¥é“ï¼Œä»–åªçŸ¥é“ä»–åœ¨ç­‰ï¼Œä»–ä»¬éƒ½åœ¨ç­‰ã€‚.ç©ºæ—·çš„æ–­å´–è¾¹ï¼Œä¸€ä¸ªäººå½±ä¼«ç«‹ï¼Œè‰¯ä¹…ï¼Œä¸€åŠ¨ä¸åŠ¨ã€‚å±±é£ŽåŠ²è¢­ï¼ŒäººçŠ¹å¦‚ä¸Žå±±æµ‘ç„¶ä¸€ä½“ï¼Œä»æ˜¯ä¸€åŠ¨ä¸åŠ¨ï¼Œåšæ¯…çš„é¢å®¹æ¯«æ— è¡¨æƒ…ï¼Œåªæœ‰æ˜Žäº®çš„åŒçœ¸åœ¨é»‘å¤œå°è¡¬ä¸‹å¯’å…‰é—ªçŽ°ï¼Œçœºæœ›ç€è¿œæ–¹ã€‚è¿œå¤„ï¼Œéª·é«…å±±é¡¶ï¼Œä¸€å—é¡½çŸ³å¥½è±¡åŠ¨äº†ä¸€åŠ¨ï¼ŒåˆåŠ¨äº†ä¸€åŠ¨ï¼Œä»¿ä½›æœ‰äº†å‘¼å¸ã€‚æ…¢æ…¢åœ°ï¼Œé¡½çŸ³å‘¨å›´ç«Ÿç„¶å¿½éšå¿½çŽ°å‡ºç€çŽ„é»„è‰²çš„å…‰èŠ’ï¼Œæœ€ç»ˆå¹»åŒ–ä¸ºä¸€ä¸ªäººå½¢çš„å…‰å›¢ï¼Œç¼“ç¼“é£˜å‘å±±åŽçš„å¹½å†¥æ¶§ã€‚æ­¤æ—¶ï¼Œäººå½±çš„è‹ç™½é¢å®¹ä¸Šæµ®çŽ°å‡ºå¥‡æ€ªçš„ç¬‘æ„ï¼Œä»¤äººä¸å¯’è€Œæ —ï¼Œä»–æ˜¯é€šå¤©ã€‚äº”ç™¾å¹´åŽçš„ä¸­æ´²å¤§é™†ã€‚åœ¨ä¸œæµ·æ¸”æ‘ï¼Œä¸–ä¸–ä»£ä»£ä»¥æ•é±¼ä¸ºç”Ÿçš„æ¸”æ°‘æœ‰ä¸€å¤©çªç„¶å‘çŽ°ç¦»ä»–ä»¬æ‘å­ä¸è¿œçš„æµ·é¢ä¸Šï¼Œç«Ÿç„¶å‡ºçŽ°ä¸€ä¸ªå¼‚å¸¸ç¾Žä¸½çš„ä»™å²›ã€‚åœ¨å¤©å¢‰åŸŽï¼Œç†™ç†™æ”˜æ”˜åœ°è¡—é“ä¸Šçªç„¶å¤šäº†ä¸€äº›èº«ç€å¥‡è£…å¥‡æœï¼Œè¡Œä¸ºä¸¾æ­¢ååˆ†å¯ç–‘ä¹‹äººã€‚åœ¨æ½ä»™é•‡ï¼Œä¸€ä¸ªå¹³å‡¡å†·æ¸…çš„å°é•‡ä¸Šçªç„¶é—´çƒ­é—¹äº†èµ·æ¥ï¼Œä»Žå››é¢å…«æ–¹èµ¶æ¥çš„ä¿Šç”·ç¾Žå¥³ç»œç»Žä¸ç»ã€‚æœ¬æ¥å¹³é™çš„ã€Šé—®é“ã€‹ä¸–ç•Œä¸­å‡ºçŽ°å„ç§å¼‚è±¡å’Œå¾å…†ï¼Œè€Œæ­¤æ—¶ï¼Œå‡†å¤‡ä¸€æŽ¢ç©¶ç«Ÿçš„çŽ©å®¶ï¼Œæ­£èµ¶å¾€æ½ä»™é•‡çš„é€”ä¸­ã€‚ [1]æˆªå›¾ä¸‹è½½å®¢æˆ·ç«¯ä¸‹è½½ç™»å½•å™¨ä¸‹è½½ç›®å‰åªæä¾›1.60.0905ç‰ˆæœ¬å®¢æˆ·ç«¯ç™¾åº¦äº‘ä¸‹è½½é“¾æŽ¥ðŸ”—ç™¾åº¦äº‘å¯†ç (kq7m)ä¸Žç‰ˆæœ¬å¯¹åº”çš„ç™»å½•å™¨ï¼ŒæœåŠ¡å™¨ä¸ºå…¬ç›Šæœï¼Œä¸åšä»»ä½•ç›ˆåˆ©å’Œä¸å…·å¤‡å•†ä¸šæ€§è´¨ï¼é“¾æŽ¥ï¼šhttps://pan.baidu.com/s/1RN4VX3bOwH61xC70t82dMwæå–ç ï¼š**å¤åˆ¶è¿™æ®µå†…å®¹åŽæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦æ›´å¤šèµ„è®¯: Deployment]]></content>
      <categories>
        <category>PC</category>
      </categories>
      <tags>
        <tag>online</tag>
        <tag>game</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2Fposts%2F4a17b156%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.Quick StartCreate a new post1$ hexo new "My New Post"More info: WritingRun server1$ hexo serverMore info: ServerGenerate static files1$ hexo generateMore info: GeneratingDeploy to remote sites1$ hexo deployæ›´å¤šèµ„è®¯: Deployment]]></content>
      <categories>
        <category>Diary</category>
      </categories>
      <tags>
        <tag>Diary</tag>
      </tags>
  </entry>
</search>
